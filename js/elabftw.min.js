/*! elabftw 20-04-2016 */
function deleteThis(id,type,redirect){var you_sure=confirm("Delete this ?");return you_sure!==!0?!1:void $.post("app/delete.php",{id:id,type:type}).done(function(){window.location=redirect})}function addDateOnCursor(){var todayDate=new Date,year=todayDate.getFullYear(),month=todayDate.getMonth()+1;10>month&&(month="0"+month);var day=todayDate.getDate();10>day&&(day="0"+day),tinyMCE.activeEditor.execCommand("mceInsertContent",!1,year+"-"+month+"-"+day+" ")}function notif(text,cssClass){var htmlText="<p>"+text+"</p>";"ok"===cssClass?overlayClass="overlay-ok":overlayClass="overlay-ko";var overlay=document.createElement("div");overlay.setAttribute("id","overlay"),overlay.setAttribute("class","overlay "+overlayClass),document.body.appendChild(overlay),document.getElementById("overlay").innerHTML=htmlText,window.setTimeout(removeNotif,2733)}function removeNotif(){$("#overlay").fadeOut(763,function(){$(this).remove()})}function getGetParameters(){var prmstr=window.location.search.substr(1);return null!==prmstr&&""!==prmstr?transformToAssocArray(prmstr):{}}function transformToAssocArray(prmstr){for(var params={},prmarr=prmstr.split("&"),i=0;i<prmarr.length;i++){var tmparr=prmarr[i].split("=");params[tmparr[0]]=tmparr[1]}return params}function isInt(n){return n%1===0}function toggleTodoList(){todoList=$("#todoList"),"none"===todoList.css("display")?todoList.css("display","inline"):todoList.css("display","none")}function showMol(molFileContent){var viewer=new ChemDoodle.ViewerCanvas(Math.random(),100,100);viewer.specs.bonds_width_2D=.6,viewer.specs.bonds_saturationWidth_2D=.18,viewer.specs.bonds_hashSpacing_2D=2.5,viewer.specs.atoms_font_size_2D=10,viewer.specs.atoms_font_families_2D=["Helvetica","Arial","sans-serif"],viewer.specs.atoms_displayTerminalCarbonLabels_2D=!0;var mol=ChemDoodle.readMOL(molFileContent);viewer.loadMolecule(mol)}function go_url(x){""!==x&&(window.location=x)}function updateVisibility(item,visibility){$.post("app/controllers/ExperimentsController.php",{updateVisibility:!0,id:item,visibility:visibility}).done(function(data){"0"===data?notif("There was an error!","ko"):notif("Visibility updated","ok")})}function updateStatus(item,status){$.post("app/controllers/ExperimentsController.php",{updateStatus:!0,id:item,status:status}).done(function(data){"0"===data?notif("There was an error!"):(notif("Status updated","ok"),$("#main_section").css("border",null),css="6px solid #"+data,$("#main_section").css("border-left",css))})}function createTag(e,item_id,type){var keynum;e.which&&(keynum=e.which),13==keynum&&(tag=$("#createTagInput").val(),$.post("app/controllers/EntityController.php",{createTag:!0,createTagTag:tag,createTagId:item_id,createTagType:type}).done(function(){"experiments"===type?$("#tags_div").load("experiments.php?mode=edit&id="+item_id+" #tags_div"):$("#tags_div").load("database.php?mode=edit&id="+item_id+" #tags_div"),$("#createTagInput").val("")}))}function experimentsCreateLink(e,item){var keynum;e.which&&(keynum=e.which),13==keynum&&(link=decodeURIComponent($("#linkinput").val()),link.length>0&&(link=parseInt(link,10),isNaN(link)!==!0&&$.post("app/controllers/ExperimentsController.php",{createLink:!0,id:item,linkId:link}).done(function(){return $("#links_div").load("experiments.php?mode=edit&id="+item+" #links_div"),$("#linkinput").val(""),!1})))}function experimentsDestroyLink(link,item,confirmText){var youSure=confirm(confirmText);return youSure===!0&&$.post("app/controllers/ExperimentsController.php",{destroyLink:!0,id:item,linkId:link}).done(function(data){"1"===data?(notif("Link removed","ok"),$("#links_div").load("experiments.php?mode=edit&id="+item+" #links_div")):notif("Something went wrong! :(","ko")}),!1}function commentsCreateButtonDivShow(){$("#commentsCreateButtonDiv").show()}function commentsCreate(id){return document.getElementById("commentsCreateButton").disabled=!0,comment=$("#commentsCreateArea").val(),comment.length<2?(notif("Comment too short!"),document.getElementById("commentsCreateButton").disabled=!1,!1):void $.post("app/controllers/CommentsController.php",{commentsCreate:!0,comment:comment,id:id}).done(function(data){data?(notif("Comment added","ok"),$("#expcomment_container").load("experiments.php?mode=view&id="+id+" #expcomment")):notif("There was an error!")})}function commentsDestroy(id,expId,confirmText){var you_sure=confirm(confirmText);return you_sure!==!0?!1:void $.post("app/controllers/CommentsController.php",{commentsDestroy:!0,id:id}).done(function(data){1==data?(notif("Comment deleted","ok"),$("#expcomment_container").load("experiments.php?mode=view&id="+expId+" #expcomment")):notif("Error while deleting comment","ko")})}function experimentsDestroy(id,confirmText){var you_sure=confirm(confirmText);return you_sure!==!0?!1:void $.post("app/controllers/ExperimentsController.php",{destroy:!0,id:id}).done(function(data){1==data?(notif("Experiment deleted","ok"),window.location.replace("experiments.php")):notif("Error while deleting experiment","ko")})}function databaseDestroy(id,confirmText){var you_sure=confirm(confirmText);return you_sure!==!0?!1:void $.post("app/controllers/DatabaseController.php",{destroy:!0,id:id}).done(function(data){1==data?(notif("Item deleted","ok"),window.location.replace("database.php")):notif("Error while deleting item","ko")})}function statusCreate(){name=$("#statusName").val(),color=$("#statusColor").val(),$.post("app/controllers/StatusController.php",{statusCreate:!0,statusName:name,statusColor:color}).done(function(data){data?(notif("Saved","ok"),window.location.replace("admin.php?tab=3")):notif("Error","ko")})}function statusUpdate(id){name=$("#statusName_"+id).val(),color=$("#statusColor_"+id).val(),defaultBox=$("#statusDefault_"+id).val(),$.post("app/controllers/StatusController.php",{statusUpdate:!0,statusId:id,statusName:name,statusColor:color,statusDefault:defaultBox}).done(function(data){data?(notif("Saved","ok"),window.location.replace("admin.php?tab=3")):notif("Error","ko")})}function itemsTypesCreate(){name=$("#itemsTypesName").val(),color=$("#itemsTypesColor").val(),template=tinymce.get("itemsTypesTemplate").getContent(),$.post("app/controllers/ItemsTypesController.php",{itemsTypesCreate:!0,itemsTypesName:name,itemsTypesColor:color,itemsTypesTemplate:template}).done(function(){notif("Saved","ok"),window.location.replace("admin.php?tab=4")})}function itemsTypesShowEditor(id){$("#itemsTypesEditor_"+id).toggle()}function itemsTypesUpdate(id){name=$("#itemsTypesName_"+id).val(),color=$("#itemsTypesColor_"+id).val(),template=tinymce.get("itemsTypesTemplate_"+id).getContent(),$.post("app/controllers/ItemsTypesController.php",{itemsTypesUpdate:!0,itemsTypesId:id,itemsTypesName:name,itemsTypesColor:color,itemsTypesTemplate:template}).done(function(){notif("Saved","ok")})}function itemsTypesDestroy(id){$.post("app/controllers/ItemsTypesController.php",{itemsTypesDestroy:!0,itemsTypesId:id}).done(function(){notif("Deleted","ok"),$("#itemstypes_"+id).hide()})}function commonTplUpdate(){template=tinymce.get("commonTplTemplate").getContent(),$.post("app/controllers/ConfigController.php",{commonTplUpdate:template}).done(function(){notif("Saved","ok")})}function teamGroupCreate(){var name=$("#teamGroupCreate").val();name.length>0&&$.post("app/controllers/TeamGroupsController.php",{teamGroupCreate:name}).done(function(){$("#team_groups_div").load("admin.php #team_groups_div"),$("#teamGroupCreate").val("")})}function teamGroupUpdate(action){"add"===action?(user=$("#teamGroupUserAdd").val(),group=$("#teamGroupGroupAdd").val()):(user=$("#teamGroupUserRm").val(),group=$("#teamGroupGroupRm").val()),$.post("app/controllers/TeamGroupsController.php",{teamGroupUpdate:!0,action:action,teamGroupUser:user,teamGroupGroup:group}).done(function(){$("#team_groups_div").load("admin.php #team_groups_div")})}function teamGroupDestroy(groupid,confirmText){var you_sure=confirm(confirmText);return you_sure===!0&&$.post("app/controllers/TeamGroupsController.php",{teamGroupDestroy:!0,teamGroupGroup:groupid}).done(function(){$("#team_groups_div").load("admin.php #team_groups_div")}),!1}function goNext(x){""!==x&&(document.cookie="itemType="+x,$(".import_block").show())}function promoteSysadmin(){document.getElementById("promoteSysadminButton").disabled=!0,email=$("#promoteSysadmin").val(),$.post("app/controllers/ConfigController.php",{promoteSysadmin:!0,email:email}).done(function(data){data?(notif("User promoted","ok"),$("#teamsDiv").load("sysconfig.php #teamsDiv")):notif("There was an error!")})}function teamsCreate(){document.getElementById("teamsCreateButton").disabled=!0,name=$("#teamsName").val(),$.post("app/controllers/ConfigController.php",{teamsCreate:!0,teamsName:name}).done(function(data){data?(notif("Team created","ok"),$("#teamsDiv").load("sysconfig.php #teamsDiv")):notif("There was an error!")})}function teamsUpdate(id){document.getElementById("teamsUpdateButton_"+id).disabled=!0,name=$("#team_"+id).val(),$.post("app/controllers/ConfigController.php",{teamsUpdate:!0,teamsUpdateId:id,teamsUpdateName:name}).done(function(data){data?(notif("Name updated","ok"),$("#teamsDiv").load("sysconfig.php #teamsDiv")):notif("Error","ko")})}function teamsDestroy(id){document.getElementById("teamsDestroyButton_"+id).disabled=!0,$.post("app/controllers/ConfigController.php",{teamsDestroy:!0,teamsDestroyId:id}).done(function(data){data?(notif("Team removed","ok"),$("#teamsDiv").load("sysconfig.php #teamsDiv")):notif("Team not removed because not empty!","ko")})}function teamsUpdateButtonEnable(id){button=document.getElementById("teamsUpdateButton_"+id).disabled=!1}function teamsArchive(id){document.getElementById("teamsArchiveButton_"+id).disabled=!0,$.post("app/controllers/ConfigController.php",{teamsArchive:!0,teamsArchiveId:id}).done(function(data){notif("Feature not yet implemented :)"),document.getElementById("teamsArchiveButton_"+id).disabled=!1})}function toggleMailMethod(value){"sendmail"==value?($("#smtp_config").hide(),$("#sendmail_config").show()):"smtp"==value?($("#smtp_config").show(),$("#sendmail_config").hide()):"php"==value?($("#smtp_config").hide(),$("#sendmail_config").hide(),$("#general_mail_config").show()):($("#smtp_config").hide(),$("#sendmail_config").hide(),$("#general_mail_config").hide())}function testemailSend(){email=$("#testemailEmail").val(),/\S+@\S+\.\S+/.test(email)?(document.getElementById("testemailButton").disabled=!0,$.post("app/controllers/ConfigController.php",{testemailSend:!0,testemailEmail:email}).done(function(data){"1"===data?(notif("Email sent!","ok"),document.getElementById("testemailButton").disabled=!1):notif("Something went wrong! :(","ko")})):notif("Email address looks weird","ko")}function logsDestroy(){document.getElementById("logsDestroyButton").disabled=!0,$.post("app/controllers/ConfigController.php",{logsDestroy:!0}).done(function(data){1==data?notif("All logs cleared","ok"):notif("Something went wrong! :(","ko"),$("#logsDiv").load("sysconfig.php #logsDiv")})}function uploadsDestroy(id,type,item_id,confirmText){var youSure=confirm(confirmText);youSure===!0&&$.post("app/controllers/EntityController.php",{uploadsDestroy:!0,id:id,item_id:item_id,type:type}).done(function(data){"1"===data?(notif("File removed","ok"),"items"===type&&(type="database"),$("#filesdiv").load(type+".php?mode=edit&id="+item_id+" #filesdiv")):notif("Something went wrong! :(<br>"+data,"ko")})}function updateRating(rating,id){$.post("app/controllers/DatabaseController.php",{rating:rating,id:id}).done(function(data){"1"===data?notif("Rating updated","ok"):notif("Something went wrong! :(","ko")})}function insertParamAndReload(key,value){key=escape(key),value=escape(value);var kvp=document.location.search.substr(1).split("&");if(""===kvp)document.location.search="?"+key+"="+value;else{for(var x,i=kvp.length;i--;)if(x=kvp[i].split("="),x[0]==key){x[1]=value,kvp[i]=x.join("=");break}0>i&&(kvp[kvp.length]=[key,value].join("=")),document.location.search=kvp.join("&")}}function readFile(file,onLoadCallback){if(!window.FileReader)return alert("Please use a modern web browser. Import aborted."),!1;var reader=new FileReader;reader.onload=onLoadCallback,reader.readAsText(file)}function exportTpl(name,id){var content=tinyMCE.get(id).getContent(),blob=new Blob([content],{type:"text/plain;charset=utf-8"});saveAs(blob,name+".elabftw.tpl")}function remove_surfaces(id){var view=$3Dmol.viewers[id];view.removeAllSurfaces(),view.render()}function show_cartoon(id,color){"string"!=typeof color&&(color="spectrum");var view=$3Dmol.viewers[id];view.setStyle({hetflag:!1},{cartoon:{color:color}}),view.render()}function show_stick(id){var view=$3Dmol.viewers[id];view.setStyle({},{stick:{}}),view.render()}function show_surface(id,opacity,color){var view=$3Dmol.viewers[id];"number"!=typeof opacity&&(opacity=1);"string"!=typeof color?view.addSurface($3Dmol.SurfaceType.MS,{opacity:opacity,map:{prop:"partialCharge",scheme:new $3Dmol.Gradient.RWB(-.6,.6)}},{hetflag:!1},{hetflag:!1}):view.addSurface($3Dmol.SurfaceType.MS,{opacity:opacity,color:color},{hetflag:!1},{hetflag:!1}),view.render()}var cornify_count=0;cornify_add=function(){cornify_count+=1;var cornify_url="http://www.cornify.com/",div=document.createElement("div");div.style.position="fixed";var numType="px",heightRandom=.75*Math.random(),windowHeight=768,windowWidth=1024,height=0,de=document.documentElement;"number"==typeof window.innerHeight?(windowHeight=window.innerHeight,windowWidth=window.innerWidth):de&&de.clientHeight?(windowHeight=de.clientHeight,windowWidth=de.clientWidth):(numType="%",height=Math.round(100*height)+"%"),div.onclick=cornify_add,div.style.zIndex=10,div.style.outline=0,15==cornify_count?(div.style.top=Math.max(0,Math.round((windowHeight-530)/2))+"px",div.style.left=Math.round((windowWidth-530)/2)+"px",div.style.zIndex=1e3):("px"==numType?div.style.top=Math.round(windowHeight*heightRandom)+numType:div.style.top=height,div.style.left=Math.round(90*Math.random())+"%");var img=document.createElement("img"),currentTime=new Date,submitTime=currentTime.getTime();15==cornify_count&&(submitTime=0),img.setAttribute("src",cornify_url+"getacorn.php?r="+submitTime);var ease="all .1s linear";div.style.WebkitTransition=ease,div.style.WebkitTransform="rotate(1deg) scale(1.01,1.01)",div.style.transition="all .1s linear",div.onmouseover=function(){var size=1+Math.round(10*Math.random())/100,angle=Math.round(20*Math.random()-10),result="rotate("+angle+"deg) scale("+size+","+size+")";this.style.transform=result,this.style.WebkitTransform=result},div.onmouseout=function(){var size=.9+Math.round(10*Math.random())/100,angle=Math.round(6*Math.random()-3),result="rotate("+angle+"deg) scale("+size+","+size+")";this.style.transform=result,this.style.WebkitTransform=result};var body=document.getElementsByTagName("body")[0];if(body.appendChild(div),div.appendChild(img),1==cornify_count){var cssExisting=document.getElementById("__cornify_css");if(!cssExisting){var head=document.getElementsByTagName("head")[0],css=document.createElement("link");css.id="__cornify_css",css.type="text/css",css.rel="stylesheet",css.href="css/cornify.css",css.media="screen",head.appendChild(css)}cornify_replace()}},cornify_replace=function(){for(var hs,h,k,hc=6,words=["Happy","Sparkly","Glittery","Fun","Magical","Lovely","Cute","Charming","Amazing","Wonderful"];hc>=1;){for(hs=document.getElementsByTagName("h"+hc),k=0;k<hs.length;k++)h=hs[k],h.innerHTML=words[Math.floor(Math.random()*words.length)]+" "+h.innerHTML;hc-=1}};var cornami={input:"",pattern:"38384040373937396665",clear:setTimeout("cornami.clear_input()",5e3),load:function(){window.document.onkeydown=function(e){return cornami.input==cornami.pattern?(cornify_add(),void clearTimeout(cornami.clear)):(cornami.input+=e?e.keyCode:event.keyCode,cornami.input==cornami.pattern&&cornify_add(),clearTimeout(cornami.clear),cornami.clear=setTimeout("cornami.clear_input()",5e3),void 0)}},clear_input:function(){cornami.input="",clearTimeout(cornami.clear)}};cornami.load(),window.jQuery&&function($){if(!$.support.opacity&&!$.support.style)try{document.execCommand("BackgroundImageCache",!1,!0)}catch(e){}$.fn.rating=function(options){if(0==this.length)return this;if("string"==typeof arguments[0]){if(this.length>1){var args=arguments;return this.each(function(){$.fn.rating.apply($(this),args)})}return $.fn.rating[arguments[0]].apply(this,$.makeArray(arguments).slice(1)||[]),this}var options=$.extend({},$.fn.rating.options,options||{});return $.fn.rating.calls++,this.not(".star-rating-applied").addClass("star-rating-applied").each(function(){var control,input=$(this),eid=(this.name||"unnamed-rating").replace(/\[|\]/g,"_").replace(/^\_+|\_+$/g,""),context=$(this.form||document.body),raters=context.data("rating");raters&&raters.call==$.fn.rating.calls||(raters={count:0,call:$.fn.rating.calls});var rater=raters[eid]||context.data("rating"+eid);rater&&(control=rater.data("rating")),rater&&control?control.count++:(control=$.extend({},options||{},($.metadata?input.metadata():$.meta?input.data():null)||{},{count:0,stars:[],inputs:[]}),control.serial=raters.count++,rater=$('<span class="star-rating-control"/>'),input.before(rater),rater.addClass("rating-to-be-drawn"),(input.attr("disabled")||input.hasClass("disabled"))&&(control.readOnly=!0),input.hasClass("required")&&(control.required=!0),rater.append(control.cancel=$('<div class="rating-cancel"><a title="'+control.cancel+'">'+control.cancelValue+"</a></div>").on("mouseover",function(){$(this).rating("drain"),$(this).addClass("star-rating-hover")}).on("mouseout",function(){$(this).rating("draw"),$(this).removeClass("star-rating-hover")}).on("click",function(){$(this).rating("select")}).data("rating",control)));var star=$('<div role="text" aria-label="'+this.title+'" class="star-rating rater-'+control.serial+'"><a title="'+(this.title||this.value)+'">'+this.value+"</a></div>");if(rater.append(star),this.id&&star.attr("id",this.id),this.className&&star.addClass(this.className),control.half&&(control.split=2),"number"==typeof control.split&&control.split>0){var stw=($.fn.width?star.width():0)||control.starWidth,spi=control.count%control.split,spw=Math.floor(stw/control.split);star.width(spw).find("a").css({"margin-left":"-"+spi*spw+"px"})}control.readOnly?star.addClass("star-rating-readonly"):star.addClass("star-rating-live").on("mouseover",function(){$(this).rating("fill"),$(this).rating("focus")}).on("mouseout",function(){$(this).rating("draw"),$(this).rating("blur")}).on("click",function(){$(this).rating("select")}),this.checked&&(control.current=star),"A"==this.nodeName&&$(this).hasClass("selected")&&(control.current=star),input.hide(),input.on("change.rating",function(event){return event.selfTriggered?!1:void $(this).rating("select")}),star.data("rating.input",input.data("rating.star",star)),control.stars[control.stars.length]=star[0],control.inputs[control.inputs.length]=input[0],control.rater=raters[eid]=rater,control.context=context,input.data("rating",control),rater.data("rating",control),star.data("rating",control),context.data("rating",raters),context.data("rating"+eid,rater)}),$(".rating-to-be-drawn").rating("draw").removeClass("rating-to-be-drawn"),this},$.extend($.fn.rating,{calls:0,focus:function(){var control=this.data("rating");if(!control)return this;if(!control.focus)return this;var input=$(this).data("rating.input")||$("INPUT"==this.tagName?this:null);control.focus&&control.focus.apply(input[0],[input.val(),$("a",input.data("rating.star"))[0]])},blur:function(){var control=this.data("rating");if(!control)return this;if(!control.blur)return this;var input=$(this).data("rating.input")||$("INPUT"==this.tagName?this:null);control.blur&&control.blur.apply(input[0],[input.val(),$("a",input.data("rating.star"))[0]])},fill:function(){var control=this.data("rating");return control?void(control.readOnly||(this.rating("drain"),this.prevAll().addBack().filter(".rater-"+control.serial).addClass("star-rating-hover"))):this},drain:function(){var control=this.data("rating");return control?void(control.readOnly||control.rater.children().filter(".rater-"+control.serial).removeClass("star-rating-on").removeClass("star-rating-hover")):this},draw:function(){var control=this.data("rating");if(!control)return this;this.rating("drain");var current=$(control.current),starson=current.length?current.prevAll().addBack().filter(".rater-"+control.serial):null;starson&&starson.addClass("star-rating-on"),control.cancel[control.readOnly||control.required?"hide":"show"](),this.siblings()[control.readOnly?"addClass":"removeClass"]("star-rating-readonly")},select:function(value,wantCallBack){var control=this.data("rating");if(!control)return this;if(!control.readOnly){if(control.current=null,"undefined"!=typeof value||this.length>1){if("number"==typeof value)return $(control.stars[value]).rating("select",void 0,wantCallBack);if("string"==typeof value)return $.each(control.stars,function(){$(this).data("rating.input").val()==value&&$(this).rating("select",void 0,wantCallBack)}),this}else control.current="INPUT"==this[0].tagName?this.data("rating.star"):this.is(".rater-"+control.serial)?this:null;this.data("rating",control),this.rating("draw");var current=$(control.current?control.current.data("rating.input"):null),lastipt=$(control.inputs).filter(":checked"),deadipt=$(control.inputs).not(current);return deadipt.prop("checked",!1),current.prop("checked",!0),$(current.length?current:lastipt).trigger({type:"change",selfTriggered:!0}),(wantCallBack||void 0==wantCallBack)&&control.callback&&control.callback.apply(current[0],[current.val(),$("a",control.current)[0]]),this}},readOnly:function(toggle,disable){var control=this.data("rating");return control?(control.readOnly=toggle||void 0==toggle?!0:!1,disable?$(control.inputs).attr("disabled","disabled"):$(control.inputs).removeAttr("disabled"),this.data("rating",control),void this.rating("draw")):this},disable:function(){this.rating("readOnly",!0,!0)},enable:function(){this.rating("readOnly",!1,!1)}}),$.fn.rating.options={cancel:"Cancel Rating",cancelValue:"",split:0,starWidth:16},$(function(){$("input[type=radio].star").rating()})}(jQuery),function(global){function index(array,item){for(var i=array.length;i--;)if(array[i]===item)return i;return-1}function compareArray(a1,a2){if(a1.length!=a2.length)return!1;for(var i=0;i<a1.length;i++)if(a1[i]!==a2[i])return!1;return!0}function updateModifierKey(event){for(k in _mods)_mods[k]=event[modifierMap[k]]}function dispatch(event){var key,handler,k,i,modifiersMatch,scope;if(key=event.keyCode,-1==index(_downKeys,key)&&_downKeys.push(key),(93==key||224==key)&&(key=91),key in _mods){_mods[key]=!0;for(k in _MODIFIERS)_MODIFIERS[k]==key&&(assignKey[k]=!0)}else if(updateModifierKey(event),assignKey.filter.call(this,event)&&key in _handlers)for(scope=getScope(),i=0;i<_handlers[key].length;i++)if(handler=_handlers[key][i],handler.scope==scope||"all"==handler.scope){modifiersMatch=handler.mods.length>0;for(k in _mods)(!_mods[k]&&index(handler.mods,+k)>-1||_mods[k]&&-1==index(handler.mods,+k))&&(modifiersMatch=!1);(0!=handler.mods.length||_mods[16]||_mods[18]||_mods[17]||_mods[91])&&!modifiersMatch||handler.method(event,handler)===!1&&(event.preventDefault?event.preventDefault():event.returnValue=!1,event.stopPropagation&&event.stopPropagation(),event.cancelBubble&&(event.cancelBubble=!0))}}function clearModifier(event){var k,key=event.keyCode,i=index(_downKeys,key);if(i>=0&&_downKeys.splice(i,1),(93==key||224==key)&&(key=91),key in _mods){_mods[key]=!1;for(k in _MODIFIERS)_MODIFIERS[k]==key&&(assignKey[k]=!1)}}function resetModifiers(){for(k in _mods)_mods[k]=!1;for(k in _MODIFIERS)assignKey[k]=!1}function assignKey(key,scope,method){var keys,mods;keys=getKeys(key),void 0===method&&(method=scope,scope="all");for(var i=0;i<keys.length;i++)mods=[],key=keys[i].split("+"),key.length>1&&(mods=getMods(key),key=[key[key.length-1]]),key=key[0],key=code(key),key in _handlers||(_handlers[key]=[]),_handlers[key].push({shortcut:keys[i],scope:scope,method:method,key:keys[i],mods:mods})}function unbindKey(key,scope){var multipleKeys,keys,i,j,obj,mods=[];for(multipleKeys=getKeys(key),j=0;j<multipleKeys.length;j++){if(keys=multipleKeys[j].split("+"),keys.length>1&&(mods=getMods(keys)),key=keys[keys.length-1],key=code(key),void 0===scope&&(scope=getScope()),!_handlers[key])return;for(i=0;i<_handlers[key].length;i++)obj=_handlers[key][i],obj.scope===scope&&compareArray(obj.mods,mods)&&(_handlers[key][i]={})}}function isPressed(keyCode){return"string"==typeof keyCode&&(keyCode=code(keyCode)),-1!=index(_downKeys,keyCode)}function getPressedKeyCodes(){return _downKeys.slice(0)}function filter(event){var tagName=(event.target||event.srcElement).tagName;return!("INPUT"==tagName||"SELECT"==tagName||"TEXTAREA"==tagName)}function setScope(scope){_scope=scope||"all"}function getScope(){return _scope||"all"}function deleteScope(scope){var key,handlers,i;for(key in _handlers)for(handlers=_handlers[key],i=0;i<handlers.length;)handlers[i].scope===scope?handlers.splice(i,1):i++}function getKeys(key){var keys;return key=key.replace(/\s/g,""),keys=key.split(","),""==keys[keys.length-1]&&(keys[keys.length-2]+=","),keys}function getMods(key){for(var mods=key.slice(0,key.length-1),mi=0;mi<mods.length;mi++)mods[mi]=_MODIFIERS[mods[mi]];return mods}function addEvent(object,event,method){object.addEventListener?object.addEventListener(event,method,!1):object.attachEvent&&object.attachEvent("on"+event,function(){method(window.event)})}function noConflict(){var k=global.key;return global.key=previousKey,k}var k,_handlers={},_mods={16:!1,18:!1,17:!1,91:!1},_scope="all",_MODIFIERS={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},_MAP={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},code=function(x){return _MAP[x]||x.toUpperCase().charCodeAt(0)},_downKeys=[];for(k=1;20>k;k++)_MAP["f"+k]=111+k;var modifierMap={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(k in _MODIFIERS)assignKey[k]=!1;addEvent(document,"keydown",function(event){dispatch(event)}),addEvent(document,"keyup",clearModifier),addEvent(window,"focus",resetModifiers);var previousKey=global.key;global.key=assignKey,global.key.setScope=setScope,global.key.getScope=getScope,global.key.deleteScope=deleteScope,global.key.filter=filter,global.key.isPressed=isPressed,global.key.getPressedKeyCodes=getPressedKeyCodes,global.key.noConflict=noConflict,global.key.unbind=unbindKey,"undefined"!=typeof module&&(module.exports=assignKey)}(this),$(function(){function remove($this){var parentId=$this.parent().attr("id");localStorage.removeItem("'"+parentId+"'"),$this.parent().fadeOut(function(){$this.parent().remove(),regenerate()})}function regenerate(){var $todoItemLi=$("#show-items li");order.length=0,$todoItemLi.each(function(){var id=$(this).attr("id");order.push(id)}),localStorage.setItem("todo-orders",order.join(","))}function clearAll(){var $todoListLi=$("#show-items li");order.length=0,localStorage.clear(),$todoListLi.remove()}var k,orderList,i=Number(localStorage.getItem("todo-counter"))+1,j=0,$form=$("#todo-form"),$itemList=($("#show-items li a"),$("#show-items")),$clearAll=$("#clear-all"),$newTodo=$("#todo"),order=[];for(orderList=localStorage.getItem("todo-orders"),orderList=orderList?orderList.split(","):[],j=0,k=orderList.length;k>j;j++)$itemList.append("<li id='"+orderList[j]+"'>"+localStorage.getItem(orderList[j])+" <a href='#'>X</a></li>");$form.submit(function(e){e.preventDefault(),""!==$newTodo.val()&&(localStorage.setItem("todo-"+i,$newTodo.val()),localStorage.setItem("todo-counter",i),$itemList.append("<li id='todo-"+i+"'><span class='editable'>"+localStorage.getItem("todo-"+i)+" </span><a href='#'>x</a></li>"),regenerate(),$("#todo-"+i).css("display","none").fadeIn(),$newTodo.val(""),i++)}),$itemList.delegate("a","click",function(e){var $this=$(this);e.preventDefault(),remove($this)}),$clearAll.click(function(e){e.preventDefault(),clearAll()}),$itemList.delegate("li","mouseover mouseout",function(event){var $this=$(this).find("a");"mouseover"===event.type?$this.stop(!0,!0).fadeIn():$this.stop(!0,!0).fadeOut()})}),function(r,G,f,v){var J=f("html"),n=f(r),p=f(G),b=f.fancybox=function(){b.open.apply(this,arguments)},I=navigator.userAgent.match(/msie/i),B=null,s=G.createTouch!==v,t=function(a){return a&&a.hasOwnProperty&&a instanceof f},q=function(a){return a&&"string"===f.type(a)},E=function(a){return q(a)&&0<a.indexOf("%")},l=function(a,d){var e=parseInt(a,10)||0;return d&&E(a)&&(e*=b.getViewport()[d]/100),Math.ceil(e)},w=function(a,b){return l(a,b)+"px"};f.extend(b,{version:"2.1.5",defaults:{padding:15,margin:20,width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,pixelRatio:1,autoSize:!0,autoHeight:!1,autoWidth:!1,autoResize:!0,autoCenter:!s,fitToView:!0,aspectRatio:!1,topRatio:.5,leftRatio:.5,scrolling:"auto",wrapCSS:"",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3e3,preload:3,modal:!1,loop:!0,ajax:{dataType:"html",headers:{"X-fancyBox":!0}},iframe:{scrolling:"auto",preload:!0},swf:{wmode:"transparent",allowfullscreen:"true",allowscriptaccess:"always"},keys:{next:{13:"left",34:"up",39:"left",40:"up"},prev:{8:"right",33:"down",37:"right",38:"down"},close:[27],play:[32],toggle:[70]},direction:{next:"left",prev:"right"},scrollOutside:!0,index:0,type:null,href:null,content:null,title:null,tpl:{wrap:'<div class="fancybox-wrap" tabIndex="-1"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe id="fancybox-frame{rnd}" name="fancybox-frame{rnd}" class="fancybox-iframe" frameborder="0" vspace="0" hspace="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen'+(I?' allowtransparency="true"':"")+"></iframe>",error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<a title="Close" class="fancybox-item fancybox-close" href="javascript:;"></a>',next:'<a title="Next" class="fancybox-nav fancybox-next" href="javascript:;"><span></span></a>',prev:'<a title="Previous" class="fancybox-nav fancybox-prev" href="javascript:;"><span></span></a>'},openEffect:"fade",openSpeed:250,openEasing:"swing",openOpacity:!0,openMethod:"zoomIn",closeEffect:"fade",closeSpeed:250,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:250,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:250,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:!0,title:!0},onCancel:f.noop,beforeLoad:f.noop,afterLoad:f.noop,beforeShow:f.noop,afterShow:f.noop,beforeChange:f.noop,beforeClose:f.noop,afterClose:f.noop},group:{},opts:{},previous:null,coming:null,current:null,isActive:!1,isOpen:!1,isOpened:!1,wrap:null,skin:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(a,d){return a&&(f.isPlainObject(d)||(d={}),!1!==b.close(!0))?(f.isArray(a)||(a=t(a)?f(a).get():[a]),f.each(a,function(e,c){var g,h,j,m,l,k={};"object"===f.type(c)&&(c.nodeType&&(c=f(c)),t(c)?(k={href:c.data("fancybox-href")||c.attr("href"),title:c.data("fancybox-title")||c.attr("title"),isDom:!0,element:c},f.metadata&&f.extend(!0,k,c.metadata())):k=c),g=d.href||k.href||(q(c)?c:null),h=d.title!==v?d.title:k.title||"",m=(j=d.content||k.content)?"html":d.type||k.type,!m&&k.isDom&&(m=c.data("fancybox-type"),m||(m=(m=c.prop("class").match(/fancybox\.(\w+)/))?m[1]:null)),q(g)&&(m||(b.isImage(g)?m="image":b.isSWF(g)?m="swf":"#"===g.charAt(0)?m="inline":q(c)&&(m="html",j=c)),"ajax"===m&&(l=g.split(/\s+/,2),g=l.shift(),l=l.shift())),j||("inline"===m?g?j=f(q(g)?g.replace(/.*(?=#[^\s]+$)/,""):g):k.isDom&&(j=c):"html"===m?j=g:!m&&!g&&k.isDom&&(m="inline",
j=c)),f.extend(k,{href:g,type:m,content:j,title:h,selector:l}),a[e]=k}),b.opts=f.extend(!0,{},b.defaults,d),d.keys!==v&&(b.opts.keys=d.keys?f.extend({},b.defaults.keys,d.keys):!1),b.group=a,b._start(b.opts.index)):void 0},cancel:function(){var a=b.coming;a&&!1!==b.trigger("onCancel")&&(b.hideLoading(),b.ajaxLoad&&b.ajaxLoad.abort(),b.ajaxLoad=null,b.imgPreload&&(b.imgPreload.onload=b.imgPreload.onerror=null),a.wrap&&a.wrap.stop(!0,!0).trigger("onReset").remove(),b.coming=null,b.current||b._afterZoomOut(a))},close:function(a){b.cancel(),!1!==b.trigger("beforeClose")&&(b.unbindEvents(),b.isActive&&(b.isOpen&&!0!==a?(b.isOpen=b.isOpened=!1,b.isClosing=!0,f(".fancybox-item, .fancybox-nav").remove(),b.wrap.stop(!0,!0).removeClass("fancybox-opened"),b.transitions[b.current.closeMethod]()):(f(".fancybox-wrap").stop(!0).trigger("onReset").remove(),b._afterZoomOut())))},play:function(a){var d=function(){clearTimeout(b.player.timer)},e=function(){d(),b.current&&b.player.isActive&&(b.player.timer=setTimeout(b.next,b.current.playSpeed))},c=function(){d(),p.unbind(".player"),b.player.isActive=!1,b.trigger("onPlayEnd")};!0===a||!b.player.isActive&&!1!==a?b.current&&(b.current.loop||b.current.index<b.group.length-1)&&(b.player.isActive=!0,p.bind({"onCancel.player beforeClose.player":c,"onUpdate.player":e,"beforeLoad.player":d}),e(),b.trigger("onPlayStart")):c()},next:function(a){var d=b.current;d&&(q(a)||(a=d.direction.next),b.jumpto(d.index+1,a,"next"))},prev:function(a){var d=b.current;d&&(q(a)||(a=d.direction.prev),b.jumpto(d.index-1,a,"prev"))},jumpto:function(a,d,e){var c=b.current;c&&(a=l(a),b.direction=d||c.direction[a>=c.index?"next":"prev"],b.router=e||"jumpto",c.loop&&(0>a&&(a=c.group.length+a%c.group.length),a%=c.group.length),c.group[a]!==v&&(b.cancel(),b._start(a)))},reposition:function(a,d){var k,e=b.current,c=e?e.wrap:null;c&&(k=b._getPosition(d),a&&"scroll"===a.type?(delete k.position,c.stop(!0,!0).animate(k,200)):(c.css(k),e.pos=f.extend({},e.dim,k)))},update:function(a){var d=a&&a.type,e=!d||"orientationchange"===d;e&&(clearTimeout(B),B=null),b.isOpen&&!B&&(B=setTimeout(function(){var c=b.current;c&&!b.isClosing&&(b.wrap.removeClass("fancybox-tmp"),(e||"load"===d||"resize"===d&&c.autoResize)&&b._setDimension(),"scroll"===d&&c.canShrink||b.reposition(a),b.trigger("onUpdate"),B=null)},e&&!s?0:300))},toggle:function(a){b.isOpen&&(b.current.fitToView="boolean"===f.type(a)?a:!b.current.fitToView,s&&(b.wrap.removeAttr("style").addClass("fancybox-tmp"),b.trigger("onUpdate")),b.update())},hideLoading:function(){p.unbind(".loading"),f("#fancybox-loading").remove()},showLoading:function(){var a,d;b.hideLoading(),a=f('<div id="fancybox-loading"><div></div></div>').click(b.cancel).appendTo("body"),p.bind("keydown.loading",function(a){27===(a.which||a.keyCode)&&(a.preventDefault(),b.cancel())}),b.defaults.fixed||(d=b.getViewport(),a.css({position:"absolute",top:.5*d.h+d.y,left:.5*d.w+d.x}))},getViewport:function(){var a=b.current&&b.current.locked||!1,d={x:n.scrollLeft(),y:n.scrollTop()};return a?(d.w=a[0].clientWidth,d.h=a[0].clientHeight):(d.w=s&&r.innerWidth?r.innerWidth:n.width(),d.h=s&&r.innerHeight?r.innerHeight:n.height()),d},unbindEvents:function(){b.wrap&&t(b.wrap)&&b.wrap.unbind(".fb"),p.unbind(".fb"),n.unbind(".fb")},bindEvents:function(){var d,a=b.current;a&&(n.bind("orientationchange.fb"+(s?"":" resize.fb")+(a.autoCenter&&!a.locked?" scroll.fb":""),b.update),(d=a.keys)&&p.bind("keydown.fb",function(e){var c=e.which||e.keyCode,k=e.target||e.srcElement;return 27===c&&b.coming?!1:void(!e.ctrlKey&&!e.altKey&&!e.shiftKey&&!e.metaKey&&(!k||!k.type&&!f(k).is("[contenteditable]"))&&f.each(d,function(d,k){return 1<a.group.length&&k[c]!==v?(b[d](k[c]),e.preventDefault(),!1):-1<f.inArray(c,k)?(b[d](),e.preventDefault(),!1):void 0}))}),f.fn.mousewheel&&a.mouseWheel&&b.wrap.bind("mousewheel.fb",function(d,c,k,g){for(var h=f(d.target||null),j=!1;h.length&&!j&&!h.is(".fancybox-skin")&&!h.is(".fancybox-wrap");)j=h[0]&&!(h[0].style.overflow&&"hidden"===h[0].style.overflow)&&(h[0].clientWidth&&h[0].scrollWidth>h[0].clientWidth||h[0].clientHeight&&h[0].scrollHeight>h[0].clientHeight),h=f(h).parent();0!==c&&!j&&1<b.group.length&&!a.canShrink&&(g>0||k>0?b.prev(g>0?"down":"left"):(0>g||0>k)&&b.next(0>g?"up":"right"),d.preventDefault())}))},trigger:function(a,d){var e,c=d||b.coming||b.current;if(c){if(f.isFunction(c[a])&&(e=c[a].apply(c,Array.prototype.slice.call(arguments,1))),!1===e)return!1;c.helpers&&f.each(c.helpers,function(d,e){e&&b.helpers[d]&&f.isFunction(b.helpers[d][a])&&b.helpers[d][a](f.extend(!0,{},b.helpers[d].defaults,e),c)}),p.trigger(a)}},isImage:function(a){return q(a)&&a.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg)((\?|#).*)?$)/i)},isSWF:function(a){return q(a)&&a.match(/\.(swf)((\?|#).*)?$/i)},_start:function(a){var e,c,d={};if(a=l(a),e=b.group[a]||null,!e)return!1;if(d=f.extend(!0,{},b.opts,e),e=d.margin,c=d.padding,"number"===f.type(e)&&(d.margin=[e,e,e,e]),"number"===f.type(c)&&(d.padding=[c,c,c,c]),d.modal&&f.extend(!0,d,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,mouseWheel:!1,keys:null,helpers:{overlay:{closeClick:!1}}}),d.autoSize&&(d.autoWidth=d.autoHeight=!0),"auto"===d.width&&(d.autoWidth=!0),"auto"===d.height&&(d.autoHeight=!0),d.group=b.group,d.index=a,b.coming=d,!1===b.trigger("beforeLoad"))b.coming=null;else{if(c=d.type,e=d.href,!c)return b.coming=null,b.current&&b.router&&"jumpto"!==b.router?(b.current.index=a,b[b.router](b.direction)):!1;if(b.isActive=!0,("image"===c||"swf"===c)&&(d.autoHeight=d.autoWidth=!1,d.scrolling="visible"),"image"===c&&(d.aspectRatio=!0),"iframe"===c&&s&&(d.scrolling="scroll"),d.wrap=f(d.tpl.wrap).addClass("fancybox-"+(s?"mobile":"desktop")+" fancybox-type-"+c+" fancybox-tmp "+d.wrapCSS).appendTo(d.parent||"body"),f.extend(d,{skin:f(".fancybox-skin",d.wrap),outer:f(".fancybox-outer",d.wrap),inner:f(".fancybox-inner",d.wrap)}),f.each(["Top","Right","Bottom","Left"],function(a,b){d.skin.css("padding"+b,w(d.padding[a]))}),b.trigger("onReady"),"inline"===c||"html"===c){if(!d.content||!d.content.length)return b._error("content")}else if(!e)return b._error("href");"image"===c?b._loadImage():"ajax"===c?b._loadAjax():"iframe"===c?b._loadIframe():b._afterLoad()}},_error:function(a){f.extend(b.coming,{type:"html",autoWidth:!0,autoHeight:!0,minWidth:0,minHeight:0,scrolling:"no",hasError:a,content:b.coming.tpl.error}),b._afterLoad()},_loadImage:function(){var a=b.imgPreload=new Image;a.onload=function(){this.onload=this.onerror=null,b.coming.width=this.width/b.opts.pixelRatio,b.coming.height=this.height/b.opts.pixelRatio,b._afterLoad()},a.onerror=function(){this.onload=this.onerror=null,b._error("image")},a.src=b.coming.href,!0!==a.complete&&b.showLoading()},_loadAjax:function(){var a=b.coming;b.showLoading(),b.ajaxLoad=f.ajax(f.extend({},a.ajax,{url:a.href,error:function(a,e){b.coming&&"abort"!==e?b._error("ajax",a):b.hideLoading()},success:function(d,e){"success"===e&&(a.content=d,b._afterLoad())}}))},_loadIframe:function(){var a=b.coming,d=f(a.tpl.iframe.replace(/\{rnd\}/g,(new Date).getTime())).attr("scrolling",s?"auto":a.iframe.scrolling).attr("src",a.href);f(a.wrap).bind("onReset",function(){try{f(this).find("iframe").hide().attr("src","//about:blank").end().empty()}catch(a){}}),a.iframe.preload&&(b.showLoading(),d.one("load",function(){f(this).data("ready",1),s||f(this).bind("load.fb",b.update),f(this).parents(".fancybox-wrap").width("100%").removeClass("fancybox-tmp").show(),b._afterLoad()})),a.content=d.appendTo(a.inner),a.iframe.preload||b._afterLoad()},_preloadImages:function(){var f,g,a=b.group,d=b.current,e=a.length,c=d.preload?Math.min(d.preload,e-1):0;for(g=1;c>=g;g+=1)f=a[(d.index+g)%e],"image"===f.type&&f.href&&((new Image).src=f.href)},_afterLoad:function(){var e,c,k,g,h,a=b.coming,d=b.current;if(b.hideLoading(),a&&!1!==b.isActive)if(!1===b.trigger("afterLoad",a,d))a.wrap.stop(!0).trigger("onReset").remove(),b.coming=null;else{switch(d&&(b.trigger("beforeChange",d),d.wrap.stop(!0).removeClass("fancybox-opened").find(".fancybox-item, .fancybox-nav").remove()),b.unbindEvents(),e=a.content,c=a.type,k=a.scrolling,f.extend(b,{wrap:a.wrap,skin:a.skin,outer:a.outer,inner:a.inner,current:a,previous:d}),g=a.href,c){case"inline":case"ajax":case"html":a.selector?e=f("<div>").html(e).find(a.selector):t(e)&&(e.data("fancybox-placeholder")||e.data("fancybox-placeholder",f('<div class="fancybox-placeholder"></div>').insertAfter(e).hide()),e=e.show().detach(),a.wrap.bind("onReset",function(){f(this).find(e).length&&e.hide().replaceAll(e.data("fancybox-placeholder")).data("fancybox-placeholder",!1)}));break;case"image":e=a.tpl.image.replace("{href}",g);break;case"swf":e='<object id="fancybox-swf" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="'+g+'"></param>',h="",f.each(a.swf,function(a,b){e+='<param name="'+a+'" value="'+b+'"></param>',h+=" "+a+'="'+b+'"'}),e+='<embed src="'+g+'" type="application/x-shockwave-flash" width="100%" height="100%"'+h+"></embed></object>"}(!t(e)||!e.parent().is(a.inner))&&a.inner.append(e),b.trigger("beforeShow"),a.inner.css("overflow","yes"===k?"scroll":"no"===k?"hidden":k),b._setDimension(),b.reposition(),b.isOpen=!1,b.coming=null,b.bindEvents(),b.isOpened?d.prevMethod&&b.transitions[d.prevMethod]():f(".fancybox-wrap").not(a.wrap).stop(!0).trigger("onReset").remove(),b.transitions[b.isOpened?a.nextMethod:a.openMethod](),b._preloadImages()}},_setDimension:function(){var v,z,t,C,A,F,B,D,H,a=b.getViewport(),d=0,e=!1,c=!1,e=b.wrap,k=b.skin,g=b.inner,h=b.current,c=h.width,j=h.height,m=h.minWidth,u=h.minHeight,n=h.maxWidth,p=h.maxHeight,s=h.scrolling,q=h.scrollOutside?h.scrollbarWidth:0,x=h.margin,y=l(x[1]+x[3]),r=l(x[0]+x[2]);if(e.add(k).add(g).width("auto").height("auto").removeClass("fancybox-tmp"),x=l(k.outerWidth(!0)-k.width()),v=l(k.outerHeight(!0)-k.height()),z=y+x,t=r+v,C=E(c)?(a.w-z)*l(c)/100:c,A=E(j)?(a.h-t)*l(j)/100:j,"iframe"===h.type){if(H=h.content,h.autoHeight&&1===H.data("ready"))try{H[0].contentWindow.document.location&&(g.width(C).height(9999),F=H.contents().find("body"),q&&F.css("overflow-x","hidden"),A=F.outerHeight(!0))}catch(G){}}else(h.autoWidth||h.autoHeight)&&(g.addClass("fancybox-tmp"),h.autoWidth||g.width(C),h.autoHeight||g.height(A),h.autoWidth&&(C=g.width()),h.autoHeight&&(A=g.height()),g.removeClass("fancybox-tmp"));if(c=l(C),j=l(A),D=C/A,m=l(E(m)?l(m,"w")-z:m),n=l(E(n)?l(n,"w")-z:n),u=l(E(u)?l(u,"h")-t:u),p=l(E(p)?l(p,"h")-t:p),F=n,B=p,h.fitToView&&(n=Math.min(a.w-z,n),p=Math.min(a.h-t,p)),z=a.w-y,r=a.h-r,h.aspectRatio?(c>n&&(c=n,j=l(c/D)),j>p&&(j=p,c=l(j*D)),m>c&&(c=m,j=l(c/D)),u>j&&(j=u,c=l(j*D))):(c=Math.max(m,Math.min(c,n)),h.autoHeight&&"iframe"!==h.type&&(g.width(c),j=g.height()),j=Math.max(u,Math.min(j,p))),h.fitToView)if(g.width(c).height(j),e.width(c+x),a=e.width(),y=e.height(),h.aspectRatio)for(;(a>z||y>r)&&c>m&&j>u&&!(19<d++);)j=Math.max(u,Math.min(p,j-10)),c=l(j*D),m>c&&(c=m,j=l(c/D)),c>n&&(c=n,j=l(c/D)),g.width(c).height(j),e.width(c+x),a=e.width(),y=e.height();else c=Math.max(m,Math.min(c,c-(a-z))),j=Math.max(u,Math.min(j,j-(y-r)));q&&"auto"===s&&A>j&&z>c+x+q&&(c+=q),g.width(c).height(j),e.width(c+x),a=e.width(),y=e.height(),e=(a>z||y>r)&&c>m&&j>u,c=h.aspectRatio?F>c&&B>j&&C>c&&A>j:(F>c||B>j)&&(C>c||A>j),f.extend(h,{dim:{width:w(a),height:w(y)},origWidth:C,origHeight:A,canShrink:e,canExpand:c,wPadding:x,hPadding:v,wrapSpace:y-k.outerHeight(!0),skinSpace:k.height()-j}),!H&&h.autoHeight&&j>u&&p>j&&!c&&g.height("auto")},_getPosition:function(a){var d=b.current,e=b.getViewport(),c=d.margin,f=b.wrap.width()+c[1]+c[3],g=b.wrap.height()+c[0]+c[2],c={position:"absolute",top:c[0],left:c[3]};return d.autoCenter&&d.fixed&&!a&&g<=e.h&&f<=e.w?c.position="fixed":d.locked||(c.top+=e.y,c.left+=e.x),c.top=w(Math.max(c.top,c.top+(e.h-g)*d.topRatio)),c.left=w(Math.max(c.left,c.left+(e.w-f)*d.leftRatio)),c},_afterZoomIn:function(){var a=b.current;a&&(b.isOpen=b.isOpened=!0,b.wrap.css("overflow","visible").addClass("fancybox-opened"),b.update(),(a.closeClick||a.nextClick&&1<b.group.length)&&b.inner.css("cursor","pointer").bind("click.fb",function(d){!f(d.target).is("a")&&!f(d.target).parent().is("a")&&(d.preventDefault(),b[a.closeClick?"close":"next"]())}),a.closeBtn&&f(a.tpl.closeBtn).appendTo(b.skin).bind("click.fb",function(a){a.preventDefault(),b.close()}),a.arrows&&1<b.group.length&&((a.loop||0<a.index)&&f(a.tpl.prev).appendTo(b.outer).bind("click.fb",b.prev),(a.loop||a.index<b.group.length-1)&&f(a.tpl.next).appendTo(b.outer).bind("click.fb",b.next)),b.trigger("afterShow"),a.loop||a.index!==a.group.length-1?b.opts.autoPlay&&!b.player.isActive&&(b.opts.autoPlay=!1,b.play()):b.play(!1))},_afterZoomOut:function(a){a=a||b.current,f(".fancybox-wrap").trigger("onReset").remove(),f.extend(b,{group:{},opts:{},router:!1,current:null,isActive:!1,isOpened:!1,isOpen:!1,isClosing:!1,wrap:null,skin:null,outer:null,inner:null}),b.trigger("afterClose",a)}}),b.transitions={getOrigPosition:function(){var a=b.current,d=a.element,e=a.orig,c={},f=50,g=50,h=a.hPadding,j=a.wPadding,m=b.getViewport();return!e&&a.isDom&&d.is(":visible")&&(e=d.find("img:first"),e.length||(e=d)),t(e)?(c=e.offset(),e.is("img")&&(f=e.outerWidth(),g=e.outerHeight())):(c.top=m.y+(m.h-g)*a.topRatio,c.left=m.x+(m.w-f)*a.leftRatio),("fixed"===b.wrap.css("position")||a.locked)&&(c.top-=m.y,c.left-=m.x),c={top:w(c.top-h*a.topRatio),left:w(c.left-j*a.leftRatio),width:w(f+j),height:w(g+h)}},step:function(a,d){var e,c,f=d.prop;c=b.current;var g=c.wrapSpace,h=c.skinSpace;("width"===f||"height"===f)&&(e=d.end===d.start?1:(a-d.start)/(d.end-d.start),b.isClosing&&(e=1-e),c="width"===f?c.wPadding:c.hPadding,c=a-c,b.skin[f](l("width"===f?c:c-g*e)),b.inner[f](l("width"===f?c:c-g*e-h*e)))},zoomIn:function(){var a=b.current,d=a.pos,e=a.openEffect,c="elastic"===e,k=f.extend({opacity:1},d);delete k.position,c?(d=this.getOrigPosition(),a.openOpacity&&(d.opacity=.1)):"fade"===e&&(d.opacity=.1),b.wrap.css(d).animate(k,{duration:"none"===e?0:a.openSpeed,easing:a.openEasing,step:c?this.step:null,complete:b._afterZoomIn})},zoomOut:function(){var a=b.current,d=a.closeEffect,e="elastic"===d,c={opacity:.1};e&&(c=this.getOrigPosition(),a.closeOpacity&&(c.opacity=.1)),b.wrap.animate(c,{duration:"none"===d?0:a.closeSpeed,easing:a.closeEasing,step:e?this.step:null,complete:b._afterZoomOut})},changeIn:function(){var g,a=b.current,d=a.nextEffect,e=a.pos,c={opacity:1},f=b.direction;e.opacity=.1,"elastic"===d&&(g="down"===f||"up"===f?"top":"left","down"===f||"right"===f?(e[g]=w(l(e[g])-200),c[g]="+=200px"):(e[g]=w(l(e[g])+200),c[g]="-=200px")),"none"===d?b._afterZoomIn():b.wrap.css(e).animate(c,{duration:a.nextSpeed,easing:a.nextEasing,complete:b._afterZoomIn})},changeOut:function(){var a=b.previous,d=a.prevEffect,e={opacity:.1},c=b.direction;"elastic"===d&&(e["down"===c||"up"===c?"top":"left"]=("up"===c||"left"===c?"-":"+")+"=200px"),a.wrap.animate(e,{duration:"none"===d?0:a.prevSpeed,easing:a.prevEasing,complete:function(){f(this).trigger("onReset").remove()}})}},b.helpers.overlay={defaults:{closeClick:!0,speedOut:200,showEarly:!0,css:{},locked:!s,fixed:!0},overlay:null,fixed:!1,el:f("html"),create:function(a){a=f.extend({},this.defaults,a),this.overlay&&this.close(),this.overlay=f('<div class="fancybox-overlay"></div>').appendTo(b.coming?b.coming.parent:a.parent),this.fixed=!1,a.fixed&&b.defaults.fixed&&(this.overlay.addClass("fancybox-overlay-fixed"),this.fixed=!0)},open:function(a){var d=this;a=f.extend({},this.defaults,a),this.overlay?this.overlay.unbind(".overlay").width("auto").height("auto"):this.create(a),this.fixed||(n.bind("resize.overlay",f.proxy(this.update,this)),this.update()),a.closeClick&&this.overlay.bind("click.overlay",function(a){return f(a.target).hasClass("fancybox-overlay")?(b.isActive?b.close():d.close(),!1):void 0}),this.overlay.css(a.css).show()},close:function(){var a,b;n.unbind("resize.overlay"),this.el.hasClass("fancybox-lock")&&(f(".fancybox-margin").removeClass("fancybox-margin"),a=n.scrollTop(),b=n.scrollLeft(),this.el.removeClass("fancybox-lock"),n.scrollTop(a).scrollLeft(b)),f(".fancybox-overlay").remove().hide(),f.extend(this,{overlay:null,fixed:!1})},update:function(){var b,a="100%";this.overlay.width(a).height("100%"),I?(b=Math.max(G.documentElement.offsetWidth,G.body.offsetWidth),p.width()>b&&(a=p.width())):p.width()>n.width()&&(a=p.width()),this.overlay.width(a).height(p.height())},onReady:function(a,b){var e=this.overlay;f(".fancybox-overlay").stop(!0,!0),e||this.create(a),a.locked&&this.fixed&&b.fixed&&(e||(this.margin=p.height()>n.height()?f("html").css("margin-right").replace("px",""):!1),b.locked=this.overlay.append(b.wrap),b.fixed=!1),!0===a.showEarly&&this.beforeShow.apply(this,arguments)},beforeShow:function(a,b){var e,c;b.locked&&(!1!==this.margin&&(f("*").filter(function(){return"fixed"===f(this).css("position")&&!f(this).hasClass("fancybox-overlay")&&!f(this).hasClass("fancybox-wrap")}).addClass("fancybox-margin"),this.el.addClass("fancybox-margin")),e=n.scrollTop(),c=n.scrollLeft(),this.el.addClass("fancybox-lock"),n.scrollTop(e).scrollLeft(c)),this.open(a)},onUpdate:function(){this.fixed||this.update()},afterClose:function(a){this.overlay&&!b.coming&&this.overlay.fadeOut(a.speedOut,f.proxy(this.close,this))}},b.helpers.title={defaults:{type:"float",position:"bottom"},beforeShow:function(a){var d=b.current,e=d.title,c=a.type;if(f.isFunction(e)&&(e=e.call(d.element,d)),q(e)&&""!==f.trim(e)){switch(d=f('<div class="fancybox-title fancybox-title-'+c+'-wrap">'+e+"</div>"),c){case"inside":c=b.skin;break;case"outside":c=b.wrap;break;case"over":c=b.inner;break;default:c=b.skin,d.appendTo("body"),I&&d.width(d.width()),d.wrapInner('<span class="child"></span>'),b.current.margin[2]+=Math.abs(l(d.css("margin-bottom")))}d["top"===a.position?"prependTo":"appendTo"](c)}}},f.fn.fancybox=function(a){var d,e=f(this),c=this.selector||"",k=function(g){var k,l,h=f(this).blur(),j=d;!g.ctrlKey&&!g.altKey&&!g.shiftKey&&!g.metaKey&&!h.is(".fancybox-wrap")&&(k=a.groupAttr||"data-fancybox-group",l=h.attr(k),l||(k="rel",l=h.get(0)[k]),l&&""!==l&&"nofollow"!==l&&(h=c.length?f(c):e,h=h.filter("["+k+'="'+l+'"]'),j=h.index(this)),a.index=j,!1!==b.open(h,a)&&g.preventDefault())};return a=a||{},d=a.index||0,c&&!1!==a.live?p.undelegate(c,"click.fb-start").delegate(c+":not('.fancybox-item, .fancybox-nav')","click.fb-start",k):e.unbind("click.fb-start").bind("click.fb-start",k),this.filter("[data-fancybox-start=1]").trigger("click"),this},p.ready(function(){var a,d;if(f.scrollbarWidth===v&&(f.scrollbarWidth=function(){var a=f('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),b=a.children(),b=b.innerWidth()-b.height(99).innerWidth();return a.remove(),b}),f.support.fixedPosition===v){a=f.support,d=f('<div style="position:fixed;top:20px;"></div>').appendTo("body");var e=20===d[0].offsetTop||15===d[0].offsetTop;d.remove(),a.fixedPosition=e}f.extend(b.defaults,{scrollbarWidth:f.scrollbarWidth(),fixed:f.support.fixedPosition,parent:f("body")}),a=f(r).width(),J.addClass("fancybox-lock-test"),d=f(r).width(),J.removeClass("fancybox-lock-test"),f("<style type='text/css'>.fancybox-margin{margin-right:"+(d-a)+"px;}</style>").appendTo("head")})}(window,document,jQuery),function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):factory(jQuery)}(function($){"use strict";var _colorpicker_index=0,_container_popup='<div class="ui-colorpicker ui-colorpicker-dialog ui-dialog ui-widget ui-widget-content ui-corner-all" style="display: none;"></div>',_container_inlineFrame='<div class="ui-colorpicker ui-colorpicker-inline ui-dialog ui-widget ui-widget-content ui-corner-all"></div>',_container_inline='<div class="ui-colorpicker ui-colorpicker-inline"></div>',_intToHex=function(dec){var result=Math.round(dec).toString(16);return 1===result.length&&(result="0"+result),result.toLowerCase()},_parseHex=function(color){var c,m;return m=/^#?([a-fA-F0-9]{1,6})$/.exec(color),m?(c=parseInt(m[1],16),new $.colorpicker.Color((c>>16&255)/255,(c>>8&255)/255,(255&c)/255)):new $.colorpicker.Color},_layoutTable=function(layout,callback){var bitmap,x,y,width,height,columns,rows,index,cell,html,w,h,colspan,walked;for(layout.sort(function(a,b){return a.pos[1]===b.pos[1]?a.pos[0]-b.pos[0]:a.pos[1]-b.pos[1]}),width=0,height=0,$.each(layout,function(index,part){width=Math.max(width,part.pos[0]+part.pos[2]),height=Math.max(height,part.pos[1]+part.pos[3])}),bitmap=[],x=0;width>x;++x)bitmap.push([]);for(rows=[],columns=[],$.each(layout,function(index,part){for(x=0;x<part.pos[2];x+=1)columns[part.pos[0]+x]=!0;for(y=0;y<part.pos[3];y+=1)rows[part.pos[1]+y]=!0}),html="",cell=layout[index=0],y=0;height>y;++y){for(html+="<tr>",x=0;width>x;)if("undefined"!=typeof cell&&x===cell.pos[0]&&y===cell.pos[1]){for(html+=callback(cell,x,y),h=0;h<cell.pos[3];h+=1)for(w=0;w<cell.pos[2];w+=1)bitmap[x+w][y+h]=!0;x+=cell.pos[2],cell=layout[++index]}else{for(colspan=0,walked=!1;width>x&&void 0===bitmap[x][y]&&(void 0===cell||y<cell.pos[1]||y===cell.pos[1]&&x<cell.pos[0]);)columns[x]===!0&&(colspan+=1),walked=!0,x+=1;colspan>0?html+='<td colspan="'+colspan+'"></td>':walked||(x+=1)}html+="</tr>"}return'<table cellspacing="0" cellpadding="0" border="0"><tbody>'+html+"</tbody></table>"};return $.colorpicker=new function(){this.regional={"":{ok:"OK",cancel:"Cancel",none:"None",button:"Color",title:"Pick a color",transparent:"Transparent",hsvH:"H",hsvS:"S",hsvV:"V",rgbR:"R",rgbG:"G",rgbB:"B",labL:"L",labA:"a",labB:"b",hslH:"H",hslS:"S",hslL:"L",cmykC:"C",cmykM:"M",cmykY:"Y",cmykK:"K",alphaA:"A"}},this.swatchesNames={html:"HTML"},this.swatches={html:[{name:"black",r:0,g:0,b:0},{name:"dimgray",r:.4117647058823529,g:.4117647058823529,b:.4117647058823529},{name:"gray",r:.5019607843137255,g:.5019607843137255,b:.5019607843137255},{name:"darkgray",r:.6627450980392157,g:.6627450980392157,b:.6627450980392157},{name:"silver",r:.7529411764705882,g:.7529411764705882,b:.7529411764705882},{name:"lightgrey",r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},{name:"gainsboro",r:.8627450980392157,g:.8627450980392157,b:.8627450980392157},{name:"whitesmoke",r:.9607843137254902,g:.9607843137254902,b:.9607843137254902},{name:"white",r:1,g:1,b:1},{name:"rosybrown",r:.7372549019607844,g:.5607843137254902,b:.5607843137254902},{name:"indianred",r:.803921568627451,g:.3607843137254902,b:.3607843137254902},{name:"brown",r:.6470588235294118,g:.16470588235294117,b:.16470588235294117},{name:"firebrick",r:.6980392156862745,g:.13333333333333333,b:.13333333333333333},{name:"lightcoral",r:.9411764705882353,g:.5019607843137255,b:.5019607843137255},{name:"maroon",r:.5019607843137255,g:0,b:0},{name:"darkred",r:.5450980392156862,g:0,b:0},{name:"red",r:1,g:0,b:0},{name:"snow",r:1,g:.9803921568627451,b:.9803921568627451},{name:"salmon",r:.9803921568627451,g:.5019607843137255,b:.4470588235294118},{name:"mistyrose",r:1,g:.8941176470588236,b:.8823529411764706},{name:"tomato",r:1,g:.38823529411764707,b:.2784313725490196},{name:"darksalmon",r:.9137254901960784,g:.5882352941176471,b:.47843137254901963},{name:"orangered",r:1,g:.27058823529411763,b:0},{name:"coral",r:1,g:.4980392156862745,b:.3137254901960784},{name:"lightsalmon",r:1,g:.6274509803921569,b:.47843137254901963},{name:"sienna",r:.6274509803921569,g:.3215686274509804,b:.17647058823529413},{name:"seashell",r:1,g:.9607843137254902,b:.9333333333333333},{name:"chocolate",r:.8235294117647058,g:.4117647058823529,b:.11764705882352941},{name:"saddlebrown",r:.5450980392156862,g:.27058823529411763,b:.07450980392156863},{name:"sandybrown",r:.9568627450980393,g:.6431372549019608,b:.3764705882352941},{name:"peachpuff",r:1,g:.8549019607843137,b:.7254901960784313},{name:"peru",r:.803921568627451,g:.5215686274509804,b:.24705882352941178},{name:"linen",r:.9803921568627451,g:.9411764705882353,b:.9019607843137255},{name:"darkorange",r:1,g:.5490196078431373,b:0},{name:"bisque",r:1,g:.8941176470588236,b:.7686274509803922},{name:"burlywood",r:.8705882352941177,g:.7215686274509804,b:.5294117647058824},{name:"tan",r:.8235294117647058,g:.7058823529411765,b:.5490196078431373},{name:"antiquewhite",r:.9803921568627451,g:.9215686274509803,b:.8431372549019608},{name:"navajowhite",r:1,g:.8705882352941177,b:.6784313725490196},{name:"blanchedalmond",r:1,g:.9215686274509803,b:.803921568627451},{name:"papayawhip",r:1,g:.9372549019607843,b:.8352941176470589},{name:"orange",r:1,g:.6470588235294118,b:0},{name:"moccasin",r:1,g:.8941176470588236,b:.7098039215686275},{name:"wheat",r:.9607843137254902,g:.8705882352941177,b:.7019607843137254},{name:"oldlace",r:.9921568627450981,g:.9607843137254902,b:.9019607843137255},{name:"floralwhite",r:1,g:.9803921568627451,b:.9411764705882353},{name:"goldenrod",r:.8549019607843137,g:.6470588235294118,b:.12549019607843137},{name:"darkgoldenrod",r:.7215686274509804,g:.5254901960784314,b:.043137254901960784},{name:"cornsilk",r:1,g:.9725490196078431,b:.8627450980392157},{name:"gold",r:1,g:.8431372549019608,b:0},{name:"palegoldenrod",r:.9333333333333333,g:.9098039215686274,b:.6666666666666666},{name:"khaki",r:.9411764705882353,g:.9019607843137255,b:.5490196078431373},{name:"lemonchiffon",r:1,g:.9803921568627451,b:.803921568627451},{name:"darkkhaki",r:.7411764705882353,g:.7176470588235294,b:.4196078431372549},{name:"beige",r:.9607843137254902,g:.9607843137254902,b:.8627450980392157},{name:"lightgoldenrodyellow",r:.9803921568627451,g:.9803921568627451,b:.8235294117647058},{name:"olive",r:.5019607843137255,g:.5019607843137255,b:0},{name:"yellow",r:1,g:1,b:0},{name:"lightyellow",r:1,g:1,b:.8784313725490196},{name:"ivory",r:1,g:1,b:.9411764705882353},{name:"olivedrab",r:.4196078431372549,g:.5568627450980392,b:.13725490196078433},{name:"yellowgreen",r:.6039215686274509,g:.803921568627451,b:.19607843137254902},{name:"darkolivegreen",r:.3333333333333333,g:.4196078431372549,b:.1843137254901961},{name:"greenyellow",r:.6784313725490196,g:1,b:.1843137254901961},{name:"lawngreen",r:.48627450980392156,g:.9882352941176471,b:0},{name:"chartreuse",r:.4980392156862745,g:1,b:0},{name:"darkseagreen",r:.5607843137254902,g:.7372549019607844,b:.5607843137254902},{name:"forestgreen",r:.13333333333333333,g:.5450980392156862,b:.13333333333333333},{name:"limegreen",r:.19607843137254902,g:.803921568627451,b:.19607843137254902},{name:"lightgreen",r:.5647058823529412,g:.9333333333333333,b:.5647058823529412},{name:"palegreen",r:.596078431372549,g:.984313725490196,b:.596078431372549},{name:"darkgreen",r:0,g:.39215686274509803,b:0},{name:"green",r:0,g:.5019607843137255,b:0},{name:"lime",r:0,g:1,b:0},{name:"honeydew",r:.9411764705882353,g:1,b:.9411764705882353},{name:"mediumseagreen",r:.23529411764705882,g:.7019607843137254,b:.44313725490196076},{name:"seagreen",r:.1803921568627451,g:.5450980392156862,b:.3411764705882353},{name:"springgreen",r:0,g:1,b:.4980392156862745},{name:"mintcream",r:.9607843137254902,g:1,b:.9803921568627451},{name:"mediumspringgreen",r:0,g:.9803921568627451,b:.6039215686274509},{name:"mediumaquamarine",r:.4,g:.803921568627451,b:.6666666666666666},{name:"aquamarine",r:.4980392156862745,g:1,b:.8313725490196079},{name:"turquoise",r:.25098039215686274,g:.8784313725490196,b:.8156862745098039},{name:"lightseagreen",r:.12549019607843137,g:.6980392156862745,b:.6666666666666666},{name:"mediumturquoise",r:.2823529411764706,g:.8196078431372549,b:.8},{name:"darkslategray",r:.1843137254901961,g:.30980392156862746,b:.30980392156862746},{name:"paleturquoise",r:.6862745098039216,g:.9333333333333333,b:.9333333333333333},{name:"teal",r:0,g:.5019607843137255,b:.5019607843137255},{name:"darkcyan",r:0,g:.5450980392156862,b:.5450980392156862},{name:"darkturquoise",r:0,g:.807843137254902,b:.8196078431372549},{name:"aqua",r:0,g:1,b:1},{name:"cyan",r:0,g:1,b:1},{name:"lightcyan",r:.8784313725490196,g:1,b:1},{name:"azure",r:.9411764705882353,g:1,b:1},{name:"cadetblue",r:.37254901960784315,g:.6196078431372549,b:.6274509803921569},{name:"powderblue",r:.6901960784313725,g:.8784313725490196,b:.9019607843137255},{name:"lightblue",r:.6784313725490196,g:.8470588235294118,b:.9019607843137255},{name:"deepskyblue",r:0,g:.7490196078431373,b:1},{name:"skyblue",r:.5294117647058824,g:.807843137254902,b:.9215686274509803},{name:"lightskyblue",r:.5294117647058824,g:.807843137254902,b:.9803921568627451},{name:"steelblue",r:.27450980392156865,g:.5098039215686274,b:.7058823529411765},{name:"aliceblue",r:.9411764705882353,g:.9725490196078431,b:1},{name:"dodgerblue",r:.11764705882352941,g:.5647058823529412,b:1},{name:"slategray",r:.4392156862745098,g:.5019607843137255,b:.5647058823529412},{name:"lightslategray",r:.4666666666666667,g:.5333333333333333,b:.6},{name:"lightsteelblue",r:.6901960784313725,g:.7686274509803922,b:.8705882352941177},{name:"cornflowerblue",r:.39215686274509803,g:.5843137254901961,b:.9294117647058824},{name:"royalblue",r:.2549019607843137,g:.4117647058823529,b:.8823529411764706},{name:"midnightblue",r:.09803921568627451,g:.09803921568627451,b:.4392156862745098},{name:"lavender",r:.9019607843137255,g:.9019607843137255,b:.9803921568627451},{name:"navy",r:0,g:0,b:.5019607843137255},{name:"darkblue",r:0,g:0,b:.5450980392156862},{name:"mediumblue",r:0,g:0,b:.803921568627451},{name:"blue",r:0,g:0,b:1},{name:"ghostwhite",r:.9725490196078431,g:.9725490196078431,b:1},{name:"darkslateblue",r:.2823529411764706,g:.23921568627450981,b:.5450980392156862},{name:"slateblue",r:.41568627450980394,g:.35294117647058826,b:.803921568627451},{name:"mediumslateblue",r:.4823529411764706,g:.40784313725490196,b:.9333333333333333},{name:"mediumpurple",r:.5764705882352941,g:.4392156862745098,b:.8588235294117647},{name:"blueviolet",r:.5411764705882353,g:.16862745098039217,b:.8862745098039215},{name:"indigo",r:.29411764705882354,g:0,b:.5098039215686274},{name:"darkorchid",r:.6,g:.19607843137254902,b:.8},{name:"darkviolet",r:.5803921568627451,g:0,b:.8274509803921568},{name:"mediumorchid",r:.7294117647058823,g:.3333333333333333,b:.8274509803921568},{name:"thistle",r:.8470588235294118,g:.7490196078431373,b:.8470588235294118},{name:"plum",r:.8666666666666667,g:.6274509803921569,b:.8666666666666667},{name:"violet",r:.9333333333333333,g:.5098039215686274,b:.9333333333333333},{name:"purple",r:.5019607843137255,g:0,b:.5019607843137255},{name:"darkmagenta",r:.5450980392156862,g:0,b:.5450980392156862},{name:"magenta",r:1,g:0,b:1},{name:"fuchsia",r:1,g:0,b:1},{name:"orchid",r:.8549019607843137,g:.4392156862745098,b:.8392156862745098},{name:"mediumvioletred",r:.7803921568627451,g:.08235294117647059,b:.5215686274509804},{name:"deeppink",r:1,g:.0784313725490196,b:.5764705882352941},{name:"hotpink",r:1,g:.4117647058823529,b:.7058823529411765},{name:"palevioletred",r:.8588235294117647,g:.4392156862745098,b:.5764705882352941},{name:"lavenderblush",r:1,g:.9411764705882353,b:.9607843137254902},{name:"crimson",r:.8627450980392157,g:.0784313725490196,b:.23529411764705882},{name:"pink",r:1,g:.7529411764705882,b:.796078431372549},{name:"lightpink",r:1,g:.7137254901960784,b:.7568627450980392}]},this.writers={"#HEX":function(color,that){return that._formatColor("#rxgxbx",color)},"#HEX3":function(color,that){var hex3=$.colorpicker.writers.HEX3(color);return hex3===!1?!1:"#"+hex3},HEX:function(color,that){return that._formatColor("rxgxbx",color)},HEX3:function(color,that){var rgb=color.getRGB(),r=Math.round(255*rgb.r),g=Math.round(255*rgb.g),b=Math.round(255*rgb.b);return r>>>4===(r&=15)&&g>>>4===(g&=15)&&b>>>4===(b&=15)?r.toString(16)+g.toString(16)+b.toString(16):!1},"#HEXA":function(color,that){return that._formatColor("#rxgxbxax",color)},"#HEXA4":function(color,that){var hexa4=$.colorpicker.writers.HEXA4(color,that);return hexa4===!1?!1:"#"+hexa4},HEXA:function(color,that){return that._formatColor("rxgxbxax",color)},HEXA4:function(color,that){var a=Math.round(255*color.getAlpha());return a>>>4===(a&=15)?$.colorpicker.writers.HEX3(color,that)+a.toString(16):!1},RGB:function(color,that){return color.getAlpha()>=1?that._formatColor("rgb(rd,gd,bd)",color):!1},RGBA:function(color,that){
return that._formatColor("rgba(rd,gd,bd,af)",color)},"RGB%":function(color,that){return color.getAlpha()>=1?that._formatColor("rgb(rp%,gp%,bp%)",color):!1},"RGBA%":function(color,that){return that._formatColor("rgba(rp%,gp%,bp%,af)",color)},HSL:function(color,that){return color.getAlpha()>=1?that._formatColor("hsl(hd,sd,vd)",color):!1},HSLA:function(color,that){return that._formatColor("hsla(hd,sd,vd,af)",color)},"HSL%":function(color,that){return color.getAlpha()>=1?that._formatColor("hsl(hp%,sp%,vp%)",color):!1},"HSLA%":function(color,that){return that._formatColor("hsla(hp%,sp%,vp%,af)",color)},NAME:function(color,that){return that._closestName(color)},EXACT:function(color,that){return that._exactName(color)}},this.parsers={"":function(color){return""===color?new $.colorpicker.Color:void 0},NAME:function(color,that){var c=that._getSwatch($.trim(color));return c?new $.colorpicker.Color(c.r,c.g,c.b):void 0},RGBA:function(color){var m=/^rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/.exec(color);return m?new $.colorpicker.Color(m[1]/255,m[2]/255,m[3]/255,parseFloat(m[4])):void 0},"RGBA%":function(color){var m=/^rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/.exec(color);return m?new $.colorpicker.Color(m[1]/100,m[2]/100,m[3]/100,m[4]/100):void 0},HSLA:function(color){var m=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/.exec(color);return m?(new $.colorpicker.Color).setHSL(m[1]/255,m[2]/255,m[3]/255).setAlpha(parseFloat(m[4])):void 0},"HSLA%":function(color){var m=/^hsla?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/.exec(color);return m?(new $.colorpicker.Color).setHSL(m[1]/100,m[2]/100,m[3]/100).setAlpha(m[4]/100):void 0},"#HEX":function(color){var m=/^#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/.exec(color);return m?new $.colorpicker.Color(parseInt(m[1],16)/255,parseInt(m[2],16)/255,parseInt(m[3],16)/255):void 0},"#HEX3":function(color){var m=/^#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/.exec(color);return m?new $.colorpicker.Color(parseInt(String(m[1])+m[1],16)/255,parseInt(String(m[2])+m[2],16)/255,parseInt(String(m[3])+m[3],16)/255):void 0},HEX:function(color){var m=/^([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/.exec(color);return m?new $.colorpicker.Color(parseInt(m[1],16)/255,parseInt(m[2],16)/255,parseInt(m[3],16)/255):void 0},HEX3:function(color){var m=/^([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/.exec(color);return m?new $.colorpicker.Color(parseInt(String(m[1])+m[1],16)/255,parseInt(String(m[2])+m[2],16)/255,parseInt(String(m[3])+m[3],16)/255):void 0},"#HEXA":function(color){var m=/^#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/.exec(color);return m?new $.colorpicker.Color(parseInt(m[1],16)/255,parseInt(m[2],16)/255,parseInt(m[3],16)/255,parseInt(m[4],16)/255):void 0},"#HEXA4":function(color){var m=/^#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/.exec(color);return m?new $.colorpicker.Color(parseInt(String(m[1])+m[1],16)/255,parseInt(String(m[2])+m[2],16)/255,parseInt(String(m[3])+m[3],16)/255,parseInt(String(m[4])+m[4],16)/255):void 0},HEXA:function(color){var m=/^([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/.exec(color);return m?new $.colorpicker.Color(parseInt(m[1],16)/255,parseInt(m[2],16)/255,parseInt(m[3],16)/255,parseInt(m[4],16)/255):void 0},HEXA4:function(color){var m=/^([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/.exec(color);return m?new $.colorpicker.Color(parseInt(String(m[1])+m[1],16)/255,parseInt(String(m[2])+m[2],16)/255,parseInt(String(m[3])+m[3],16)/255,parseInt(String(m[4])+m[4],16)/255):void 0}},this.partslists={full:["header","map","bar","hex","hsv","rgb","alpha","lab","cmyk","preview","swatches","footer"],popup:["map","bar","hex","hsv","rgb","alpha","preview","footer"],draggable:["header","map","bar","hex","hsv","rgb","alpha","preview","footer"],inline:["map","bar","hex","hsv","rgb","alpha","preview"]},this.limits={websafe:function(color){color.limit(6)},nibble:function(color){color.limit(16)},binary:function(color){color.limit(2)},name:function(color,that){var swatch=that._getSwatch(that._closestName(color));color.setRGB(swatch.r,swatch.g,swatch.b)}},this.parts={header:function(inst){var e=null,_html=function(){var title=inst.options.title||inst._getRegional("title"),html='<span class="ui-dialog-title">'+title+"</span>";return!inst.inline&&inst.options.showCloseButton&&(html+='<a href="#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a>'),'<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix">'+html+"</div>"};this.init=function(){e=$(_html()).prependTo(inst.dialog);var close=$(".ui-dialog-titlebar-close",e);if(inst._hoverable(close),inst._focusable(close),close.click(function(event){event.preventDefault(),inst.close(inst.options.revert)}),!inst.inline&&inst.options.draggable){var draggableOptions={handle:e};inst.options.containment&&(draggableOptions.containment=inst.options.containment),inst.dialog.draggable(draggableOptions)}}},map:function(inst){var pointer,width,height,_mousedown,_mouseup,_mousemove,_html,that=this,e=null,layers={};_mousedown=function(event){if(inst.opened){var offset=layers.p.offset(),x=event.pageX-offset.left,y=event.pageY-offset.top;x>=0&&width>x&&y>=0&&height>y&&(event.stopImmediatePropagation(),event.preventDefault(),e.unbind("mousedown",_mousedown),$(document).bind("mouseup",_mouseup),$(document).bind("mousemove",_mousemove),_mousemove(event))}},_mouseup=function(event){event.stopImmediatePropagation(),event.preventDefault(),$(document).unbind("mouseup",_mouseup),$(document).unbind("mousemove",_mousemove),e.bind("mousedown",_mousedown),inst._callback("stop")},_mousemove=function(event){if(event.stopImmediatePropagation(),event.preventDefault(),event.pageX!==that.x||event.pageY!==that.y){that.x=event.pageX,that.y=event.pageY;var offset=layers.p.offset(),x=event.pageX-offset.left,y=event.pageY-offset.top;switch(x=Math.max(0,Math.min(x/width,1)),y=Math.max(0,Math.min(y/height,1)),inst.mode){case"h":inst.color.setHSV(null,x,1-y);break;case"s":case"a":inst.color.setHSV(x,null,1-y);break;case"v":inst.color.setHSV(x,1-y,null);break;case"r":inst.color.setRGB(null,1-y,x);break;case"g":inst.color.setRGB(1-y,null,x);break;case"b":inst.color.setRGB(x,1-y,null)}inst._change(!1)}},_html=function(){var html='<div class="ui-colorpicker-map ui-colorpicker-map-'+(inst.options.part.map.size||256)+' ui-colorpicker-border"><span class="ui-colorpicker-map-layer-1">&nbsp;</span><span class="ui-colorpicker-map-layer-2">&nbsp;</span>'+(inst.options.alpha?'<span class="ui-colorpicker-map-layer-alpha">&nbsp;</span>':"")+'<span class="ui-colorpicker-map-layer-pointer"><span class="ui-colorpicker-map-pointer"></span></span></div>';return html},this.init=function(){e=$(_html()).appendTo($(".ui-colorpicker-map-container",inst.dialog)),e.bind("mousedown",_mousedown),layers[1]=$(".ui-colorpicker-map-layer-1",e),layers[2]=$(".ui-colorpicker-map-layer-2",e),layers.a=$(".ui-colorpicker-map-layer-alpha",e),layers.p=$(".ui-colorpicker-map-layer-pointer",e),width=layers.p.width(),height=layers.p.height(),pointer=$(".ui-colorpicker-map-pointer",e)},this.update=function(){var step=65*(inst.options.part.map.size||256)/64;switch(inst.mode){case"h":layers[1].css({"background-position":"0 0",opacity:""}).show(),layers[2].hide();break;case"s":case"a":layers[1].css({"background-position":"0 "+-step+"px",opacity:""}).show(),layers[2].css({"background-position":"0 "+2*-step+"px",opacity:""}).show();break;case"v":e.css("background-color","black"),layers[1].css({"background-position":"0 "+3*-step+"px",opacity:""}).show(),layers[2].hide();break;case"r":layers[1].css({"background-position":"0 "+4*-step+"px",opacity:""}).show(),layers[2].css({"background-position":"0 "+5*-step+"px",opacity:""}).show();break;case"g":layers[1].css({"background-position":"0 "+6*-step+"px",opacity:""}).show(),layers[2].css({"background-position":"0 "+7*-step+"px",opacity:""}).show();break;case"b":layers[1].css({"background-position":"0 "+8*-step+"px",opacity:""}).show(),layers[2].css({"background-position":"0 "+9*-step+"px",opacity:""}).show()}that.repaint()},this.repaint=function(){var x=0,y=0;switch(inst.mode){case"h":var hsv=inst.color.getHSV();x=hsv.s*width,y=(1-hsv.v)*width,e.css("background-color",inst.color.copy().setHSV(null,1,1).toCSS());break;case"s":case"a":var hsv=inst.color.getHSV();x=hsv.h*width,y=(1-hsv.v)*width,layers[2].css("opacity",1-hsv.s);break;case"v":var hsv=inst.color.getHSV();x=hsv.h*width,y=(1-hsv.s)*width,layers[1].css("opacity",hsv.v);break;case"r":var rgb=inst.color.getRGB();x=rgb.b*width,y=(1-rgb.g)*width,layers[2].css("opacity",rgb.r);break;case"g":var rgb=inst.color.getRGB();x=rgb.b*width,y=(1-rgb.r)*width,layers[2].css("opacity",rgb.g);break;case"b":var rgb=inst.color.getRGB();x=rgb.r*width,y=(1-rgb.g)*width,layers[2].css("opacity",rgb.b)}inst.options.alpha&&layers.a.css("opacity",1-inst.color.getAlpha()),pointer.css({left:x-7,top:y-7})}},bar:function(inst){var pointer,width,height,_mousedown,_mouseup,_mousemove,_html,that=this,e=null,layers={};_mousedown=function(event){if(inst.opened){var offset=layers.p.offset(),x=event.pageX-offset.left,y=event.pageY-offset.top;x>=0&&width>x&&y>=0&&height>y&&(event.stopImmediatePropagation(),event.preventDefault(),e.unbind("mousedown",_mousedown),$(document).bind("mouseup",_mouseup),$(document).bind("mousemove",_mousemove),_mousemove(event))}},_mouseup=function(event){event.stopImmediatePropagation(),event.preventDefault(),$(document).unbind("mouseup",_mouseup),$(document).unbind("mousemove",_mousemove),e.bind("mousedown",_mousedown),inst._callback("stop")},_mousemove=function(event){if(event.stopImmediatePropagation(),event.preventDefault(),event.pageY!==that.y){that.y=event.pageY;var offset=layers.p.offset(),y=event.pageY-offset.top;switch(y=Math.max(0,Math.min(y/height,1)),inst.mode){case"h":inst.color.setHSV(1-y,null,null);break;case"s":inst.color.setHSV(null,1-y,null);break;case"v":inst.color.setHSV(null,null,1-y);break;case"r":inst.color.setRGB(1-y,null,null);break;case"g":inst.color.setRGB(null,1-y,null);break;case"b":inst.color.setRGB(null,null,1-y);break;case"a":inst.color.setAlpha(1-y)}inst._change(!1)}},_html=function(){var html='<div class="ui-colorpicker-bar ui-colorpicker-bar-'+(inst.options.part.bar.size||256)+'  ui-colorpicker-border"><span class="ui-colorpicker-bar-layer-1">&nbsp;</span><span class="ui-colorpicker-bar-layer-2">&nbsp;</span><span class="ui-colorpicker-bar-layer-3">&nbsp;</span><span class="ui-colorpicker-bar-layer-4">&nbsp;</span>';return inst.options.alpha&&(html+='<span class="ui-colorpicker-bar-layer-alpha">&nbsp;</span><span class="ui-colorpicker-bar-layer-alphabar">&nbsp;</span>'),html+='<span class="ui-colorpicker-bar-layer-pointer"><span class="ui-colorpicker-bar-pointer"></span></span></div>'},this.init=function(){e=$(_html()).appendTo($(".ui-colorpicker-bar-container",inst.dialog)),e.bind("mousedown",_mousedown),layers[1]=$(".ui-colorpicker-bar-layer-1",e),layers[2]=$(".ui-colorpicker-bar-layer-2",e),layers[3]=$(".ui-colorpicker-bar-layer-3",e),layers[4]=$(".ui-colorpicker-bar-layer-4",e),layers.a=$(".ui-colorpicker-bar-layer-alpha",e),layers.ab=$(".ui-colorpicker-bar-layer-alphabar",e),layers.p=$(".ui-colorpicker-bar-layer-pointer",e),width=layers.p.width(),height=layers.p.height(),pointer=$(".ui-colorpicker-bar-pointer",e)},this.update=function(){var step=65*(inst.options.part.bar.size||256)/64;switch(inst.mode){case"h":case"s":case"v":case"r":case"g":case"b":layers.a.show(),layers.ab.hide();break;case"a":layers.a.hide(),layers.ab.show()}switch(inst.mode){case"h":layers[1].css({"background-position":"0 0",opacity:""}).show(),layers[2].hide(),layers[3].hide(),layers[4].hide();break;case"s":layers[1].css({"background-position":"0 "+-step+"px",opacity:""}).show(),layers[2].css({"background-position":"0 "+2*-step+"px",opacity:""}).show(),layers[3].hide(),layers[4].hide();break;case"v":layers[1].css({"background-position":"0 "+2*-step+"px",opacity:""}).show(),layers[2].hide(),layers[3].hide(),layers[4].hide();break;case"r":layers[1].css({"background-position":"0 "+6*-step+"px",opacity:""}).show(),layers[2].css({"background-position":"0 "+5*-step+"px",opacity:""}).show(),layers[3].css({"background-position":"0 "+3*-step+"px",opacity:""}).show(),layers[4].css({"background-position":"0 "+4*-step+"px",opacity:""}).show();break;case"g":layers[1].css({"background-position":"0 "+10*-step+"px",opacity:""}).show(),layers[2].css({"background-position":"0 "+9*-step+"px",opacity:""}).show(),layers[3].css({"background-position":"0 "+7*-step+"px",opacity:""}).show(),layers[4].css({"background-position":"0 "+8*-step+"px",opacity:""}).show();break;case"b":layers[1].css({"background-position":"0 "+14*-step+"px",opacity:""}).show(),layers[2].css({"background-position":"0 "+13*-step+"px",opacity:""}).show(),layers[3].css({"background-position":"0 "+11*-step+"px",opacity:""}).show(),layers[4].css({"background-position":"0 "+12*-step+"px",opacity:""}).show();break;case"a":layers[1].hide(),layers[2].hide(),layers[3].hide(),layers[4].hide()}that.repaint()},this.repaint=function(){var y=0;switch(inst.mode){case"h":y=(1-inst.color.getHSV().h)*height;break;case"s":var hsv=inst.color.getHSV();y=(1-hsv.s)*height,layers[2].css("opacity",1-hsv.v),e.css("background-color",inst.color.copy().setHSV(null,1,null).toCSS());break;case"v":y=(1-inst.color.getHSV().v)*height,e.css("background-color",inst.color.copy().setHSV(null,null,1).toCSS());break;case"r":var rgb=inst.color.getRGB();y=(1-rgb.r)*height,layers[2].css("opacity",Math.max(0,rgb.b-rgb.g)),layers[3].css("opacity",Math.max(0,rgb.g-rgb.b)),layers[4].css("opacity",Math.min(rgb.b,rgb.g));break;case"g":var rgb=inst.color.getRGB();y=(1-rgb.g)*height,layers[2].css("opacity",Math.max(0,rgb.b-rgb.r)),layers[3].css("opacity",Math.max(0,rgb.r-rgb.b)),layers[4].css("opacity",Math.min(rgb.r,rgb.b));break;case"b":var rgb=inst.color.getRGB();y=(1-rgb.b)*height,layers[2].css("opacity",Math.max(0,rgb.r-rgb.g)),layers[3].css("opacity",Math.max(0,rgb.g-rgb.r)),layers[4].css("opacity",Math.min(rgb.r,rgb.g));break;case"a":y=(1-inst.color.getAlpha())*height,e.css("background-color",inst.color.copy().toCSS())}"a"!==inst.mode&&layers.a.css("opacity",1-inst.color.getAlpha()),pointer.css("top",y-3)}},preview:function(inst){var both,initial,initial_alpha,current,current_alpha,_html,e=null;_html=function(){return'<div class="ui-colorpicker-preview ui-colorpicker-border"><div class="ui-colorpicker-preview-initial"><div class="ui-colorpicker-preview-initial-alpha"></div></div><div class="ui-colorpicker-preview-current"><div class="ui-colorpicker-preview-current-alpha"></div></div></div>'},this.init=function(){e=$(_html()).appendTo($(".ui-colorpicker-preview-container",inst.dialog)),$(".ui-colorpicker-preview-initial",e).click(function(){inst.color=inst.currentColor.copy(),inst._change()}),initial=$(".ui-colorpicker-preview-initial",e),initial_alpha=$(".ui-colorpicker-preview-initial-alpha",e),current=$(".ui-colorpicker-preview-current",e),current_alpha=$(".ui-colorpicker-preview-current-alpha",e),both=$(".ui-colorpicker-preview-initial-alpha, .ui-colorpicker-preview-current-alpha",e)},this.update=function(){both[inst.options.alpha?"show":"hide"](),this.repaint()},this.repaint=function(){initial.css("background-color",inst.currentColor.set?inst.currentColor.toCSS():"").attr("title",inst.currentColor.set?inst.currentColor.toCSS():""),initial_alpha.css("opacity",1-inst.currentColor.getAlpha()),current.css("background-color",inst.color.set?inst.color.toCSS():"").attr("title",inst.color.set?inst.color.toCSS():""),current_alpha.css("opacity",1-inst.color.getAlpha())}},hsv:function(inst){var _html,e=null,inputs={};_html=function(){var html="";return inst.options.hsv&&(html+='<div class="ui-colorpicker-hsv-h"><input class="ui-colorpicker-mode" type="radio" value="h"/><label>'+inst._getRegional("hsvH")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="360" size="10"/><span class="ui-colorpicker-unit">&deg;</span></div><div class="ui-colorpicker-hsv-s"><input class="ui-colorpicker-mode" type="radio" value="s"/><label>'+inst._getRegional("hsvS")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100" size="10"/><span class="ui-colorpicker-unit">%</span></div><div class="ui-colorpicker-hsv-v"><input class="ui-colorpicker-mode" type="radio" value="v"/><label>'+inst._getRegional("hsvV")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100" size="10"/><span class="ui-colorpicker-unit">%</span></div>'),'<div class="ui-colorpicker-hsv">'+html+"</div>"},this.init=function(){e=$(_html()).appendTo($(".ui-colorpicker-hsv-container",inst.dialog)),$(".ui-colorpicker-mode",e).click(function(){inst.mode=$(this).val(),inst._updateAllParts()}),inputs.h=$(".ui-colorpicker-hsv-h .ui-colorpicker-number",e),inputs.s=$(".ui-colorpicker-hsv-s .ui-colorpicker-number",e),inputs.v=$(".ui-colorpicker-hsv-v .ui-colorpicker-number",e),$(".ui-colorpicker-number",e).bind("change keyup",function(){inst.color.setHSV(inputs.h.val()/360,inputs.s.val()/100,inputs.v.val()/100),inst._change()})},this.repaint=function(){var hsv=inst.color.getHSV();inputs.h.val(Math.round(360*hsv.h)),inputs.s.val(Math.round(100*hsv.s)),inputs.v.val(Math.round(100*hsv.v))},this.update=function(){$(".ui-colorpicker-mode",e).each(function(){var $this=$(this);$this.attr("checked",$this.val()===inst.mode)}),this.repaint()}},rgb:function(inst){var _html,e=null,inputs={};_html=function(){var html="";return inst.options.rgb&&(html+='<div class="ui-colorpicker-rgb-r"><input class="ui-colorpicker-mode" type="radio" value="r"/><label>'+inst._getRegional("rgbR")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="255"/></div><div class="ui-colorpicker-rgb-g"><input class="ui-colorpicker-mode" type="radio" value="g"/><label>'+inst._getRegional("rgbG")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="255"/></div><div class="ui-colorpicker-rgb-b"><input class="ui-colorpicker-mode" type="radio" value="b"/><label>'+inst._getRegional("rgbB")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="255"/></div>'),'<div class="ui-colorpicker-rgb">'+html+"</div>"},this.init=function(){e=$(_html()).appendTo($(".ui-colorpicker-rgb-container",inst.dialog)),$(".ui-colorpicker-mode",e).click(function(){inst.mode=$(this).val(),inst._updateAllParts()}),inputs.r=$(".ui-colorpicker-rgb-r .ui-colorpicker-number",e),inputs.g=$(".ui-colorpicker-rgb-g .ui-colorpicker-number",e),inputs.b=$(".ui-colorpicker-rgb-b .ui-colorpicker-number",e),$(".ui-colorpicker-number",e).bind("change keyup",function(){$(".ui-colorpicker-rgb-r .ui-colorpicker-number",e).val();inst.color.setRGB(inputs.r.val()/255,inputs.g.val()/255,inputs.b.val()/255),inst._change()})},this.repaint=function(){var rgb=inst.color.getRGB();inputs.r.val(Math.round(255*rgb.r)),inputs.g.val(Math.round(255*rgb.g)),inputs.b.val(Math.round(255*rgb.b))},this.update=function(){$(".ui-colorpicker-mode",e).each(function(){var $this=$(this);$this.attr("checked",$this.val()===inst.mode)}),this.repaint()}},lab:function(inst){var part=null,inputs={},html=function(){var html="";return inst.options.hsv&&(html+='<div class="ui-colorpicker-lab-l"><label>'+inst._getRegional("labL")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/></div><div class="ui-colorpicker-lab-a"><label>'+inst._getRegional("labA")+'</label><input class="ui-colorpicker-number" type="number" min="-128" max="127"/></div><div class="ui-colorpicker-lab-b"><label>'+inst._getRegional("labB")+'</label><input class="ui-colorpicker-number" type="number" min="-128" max="127"/></div>'),'<div class="ui-colorpicker-lab">'+html+"</div>"};this.init=function(){part=$(html()).appendTo($(".ui-colorpicker-lab-container",inst.dialog)),inputs.l=$(".ui-colorpicker-lab-l .ui-colorpicker-number",part),inputs.a=$(".ui-colorpicker-lab-a .ui-colorpicker-number",part),inputs.b=$(".ui-colorpicker-lab-b .ui-colorpicker-number",part),$(".ui-colorpicker-number",part).bind("change keyup",function(event){inst.color.setLAB(parseInt(inputs.l.val(),10)/100,(parseInt(inputs.a.val(),10)+128)/255,(parseInt(inputs.b.val(),10)+128)/255),inst._change()})},this.repaint=function(){var lab=inst.color.getLAB();inputs.l.val(Math.round(100*lab.l)),inputs.a.val(Math.round(255*lab.a)-128),inputs.b.val(Math.round(255*lab.b)-128)},this.update=this.repaint},cmyk:function(inst){var part=null,inputs={},html=function(){var html="";return inst.options.hsv&&(html+='<div class="ui-colorpicker-cmyk-c"><label>'+inst._getRegional("cmykC")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div><div class="ui-colorpicker-cmyk-m"><label>'+inst._getRegional("cmykM")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div><div class="ui-colorpicker-cmyk-y"><label>'+inst._getRegional("cmykY")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div><div class="ui-colorpicker-cmyk-k"><label>'+inst._getRegional("cmykK")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div>'),'<div class="ui-colorpicker-cmyk">'+html+"</div>"};this.init=function(){part=$(html()).appendTo($(".ui-colorpicker-cmyk-container",inst.dialog)),inputs.c=$(".ui-colorpicker-cmyk-c .ui-colorpicker-number",part),inputs.m=$(".ui-colorpicker-cmyk-m .ui-colorpicker-number",part),inputs.y=$(".ui-colorpicker-cmyk-y .ui-colorpicker-number",part),inputs.k=$(".ui-colorpicker-cmyk-k .ui-colorpicker-number",part),$(".ui-colorpicker-number",part).bind("change keyup",function(event){inst.color.setCMYK(parseInt(inputs.c.val(),10)/100,parseInt(inputs.m.val(),10)/100,parseInt(inputs.y.val(),10)/100,parseInt(inputs.k.val(),10)/100),inst._change()})},this.repaint=function(){var cmyk=inst.color.getCMYK();inputs.c.val(Math.round(100*cmyk.c)),inputs.m.val(Math.round(100*cmyk.m)),inputs.y.val(Math.round(100*cmyk.y)),inputs.k.val(Math.round(100*cmyk.k))},this.update=this.repaint},alpha:function(inst){var input,e=null,html=function(){var html="";return inst.options.alpha&&(html+='<div class="ui-colorpicker-a"><input class="ui-colorpicker-mode" name="mode" type="radio" value="a"/><label>'+inst._getRegional("alphaA")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div>'),'<div class="ui-colorpicker-alpha">'+html+"</div>"};this.init=function(){e=$(html()).appendTo($(".ui-colorpicker-alpha-container",inst.dialog)),$(".ui-colorpicker-mode",e).click(function(){inst.mode=$(this).val(),inst._updateAllParts()}),input=$(".ui-colorpicker-a .ui-colorpicker-number",e),$(".ui-colorpicker-number",e).bind("change keyup",function(){inst.color.setAlpha(input.val()/100),inst._change()})},this.update=function(){$(".ui-colorpicker-mode",e).each(function(){$(this).attr("checked",$(this).val()===inst.mode)}),this.repaint()},this.repaint=function(){input.val(Math.round(100*inst.color.getAlpha()))}},hex:function(inst){var _html,e=null,inputs={};_html=function(){var html="";return inst.options.alpha&&(html+='<input class="ui-colorpicker-hex-alpha" type="text" maxlength="2" size="2"/>'),html+='<input class="ui-colorpicker-hex-input" type="text" maxlength="6" size="6"/>','<div class="ui-colorpicker-hex"><label>#</label>'+html+"</div>"},this.init=function(){e=$(_html()).appendTo($(".ui-colorpicker-hex-container",inst.dialog)),inputs.color=$(".ui-colorpicker-hex-input",e),inputs.alpha=$(".ui-colorpicker-hex-alpha",e),inputs.color.bind("change keydown keyup",function(a,b,c){/[^a-fA-F0-9]/.test(inputs.color.val())&&inputs.color.val(inputs.color.val().replace(/[^a-fA-F0-9]/,""))}),inputs.color.bind("change keyup",function(){inst.color=_parseHex(inputs.color.val()).setAlpha(inst.color.getAlpha()),inst._change()}),inputs.alpha.bind("change keydown keyup",function(){/[^a-fA-F0-9]/.test(inputs.alpha)&&inputs.alpha.val(inputs.alpha.val().replace(/[^a-fA-F0-9]/,""))}),inputs.alpha.bind("change keyup",function(){inst.color.setAlpha(parseInt(inputs.alpha.val(),16)/255),inst._change()})},this.repaint=function(){inputs.color.is(":focus")||inputs.color.val(inst.color.toHex(!0)),inputs.alpha.is(":focus")||inputs.alpha.val(_intToHex(255*inst.color.getAlpha()))},this.update=this.repaint},swatches:function(inst){var html=function(){var html="";return inst._eachSwatch(function(name,color){var c=new $.colorpicker.Color(color.r,color.g,color.b),css=c.toCSS();html+='<div class="ui-colorpicker-swatch" style="background-color:'+css+'" title="'+name+'"></div>'}),'<div class="ui-colorpicker-swatches ui-colorpicker-border" style="width:'+inst.options.swatchesWidth+'px">'+html+"</div>"};this.init=function(){var part=$(html());$(".ui-colorpicker-swatches-container",inst.dialog).html(part),$(".ui-colorpicker-swatch",part).click(function(){inst.color=inst._parseColor($(this).css("background-color"))||new $.colorpicker.Color,inst._change()})}},footer:function(inst){var part=null,id_transparent="ui-colorpicker-special-transparent-"+inst.colorpicker_index,id_none="ui-colorpicker-special-none-"+inst.colorpicker_index,html=function(){var html="";return(inst.options.alpha||!inst.inline&&inst.options.showNoneButton)&&(html+='<div class="ui-colorpicker-buttonset">',inst.options.alpha&&(html+='<input type="radio" name="ui-colorpicker-special" id="'+id_transparent+'" class="ui-colorpicker-special-transparent"/><label for="'+id_transparent+'">'+inst._getRegional("transparent")+"</label>"),!inst.inline&&inst.options.showNoneButton&&(html+='<input type="radio" name="ui-colorpicker-special" id="'+id_none+'" class="ui-colorpicker-special-none"><label for="'+id_none+'">'+inst._getRegional("none")+"</label>"),html+="</div>"),inst.inline||(html+='<div class="ui-dialog-buttonset">',inst.options.showCancelButton&&(html+='<button class="ui-colorpicker-cancel">'+inst._getRegional("cancel")+"</button>"),html+='<button class="ui-colorpicker-ok">'+inst._getRegional("ok")+"</button>",html+="</div>"),'<div class="ui-dialog-buttonpane ui-widget-content">'+html+"</div>"};this.init=function(){part=$(html()).appendTo(inst.dialog),$(".ui-colorpicker-ok",part).button().click(function(){inst.close()}),$(".ui-colorpicker-cancel",part).button().click(function(){inst.close(!0)}),$(".ui-colorpicker-buttonset",part).buttonset(),$(".ui-colorpicker-special-color",part).click(function(){inst._change()}),$("#"+id_none,part).click(function(){inst.color.set=!1,inst._change()}),$("#"+id_transparent,part).click(function(){inst.color.setAlpha(0),inst._change()})},this.repaint=function(){inst.color.set?0===inst.color.getAlpha()?$(".ui-colorpicker-special-transparent",part).attr("checked",!0).button("refresh"):$("input",part).attr("checked",!1).button("refresh"):$(".ui-colorpicker-special-none",part).attr("checked",!0).button("refresh"),$(".ui-colorpicker-cancel",part).button(inst.changed?"enable":"disable")},this.update=function(){}}},this.Color=function(){var spaces={rgb:{r:0,g:0,b:0},hsv:{h:0,s:0,v:0},hsl:{h:0,s:0,l:0},lab:{l:0,a:0,b:0},cmyk:{c:0,m:0,y:0,k:1}},a=1,illuminant=[.9504285,1,1.0889],args=arguments,_clip=function(v){return isNaN(v)||null===v?0:("string"==typeof v&&(v=parseInt(v,10)),Math.max(0,Math.min(v,1)))},_hexify=function(number){var number=Math.round(number),digits="0123456789abcdef",lsd=number%16,msd=(number-lsd)/16,hexified=digits.charAt(msd)+digits.charAt(lsd);return hexified},_rgb_to_xyz=function(rgb){var r=rgb.r>.04045?Math.pow((rgb.r+.055)/1.055,2.4):rgb.r/12.92,g=rgb.g>.04045?Math.pow((rgb.g+.055)/1.055,2.4):rgb.g/12.92,b=rgb.b>.04045?Math.pow((rgb.b+.055)/1.055,2.4):rgb.b/12.92;return{x:.4124*r+.3576*g+.1805*b,y:.2126*r+.7152*g+.0722*b,z:.0193*r+.1192*g+.9505*b}},_xyz_to_rgb=function(xyz){var rgb={r:3.2406*xyz.x+-1.5372*xyz.y+xyz.z*-.4986,g:xyz.x*-.9689+1.8758*xyz.y+.0415*xyz.z,b:.0557*xyz.x+xyz.y*-.204+1.057*xyz.z};return rgb.r=rgb.r>.0031308?1.055*Math.pow(rgb.r,1/2.4)-.055:12.92*rgb.r,rgb.g=rgb.g>.0031308?1.055*Math.pow(rgb.g,1/2.4)-.055:12.92*rgb.g,rgb.b=rgb.b>.0031308?1.055*Math.pow(rgb.b,1/2.4)-.055:12.92*rgb.b,rgb},_rgb_to_hsv=function(rgb){var del_R,del_G,del_B,minVal=Math.min(rgb.r,rgb.g,rgb.b),maxVal=Math.max(rgb.r,rgb.g,rgb.b),delta=maxVal-minVal,hsv={h:0,s:0,v:maxVal};return 0===delta?(hsv.h=0,hsv.s=0):(hsv.s=delta/maxVal,del_R=((maxVal-rgb.r)/6+delta/2)/delta,del_G=((maxVal-rgb.g)/6+delta/2)/delta,del_B=((maxVal-rgb.b)/6+delta/2)/delta,rgb.r===maxVal?hsv.h=del_B-del_G:rgb.g===maxVal?hsv.h=1/3+del_R-del_B:rgb.b===maxVal&&(hsv.h=2/3+del_G-del_R),hsv.h<0?hsv.h+=1:hsv.h>1&&(hsv.h-=1)),hsv},_hsv_to_rgb=function(hsv){var var_h,var_i,var_1,var_2,var_3,rgb={r:0,g:0,b:0};return 0===hsv.s?rgb.r=rgb.g=rgb.b=hsv.v:(var_h=1===hsv.h?0:6*hsv.h,var_i=Math.floor(var_h),var_1=hsv.v*(1-hsv.s),var_2=hsv.v*(1-hsv.s*(var_h-var_i)),var_3=hsv.v*(1-hsv.s*(1-(var_h-var_i))),0===var_i?(rgb.r=hsv.v,rgb.g=var_3,rgb.b=var_1):1===var_i?(rgb.r=var_2,rgb.g=hsv.v,rgb.b=var_1):2===var_i?(rgb.r=var_1,rgb.g=hsv.v,rgb.b=var_3):3===var_i?(rgb.r=var_1,rgb.g=var_2,rgb.b=hsv.v):4===var_i?(rgb.r=var_3,rgb.g=var_1,rgb.b=hsv.v):(rgb.r=hsv.v,rgb.g=var_1,rgb.b=var_2)),rgb},_rgb_to_hsl=function(rgb){var del_R,del_G,del_B,minVal=Math.min(rgb.r,rgb.g,rgb.b),maxVal=Math.max(rgb.r,rgb.g,rgb.b),delta=maxVal-minVal,hsl={h:0,s:0,l:(maxVal+minVal)/2};return 0===delta?(hsl.h=0,hsl.s=0):(hsl.s=hsl.l<.5?delta/(maxVal+minVal):delta/(2-maxVal-minVal),del_R=((maxVal-rgb.r)/6+delta/2)/delta,del_G=((maxVal-rgb.g)/6+delta/2)/delta,del_B=((maxVal-rgb.b)/6+delta/2)/delta,rgb.r===maxVal?hsl.h=del_B-del_G:rgb.g===maxVal?hsl.h=1/3+del_R-del_B:rgb.b===maxVal&&(hsl.h=2/3+del_G-del_R),hsl.h<0?hsl.h+=1:hsl.h>1&&(hsl.h-=1)),hsl},_hsl_to_rgb=function(hsl){var var_1,var_2,hue_to_rgb=function(v1,v2,vH){return 0>vH&&(vH+=1),vH>1&&(vH-=1),1>6*vH?v1+6*(v2-v1)*vH:1>2*vH?v2:2>3*vH?v1+(v2-v1)*(2/3-vH)*6:v1};return 0===hsl.s?{r:hsl.l,g:hsl.l,b:hsl.l}:(var_2=hsl.l<.5?hsl.l*(1+hsl.s):hsl.l+hsl.s-hsl.s*hsl.l,var_1=2*hsl.l-var_2,{r:hue_to_rgb(var_1,var_2,hsl.h+1/3),g:hue_to_rgb(var_1,var_2,hsl.h),b:hue_to_rgb(var_1,var_2,hsl.h-1/3)})},_xyz_to_lab=function(xyz){var x=xyz.x/illuminant[0],y=xyz.y/illuminant[1],z=xyz.z/illuminant[2];return x=x>.008856?Math.pow(x,1/3):7.787*x+16/116,y=y>.008856?Math.pow(y,1/3):7.787*y+16/116,z=z>.008856?Math.pow(z,1/3):7.787*z+16/116,{l:(116*y-16)/100,a:(500*(x-y)+128)/255,b:(200*(y-z)+128)/255}},_lab_to_xyz=function(lab){var lab2={l:100*lab.l,a:255*lab.a-128,b:255*lab.b-128},xyz={x:0,y:(lab2.l+16)/116,z:0};return xyz.x=lab2.a/500+xyz.y,xyz.z=xyz.y-lab2.b/200,xyz.x=Math.pow(xyz.x,3)>.008856?Math.pow(xyz.x,3):(xyz.x-16/116)/7.787,xyz.y=Math.pow(xyz.y,3)>.008856?Math.pow(xyz.y,3):(xyz.y-16/116)/7.787,xyz.z=Math.pow(xyz.z,3)>.008856?Math.pow(xyz.z,3):(xyz.z-16/116)/7.787,xyz.x*=illuminant[0],xyz.y*=illuminant[1],xyz.z*=illuminant[2],xyz},_rgb_to_cmy=function(rgb){return{c:1-rgb.r,m:1-rgb.g,y:1-rgb.b}},_cmy_to_rgb=function(cmy){return{r:1-cmy.c,g:1-cmy.m,b:1-cmy.y}},_cmy_to_cmyk=function(cmy){var K=1;return cmy.c<K&&(K=cmy.c),cmy.m<K&&(K=cmy.m),cmy.y<K&&(K=cmy.y),1===K?{c:0,m:0,y:0,k:1}:{c:(cmy.c-K)/(1-K),m:(cmy.m-K)/(1-K),y:(cmy.y-K)/(1-K),k:K}},_cmyk_to_cmy=function(cmyk){return{c:cmyk.c*(1-cmyk.k)+cmyk.k,m:cmyk.m*(1-cmyk.k)+cmyk.k,y:cmyk.y*(1-cmyk.k)+cmyk.k}};this.set=!1,this.setAlpha=function(_a){return null!==_a&&(a=_clip(_a)),this.set=!0,this},this.getAlpha=function(){return a},this.setRGB=function(r,g,b){return spaces={rgb:this.getRGB()},null!==r&&(spaces.rgb.r=_clip(r)),null!==g&&(spaces.rgb.g=_clip(g)),null!==b&&(spaces.rgb.b=_clip(b)),this.set=!0,this;
},this.setHSV=function(h,s,v){return spaces={hsv:this.getHSV()},null!==h&&(spaces.hsv.h=_clip(h)),null!==s&&(spaces.hsv.s=_clip(s)),null!==v&&(spaces.hsv.v=_clip(v)),this.set=!0,this},this.setHSL=function(h,s,l){return spaces={hsl:this.getHSL()},null!==h&&(spaces.hsl.h=_clip(h)),null!==s&&(spaces.hsl.s=_clip(s)),null!==l&&(spaces.hsl.l=_clip(l)),this.set=!0,this},this.setLAB=function(l,a,b){return spaces={lab:this.getLAB()},null!==l&&(spaces.lab.l=_clip(l)),null!==a&&(spaces.lab.a=_clip(a)),null!==b&&(spaces.lab.b=_clip(b)),this.set=!0,this},this.setCMYK=function(c,m,y,k){return spaces={cmyk:this.getCMYK()},null!==c&&(spaces.cmyk.c=_clip(c)),null!==m&&(spaces.cmyk.m=_clip(m)),null!==y&&(spaces.cmyk.y=_clip(y)),null!==k&&(spaces.cmyk.k=_clip(k)),this.set=!0,this},this.getRGB=function(){return spaces.rgb||(spaces.rgb=spaces.lab?_xyz_to_rgb(_lab_to_xyz(spaces.lab)):spaces.hsv?_hsv_to_rgb(spaces.hsv):spaces.hsl?_hsl_to_rgb(spaces.hsl):spaces.cmyk?_cmy_to_rgb(_cmyk_to_cmy(spaces.cmyk)):{r:0,g:0,b:0},spaces.rgb.r=_clip(spaces.rgb.r),spaces.rgb.g=_clip(spaces.rgb.g),spaces.rgb.b=_clip(spaces.rgb.b)),$.extend({},spaces.rgb)},this.getHSV=function(){return spaces.hsv||(spaces.hsv=spaces.lab?_rgb_to_hsv(this.getRGB()):spaces.rgb?_rgb_to_hsv(spaces.rgb):spaces.hsl?_rgb_to_hsv(this.getRGB()):spaces.cmyk?_rgb_to_hsv(this.getRGB()):{h:0,s:0,v:0},spaces.hsv.h=_clip(spaces.hsv.h),spaces.hsv.s=_clip(spaces.hsv.s),spaces.hsv.v=_clip(spaces.hsv.v)),$.extend({},spaces.hsv)},this.getHSL=function(){return spaces.hsl||(spaces.hsl=spaces.rgb?_rgb_to_hsl(spaces.rgb):spaces.hsv?_rgb_to_hsl(this.getRGB()):spaces.cmyk?_rgb_to_hsl(this.getRGB()):spaces.hsv?_rgb_to_hsl(this.getRGB()):{h:0,s:0,l:0},spaces.hsl.h=_clip(spaces.hsl.h),spaces.hsl.s=_clip(spaces.hsl.s),spaces.hsl.l=_clip(spaces.hsl.l)),$.extend({},spaces.hsl)},this.getCMYK=function(){return spaces.cmyk||(spaces.cmyk=spaces.rgb?_cmy_to_cmyk(_rgb_to_cmy(spaces.rgb)):spaces.hsv?_cmy_to_cmyk(_rgb_to_cmy(this.getRGB())):spaces.hsl?_cmy_to_cmyk(_rgb_to_cmy(this.getRGB())):spaces.lab?_cmy_to_cmyk(_rgb_to_cmy(this.getRGB())):{c:0,m:0,y:0,k:1},spaces.cmyk.c=_clip(spaces.cmyk.c),spaces.cmyk.m=_clip(spaces.cmyk.m),spaces.cmyk.y=_clip(spaces.cmyk.y),spaces.cmyk.k=_clip(spaces.cmyk.k)),$.extend({},spaces.cmyk)},this.getLAB=function(){return spaces.lab||(spaces.lab=spaces.rgb?_xyz_to_lab(_rgb_to_xyz(spaces.rgb)):spaces.hsv?_xyz_to_lab(_rgb_to_xyz(this.getRGB())):spaces.hsl?_xyz_to_lab(_rgb_to_xyz(this.getRGB())):spaces.cmyk?_xyz_to_lab(_rgb_to_xyz(this.getRGB())):{l:0,a:0,b:0},spaces.lab.l=_clip(spaces.lab.l),spaces.lab.a=_clip(spaces.lab.a),spaces.lab.b=_clip(spaces.lab.b)),$.extend({},spaces.lab)},this.getChannels=function(){return{r:this.getRGB().r,g:this.getRGB().g,b:this.getRGB().b,a:this.getAlpha(),h:this.getHSV().h,s:this.getHSV().s,v:this.getHSV().v,c:this.getCMYK().c,m:this.getCMYK().m,y:this.getCMYK().y,k:this.getCMYK().k,L:this.getLAB().l,A:this.getLAB().a,B:this.getLAB().b}},this.getSpaces=function(){return $.extend(!0,{},spaces)},this.distance=function(color){var channel,space="lab",getter="get"+space.toUpperCase(),a=this[getter](),b=color[getter](),distance=0;for(channel in a)distance+=Math.pow(a[channel]-b[channel],2);return distance},this.equals=function(color){if(color){var a=this.getRGB(),b=color.getRGB();return this.set===color.set&&this.getAlpha()===color.getAlpha()&&a.r===b.r&&a.g===b.g&&a.b===b.b}return!1},this.limit=function(steps){steps-=1;var rgb=this.getRGB();this.setRGB(Math.round(rgb.r*steps)/steps,Math.round(rgb.g*steps)/steps,Math.round(rgb.b*steps)/steps)},this.toHex=function(){var rgb=this.getRGB();return _hexify(255*rgb.r)+_hexify(255*rgb.g)+_hexify(255*rgb.b)},this.toCSS=function(){return"#"+this.toHex()},this.copy=function(){var color=new $.colorpicker.Color(this.getSpaces(),this.getAlpha());return color.set=this.set,color},2===args.length&&(spaces=args[0],this.setAlpha(0===args[1]?0:args[1]||1),this.set=!0),args.length>2&&(this.setRGB(args[0],args[1],args[2]),this.setAlpha(0===args[3]?0:args[3]||1),this.set=!0)}},$.widget("vanderlee.colorpicker",{options:{alpha:!1,altAlpha:!0,altField:"",altOnChange:!0,altProperties:"background-color",autoOpen:!1,buttonClass:null,buttonColorize:!1,buttonImage:"images/ui-colorpicker.png",buttonImageOnly:!1,buttonText:null,closeOnEscape:!0,closeOnOutside:!0,color:"#00FF00",colorFormat:"HEX",draggable:!0,containment:null,duration:"fast",hideOn:"button",hsv:!0,inline:!0,inlineFrame:!0,layout:{map:[0,0,1,5],bar:[1,0,1,5],preview:[2,0,1,1],hsv:[2,1,1,1],rgb:[2,2,1,1],alpha:[2,3,1,1],hex:[2,4,1,1],lab:[3,1,1,1],cmyk:[3,2,1,2],swatches:[4,0,1,5]},limit:"",modal:!1,mode:"h",okOnEnter:!1,parts:"",part:{map:{size:256},bar:{size:256}},position:null,regional:"",revert:!1,rgb:!0,showAnim:"fadeIn",showCancelButton:!0,showNoneButton:!1,showCloseButton:!0,showOn:"focus click alt",showOptions:{},swatches:null,swatchesWidth:84,title:null,cancel:null,close:null,init:null,ok:null,open:null,select:null,stop:null},_create:function(){var text,that=this;return that.colorpicker_index=_colorpicker_index++,that.widgetEventPrefix="colorpicker",that.opened=!1,that.generated=!1,that.inline=!1,that.changed=!1,that.dialog=null,that.button=null,that.image=null,that.overlay=null,that.events={window_resize:null,document_keydown:null,document_click_html:null},that.mode=that.options.mode,that.element.is("input")||that.options.inline===!1?(that._setColor(that.element.is("input")?that.element.val():that.options.color),that._callback("init"),/\bfocus|all|both\b/.test(that.options.showOn)&&that.element.bind("focus",function(){that.open()}),/\bfocus|all|both\b/.test(that.options.hideOn)&&that.element.bind("focusout",function(e){that.close()}),/\bclick|all|both\b/.test(that.options.showOn)&&that.element.bind("click",function(e){that.opened&&/\bclick|all|both\b/.test(that.options.hideOn)?that.close():that.open()}),/\bbutton|all|both\b/.test(that.options.showOn)&&(""!==that.options.buttonImage&&(text=that.options.buttonText||that._getRegional("button"),that.image=$("<img/>").attr({src:that.options.buttonImage,alt:text,title:text}),that.options.buttonClass&&that.image.attr("class",that.options.buttonClass),that._setImageBackground()),that.options.buttonImageOnly&&that.image?that.button=that.image:(that.button=$('<button type="button"></button>').html(that.image||that.options.buttonText).button(),that.image=that.image?$("img",that.button).first():null),that.button.insertAfter(that.element).click(function(){that.opened&&/\bbutton|all|both\b/.test(that.options.hideOn)?that.close():that.open()})),/\balt|all|both\b/.test(that.options.showOn)&&$(that.options.altField).bind("click",function(){that.opened&&/\balt|all|both\b/.test(that.options.hideOn)?that.close():that.open()}),that.options.autoOpen&&that.open()):(that.inline=!0,that._generate(),that.opened=!0),this},_setOption:function(key,value){switch(key){case"disabled":value?this.dialog.addClass("ui-colorpicker-disabled"):this.dialog.removeClass("ui-colorpicker-disabled");break;case"swatches":this.options.swatches=value,this.parts.swatches.init()}$.Widget.prototype._setOption.apply(this,arguments)},_setImageBackground:function(){this.image&&this.options.buttonColorize&&this.image.css("background-color",this.color.set?this._formatColor("RGBA",this.color):"")},_setAltField:function(){if(this.options.altOnChange&&this.options.altField&&this.options.altProperties){var index,property,properties=this.options.altProperties.split(",");for(index=0;index<=properties.length;++index)switch(property=$.trim(properties[index])){case"color":case"fill":case"stroke":case"background-color":case"backgroundColor":case"outline-color":case"border-color":$(this.options.altField).css(property,this.color.set?this.color.toCSS():"")}this.options.altAlpha&&$(this.options.altField).css("opacity",this.color.set?this.color.getAlpha():"")}},_setColor:function(text){this.color=this._parseColor(text)||new $.colorpicker.Color,this.currentColor=this.color.copy(),this._setImageBackground(),this._setAltField()},setColor:function(text){this._setColor(text),this._change()},getColor:function(format){return this._formatColor(format||this.options.colorFormat,this.color)},_generateInline:function(){var that=this;$(that.element).html(that.options.inlineFrame?_container_inlineFrame:_container_inline),that.dialog=$(".ui-colorpicker",that.element)},_generatePopup:function(){var that=this;that.dialog=$(_container_popup).appendTo("body"),null===that.events.document_click_html&&$(document).delegate("html","touchstart click",that.events.document_click_html=function(event){if(that.opened&&event.target!==that.element[0]&&!that.overlay){if(that.dialog.is(event.target)||that.dialog.has(event.target).length>0)return void that.element.blur();var p,parents=$(event.target).parents();for(parents.push(event.target),p=0;p<=parents.length;++p){if(null!==that.button&&parents[p]===that.button[0])return;if(/\balt|all|both\b/.test(that.options.showOn)&&$(that.options.altField).is(parents[p]))return}that.options.closeOnOutside&&that.close(that.options.revert)}}),null===that.events.document_keydown&&$(document).bind("keydown",that.events.document_keydown=function(event){that.opened&&27===event.keyCode&&that.options.closeOnEscape&&that.close(that.options.revert),that.opened&&13===event.keyCode&&that.options.okOnEnter&&that.close()}),that.element.keydown(function(event){9===event.keyCode&&that.close()}).keyup(function(event){var color=that._parseColor(that.element.val());color&&!that.color.equals(color)&&(that.color=color,that._change())})},_generate:function(){var parts_list,layout_parts,table,classes,that=this;that._setColor(that.inline||!that.element.is("input")?that.options.color:that.element.val()),that[that.inline?"_generateInline":"_generatePopup"](),parts_list="string"==typeof that.options.parts?$.colorpicker.partslists[that.options.parts]?$.colorpicker.partslists[that.options.parts]:$.colorpicker.partslists[that.inline?"inline":"popup"]:that.options.parts,that.parts={},$.each(parts_list,function(index,part){$.colorpicker.parts[part]&&(that.parts[part]=new $.colorpicker.parts[part](that))}),that.generated||(layout_parts=[],$.each(that.options.layout,function(part,pos){that.parts[part]&&layout_parts.push({part:part,pos:pos})}),table=$(_layoutTable(layout_parts,function(cell,x,y){return classes=["ui-colorpicker-"+cell.part+"-container"],x>0&&classes.push("ui-colorpicker-padding-left"),y>0&&classes.push("ui-colorpicker-padding-top"),'<td  class="'+classes.join(" ")+'"'+(cell.pos[2]>1?' colspan="'+cell.pos[2]+'"':"")+(cell.pos[3]>1?' rowspan="'+cell.pos[3]+'"':"")+' valign="top"></td>'})).appendTo(that.dialog),that.options.inlineFrame&&table.addClass("ui-dialog-content ui-widget-content"),that._initAllParts(),that._updateAllParts(),that.generated=!0)},_effectGeneric:function(element,show,slide,fade,callback){var that=this;$.effects&&$.effects[that.options.showAnim]?element[show](that.options.showAnim,that.options.showOptions,that.options.duration,callback):(element["slideDown"===that.options.showAnim?slide:"fadeIn"===that.options.showAnim?fade:show](that.options.showAnim?that.options.duration:null,callback),that.options.showAnim&&that.options.duration||callback())},_effectShow:function(element,callback){this._effectGeneric(element,"show","slideDown","fadeIn",callback)},_effectHide:function(element,callback){this._effectGeneric(element,"hide","slideUp","fadeOut",callback)},open:function(){var zIndex,element,position,that=this;that.opened||(that._generate(),element=that.element.is(":hidden")?$("<div/>").insertBefore(that.element):that.element,that.element.is(":hidden")&&element.remove(),zIndex=0,$(that.element[0]).parents().each(function(){var z=$(this).css("z-index");if("number"!=typeof z&&"string"!=typeof z||""===z||isNaN(z))$(this).siblings().each(function(){var z=$(this).css("z-index");"number"!=typeof z&&"string"!=typeof z||""===z||isNaN(z)||z>zIndex&&(zIndex=parseInt(z,10))});else if(z>zIndex)return zIndex=parseInt(z,10),!1}),zIndex+=2,that.dialog.css("z-index",zIndex),that.options.modal&&(that.overlay=$('<div class="ui-widget-overlay"></div>').appendTo("body").css("z-index",zIndex-1),null!==that.events.window_resize&&$(window).unbind("resize",that.events.window_resize),that.events.window_resize=function(){that.overlay&&(that.overlay.width($(document).width()),that.overlay.height($(document).height()))},$(window).bind("resize",that.events.window_resize),that.events.window_resize()),that._effectShow(this.dialog),that.options.position?(position=$.extend({},that.options.position),"element"===position.of&&(position.of=element)):position={my:"left top",at:"left bottom",of:element,collision:"flip"},that.dialog.position(position),that.opened=!0,that._callback("open",!0),$(function(){that._repaintAllParts()}))},close:function(cancel){var that=this;that.opened&&(cancel?(that.color=that.currentColor.copy(),that._change(),that._callback("cancel",!0)):(that.currentColor=that.color.copy(),that._callback("ok",!0)),that.changed=!1,that.overlay&&($(window).unbind("resize",that.events.window_resize),that.overlay.remove()),that._effectHide(that.dialog,function(){that.dialog.remove(),that.dialog=null,that.generated=!1,that.opened=!1,that._callback("close",!0)}))},destroy:function(){null!==that.events.document_click_html&&$(document).undelegate("html","touchstart click",that.events.document_click_html),null!==that.events.document_keydown&&$(document).unbind("keydown",that.events.document_keydown),null!==that.events.resizeOverlay&&$(window).unbind("resize",that.events.resizeOverlay),this.element.unbind(),this.overlay&&this.overlay.remove(),null!==this.dialog&&this.dialog.remove(),null!==this.image&&this.image.remove(),null!==this.button&&this.button.remove()},_callback:function(callback,spaces){var data,lab,that=this;return that.color.set?(data={formatted:that._formatColor(that.options.colorFormat,that.color),colorPicker:that},lab=that.color.getLAB(),lab.a=2*lab.a-1,lab.b=2*lab.b-1,spaces===!0&&(data.a=that.color.getAlpha(),data.rgb=that.color.getRGB(),data.hsv=that.color.getHSV(),data.cmyk=that.color.getCMYK(),data.hsl=that.color.getHSL(),data.lab=lab),that._trigger(callback,null,data)):that._trigger(callback,null,{formatted:"",colorPicker:that})},_initAllParts:function(){$.each(this.parts,function(index,part){part.init&&part.init()})},_updateAllParts:function(){$.each(this.parts,function(index,part){part.update&&part.update()})},_repaintAllParts:function(){$.each(this.parts,function(index,part){part.repaint&&part.repaint()})},_change:function(stop){this.changed=!0,stop="undefined"!=typeof stop?!!stop:!0,this.color.set&&this.options.limit&&$.colorpicker.limits[this.options.limit]&&$.colorpicker.limits[this.options.limit](this.color,this),this.inline||(this.color.set?this.color.equals(this._parseColor(this.element.val()))||this.element.val(this._formatColor(this.options.colorFormat,this.color)).change():""!==this.element.val()&&this.element.val("").change(),this._setImageBackground(),this._setAltField()),this.options.color=this.color.set?this.color.toCSS():"",this.opened&&this._repaintAllParts(),this._callback("select"),stop&&this._callback("stop")},_hoverable:function(e){e.hover(function(){e.addClass("ui-state-hover")},function(){e.removeClass("ui-state-hover")})},_focusable:function(e){e.focus(function(){e.addClass("ui-state-focus")}).blur(function(){e.removeClass("ui-state-focus")})},_getRegional:function(name){return void 0!==$.colorpicker.regional[this.options.regional][name]?$.colorpicker.regional[this.options.regional][name]:$.colorpicker.regional[""][name]},_getSwatches:function(){return"string"==typeof this.options.swatches?$.colorpicker.swatches[this.options.swatches]:$.isPlainObject(this.options.swatches)?this.options.swatches:$.colorpicker.swatches.html},_eachSwatch:function(callback){var name,currentSwatches=this._getSwatches();$.each(currentSwatches,function(nameOrIndex,swatch){return name=$.isArray(currentSwatches)?swatch.name:nameOrIndex,callback(name,swatch)})},_getSwatch:function(name){var swatch=!1;return this._eachSwatch(function(swatchName,current){return swatchName.toLowerCase()==name.toLowerCase()?(swatch=current,!1):void 0}),swatch},_parseFormat:function(format,text){var color,pattern,typeRegexps={x:function(){return"([0-9a-fA-F]{2})"},d:function(){return"([12]?[0-9]{1,2})"},f:function(){return"([0-9]*\\.?[0-9]*)"},p:function(){return"([0-9]*\\.?[0-9]*)"}},typeConverters={x:function(v){return parseInt(v,16)/255},d:function(v){return v/255},f:function(v){return v},p:function(v){return.01*v}},setters={r:"setRGB",g:"setRGB",b:"setRGB",h:"setHSV",s:"setHSV",v:"setHSV",c:"setCMYK",m:"setCMYK",y:"setCMYK",k:"setCMYK",L:"setLAB",A:"setLAB",B:"setLAB"},setterChannels={setRGB:["r","g","b"],setHSV:["h","s","v"],setCMYK:["c","m","y","k"],setLAB:["L","A","B"]},channels=[],converters=[],setter=null;if(pattern=format.replace(/[()\\^$.|?*+[\]]/g,function(m){return"\\"+m}),pattern=pattern.replace(/\\?[argbhsvcmykLAB][xdfp]/g,function(variable){if(variable.match(/^\\/))return variable.slice(1);var channel=variable.charAt(0),type=variable.charAt(1);return channels.push(channel),converters.push(typeConverters[type]),setters[channel]&&(setter=setters[channel]),typeRegexps[type]()}),setter){var values=text.match(new RegExp(pattern));if(values){var channelIndex,args=[];values.shift(),$.each(setterChannels[setter],function(index,channel){channelIndex=$.inArray(channel,channels),args[index]=converters[channelIndex](values[channelIndex])}),color=new $.colorpicker.Color,color[setter].apply(color,args)}}return color},_parseColor:function(text){var color,that=this,formats=$.isArray(that.options.colorFormat)?that.options.colorFormat:[that.options.colorFormat];return $.each(formats,function(index,format){return color=$.colorpicker.parsers[format]?$.colorpicker.parsers[format](text,that):that._parseFormat(format,text),color?!1:void 0}),color||$.each($.colorpicker.parsers,function(name,parser){return color=parser(text,that),color?!1:void 0}),color?color:!1},_exactName:function(color){var name=!1;return this._eachSwatch(function(n,swatch){return color.equals(new $.colorpicker.Color(swatch.r,swatch.g,swatch.b))?(name=n,!1):void 0}),name},_closestName:function(color){var d,distance=(color.getRGB(),null),name=!1;return this._eachSwatch(function(n,swatch){if(d=color.distance(new $.colorpicker.Color(swatch.r,swatch.g,swatch.b)),distance>d||null===distance){if(name=n,1e-20>=d)return!1;distance=d}}),name},_formatColor:function(formats,color){var that=this,text=null,types={x:function(v){return _intToHex(255*v)},d:function(v){return Math.round(255*v)},f:function(v){return v},p:function(v){return 100*v}},channels=color.getChannels();return $.isArray(formats)||(formats=[formats]),$.each(formats,function(index,format){return $.colorpicker.writers[format]?(text=$.colorpicker.writers[format](color,that),text===!1):(text=format.replace(/\\?[argbhsvcmykLAB][xdfp]/g,function(m){return m.match(/^\\/)?m.slice(1):types[m.charAt(1)](channels[m.charAt(0)])}),!1)}),text}}),$.vanderlee.colorpicker}),function($){$.fn.editable=function(target,options){if("disable"==target)return void $(this).data("disabled.editable",!0);if("enable"==target)return void $(this).data("disabled.editable",!1);if("destroy"==target)return void $(this).unbind($(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable");var settings=$.extend({},$.fn.editable.defaults,{target:target},options),plugin=$.editable.types[settings.type].plugin||function(){},submit=$.editable.types[settings.type].submit||function(){},buttons=$.editable.types[settings.type].buttons||$.editable.types.defaults.buttons,content=$.editable.types[settings.type].content||$.editable.types.defaults.content,element=$.editable.types[settings.type].element||$.editable.types.defaults.element,reset=$.editable.types[settings.type].reset||$.editable.types.defaults.reset,callback=settings.callback||function(){},onedit=settings.onedit||function(){},onsubmit=settings.onsubmit||function(){},onreset=settings.onreset||function(){},onerror=settings.onerror||reset;return settings.tooltip&&$(this).attr("title",settings.tooltip),settings.autowidth="auto"==settings.width,settings.autoheight="auto"==settings.height,this.each(function(){var self=this,savedwidth=$(self).width(),savedheight=$(self).height();$(this).data("event.editable",settings.event),$.trim($(this).html())||$(this).html(settings.placeholder),$(this).bind(settings.event,function(e){if(!0!==$(this).data("disabled.editable")&&!self.editing&&!1!==onedit.apply(this,[settings,self])){e.preventDefault(),e.stopPropagation(),settings.tooltip&&$(self).removeAttr("title"),0==$(self).width()?(settings.width=savedwidth,settings.height=savedheight):("none"!=settings.width&&(settings.width=settings.autowidth?$(self).width():settings.width),"none"!=settings.height&&(settings.height=settings.autoheight?$(self).height():settings.height)),$(this).html().toLowerCase().replace(/(;|"|\/)/g,"")==settings.placeholder.toLowerCase().replace(/(;|"|\/)/g,"")&&$(this).html(""),self.editing=!0,self.revert=$(self).html(),$(self).html("");var form=$("<form />");settings.cssclass&&("inherit"==settings.cssclass?form.attr("class",$(self).attr("class")):form.attr("class",settings.cssclass)),settings.style&&("inherit"==settings.style?(form.attr("style",$(self).attr("style")),form.css("display",$(self).css("display"))):form.attr("style",settings.style));var input_content,input=element.apply(form,[settings,self]);if(settings.loadurl){var t=setTimeout(function(){input.disabled=!0,content.apply(form,[settings.loadtext,settings,self])},100),loaddata={};loaddata[settings.id]=self.id,$.isFunction(settings.loaddata)?$.extend(loaddata,settings.loaddata.apply(self,[self.revert,settings])):$.extend(loaddata,settings.loaddata),$.ajax({type:settings.loadtype,url:settings.loadurl,data:loaddata,async:!1,success:function(result){window.clearTimeout(t),input_content=result,input.disabled=!1}})}else settings.data?(input_content=settings.data,$.isFunction(settings.data)&&(input_content=settings.data.apply(self,[self.revert,settings]))):input_content=self.revert;content.apply(form,[input_content,settings,self]),input.attr("name",settings.name),buttons.apply(form,[settings,self]),$(self).append(form),plugin.apply(form,[settings,self]),$(":input:visible:enabled:first",form).focus(),settings.select&&input.select(),input.keydown(function(e){27==e.keyCode&&(e.preventDefault(),reset.apply(form,[settings,self]))});var t;"cancel"==settings.onblur?input.blur(function(e){t=setTimeout(function(){reset.apply(form,[settings,self])},500)}):"submit"==settings.onblur?input.blur(function(e){t=setTimeout(function(){form.submit()},200)}):$.isFunction(settings.onblur)?input.blur(function(e){settings.onblur.apply(self,[input.val(),settings])}):input.blur(function(e){}),form.submit(function(e){if(t&&clearTimeout(t),e.preventDefault(),!1!==onsubmit.apply(form,[settings,self])&&!1!==submit.apply(form,[settings,self]))if($.isFunction(settings.target)){var str=settings.target.apply(self,[input.val(),settings]);$(self).html(str),self.editing=!1,callback.apply(self,[self.innerHTML,settings]),$.trim($(self).html())||$(self).html(settings.placeholder)}else{var submitdata={};submitdata[settings.name]=input.val(),submitdata[settings.id]=self.id,$.isFunction(settings.submitdata)?$.extend(submitdata,settings.submitdata.apply(self,[self.revert,settings])):$.extend(submitdata,settings.submitdata),"PUT"==settings.method&&(submitdata._method="put"),$(self).html(settings.indicator);var ajaxoptions={type:"POST",data:submitdata,dataType:"html",url:settings.target,success:function(result,status){"html"==ajaxoptions.dataType&&$(self).html(result),self.editing=!1,callback.apply(self,[result,settings]),$.trim($(self).html())||$(self).html(settings.placeholder)},error:function(xhr,status,error){onerror.apply(form,[settings,self,xhr])}};$.extend(ajaxoptions,settings.ajaxoptions),$.ajax(ajaxoptions)}return $(self).attr("title",settings.tooltip),!1})}}),this.reset=function(form){this.editing&&!1!==onreset.apply(form,[settings,self])&&($(self).html(self.revert),self.editing=!1,$.trim($(self).html())||$(self).html(settings.placeholder),settings.tooltip&&$(self).attr("title",settings.tooltip))}})},$.editable={types:{defaults:{element:function(settings,original){var input=$('<input type="hidden"></input>');return $(this).append(input),input},content:function(string,settings,original){$(":input:first",this).val(string)},reset:function(settings,original){original.reset(this)},buttons:function(settings,original){var form=this;if(settings.submit){if(settings.submit.match(/>$/))var submit=$(settings.submit).click(function(){"submit"!=submit.attr("type")&&form.submit()});else{var submit=$('<button type="submit" />');submit.html(settings.submit)}$(this).append(submit)}if(settings.cancel){if(settings.cancel.match(/>$/))var cancel=$(settings.cancel);else{var cancel=$('<button type="cancel" />');cancel.html(settings.cancel)}$(this).append(cancel),$(cancel).click(function(event){if($.isFunction($.editable.types[settings.type].reset))var reset=$.editable.types[settings.type].reset;else var reset=$.editable.types.defaults.reset;return reset.apply(form,[settings,original]),!1})}}},text:{element:function(settings,original){var input=$("<input />");return"none"!=settings.width&&input.width(settings.width),"none"!=settings.height&&input.height(settings.height),input.attr("autocomplete","off"),$(this).append(input),input}},textarea:{element:function(settings,original){var textarea=$("<textarea />");return settings.rows?textarea.attr("rows",settings.rows):"none"!=settings.height&&textarea.height(settings.height),settings.cols?textarea.attr("cols",settings.cols):"none"!=settings.width&&textarea.width(settings.width),$(this).append(textarea),textarea}},select:{element:function(settings,original){var select=$("<select />");return $(this).append(select),select},content:function(data,settings,original){if(String==data.constructor)eval("var json = "+data);else var json=data;for(var key in json)if(json.hasOwnProperty(key)&&"selected"!=key){var option=$("<option />").val(key).append(json[key]);$("select",this).append(option)}if($("select",this).children().each(function(){($(this).val()==json.selected||$(this).text()==$.trim(original.revert))&&$(this).attr("selected","selected")}),!settings.submit){var form=this;$("select",this).change(function(){form.submit()})}}}},addInputType:function(name,input){$.editable.types[name]=input}},$.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},ajaxoptions:{}}}(jQuery),function($){$.fn.extend({complexify:function(options,callback){function additionalComplexityForCharset(str,charset){for(var i=str.length-1;i>=0;i--)if(charset[0]<=str.charCodeAt(i)&&str.charCodeAt(i)<=charset[1])return charset[1]-charset[0]+1;return 0}function inBanlist(str){if("strict"===options.banMode){for(var i=0;i<options.bannedPasswords.length;i++)if(-1!==str.toLowerCase().indexOf(options.bannedPasswords[i].toLowerCase()))return!0;return!1}return $.inArray(str,options.bannedPasswords)>-1?!0:!1}function evaluateSecurity(){var password=$(this).val(),complexity=0,valid=!1;if(inBanlist(password))complexity=1;else for(var i=CHARSETS.length-1;i>=0;i--)complexity+=additionalComplexityForCharset(password,CHARSETS[i]);complexity=Math.log(Math.pow(complexity,password.length))*(1/options.strengthScaleFactor),valid=complexity>MIN_COMPLEXITY&&password.length>=options.minimumChars,complexity=complexity/MAX_COMPLEXITY*100,complexity=complexity>100?100:complexity,callback.call(this,valid,complexity)}var MIN_COMPLEXITY=49,MAX_COMPLEXITY=120,CHARSETS=[[32,32],[48,57],[65,90],[97,122],[33,47],[58,64],[91,96],[123,126],[128,255],[256,383],[384,591],[592,687],[688,767],[768,879],[880,1023],[1024,1279],[1328,1423],[1424,1535],[1536,1791],[1792,1871],[1920,1983],[2304,2431],[2432,2559],[2560,2687],[2688,2815],[2816,2943],[2944,3071],[3072,3199],[3200,3327],[3328,3455],[3456,3583],[3584,3711],[3712,3839],[3840,4095],[4096,4255],[4256,4351],[4352,4607],[4608,4991],[5024,5119],[5120,5759],[5760,5791],[5792,5887],[6016,6143],[6144,6319],[7680,7935],[7936,8191],[8192,8303],[8304,8351],[8352,8399],[8400,8447],[8448,8527],[8528,8591],[8592,8703],[8704,8959],[8960,9215],[9216,9279],[9280,9311],[9312,9471],[9472,9599],[9600,9631],[9632,9727],[9728,9983],[9984,10175],[10240,10495],[11904,12031],[12032,12255],[12272,12287],[12288,12351],[12352,12447],[12448,12543],[12544,12591],[12592,12687],[12688,12703],[12704,12735],[12800,13055],[13056,13311],[13312,19893],[19968,40959],[40960,42127],[42128,42191],[44032,55203],[55296,56191],[56192,56319],[56320,57343],[57344,63743],[63744,64255],[64256,64335],[64336,65023],[65056,65071],[65072,65103],[65104,65135],[65136,65278],[65279,65279],[65280,65519],[65520,65533]],defaults={minimumChars:8,strengthScaleFactor:1,bannedPasswords:window.COMPLEXIFY_BANLIST||[],banMode:"strict"};return $.isFunction(options)&&!callback&&(callback=options,options={}),options=$.extend(defaults,options),this.each(function(){$(this).val()&&evaluateSecurity.apply(this)}),this.each(function(){$(this).bind("keyup focus input propertychange mouseup",evaluateSecurity)})}})}(jQuery),COMPLEXIFY_BANLIST="000000|111111|11111111|112233|121212|123123|123456|1234567|12345678|123456789|131313|232323|654321|666666|696969|777777|7777777|8675309|987654|nnnnnn|nop123|nopqrs|noteglh|npprff|npprff14|npgvba|nyoreg|nyoregb|nyrkvf|nyrwnaqen|nyrwnaqeb|nznaqn|nzngrhe|nzrevpn|naqern|naqerj|natryn|natryf|navzny|nagubal|ncbyyb|nccyrf|nefrany|neguhe|nfqstu|nfuyrl|nffubyr|nhthfg|nhfgva|onqobl|onvyrl|onanan|onearl|onfronyy|ongzna|orngevm|ornire|ornivf|ovtpbpx|ovtqnqql|ovtqvpx|ovtqbt|ovtgvgf|oveqvr|ovgpurf|ovgrzr|oynmre|oybaqr|oybaqrf|oybjwbo|oybjzr|obaq007|obavgn|obaavr|obbobb|obbtre|obbzre|obfgba|oenaqba|oenaql|oenirf|oenmvy|oebapb|oebapbf|ohyyqbt|ohfgre|ohggre|ohggurnq|pnyiva|pnzneb|pnzreba|pnanqn|pncgnva|pneybf|pnegre|pnfcre|puneyrf|puneyvr|purrfr|puryfrn|purfgre|puvpntb|puvpxra|pbpnpbyn|pbssrr|pbyyrtr|pbzcnd|pbzchgre|pbafhzre|pbbxvr|pbbcre|pbeirggr|pbjobl|pbjoblf|pelfgny|phzzvat|phzfubg|qnxbgn|qnyynf|qnavry|qnavryyr|qroovr|qraavf|qvnoyb|qvnzbaq|qbpgbe|qbttvr|qbycuva|qbycuvaf|qbanyq|qentba|qernzf|qevire|rntyr1|rntyrf|rqjneq|rvafgrva|rebgvp|rfgeryyn|rkgerzr|snypba|sraqre|sreenev|sveroveq|svfuvat|sybevqn|sybjre|sylref|sbbgonyy|sberire|serqql|serrqbz|shpxrq|shpxre|shpxvat|shpxzr|shpxlbh|tnaqnys|tngrjnl|tngbef|trzvav|trbetr|tvnagf|tvatre|tvmzbqb|tbyqra|tbysre|tbeqba|tertbel|thvgne|thaare|unzzre|unaanu|uneqpber|uneyrl|urngure|uryczr|uragnv|ubpxrl|ubbgref|ubearl|ubgqbt|uhagre|uhagvat|vprzna|vybirlbh|vagrearg|vjnagh|wnpxvr|wnpxfba|wnthne|wnfzvar|wnfcre|wraavsre|wrerzl|wrffvpn|wbuaal|wbuafba|wbeqna|wbfrcu|wbfuhn|whavbe|whfgva|xvyyre|xavtug|ynqvrf|ynxref|ynhera|yrngure|yrtraq|yrgzrva|yvggyr|ybaqba|ybiref|znqqbt|znqvfba|znttvr|zntahz|znevar|znevcbfn|zneyobeb|znegva|zneiva|znfgre|zngevk|znggurj|znirevpx|znkjryy|zryvffn|zrzore|zreprqrf|zreyva|zvpunry|zvpuryyr|zvpxrl|zvqavtug|zvyyre|zvfgerff|zbavpn|zbaxrl|zbafgre|zbetna|zbgure|zbhagnva|zhssva|zhecul|zhfgnat|anxrq|anfpne|anguna|anhtugl|app1701|arjlbex|avpubynf|avpbyr|avccyr|avccyrf|byvire|benatr|cnpxref|cnagure|cnagvrf|cnexre|cnffjbeq|cnffjbeq1|cnffjbeq12|cnffjbeq123|cngevpx|crnpurf|crnahg|crccre|cunagbz|cubravk|cynlre|cyrnfr|cbbxvr|cbefpur|cevapr|cevaprff|cevingr|checyr|chffvrf|dnmjfk|djregl|djreglhv|enoovg|enpury|enpvat|envqref|envaobj|enatre|enatref|erorppn|erqfxvaf|erqfbk|erqjvatf|evpuneq|eboreg|eboregb|ebpxrg|ebfrohq|ehaare|ehfu2112|ehffvn|fnznagun|fnzzl|fnzfba|fnaqen|fnghea|fpbbol|fpbbgre|fpbecvb|fpbecvba|fronfgvna|frperg|frkfrk|funqbj|funaaba|funirq|fvreen|fvyire|fxvccl|fynlre|fzbxrl|fabbcl|fbppre|fbcuvr|fcnaxl|fcnexl|fcvqre|fdhveg|fevavinf|fgnegerx|fgnejnef|fgrryref|fgrira|fgvpxl|fghcvq|fhpprff|fhpxvg|fhzzre|fhafuvar|fhcrezna|fhesre|fjvzzvat|flqarl|grdhvreb|gnlybe|graavf|grerfn|grfgre|grfgvat|gurzna|gubznf|guhaqre|guk1138|gvssnal|gvtref|gvttre|gbzpng|gbctha|gblbgn|genivf|gebhoyr|gehfgab1|ghpxre|ghegyr|gjvggre|havgrq|intvan|ivpgbe|ivpgbevn|ivxvat|ibbqbb|iblntre|jnygre|jneevbe|jrypbzr|jungrire|jvyyvnz|jvyyvr|jvyfba|jvaare|jvafgba|jvagre|jvmneq|knivre|kkkkkk|kkkkkkkk|lnznun|lnaxrr|lnaxrrf|lryybj|mkpioa|mkpioaz|mmmmmm|password|1234|pussy|12345|dragon|qwerty|mustang|letmein|baseball|master|michael|football|shadow|monkey|abc123|pass|fuckme|6969|jordan|harley|ranger|iwantu|jennifer|hunter|fuck|2000|test|batman|trustno1|thomas|tigger|robert|access|love|buster|soccer|hockey|killer|george|sexy|andrew|charlie|superman|asshole|fuckyou|dallas|jessica|panties|pepper|1111|austin|william|daniel|golfer|summer|heather|hammer|yankees|joshua|maggie|biteme|enter|ashley|thunder|cowboy|silver|richard|fucker|orange|merlin|michelle|corvette|bigdog|cheese|matthew|patrick|martin|freedom|ginger|blowjob|nicole|sparky|yellow|camaro|secret|dick|falcon|taylor|bitch|hello|scooter|please|porsche|guitar|chelsea|black|diamond|nascar|jackson|cameron|computer|amanda|wizard|xxxxxxxx|money|phoenix|mickey|bailey|knight|iceman|tigers|purple|andrea|horny|dakota|aaaaaa|player|sunshine|morgan|starwars|boomer|cowboys|edward|charles|girls|booboo|coffee|xxxxxx|bulldog|ncc1701|rabbit|peanut|john|johnny|gandalf|spanky|winter|brandy|compaq|carlos|tennis|james|mike|brandon|fender|anthony|blowme|ferrari|cookie|chicken|maverick|chicago|joseph|diablo|sexsex|hardcore|willie|welcome|chris|panther|yamaha|justin|banana|driver|marine|angels|fishing|david|maddog|hooters|wilson|butthead|dennis|fucking|captain|bigdick|chester|smokey|xavier|steven|viking|snoopy|blue|eagles|winner|samantha|house|miller|flower|jack|firebird|butter|united|turtle|steelers|tiffany|zxcvbn|tomcat|golf|bond007|bear|tiger|doctor|gateway|gators|angel|junior|thx1138|porno|badboy|debbie|spider|melissa|booger|1212|flyers|fish|porn|matrix|teens|scooby|jason|walter|cumshot|boston|braves|yankee|lover|barney|victor|tucker|princess|mercedes|5150|doggie|zzzzzz|gunner|horney|bubba|2112|fred|johnson|xxxxx|tits|member|boobs|donald|bigdaddy|bronco|penis|voyager|rangers|birdie|trouble|white|topgun|bigtits|bitches|green|super|qazwsx|magic|lakers|rachel|slayer|scott|2222|asdf|video|london|7777|marlboro|srinivas|internet|action|carter|jasper|monster|teresa|jeremy|bill|crystal|peter|pussies|cock|beer|rocket|theman|oliver|prince|beach|amateur|muffin|redsox|star|testing|shannon|murphy|frank|hannah|dave|eagle1|11111|mother|nathan|raiders|steve|forever|angela|viper|ou812|jake|lovers|suckit|gregory|buddy|whatever|young|nicholas|lucky|helpme|jackie|monica|midnight|college|baby|cunt|brian|mark|startrek|sierra|leather|4444|beavis|bigcock|happy|sophie|ladies|naughty|giants|booty|blonde|fucked|golden|fire|sandra|pookie|packers|einstein|dolphins|chevy|winston|warrior|sammy|slut|zxcvbnm|nipples|power|victoria|asdfgh|vagina|toyota|travis|hotdog|paris|rock|xxxx|extreme|redskins|erotic|dirty|ford|freddy|arsenal|access14|wolf|nipple|iloveyou|alex|florida|eric|legend|movie|success|rosebud|jaguar|great|cool|cooper|1313|scorpio|mountain|madison|brazil|lauren|japan|naked|squirt|stars|apple|alexis|aaaa|bonnie|peaches|jasmine|kevin|matt|qwertyui|danielle|beaver|4321|4128|runner|swimming|dolphin|gordon|casper|stupid|shit|saturn|gemini|apples|august|3333|canada|blazer|cumming|hunting|kitty|rainbow|arthur|cream|calvin|shaved|surfer|samson|kelly|paul|mine|king|racing|5555|eagle|hentai|newyork|little|redwings|smith|sticky|cocacola|animal|broncos|private|skippy|marvin|blondes|enjoy|girl|apollo|parker|qwert|time|sydney|women|voodoo|magnum|juice|abgrtyu|dreams|maxwell|music|rush2112|russia|scorpion|rebecca|tester|mistress|phantom|billy|6666|albert|abcdef|password1|password12|password123|twitter".split("|"),
function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.pako=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";var TYPED_OK="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;exports.assign=function(obj){for(var sources=Array.prototype.slice.call(arguments,1);sources.length;){var source=sources.shift();if(source){if("object"!=typeof source)throw new TypeError(source+"must be non-object");for(var p in source)source.hasOwnProperty(p)&&(obj[p]=source[p])}}return obj},exports.shrinkBuf=function(buf,size){return buf.length===size?buf:buf.subarray?buf.subarray(0,size):(buf.length=size,buf)};var fnTyped={arraySet:function(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray)return void dest.set(src.subarray(src_offs,src_offs+len),dest_offs);for(var i=0;len>i;i++)dest[dest_offs+i]=src[src_offs+i]},flattenChunks:function(chunks){var i,l,len,pos,chunk,result;for(len=0,i=0,l=chunks.length;l>i;i++)len+=chunks[i].length;for(result=new Uint8Array(len),pos=0,i=0,l=chunks.length;l>i;i++)chunk=chunks[i],result.set(chunk,pos),pos+=chunk.length;return result}},fnUntyped={arraySet:function(dest,src,src_offs,len,dest_offs){for(var i=0;len>i;i++)dest[dest_offs+i]=src[src_offs+i]},flattenChunks:function(chunks){return[].concat.apply([],chunks)}};exports.setTyped=function(on){on?(exports.Buf8=Uint8Array,exports.Buf16=Uint16Array,exports.Buf32=Int32Array,exports.assign(exports,fnTyped)):(exports.Buf8=Array,exports.Buf16=Array,exports.Buf32=Array,exports.assign(exports,fnUntyped))},exports.setTyped(TYPED_OK)},{}],2:[function(require,module,exports){"use strict";function buf2binstring(buf,len){if(65537>len&&(buf.subarray&&STR_APPLY_UIA_OK||!buf.subarray&&STR_APPLY_OK))return String.fromCharCode.apply(null,utils.shrinkBuf(buf,len));for(var result="",i=0;len>i;i++)result+=String.fromCharCode(buf[i]);return result}var utils=require("./common"),STR_APPLY_OK=!0,STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,[0])}catch(__){STR_APPLY_OK=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(__){STR_APPLY_UIA_OK=!1}for(var _utf8len=new utils.Buf8(256),q=0;256>q;q++)_utf8len[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;_utf8len[254]=_utf8len[254]=1,exports.string2buf=function(str){var buf,c,c2,m_pos,i,str_len=str.length,buf_len=0;for(m_pos=0;str_len>m_pos;m_pos++)c=str.charCodeAt(m_pos),55296===(64512&c)&&str_len>m_pos+1&&(c2=str.charCodeAt(m_pos+1),56320===(64512&c2)&&(c=65536+(c-55296<<10)+(c2-56320),m_pos++)),buf_len+=128>c?1:2048>c?2:65536>c?3:4;for(buf=new utils.Buf8(buf_len),i=0,m_pos=0;buf_len>i;m_pos++)c=str.charCodeAt(m_pos),55296===(64512&c)&&str_len>m_pos+1&&(c2=str.charCodeAt(m_pos+1),56320===(64512&c2)&&(c=65536+(c-55296<<10)+(c2-56320),m_pos++)),128>c?buf[i++]=c:2048>c?(buf[i++]=192|c>>>6,buf[i++]=128|63&c):65536>c?(buf[i++]=224|c>>>12,buf[i++]=128|c>>>6&63,buf[i++]=128|63&c):(buf[i++]=240|c>>>18,buf[i++]=128|c>>>12&63,buf[i++]=128|c>>>6&63,buf[i++]=128|63&c);return buf},exports.buf2binstring=function(buf){return buf2binstring(buf,buf.length)},exports.binstring2buf=function(str){for(var buf=new utils.Buf8(str.length),i=0,len=buf.length;len>i;i++)buf[i]=str.charCodeAt(i);return buf},exports.buf2string=function(buf,max){var i,out,c,c_len,len=max||buf.length,utf16buf=new Array(2*len);for(out=0,i=0;len>i;)if(c=buf[i++],128>c)utf16buf[out++]=c;else if(c_len=_utf8len[c],c_len>4)utf16buf[out++]=65533,i+=c_len-1;else{for(c&=2===c_len?31:3===c_len?15:7;c_len>1&&len>i;)c=c<<6|63&buf[i++],c_len--;c_len>1?utf16buf[out++]=65533:65536>c?utf16buf[out++]=c:(c-=65536,utf16buf[out++]=55296|c>>10&1023,utf16buf[out++]=56320|1023&c)}return buf2binstring(utf16buf,out)},exports.utf8border=function(buf,max){var pos;for(max=max||buf.length,max>buf.length&&(max=buf.length),pos=max-1;pos>=0&&128===(192&buf[pos]);)pos--;return 0>pos?max:0===pos?max:pos+_utf8len[buf[pos]]>max?pos:max}},{"./common":1}],3:[function(require,module,exports){"use strict";function adler32(adler,buf,len,pos){for(var s1=65535&adler|0,s2=adler>>>16&65535|0,n=0;0!==len;){n=len>2e3?2e3:len,len-=n;do s1=s1+buf[pos++]|0,s2=s2+s1|0;while(--n);s1%=65521,s2%=65521}return s1|s2<<16|0}module.exports=adler32},{}],4:[function(require,module,exports){module.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(require,module,exports){"use strict";function makeTable(){for(var c,table=[],n=0;256>n;n++){c=n;for(var k=0;8>k;k++)c=1&c?3988292384^c>>>1:c>>>1;table[n]=c}return table}function crc32(crc,buf,len,pos){var t=crcTable,end=pos+len;crc=-1^crc;for(var i=pos;end>i;i++)crc=crc>>>8^t[255&(crc^buf[i])];return-1^crc}var crcTable=makeTable();module.exports=crc32},{}],6:[function(require,module,exports){"use strict";function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}module.exports=GZheader},{}],7:[function(require,module,exports){"use strict";var BAD=30,TYPE=12;module.exports=function(strm,start){var state,_in,last,_out,beg,end,dmax,wsize,whave,wnext,window,hold,bits,lcode,dcode,lmask,dmask,here,op,len,dist,from,from_source,input,output;state=strm.state,_in=strm.next_in,input=strm.input,last=_in+(strm.avail_in-5),_out=strm.next_out,output=strm.output,beg=_out-(start-strm.avail_out),end=_out+(strm.avail_out-257),dmax=state.dmax,wsize=state.wsize,whave=state.whave,wnext=state.wnext,window=state.window,hold=state.hold,bits=state.bits,lcode=state.lencode,dcode=state.distcode,lmask=(1<<state.lenbits)-1,dmask=(1<<state.distbits)-1;top:do{15>bits&&(hold+=input[_in++]<<bits,bits+=8,hold+=input[_in++]<<bits,bits+=8),here=lcode[hold&lmask];dolen:for(;;){if(op=here>>>24,hold>>>=op,bits-=op,op=here>>>16&255,0===op)output[_out++]=65535&here;else{if(!(16&op)){if(0===(64&op)){here=lcode[(65535&here)+(hold&(1<<op)-1)];continue dolen}if(32&op){state.mode=TYPE;break top}strm.msg="invalid literal/length code",state.mode=BAD;break top}len=65535&here,op&=15,op&&(op>bits&&(hold+=input[_in++]<<bits,bits+=8),len+=hold&(1<<op)-1,hold>>>=op,bits-=op),15>bits&&(hold+=input[_in++]<<bits,bits+=8,hold+=input[_in++]<<bits,bits+=8),here=dcode[hold&dmask];dodist:for(;;){if(op=here>>>24,hold>>>=op,bits-=op,op=here>>>16&255,!(16&op)){if(0===(64&op)){here=dcode[(65535&here)+(hold&(1<<op)-1)];continue dodist}strm.msg="invalid distance code",state.mode=BAD;break top}if(dist=65535&here,op&=15,op>bits&&(hold+=input[_in++]<<bits,bits+=8,op>bits&&(hold+=input[_in++]<<bits,bits+=8)),dist+=hold&(1<<op)-1,dist>dmax){strm.msg="invalid distance too far back",state.mode=BAD;break top}if(hold>>>=op,bits-=op,op=_out-beg,dist>op){if(op=dist-op,op>whave&&state.sane){strm.msg="invalid distance too far back",state.mode=BAD;break top}if(from=0,from_source=window,0===wnext){if(from+=wsize-op,len>op){len-=op;do output[_out++]=window[from++];while(--op);from=_out-dist,from_source=output}}else if(op>wnext){if(from+=wsize+wnext-op,op-=wnext,len>op){len-=op;do output[_out++]=window[from++];while(--op);if(from=0,len>wnext){op=wnext,len-=op;do output[_out++]=window[from++];while(--op);from=_out-dist,from_source=output}}}else if(from+=wnext-op,len>op){len-=op;do output[_out++]=window[from++];while(--op);from=_out-dist,from_source=output}for(;len>2;)output[_out++]=from_source[from++],output[_out++]=from_source[from++],output[_out++]=from_source[from++],len-=3;len&&(output[_out++]=from_source[from++],len>1&&(output[_out++]=from_source[from++]))}else{from=_out-dist;do output[_out++]=output[from++],output[_out++]=output[from++],output[_out++]=output[from++],len-=3;while(len>2);len&&(output[_out++]=output[from++],len>1&&(output[_out++]=output[from++]))}break}}break}}while(last>_in&&end>_out);len=bits>>3,_in-=len,bits-=len<<3,hold&=(1<<bits)-1,strm.next_in=_in,strm.next_out=_out,strm.avail_in=last>_in?5+(last-_in):5-(_in-last),strm.avail_out=end>_out?257+(end-_out):257-(_out-end),state.hold=hold,state.bits=bits}},{}],8:[function(require,module,exports){"use strict";function ZSWAP32(q){return(q>>>24&255)+(q>>>8&65280)+((65280&q)<<8)+((255&q)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new utils.Buf16(320),this.work=new utils.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(strm){var state;return strm&&strm.state?(state=strm.state,strm.total_in=strm.total_out=state.total=0,strm.msg="",state.wrap&&(strm.adler=1&state.wrap),state.mode=HEAD,state.last=0,state.havedict=0,state.dmax=32768,state.head=null,state.hold=0,state.bits=0,state.lencode=state.lendyn=new utils.Buf32(ENOUGH_LENS),state.distcode=state.distdyn=new utils.Buf32(ENOUGH_DISTS),state.sane=1,state.back=-1,Z_OK):Z_STREAM_ERROR}function inflateReset(strm){var state;return strm&&strm.state?(state=strm.state,state.wsize=0,state.whave=0,state.wnext=0,inflateResetKeep(strm)):Z_STREAM_ERROR}function inflateReset2(strm,windowBits){var wrap,state;return strm&&strm.state?(state=strm.state,0>windowBits?(wrap=0,windowBits=-windowBits):(wrap=(windowBits>>4)+1,48>windowBits&&(windowBits&=15)),windowBits&&(8>windowBits||windowBits>15)?Z_STREAM_ERROR:(null!==state.window&&state.wbits!==windowBits&&(state.window=null),state.wrap=wrap,state.wbits=windowBits,inflateReset(strm))):Z_STREAM_ERROR}function inflateInit2(strm,windowBits){var ret,state;return strm?(state=new InflateState,strm.state=state,state.window=null,ret=inflateReset2(strm,windowBits),ret!==Z_OK&&(strm.state=null),ret):Z_STREAM_ERROR}function inflateInit(strm){return inflateInit2(strm,DEF_WBITS)}function fixedtables(state){if(virgin){var sym;for(lenfix=new utils.Buf32(512),distfix=new utils.Buf32(32),sym=0;144>sym;)state.lens[sym++]=8;for(;256>sym;)state.lens[sym++]=9;for(;280>sym;)state.lens[sym++]=7;for(;288>sym;)state.lens[sym++]=8;for(inflate_table(LENS,state.lens,0,288,lenfix,0,state.work,{bits:9}),sym=0;32>sym;)state.lens[sym++]=5;inflate_table(DISTS,state.lens,0,32,distfix,0,state.work,{bits:5}),virgin=!1}state.lencode=lenfix,state.lenbits=9,state.distcode=distfix,state.distbits=5}function updatewindow(strm,src,end,copy){var dist,state=strm.state;return null===state.window&&(state.wsize=1<<state.wbits,state.wnext=0,state.whave=0,state.window=new utils.Buf8(state.wsize)),copy>=state.wsize?(utils.arraySet(state.window,src,end-state.wsize,state.wsize,0),state.wnext=0,state.whave=state.wsize):(dist=state.wsize-state.wnext,dist>copy&&(dist=copy),utils.arraySet(state.window,src,end-copy,dist,state.wnext),copy-=dist,copy?(utils.arraySet(state.window,src,end-copy,copy,0),state.wnext=copy,state.whave=state.wsize):(state.wnext+=dist,state.wnext===state.wsize&&(state.wnext=0),state.whave<state.wsize&&(state.whave+=dist))),0}function inflate(strm,flush){var state,input,output,next,put,have,left,hold,bits,_in,_out,copy,from,from_source,here_bits,here_op,here_val,last_bits,last_op,last_val,len,ret,opts,n,here=0,hbuf=new utils.Buf8(4),order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||!strm.input&&0!==strm.avail_in)return Z_STREAM_ERROR;state=strm.state,state.mode===TYPE&&(state.mode=TYPEDO),put=strm.next_out,output=strm.output,left=strm.avail_out,next=strm.next_in,input=strm.input,have=strm.avail_in,hold=state.hold,bits=state.bits,_in=have,_out=left,ret=Z_OK;inf_leave:for(;;)switch(state.mode){case HEAD:if(0===state.wrap){state.mode=TYPEDO;break}for(;16>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(2&state.wrap&&35615===hold){state.check=0,hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0),hold=0,bits=0,state.mode=FLAGS;break}if(state.flags=0,state.head&&(state.head.done=!1),!(1&state.wrap)||(((255&hold)<<8)+(hold>>8))%31){strm.msg="incorrect header check",state.mode=BAD;break}if((15&hold)!==Z_DEFLATED){strm.msg="unknown compression method",state.mode=BAD;break}if(hold>>>=4,bits-=4,len=(15&hold)+8,0===state.wbits)state.wbits=len;else if(len>state.wbits){strm.msg="invalid window size",state.mode=BAD;break}state.dmax=1<<len,strm.adler=state.check=1,state.mode=512&hold?DICTID:TYPE,hold=0,bits=0;break;case FLAGS:for(;16>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(state.flags=hold,(255&state.flags)!==Z_DEFLATED){strm.msg="unknown compression method",state.mode=BAD;break}if(57344&state.flags){strm.msg="unknown header flags set",state.mode=BAD;break}state.head&&(state.head.text=hold>>8&1),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0)),hold=0,bits=0,state.mode=TIME;case TIME:for(;32>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.head&&(state.head.time=hold),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,hbuf[2]=hold>>>16&255,hbuf[3]=hold>>>24&255,state.check=crc32(state.check,hbuf,4,0)),hold=0,bits=0,state.mode=OS;case OS:for(;16>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.head&&(state.head.xflags=255&hold,state.head.os=hold>>8),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0)),hold=0,bits=0,state.mode=EXLEN;case EXLEN:if(1024&state.flags){for(;16>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.length=hold,state.head&&(state.head.extra_len=hold),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0)),hold=0,bits=0}else state.head&&(state.head.extra=null);state.mode=EXTRA;case EXTRA:if(1024&state.flags&&(copy=state.length,copy>have&&(copy=have),copy&&(state.head&&(len=state.head.extra_len-state.length,state.head.extra||(state.head.extra=new Array(state.head.extra_len)),utils.arraySet(state.head.extra,input,next,copy,len)),512&state.flags&&(state.check=crc32(state.check,input,copy,next)),have-=copy,next+=copy,state.length-=copy),state.length))break inf_leave;state.length=0,state.mode=NAME;case NAME:if(2048&state.flags){if(0===have)break inf_leave;copy=0;do len=input[next+copy++],state.head&&len&&state.length<65536&&(state.head.name+=String.fromCharCode(len));while(len&&have>copy);if(512&state.flags&&(state.check=crc32(state.check,input,copy,next)),have-=copy,next+=copy,len)break inf_leave}else state.head&&(state.head.name=null);state.length=0,state.mode=COMMENT;case COMMENT:if(4096&state.flags){if(0===have)break inf_leave;copy=0;do len=input[next+copy++],state.head&&len&&state.length<65536&&(state.head.comment+=String.fromCharCode(len));while(len&&have>copy);if(512&state.flags&&(state.check=crc32(state.check,input,copy,next)),have-=copy,next+=copy,len)break inf_leave}else state.head&&(state.head.comment=null);state.mode=HCRC;case HCRC:if(512&state.flags){for(;16>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold!==(65535&state.check)){strm.msg="header crc mismatch",state.mode=BAD;break}hold=0,bits=0}state.head&&(state.head.hcrc=state.flags>>9&1,state.head.done=!0),strm.adler=state.check=0,state.mode=TYPE;break;case DICTID:for(;32>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}strm.adler=state.check=ZSWAP32(hold),hold=0,bits=0,state.mode=DICT;case DICT:if(0===state.havedict)return strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,Z_NEED_DICT;strm.adler=state.check=1,state.mode=TYPE;case TYPE:if(flush===Z_BLOCK||flush===Z_TREES)break inf_leave;case TYPEDO:if(state.last){hold>>>=7&bits,bits-=7&bits,state.mode=CHECK;break}for(;3>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}switch(state.last=1&hold,hold>>>=1,bits-=1,3&hold){case 0:state.mode=STORED;break;case 1:if(fixedtables(state),state.mode=LEN_,flush===Z_TREES){hold>>>=2,bits-=2;break inf_leave}break;case 2:state.mode=TABLE;break;case 3:strm.msg="invalid block type",state.mode=BAD}hold>>>=2,bits-=2;break;case STORED:for(hold>>>=7&bits,bits-=7&bits;32>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if((65535&hold)!==(hold>>>16^65535)){strm.msg="invalid stored block lengths",state.mode=BAD;break}if(state.length=65535&hold,hold=0,bits=0,state.mode=COPY_,flush===Z_TREES)break inf_leave;case COPY_:state.mode=COPY;case COPY:if(copy=state.length){if(copy>have&&(copy=have),copy>left&&(copy=left),0===copy)break inf_leave;utils.arraySet(output,input,next,copy,put),have-=copy,next+=copy,left-=copy,put+=copy,state.length-=copy;break}state.mode=TYPE;break;case TABLE:for(;14>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(state.nlen=(31&hold)+257,hold>>>=5,bits-=5,state.ndist=(31&hold)+1,hold>>>=5,bits-=5,state.ncode=(15&hold)+4,hold>>>=4,bits-=4,state.nlen>286||state.ndist>30){strm.msg="too many length or distance symbols",state.mode=BAD;break}state.have=0,state.mode=LENLENS;case LENLENS:for(;state.have<state.ncode;){for(;3>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.lens[order[state.have++]]=7&hold,hold>>>=3,bits-=3}for(;state.have<19;)state.lens[order[state.have++]]=0;if(state.lencode=state.lendyn,state.lenbits=7,opts={bits:state.lenbits},ret=inflate_table(CODES,state.lens,0,19,state.lencode,0,state.work,opts),state.lenbits=opts.bits,ret){strm.msg="invalid code lengths set",state.mode=BAD;break}state.have=0,state.mode=CODELENS;case CODELENS:for(;state.have<state.nlen+state.ndist;){for(;here=state.lencode[hold&(1<<state.lenbits)-1],here_bits=here>>>24,here_op=here>>>16&255,here_val=65535&here,!(bits>=here_bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(16>here_val)hold>>>=here_bits,bits-=here_bits,state.lens[state.have++]=here_val;else{if(16===here_val){for(n=here_bits+2;n>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold>>>=here_bits,bits-=here_bits,0===state.have){strm.msg="invalid bit length repeat",state.mode=BAD;break}len=state.lens[state.have-1],copy=3+(3&hold),hold>>>=2,bits-=2}else if(17===here_val){for(n=here_bits+3;n>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=here_bits,bits-=here_bits,len=0,copy=3+(7&hold),hold>>>=3,bits-=3}else{for(n=here_bits+7;n>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=here_bits,bits-=here_bits,len=0,copy=11+(127&hold),hold>>>=7,bits-=7}if(state.have+copy>state.nlen+state.ndist){strm.msg="invalid bit length repeat",state.mode=BAD;break}for(;copy--;)state.lens[state.have++]=len}}if(state.mode===BAD)break;if(0===state.lens[256]){strm.msg="invalid code -- missing end-of-block",state.mode=BAD;break}if(state.lenbits=9,opts={bits:state.lenbits},ret=inflate_table(LENS,state.lens,0,state.nlen,state.lencode,0,state.work,opts),state.lenbits=opts.bits,ret){strm.msg="invalid literal/lengths set",state.mode=BAD;break}if(state.distbits=6,state.distcode=state.distdyn,opts={bits:state.distbits},ret=inflate_table(DISTS,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts),state.distbits=opts.bits,ret){strm.msg="invalid distances set",state.mode=BAD;break}if(state.mode=LEN_,flush===Z_TREES)break inf_leave;case LEN_:state.mode=LEN;case LEN:if(have>=6&&left>=258){strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,inflate_fast(strm,_out),put=strm.next_out,output=strm.output,left=strm.avail_out,next=strm.next_in,input=strm.input,have=strm.avail_in,hold=state.hold,bits=state.bits,state.mode===TYPE&&(state.back=-1);break}for(state.back=0;here=state.lencode[hold&(1<<state.lenbits)-1],here_bits=here>>>24,here_op=here>>>16&255,here_val=65535&here,!(bits>=here_bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(here_op&&0===(240&here_op)){for(last_bits=here_bits,last_op=here_op,last_val=here_val;here=state.lencode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)],here_bits=here>>>24,here_op=here>>>16&255,here_val=65535&here,!(bits>=last_bits+here_bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=last_bits,bits-=last_bits,state.back+=last_bits}if(hold>>>=here_bits,bits-=here_bits,state.back+=here_bits,state.length=here_val,0===here_op){state.mode=LIT;break}if(32&here_op){state.back=-1,state.mode=TYPE;break}if(64&here_op){strm.msg="invalid literal/length code",state.mode=BAD;break}state.extra=15&here_op,state.mode=LENEXT;case LENEXT:if(state.extra){for(n=state.extra;n>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.length+=hold&(1<<state.extra)-1,hold>>>=state.extra,bits-=state.extra,state.back+=state.extra}state.was=state.length,state.mode=DIST;case DIST:for(;here=state.distcode[hold&(1<<state.distbits)-1],here_bits=here>>>24,here_op=here>>>16&255,here_val=65535&here,!(bits>=here_bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(0===(240&here_op)){for(last_bits=here_bits,last_op=here_op,last_val=here_val;here=state.distcode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)],here_bits=here>>>24,here_op=here>>>16&255,here_val=65535&here,!(bits>=last_bits+here_bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=last_bits,bits-=last_bits,state.back+=last_bits}if(hold>>>=here_bits,bits-=here_bits,state.back+=here_bits,64&here_op){strm.msg="invalid distance code",state.mode=BAD;break}state.offset=here_val,state.extra=15&here_op,state.mode=DISTEXT;case DISTEXT:if(state.extra){for(n=state.extra;n>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.offset+=hold&(1<<state.extra)-1,hold>>>=state.extra,bits-=state.extra,state.back+=state.extra}if(state.offset>state.dmax){strm.msg="invalid distance too far back",state.mode=BAD;break}state.mode=MATCH;case MATCH:if(0===left)break inf_leave;if(copy=_out-left,state.offset>copy){if(copy=state.offset-copy,copy>state.whave&&state.sane){strm.msg="invalid distance too far back",state.mode=BAD;break}copy>state.wnext?(copy-=state.wnext,from=state.wsize-copy):from=state.wnext-copy,copy>state.length&&(copy=state.length),from_source=state.window}else from_source=output,from=put-state.offset,copy=state.length;copy>left&&(copy=left),left-=copy,state.length-=copy;do output[put++]=from_source[from++];while(--copy);0===state.length&&(state.mode=LEN);break;case LIT:if(0===left)break inf_leave;output[put++]=state.length,left--,state.mode=LEN;break;case CHECK:if(state.wrap){for(;32>bits;){if(0===have)break inf_leave;have--,hold|=input[next++]<<bits,bits+=8}if(_out-=left,strm.total_out+=_out,state.total+=_out,_out&&(strm.adler=state.check=state.flags?crc32(state.check,output,_out,put-_out):adler32(state.check,output,_out,put-_out)),_out=left,(state.flags?hold:ZSWAP32(hold))!==state.check){strm.msg="incorrect data check",state.mode=BAD;break}hold=0,bits=0}state.mode=LENGTH;case LENGTH:if(state.wrap&&state.flags){for(;32>bits;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold!==(4294967295&state.total)){strm.msg="incorrect length check",state.mode=BAD;break}hold=0,bits=0}state.mode=DONE;case DONE:ret=Z_STREAM_END;break inf_leave;case BAD:ret=Z_DATA_ERROR;break inf_leave;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR}return strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,(state.wsize||_out!==strm.avail_out&&state.mode<BAD&&(state.mode<CHECK||flush!==Z_FINISH))&&updatewindow(strm,strm.output,strm.next_out,_out-strm.avail_out)?(state.mode=MEM,Z_MEM_ERROR):(_in-=strm.avail_in,_out-=strm.avail_out,strm.total_in+=_in,strm.total_out+=_out,state.total+=_out,state.wrap&&_out&&(strm.adler=state.check=state.flags?crc32(state.check,output,_out,strm.next_out-_out):adler32(state.check,output,_out,strm.next_out-_out)),strm.data_type=state.bits+(state.last?64:0)+(state.mode===TYPE?128:0)+(state.mode===LEN_||state.mode===COPY_?256:0),(0===_in&&0===_out||flush===Z_FINISH)&&ret===Z_OK&&(ret=Z_BUF_ERROR),ret)}function inflateEnd(strm){if(!strm||!strm.state)return Z_STREAM_ERROR;var state=strm.state;return state.window&&(state.window=null),strm.state=null,Z_OK}function inflateGetHeader(strm,head){var state;return strm&&strm.state?(state=strm.state,0===(2&state.wrap)?Z_STREAM_ERROR:(state.head=head,head.done=!1,Z_OK)):Z_STREAM_ERROR}var lenfix,distfix,utils=require("../utils/common"),adler32=require("./adler32"),crc32=require("./crc32"),inflate_fast=require("./inffast"),inflate_table=require("./inftrees"),CODES=0,LENS=1,DISTS=2,Z_FINISH=4,Z_BLOCK=5,Z_TREES=6,Z_OK=0,Z_STREAM_END=1,Z_NEED_DICT=2,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR=-5,Z_DEFLATED=8,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD=30,MEM=31,SYNC=32,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,virgin=!0;exports.inflateReset=inflateReset,exports.inflateReset2=inflateReset2,exports.inflateResetKeep=inflateResetKeep,exports.inflateInit=inflateInit,exports.inflateInit2=inflateInit2,exports.inflate=inflate,exports.inflateEnd=inflateEnd,exports.inflateGetHeader=inflateGetHeader,exports.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(require,module,exports){"use strict";var utils=require("../utils/common"),MAXBITS=15,ENOUGH_LENS=852,ENOUGH_DISTS=592,CODES=0,LENS=1,DISTS=2,lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];module.exports=function(type,lens,lens_index,codes,table,table_index,work,opts){var incr,fill,low,mask,next,end,here_bits,here_op,here_val,bits=opts.bits,len=0,sym=0,min=0,max=0,root=0,curr=0,drop=0,left=0,used=0,huff=0,base=null,base_index=0,count=new utils.Buf16(MAXBITS+1),offs=new utils.Buf16(MAXBITS+1),extra=null,extra_index=0;for(len=0;MAXBITS>=len;len++)count[len]=0;for(sym=0;codes>sym;sym++)count[lens[lens_index+sym]]++;for(root=bits,max=MAXBITS;max>=1&&0===count[max];max--);if(root>max&&(root=max),0===max)return table[table_index++]=20971520,table[table_index++]=20971520,opts.bits=1,0;for(min=1;max>min&&0===count[min];min++);for(min>root&&(root=min),left=1,len=1;MAXBITS>=len;len++)if(left<<=1,left-=count[len],0>left)return-1;if(left>0&&(type===CODES||1!==max))return-1;for(offs[1]=0,len=1;MAXBITS>len;len++)offs[len+1]=offs[len]+count[len];for(sym=0;codes>sym;sym++)0!==lens[lens_index+sym]&&(work[offs[lens[lens_index+sym]]++]=sym);if(type===CODES?(base=extra=work,end=19):type===LENS?(base=lbase,base_index-=257,extra=lext,extra_index-=257,end=256):(base=dbase,extra=dext,end=-1),huff=0,sym=0,len=min,next=table_index,curr=root,drop=0,low=-1,used=1<<root,mask=used-1,type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS)return 1;for(var i=0;;){i++,here_bits=len-drop,work[sym]<end?(here_op=0,here_val=work[sym]):work[sym]>end?(here_op=extra[extra_index+work[sym]],here_val=base[base_index+work[sym]]):(here_op=96,here_val=0),incr=1<<len-drop,fill=1<<curr,min=fill;do fill-=incr,table[next+(huff>>drop)+fill]=here_bits<<24|here_op<<16|here_val|0;while(0!==fill);for(incr=1<<len-1;huff&incr;)incr>>=1;if(0!==incr?(huff&=incr-1,huff+=incr):huff=0,sym++,0===--count[len]){if(len===max)break;len=lens[lens_index+work[sym]]}if(len>root&&(huff&mask)!==low){for(0===drop&&(drop=root),next+=min,curr=len-drop,left=1<<curr;max>curr+drop&&(left-=count[curr+drop],!(0>=left));)curr++,left<<=1;if(used+=1<<curr,type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS)return 1;low=huff&mask,table[low]=root<<24|curr<<16|next-table_index|0}}return 0!==huff&&(table[next+huff]=len-drop<<24|64<<16|0),opts.bits=root,0}},{"../utils/common":1}],10:[function(require,module,exports){"use strict";module.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(require,module,exports){"use strict";function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}module.exports=ZStream},{}],"/lib/inflate.js":[function(require,module,exports){"use strict";function inflate(input,options){var inflator=new Inflate(options);if(inflator.push(input,!0),inflator.err)throw inflator.msg;return inflator.result}function inflateRaw(input,options){return options=options||{},options.raw=!0,inflate(input,options)}var zlib_inflate=require("./zlib/inflate.js"),utils=require("./utils/common"),strings=require("./utils/strings"),c=require("./zlib/constants"),msg=require("./zlib/messages"),zstream=require("./zlib/zstream"),gzheader=require("./zlib/gzheader"),toString=Object.prototype.toString,Inflate=function(options){this.options=utils.assign({chunkSize:16384,windowBits:0,to:""},options||{});var opt=this.options;opt.raw&&opt.windowBits>=0&&opt.windowBits<16&&(opt.windowBits=-opt.windowBits,0===opt.windowBits&&(opt.windowBits=-15)),!(opt.windowBits>=0&&opt.windowBits<16)||options&&options.windowBits||(opt.windowBits+=32),opt.windowBits>15&&opt.windowBits<48&&0===(15&opt.windowBits)&&(opt.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;var status=zlib_inflate.inflateInit2(this.strm,opt.windowBits);if(status!==c.Z_OK)throw new Error(msg[status]);this.header=new gzheader,zlib_inflate.inflateGetHeader(this.strm,this.header)};Inflate.prototype.push=function(data,mode){var status,_mode,next_out_utf8,tail,utf8str,strm=this.strm,chunkSize=this.options.chunkSize;if(this.ended)return!1;_mode=mode===~~mode?mode:mode===!0?c.Z_FINISH:c.Z_NO_FLUSH,"string"==typeof data?strm.input=strings.binstring2buf(data):"[object ArrayBuffer]"===toString.call(data)?strm.input=new Uint8Array(data):strm.input=data,strm.next_in=0,strm.avail_in=strm.input.length;do{if(0===strm.avail_out&&(strm.output=new utils.Buf8(chunkSize),strm.next_out=0,strm.avail_out=chunkSize),status=zlib_inflate.inflate(strm,c.Z_NO_FLUSH),status!==c.Z_STREAM_END&&status!==c.Z_OK)return this.onEnd(status),this.ended=!0,!1;strm.next_out&&(0===strm.avail_out||status===c.Z_STREAM_END||0===strm.avail_in&&(_mode===c.Z_FINISH||_mode===c.Z_SYNC_FLUSH))&&("string"===this.options.to?(next_out_utf8=strings.utf8border(strm.output,strm.next_out),
tail=strm.next_out-next_out_utf8,utf8str=strings.buf2string(strm.output,next_out_utf8),strm.next_out=tail,strm.avail_out=chunkSize-tail,tail&&utils.arraySet(strm.output,strm.output,next_out_utf8,tail,0),this.onData(utf8str)):this.onData(utils.shrinkBuf(strm.output,strm.next_out)))}while(strm.avail_in>0&&status!==c.Z_STREAM_END);return status===c.Z_STREAM_END&&(_mode=c.Z_FINISH),_mode===c.Z_FINISH?(status=zlib_inflate.inflateEnd(this.strm),this.onEnd(status),this.ended=!0,status===c.Z_OK):_mode===c.Z_SYNC_FLUSH?(this.onEnd(c.Z_OK),strm.avail_out=0,!0):!0},Inflate.prototype.onData=function(chunk){this.chunks.push(chunk)},Inflate.prototype.onEnd=function(status){status===c.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=utils.flattenChunks(this.chunks)),this.chunks=[],this.err=status,this.msg=this.strm.msg},exports.Inflate=Inflate,exports.inflate=inflate,exports.inflateRaw=inflateRaw,exports.ungzip=inflate},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate.js":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")}),$3Dmol=function(window){var my=window.$3Dmol||{};return my}(window),$3Dmol.createViewer=function(element,config){if("string"===$.type(element)&&(element=$("#"+element)),element){config=config||{};try{return new $3Dmol.GLViewer(element,config)}catch(e){throw"error creating viewer: "+e}return null}},$3Dmol.viewers={},$3Dmol.download=function(query,viewer,options,callback){var type="",pdbUri="",m=viewer.addModel();if("pdb:"===query.substr(0,4)){if(pdbUri=options&&options.pdbUri?options.pdbUri:"http://www.rcsb.org/pdb/files/",type=options&&options.format?options.format:"pdb",query=query.substr(4).toUpperCase(),!query.match(/^[1-9][A-Za-z0-9]{3}$/))return void alert("Wrong PDB ID");options&&options.format?uri=pdbUri+query+"."+options.format:uri=pdbUri+query+".pdb"}else if("cid:"==query.substr(0,4)){if(type="sdf",query=query.substr(4),!query.match(/^[1-9]+$/))return void alert("Wrong Compound ID");uri="http://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+query+"/SDF?record_type=3d"}return $.get(uri,function(ret){m.addMolData(ret,type,options),viewer.zoomTo(),viewer.render(),callback&&callback(m)}),m},$3Dmol.SurfaceType={VDW:1,MS:2,SAS:3,SES:4},$3Dmol.mergeGeos=function(geometry,mesh){var meshGeo=mesh.geometry;void 0!==meshGeo&&geometry.geometryGroups.push(meshGeo.geometryGroups[0])},$3Dmol.multiLineString=function(f){return f.toString().replace(/^[^\/]+\/\*!?/,"").replace(/\*\/[^\/]+$/,"")},$3Dmol.syncSurface=!1,(window.navigator.userAgent.indexOf("MSIE ")>=0||window.navigator.userAgent.indexOf("Trident/")>=0)&&($3Dmol.syncSurface=!0),$3Dmol.specStringToObject=function(str){if("object"==typeof str)return str;if("undefined"==typeof str||null==str)return str;str=str.replace(/%7E/,"~");for(var massage=function(val){return $.isNumeric(val)?Math.floor(parseFloat(val))==parseInt(val)?parseFloat(val):val.indexOf(".")>=0?parseFloat(val):parseInt(val):val},ret={},fields=str.split(";"),i=0;i<fields.length;i++){var fv=fields[i].split(":"),f=fv[0],val={},vstr=fv[1];if(vstr)if(vstr=vstr.replace(/~/g,"="),-1!==vstr.indexOf("="))for(var kvs=vstr.split(","),j=0;j<kvs.length;j++){var kv=kvs[j].split("=",2);val[kv[0]]=massage(kv[1])}else val=-1!==vstr.indexOf(",")?vstr.split(","):massage(vstr);ret[f]=val}return ret},$3Dmol.getExtent=function(atomlist,ignoreSymmetries){var xmin,ymin,zmin,xmax,ymax,zmax,xsum,ysum,zsum,cnt,includeSym=!ignoreSymmetries;if(xmin=ymin=zmin=9999,xmax=ymax=zmax=-9999,xsum=ysum=zsum=cnt=0,0===atomlist.length)return[[0,0,0],[0,0,0],[0,0,0]];for(var i=0;i<atomlist.length;i++){var atom=atomlist[i];if("undefined"!=typeof atom&&isFinite(atom.x)&&isFinite(atom.y)&&isFinite(atom.z)&&(cnt++,xsum+=atom.x,ysum+=atom.y,zsum+=atom.z,xmin=xmin<atom.x?xmin:atom.x,ymin=ymin<atom.y?ymin:atom.y,zmin=zmin<atom.z?zmin:atom.z,xmax=xmax>atom.x?xmax:atom.x,ymax=ymax>atom.y?ymax:atom.y,zmax=zmax>atom.z?zmax:atom.z,atom.symmetries&&includeSym))for(var n=0;n<atom.symmetries.length;n++)cnt++,xsum+=atom.symmetries[n].x,ysum+=atom.symmetries[n].y,zsum+=atom.symmetries[n].z,xmin=xmin<atom.symmetries[n].x?xmin:atom.symmetries[n].x,ymin=ymin<atom.symmetries[n].y?ymin:atom.symmetries[n].y,zmin=zmin<atom.symmetries[n].z?zmin:atom.symmetries[n].z,xmax=xmax>atom.symmetries[n].x?xmax:atom.symmetries[n].x,ymax=ymax>atom.symmetries[n].y?ymax:atom.symmetries[n].y,zmax=zmax>atom.symmetries[n].z?zmax:atom.symmetries[n].z}return[[xmin,ymin,zmin],[xmax,ymax,zmax],[xsum/cnt,ysum/cnt,zsum/cnt]]},$3Dmol.getAtomProperty=function(atom,prop){var val=null;return atom.properties&&"undefined"!=typeof atom.properties[prop]?val=atom.properties[prop]:"undefined"!=typeof atom[prop]&&(val=atom[prop]),val},$3Dmol.getPropertyRange=function(atomlist,prop){for(var min=Number.POSITIVE_INFINITY,max=Number.NEGATIVE_INFINITY,i=0,n=atomlist.length;n>i;i++){var atom=atomlist[i],val=$3Dmol.getAtomProperty(atom,prop);null!=val&&(min>val&&(min=val),val>max&&(max=val))}return isFinite(min)||isFinite(max)?isFinite(min)?isFinite(max)||(max=min):min=max:min=max=0,[min,max]};var $3Dmol=$3Dmol||{};$3Dmol.Math={clamp:function(x,min,max){return Math.min(Math.max(x,min),max)},degToRad:function(){var degreeToRadiansFactor=Math.PI/180;return function(deg){return deg*degreeToRadiansFactor}}()},$3Dmol.Quaternion=function(x,y,z,w){this.x=x||0,this.y=y||0,this.z=z||0,this.w=void 0!==w?w:1},$3Dmol.Quaternion.prototype={constructor:$3Dmol.Quaternion,set:function(x,y,z,w){return this.x=x,this.y=y,this.z=z,this.w=w,this},copy:function(q){return this.x=q.x,this.y=q.y,this.z=q.z,this.w=q.w,this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},inverse:function(){return this.conjugate().normalize()},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var l=this.length();return 0===l?(this.x=0,this.y=0,this.z=0,this.w=1):(l=1/l,this.x*=l,this.y*=l,this.z*=l,this.w*=l),this},multiply:function(q){return this.multiplyQuaternions(this,q)},multiplyQuaternions:function(a,b){var qax=a.x,qay=a.y,qaz=a.z,qaw=a.w,qbx=b.x,qby=b.y,qbz=b.z,qbw=b.w;this.x=qax*qbw+qaw*qbx+qay*qbz-qaz*qby,this.y=qay*qbw+qaw*qby+qaz*qbx-qax*qbz,this.z=qaz*qbw+qaw*qbz+qax*qby-qay*qbx,this.w=qaw*qbw-qax*qbx-qay*qby-qaz*qbz}},$3Dmol.Vector2=function(x,y){this.x=x||0,this.y=y||0},$3Dmol.Vector2.prototype={constructor:$3Dmol.Vector2,set:function(x,y){return this.x=x,this.y=y,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},copy:function(v){return this.x=v.x,this.y=v.y,this},clone:function(){return new $3Dmol.Vector2(this.x,this.y)}},$3Dmol.Vector3=function(x,y,z){this.x=x||0,this.y=y||0,this.z=z||0},$3Dmol.Vector3.prototype={constructor:$3Dmol.Vector3,set:function(x,y,z){return this.x=x,this.y=y,this.z=z,this},copy:function(v){return this.x=v.x,this.y=v.y,this.z=v.z,this},add:function(v){return this.x+=v.x,this.y+=v.y,this.z+=v.z,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},sub:function(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiplyScalar:function(s){return this.x*=s,this.y*=s,this.z*=s,this},divideScalar:function(s){return 0!==s?(this.x/=s,this.y/=s,this.z/=s):(this.x=0,this.y=0,this.z=0),this},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v))},distanceToSquared:function(v){var dx=this.x-v.x,dy=this.y-v.y,dz=this.z-v.z;return dx*dx+dy*dy+dz*dz},applyMatrix4:function(m){var x=this.x,y=this.y,z=this.z,e=m.elements;return this.x=e[0]*x+e[4]*y+e[8]*z+e[12],this.y=e[1]*x+e[5]*y+e[9]*z+e[13],this.z=e[2]*x+e[6]*y+e[10]*z+e[14],this},applyProjection:function(m){var x=this.x,y=this.y,z=this.z,e=m.elements,d=e[3]*x+e[7]*y+e[11]*z+e[15];return this.x=(e[0]*x+e[4]*y+e[8]*z+e[12])/d,this.y=(e[1]*x+e[5]*y+e[9]*z+e[13])/d,this.z=(e[2]*x+e[6]*y+e[10]*z+e[14])/d,this},applyQuaternion:function(q){var x=this.x,y=this.y,z=this.z,qx=q.x,qy=q.y,qz=q.z,t=(q.w,{});t.x=2*(y*qz-z*qy),t.y=2*(z*qx-x*qz),t.z=2*(x*qy-y*qx);var t2={};return t2.x=t.y*qz-t.z*qy,t2.y=t.z*qx-t.x*qz,t2.z=t.x*qy-t.y*qx,this.x=x+q.w*t.x+t2.x,this.y=y+q.w*t.y+t2.y,this.z=z+q.w*t.z+t2.z,this},negate:function(){return this.multiplyScalar(-1)},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(){return this.divideScalar(this.length())},cross:function(v){var x=this.x,y=this.y,z=this.z;return this.x=y*v.z-z*v.y,this.y=z*v.x-x*v.z,this.z=x*v.y-y*v.x,this},crossVectors:function(a,b){return this.x=a.y*b.z-a.z*b.y,this.y=a.z*b.x-a.x*b.z,this.z=a.x*b.y-a.y*b.x,this},getPositionFromMatrix:function(m){return this.x=m.elements[12],this.y=m.elements[13],this.z=m.elements[14],this},setEulerFromRotationMatrix:function(m,order){var te=m.elements,m11=te[0],m12=te[4],m13=te[8],m22=(te[1],te[5]),m23=te[9],m32=(te[2],te[6]),m33=te[10];return void 0===order||"XYZ"===order?(this.y=Math.asin($3Dmol.Math.clamp(m13,-1,1)),Math.abs(m13)<.99999?(this.x=Math.atan2(-m23,m33),this.z=Math.atan2(-m12,m11)):(this.x=Math.atan2(m32,m22),this.z=0)):console.error("Error with vector's setEulerFromRotationMatrix: Unknown order: "+order),this},rotateAboutVector:function(axis,ang){axis.normalize();var cosang=Math.cos(ang),sinang=Math.sin(ang),term1=this.clone().multiplyScalar(cosang),term2=axis.clone().cross(this).multiplyScalar(sinang),term3=axis.clone().multiplyScalar(axis.clone().dot(this)).multiplyScalar(1-cosang),rot=term1.add(term2).add(term3);return this.x=rot.x,this.y=rot.y,this.z=rot.z,this},clone:function(){return new $3Dmol.Vector3(this.x,this.y,this.z)}},$3Dmol.Matrix3=function(n11,n12,n13,n21,n22,n23,n31,n32,n33){this.elements=new Float32Array(9),this.set(void 0!==n11?n11:1,n12||0,n13||0,n21||0,void 0!==n22?n22:1,n23||0,n31||0,n32||0,void 0!==n33?n33:1)},$3Dmol.Matrix3.prototype={constructor:$3Dmol.Matrix3,set:function(n11,n12,n13,n21,n22,n23,n31,n32,n33){var te=this.elements;return te[0]=n11,te[3]=n12,te[6]=n13,te[1]=n21,te[4]=n22,te[7]=n23,te[2]=n31,te[5]=n32,te[8]=n33,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(m){var me=m.elements;this.set(me[0],me[3],me[6],me[1],me[4],me[7],me[2],me[5],me[8])},multiplyScalar:function(s){var te=this.elements;return te[0]*=s,te[3]*=s,te[6]*=s,te[1]*=s,te[4]*=s,te[7]*=s,te[2]*=s,te[5]*=s,te[8]*=s,this},getInverse:function(matrix,throwOnInvertible){var me=matrix.elements,te=this.elements;te[0]=me[10]*me[5]-me[6]*me[9],te[1]=-me[10]*me[1]+me[2]*me[9],te[2]=me[6]*me[1]-me[2]*me[5],te[3]=-me[10]*me[4]+me[6]*me[8],te[4]=me[10]*me[0]-me[2]*me[8],te[5]=-me[6]*me[0]+me[2]*me[4],te[6]=me[9]*me[4]-me[5]*me[8],te[7]=-me[9]*me[0]+me[1]*me[8],te[8]=me[5]*me[0]-me[1]*me[4];var det=me[0]*te[0]+me[1]*te[3]+me[2]*te[6];if(0===det){var msg="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(throwOnInvertible)throw new Error(msg);return console.warn(msg),this.identity(),this}return this.multiplyScalar(1/det),this},getDeterminant:function(){var m=this.elements,determinant=m[0]*m[4]*m[8]+m[1]*m[5]*m[6]+m[2]*m[3]*m[7]-m[2]*m[4]*m[6]-m[1]*m[3]*m[8]-m[0]*m[5]*m[7];return determinant},transpose:function(){var tmp,m=this.elements;return tmp=m[1],m[1]=m[3],m[3]=tmp,tmp=m[2],m[2]=m[6],m[6]=tmp,tmp=m[5],m[5]=m[7],m[7]=tmp,this},clone:function(){var te=this.elements;return new $3Dmol.Matrix3(te[0],te[3],te[6],te[1],te[4],te[7],te[2],te[5],te[8])}},$3Dmol.Matrix4=function(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){var te=this.elements=new Float32Array(16);te[0]=void 0!==n11?n11:1,te[4]=n12||0,te[8]=n13||0,te[12]=n14||0,te[1]=n21||0,te[5]=void 0!==n22?n22:1,te[9]=n23||0,te[13]=n24||0,te[2]=n31||0,te[6]=n32||0,te[10]=void 0!==n33?n33:1,te[14]=n34||0,te[3]=n41||0,te[7]=n42||0,te[11]=n43||0,te[15]=void 0!==n44?n44:1},$3Dmol.Matrix4.prototype={constructor:$3Dmol.Matrix4,set:function(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){var te=this.elements;return te[0]=n11,te[4]=n12,te[8]=n13,te[12]=n14,te[1]=n21,te[5]=n22,te[9]=n23,te[13]=n24,te[2]=n31,te[6]=n32,te[10]=n33,te[14]=n34,te[3]=n41,te[7]=n42,te[11]=n43,te[15]=n44,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(m){var me=m.elements;return this.set(me[0],me[4],me[8],me[12],me[1],me[5],me[9],me[13],me[2],me[6],me[10],me[14],me[3],me[7],me[11],me[15]),this},matrix3FromTopLeft:function(){var te=this.elements;return new $3Dmol.Matrix3(te[0],te[4],te[8],te[1],te[5],te[9],te[2],te[6],te[10])},setRotationFromEuler:function(v,order){var te=this.elements,x=v.x,y=v.y,z=v.z,a=Math.cos(x),b=Math.sin(x),c=Math.cos(y),d=Math.sin(y),e=Math.cos(z),f=Math.sin(z);if(void 0===order||"XYZ"===order){var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e,te[4]=-c*f,te[8]=d,te[1]=af+be*d,te[5]=ae-bf*d,te[9]=-b*c,te[2]=bf-ae*d,te[6]=be+af*d,te[10]=a*c}else console.error("Error with matrix4 setRotationFromEuler. Order: "+order);return this},setRotationFromQuaternion:function(q){var te=this.elements,x=q.x,y=q.y,z=q.z,w=q.w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return te[0]=1-(yy+zz),te[4]=xy-wz,te[8]=xz+wy,te[1]=xy+wz,te[5]=1-(xx+zz),te[9]=yz-wx,te[2]=xz-wy,te[6]=yz+wx,te[10]=1-(xx+yy),this},lookAt:function(){var x=new $3Dmol.Vector3,y=new $3Dmol.Vector3,z=new $3Dmol.Vector3;return function(eye,target,up){var te=this.elements;return z.subVectors(eye,target).normalize(),0===z.length()&&(z.z=1),x.crossVectors(up,z).normalize(),0===x.length()&&(z.x+=1e-4,x.crossVectors(up,z).normalize()),y.crossVectors(z,x),te[0]=x.x,te[4]=y.x,te[8]=z.x,te[1]=x.y,te[5]=y.y,te[9]=z.y,te[2]=x.z,te[6]=y.z,te[10]=z.z,this}}(),multiplyMatrices:function(a,b){var ae=a.elements,be=b.elements,te=this.elements,a11=ae[0],a12=ae[4],a13=ae[8],a14=ae[12],a21=ae[1],a22=ae[5],a23=ae[9],a24=ae[13],a31=ae[2],a32=ae[6],a33=ae[10],a34=ae[14],a41=ae[3],a42=ae[7],a43=ae[11],a44=ae[15],b11=be[0],b12=be[4],b13=be[8],b14=be[12],b21=be[1],b22=be[5],b23=be[9],b24=be[13],b31=be[2],b32=be[6],b33=be[10],b34=be[14],b41=be[3],b42=be[7],b43=be[11],b44=be[15];return te[0]=a11*b11+a12*b21+a13*b31+a14*b41,te[4]=a11*b12+a12*b22+a13*b32+a14*b42,te[8]=a11*b13+a12*b23+a13*b33+a14*b43,te[12]=a11*b14+a12*b24+a13*b34+a14*b44,te[1]=a21*b11+a22*b21+a23*b31+a24*b41,te[5]=a21*b12+a22*b22+a23*b32+a24*b42,te[9]=a21*b13+a22*b23+a23*b33+a24*b43,te[13]=a21*b14+a22*b24+a23*b34+a24*b44,te[2]=a31*b11+a32*b21+a33*b31+a34*b41,te[6]=a31*b12+a32*b22+a33*b32+a34*b42,te[10]=a31*b13+a32*b23+a33*b33+a34*b43,te[14]=a31*b14+a32*b24+a33*b34+a34*b44,te[3]=a41*b11+a42*b21+a43*b31+a44*b41,te[7]=a41*b12+a42*b22+a43*b32+a44*b42,te[11]=a41*b13+a42*b23+a43*b33+a44*b43,te[15]=a41*b14+a42*b24+a43*b34+a44*b44,this},multiplyScalar:function(s){var te=this.elements;return te[0]*=s,te[4]*=s,te[8]*=s,te[12]*=s,te[1]*=s,te[5]*=s,te[9]*=s,te[13]*=s,te[2]*=s,te[6]*=s,te[10]*=s,te[14]*=s,te[3]*=s,te[7]*=s,te[11]*=s,te[15]*=s,this},transpose:function(){var tmp,te=this.elements;return tmp=te[1],te[1]=te[4],te[4]=tmp,tmp=te[2],te[2]=te[8],te[8]=tmp,tmp=te[6],te[6]=te[9],te[9]=tmp,tmp=te[3],te[3]=te[12],te[12]=tmp,tmp=te[7],te[7]=te[13],te[13]=tmp,tmp=te[11],te[11]=te[14],te[14]=tmp,this},getPosition:function(){var v1=new $3Dmol.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var te=this.elements;return v1.set(te[12],te[13],te[14])}}(),setPosition:function(v){var te=this.elements;return te[12]=v.x,te[13]=v.y,te[14]=v.z,this},getInverse:function(m,throwOnInvertible){var te=this.elements,me=m.elements,n11=me[0],n12=me[4],n13=me[8],n14=me[12],n21=me[1],n22=me[5],n23=me[9],n24=me[13],n31=me[2],n32=me[6],n33=me[10],n34=me[14],n41=me[3],n42=me[7],n43=me[11],n44=me[15];te[0]=n23*n34*n42-n24*n33*n42+n24*n32*n43-n22*n34*n43-n23*n32*n44+n22*n33*n44,te[4]=n14*n33*n42-n13*n34*n42-n14*n32*n43+n12*n34*n43+n13*n32*n44-n12*n33*n44,te[8]=n13*n24*n42-n14*n23*n42+n14*n22*n43-n12*n24*n43-n13*n22*n44+n12*n23*n44,te[12]=n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34,te[1]=n24*n33*n41-n23*n34*n41-n24*n31*n43+n21*n34*n43+n23*n31*n44-n21*n33*n44,te[5]=n13*n34*n41-n14*n33*n41+n14*n31*n43-n11*n34*n43-n13*n31*n44+n11*n33*n44,te[9]=n14*n23*n41-n13*n24*n41-n14*n21*n43+n11*n24*n43+n13*n21*n44-n11*n23*n44,te[13]=n13*n24*n31-n14*n23*n31+n14*n21*n33-n11*n24*n33-n13*n21*n34+n11*n23*n34,te[2]=n22*n34*n41-n24*n32*n41+n24*n31*n42-n21*n34*n42-n22*n31*n44+n21*n32*n44,te[6]=n14*n32*n41-n12*n34*n41-n14*n31*n42+n11*n34*n42+n12*n31*n44-n11*n32*n44,te[10]=n12*n24*n41-n14*n22*n41+n14*n21*n42-n11*n24*n42-n12*n21*n44+n11*n22*n44,te[14]=n14*n22*n31-n12*n24*n31-n14*n21*n32+n11*n24*n32+n12*n21*n34-n11*n22*n34,te[3]=n23*n32*n41-n22*n33*n41-n23*n31*n42+n21*n33*n42+n22*n31*n43-n21*n32*n43,te[7]=n12*n33*n41-n13*n32*n41+n13*n31*n42-n11*n33*n42-n12*n31*n43+n11*n32*n43,te[11]=n13*n22*n41-n12*n23*n41-n13*n21*n42+n11*n23*n42+n12*n21*n43-n11*n22*n43,te[15]=n12*n23*n31-n13*n22*n31+n13*n21*n32-n11*n23*n32-n12*n21*n33+n11*n22*n33;var det=me[0]*te[0]+me[1]*te[4]+me[2]*te[8]+me[3]*te[12];if(0===det){var msg="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(throwOnInvertible)throw new Error(msg);return console.warn(msg),this.identity(),this}return this.multiplyScalar(1/det),this},isReflected:function(){return this.matrix3FromTopLeft().getDeterminant()<0},compose:function(){var mRotation=new $3Dmol.Matrix4,mScale=new $3Dmol.Matrix4;return function(translation,rotation,scale){var te=this.elements;return mRotation.identity(),mRotation.setRotationFromQuaternion(rotation),mScale.makeScale(scale.x,scale.y,scale.z),this.multiplyMatrices(mRotation,mScale),te[12]=translation.x,te[13]=translation.y,te[14]=translation.z,this}}(),decompose:function(){var x=new $3Dmol.Vector3,y=new $3Dmol.Vector3,z=new $3Dmol.Vector3,matrix=new $3Dmol.Matrix4;return function(translation,rotation,scale){var te=this.elements;return x.set(te[0],te[1],te[2]),y.set(te[4],te[5],te[6]),z.set(te[8],te[9],te[10]),translation=translation instanceof $3Dmol.Vector3?translation:new $3Dmol.Vector3,rotation=rotation instanceof $3Dmol.Quaternion?rotation:new $3Dmol.Quaternion,scale=scale instanceof $3Dmol.Vector3?scale:new $3Dmol.Vector3,scale.x=x.length(),scale.y=y.length(),scale.z=z.length(),translation.x=te[12],translation.y=te[13],translation.z=te[14],matrix.copy(this),matrix.elements[0]/=scale.x,matrix.elements[1]/=scale.x,matrix.elements[2]/=scale.x,matrix.elements[4]/=scale.y,matrix.elements[5]/=scale.y,matrix.elements[6]/=scale.y,matrix.elements[8]/=scale.z,matrix.elements[9]/=scale.z,matrix.elements[10]/=scale.z,rotation.setFromRotationMatrix(matrix),[translation,rotation,scale]}}(),scale:function(v){var te=this.elements,x=v.x,y=v.y,z=v.z;return te[0]*=x,te[4]*=y,te[8]*=z,te[1]*=x,te[5]*=y,te[9]*=z,te[2]*=x,te[6]*=y,te[10]*=z,te[3]*=x,te[7]*=y,te[11]*=z,this},getMaxScaleOnAxis:function(){var te=this.elements,scaleXSq=te[0]*te[0]+te[1]*te[1]+te[2]*te[2],scaleYSq=te[4]*te[4]+te[5]*te[5]+te[6]*te[6],scaleZSq=te[8]*te[8]+te[9]*te[9]+te[10]*te[10];return Math.sqrt(Math.max(scaleXSq,Math.max(scaleYSq,scaleZSq)))},makeFrustum:function(left,right,bottom,top,near,far){var te=this.elements,x=2*near/(right-left),y=2*near/(top-bottom),a=(right+left)/(right-left),b=(top+bottom)/(top-bottom),c=-(far+near)/(far-near),d=-2*far*near/(far-near);return te[0]=x,te[4]=0,te[8]=a,te[12]=0,te[1]=0,te[5]=y,te[9]=b,te[13]=0,te[2]=0,te[6]=0,te[10]=c,te[14]=d,te[3]=0,te[7]=0,te[11]=-1,te[15]=0,this},makePerspective:function(fov,aspect,near,far){var ymax=near*Math.tan($3Dmol.Math.degToRad(.5*fov)),ymin=-ymax,xmin=ymin*aspect,xmax=ymax*aspect;return this.makeFrustum(xmin,xmax,ymin,ymax,near,far)},isEqual:function(m){var me=m.elements,te=this.elements;return te[0]==me[0]&&te[4]==me[4]&&te[8]==me[8]&&te[12]==me[12]&&te[1]==me[1]&&te[5]==me[5]&&te[9]==me[9]&&te[13]==me[13]&&te[2]==me[2]&&te[6]==me[6]&&te[10]==me[10]&&te[14]==me[14]&&te[3]==me[3]&&te[7]==me[7]&&te[11]==me[11]&&te[15]==me[15]?!0:!1},clone:function(){var te=this.elements;return new $3Dmol.Matrix4(te[0],te[4],te[8],te[12],te[1],te[5],te[9],te[13],te[2],te[6],te[10],te[14],te[3],te[7],te[11],te[15])},isIdentity:function(){var te=this.elements;return 1==te[0]&&0==te[4]&&0==te[8]&&0==te[12]&&0==te[1]&&1==te[5]&&0==te[9]&&0==te[13]&&0==te[2]&&0==te[6]&&1==te[10]&&0==te[14]&&0==te[3]&&0==te[7]&&0==te[11]&&1==te[15]?!0:!1}},$3Dmol.Ray=function(origin,direction){this.origin=void 0!==origin?origin:new $3Dmol.Vector3,this.direction=void 0!==direction?direction:new $3Dmol.Vector3},$3Dmol.Ray.prototype={constructor:$3Dmol.Ray,set:function(origin,direction){return this.origin.copy(origin),this.direction.copy(direction),this},copy:function(ray){return this.origin.copy(ray.origin),this.direction.copy(ray.direction),this},at:function(t,optionalTarget){var result=optionalTarget||new $3Dmol.Vector3;return result.copy(this.direction).multiplyScalar(t).add(this.origin)},recast:function(){var v1=new $3Dmol.Vector3;return function(t){return this.origin.copy(this.at(t,v1)),this}}(),closestPointToPoint:function(point,optionalTarget){var result=optionalTarget||new $3Dmol.Vector3;result.subVectors(point,this.origin);var directionDistance=result.dot(this.direction);return result.copy(this.direction).multiplyScalar(directionDistance).add(this.origin)},distanceToPoint:function(point){var v1=new $3Dmol.Vector3;return function(point){var directionDistance=v1.subVectors(point,this.origin).dot(this.direction);return v1.copy(this.direction).multiplyScalar(directionDistance).add(this.origin),v1.distanceTo(point)}}(),isIntersectionCylinder:function(){},isIntersectionSphere:function(sphere){return this.distanceToPoint(sphere.center)<=sphere.radius},isIntersectionPlane:function(plane){var denominator=plane.normal.dot(this.direction);return 0!==denominator?!0:0===plane.distanceToPoint(this.origin)?!0:!1},distanceToPlane:function(plane){var denominator=plane.normal.dot(this.direction);{if(0!==denominator){var t=-(this.origin.dot(plane.normal)+plane.constant)/denominator;return t}if(0===plane.distanceToPoint(this.origin))return 0}},intersectPlane:function(plane,optionalTarget){var t=this.distanceToPlane(plane);if(void 0!==t)return this.at(t,optionalTarget)},applyMatrix4:function(matrix4){return this.direction.add(this.origin).applyMatrix4(matrix4),this.origin.applyMatrix4(matrix4),this.direction.sub(this.origin),this},equals:function(ray){return ray.origin.equals(this.origin)&&ray.direction.equals(this.direction)},clone:function(){return(new $3Dmol.Ray).copy(this)}},$3Dmol.Sphere=function(center,radius){this.center=void 0!==center?center:new $3Dmol.Vector3,this.radius=void 0!==radius?radius:0},$3Dmol.Sphere.prototype={constructor:$3Dmol.Sphere,set:function(center,radius){return this.center.copy(center),this.radius=radius,this},copy:function(sphere){return this.center.copy(sphere.center),this.radius=sphere.radius,this},applyMatrix4:function(matrix){return this.center.applyMatrix4(matrix),this.radius=this.radius*matrix.getMaxScaleOnAxis(),this},translate:function(offset){return this.center.add(offset),this},equals:function(sphere){return sphere.center.equals(this.center)&&sphere.radius===this.radius},clone:function(){return(new $3Dmol.Sphere).copy(this)}},$3Dmol.Cylinder=function(c1,c2,radius){this.c1=void 0!==c1?c1:new $3Dmol.Vector3,this.c2=void 0!==c2?c2:new $3Dmol.Vector3,this.direction=(new $3Dmol.Vector3).subVectors(this.c2,this.c1).normalize(),this.radius=void 0!==radius?radius:0},$3Dmol.Cylinder.prototype={constructor:$3Dmol.Cylinder,copy:function(cylinder){return this.c1.copy(cylinder.c1),this.c2.copy(cylinder.c2),this.direction.copy(cylinder.direction),this.radius=cylinder.radius,this},lengthSq:function(){var vector=new $3Dmol.Vector3;return function(){return vector.subVectors(this.c2,this.c1).lengthSq()}}(),applyMatrix4:function(matrix){return this.direction.add(this.c1).applyMatrix4(matrix),this.c1.applyMatrix4(matrix),this.c2.applyMatrix4(matrix),this.direction.sub(this.c1).normalize(),this.radius=this.radius*matrix.getMaxScaleOnAxis(),this}},$3Dmol.Triangle=function(a,b,c){this.a=void 0!==a?a:new $3Dmol.Vector3,this.b=void 0!==b?b:new $3Dmol.Vector3,this.c=void 0!==c?c:new $3Dmol.Vector3},$3Dmol.Triangle.prototype={constructor:$3Dmol.Triangle,copy:function(triangle){return this.a.copy(triangle.a),this.b.copy(triangle.b),this.c.copy(triangle.c),this},applyMatrix4:function(matrix){return this.a.applyMatrix4(matrix),this.b.applyMatrix4(matrix),this.c.applyMatrix4(matrix),this},getNormal:function(){var v1=new $3Dmol.Vector3;return function(){var norm=this.a.clone();return norm.sub(this.b),v1.subVectors(this.c,this.b),norm.cross(v1),norm.normalize(),norm}}()},$3Dmol.EventDispatcher=function(){var listeners={};this.addEventListener=function(type,listener){void 0===listeners[type]&&(listeners[type]=[]),-1===listeners[type].indexOf(listener)&&listeners[type].push(listener)},this.removeEventListener=function(type,listener){var index=listeners[type].indexOf(listener);-1!==index&&listeners[type].splice(index,1)},this.dispatchEvent=function(event){var listenerArray=listeners[event.type];if(void 0!==listenerArray){event.target=this;for(var i=0,l=listenerArray.length;l>i;i++)listenerArray[i].call(this,event)}}},$3Dmol.Color=function(color){return arguments.length>1?(this.r=arguments[0]||0,this.g=arguments[1]||0,this.b=arguments[2]||0,this):this.set(color)},$3Dmol.Color.prototype={constructor:$3Dmol.Color,r:0,g:0,b:0,set:function(val){return val instanceof $3Dmol.Color?val.clone():void("number"==typeof val?this.setHex(val):"object"==typeof val&&"r"in val&&"g"in val&&"b"in val&&(this.r=val.r,this.g=val.g,this.b=val.b))},setHex:function(hex){return hex=Math.floor(hex),this.r=(hex>>16&255)/255,this.g=(hex>>8&255)/255,this.b=(255&hex)/255,this},getHex:function(){var R=Math.round(255*this.r),G=Math.round(255*this.g),B=Math.round(255*this.b);return R<<16|G<<8|B},clone:function(){return new $3Dmol.Color(this.r,this.g,this.b)},copy:function(color){return this.r=color.r,this.g=color.g,this.b=color.b,this},scaled:function(){var ret={};return ret.r=Math.round(255*this.r),ret.g=Math.round(255*this.g),ret.b=Math.round(255*this.b),ret.a=1,ret}},$3Dmol.Object3D=function(){this.id=$3Dmol.Object3DIDCount++,this.name="",this.parent=void 0,this.children=[],this.position=new $3Dmol.Vector3,this.rotation=new $3Dmol.Vector3,this.matrix=new $3Dmol.Matrix4,this.matrixWorld=new $3Dmol.Matrix4,this.quaternion=new $3Dmol.Quaternion,this.eulerOrder="XYZ",this.up=new $3Dmol.Vector3(0,1,0),this.scale=new $3Dmol.Vector3(1,1,1),this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.rotationAutoUpdate=!0,this.useQuaternion=!1,this.visible=!0},$3Dmol.Object3D.prototype={constructor:$3Dmol.Object3D,lookAt:function(vector){this.matrix.lookAt(vector,this.position,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!0?this.quaternion.copy(this.matrix.decompose()[1]):this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder))},add:function(object){if(object===this)return void console.error("Can't add $3Dmol.Object3D to itself");object.parent=this,this.children.push(object);for(var scene=this;void 0!==scene.parent;)scene=scene.parent;void 0!==scene&&scene instanceof $3Dmol.Scene&&scene.__addObject(object)},remove:function(object){var index=this.children.indexOf(object);if(-1!==index){object.parent=void 0,this.children.splice(index,1);for(var scene=this;void 0!==scene.parent;)scene=scene.parent;void 0!==scene&&scene instanceof $3Dmol.Scene&&scene.__removeObject(object)}},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion===!1?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(1!==this.scale.x||1!==this.scale.y||1!==this.scale.z)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(force){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||force===!0)&&(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1;for(var i=0;i<this.children.length;i++)this.children[i].updateMatrixWorld(!0)},clone:function(object){void 0===object&&(object=new $3Dmol.Object3D),object.name=this.name,object.up.copy(this.up),object.position.copy(this.position),object.rotation.copy(this.rotation),object.eulerOrder=this.eulerOrder,object.scale.copy(this.scale),object.rotationAutoUpdate=this.rotationAutoUpdate,object.matrix.copy(this.matrix),object.matrixWorld.copy(this.matrixWorld),object.quaternion.copy(this.quaternion),object.matrixAutoUpdate=this.matrixAutoUpdate,object.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,object.useQuaternion=this.useQuaternion,object.visible=this.visible;for(var i=0;i<this.children.length;i++){var child=this.children[i];object.add(child.clone())}return object},setVisible:function(val){this.visible=val;for(var i=0;i<this.children.length;i++){var child=this.children[i];child.setVisible(val)}}},$3Dmol.Object3DIDCount=0,$3Dmol.Geometry=function(){var BUFFERSIZE=65535,geometryGroup=function(id){this.id=id||0,this.vertexArray=null,this.colorArray=null,this.normalArray=null,this.faceArray=null,this.lineArray=null,this.vertices=0,this.faceidx=0,this.lineidx=0};geometryGroup.prototype.getNumVertices=function(){return this.vertices},geometryGroup.prototype.getVertices=function(){return this.vertexArray},geometryGroup.prototype.getCentroid=function(){for(var offset,x,y,z,centroid=new $3Dmol.Vector3,i=0;i<this.vertices;++i)offset=3*i,x=this.vertexArray[offset],y=this.vertexArray[offset+1],z=this.vertexArray[offset+2],centroid.x+=x,centroid.y+=y,centroid.z+=z;return centroid.divideScalar(this.vertices),centroid},geometryGroup.prototype.setNormals=function(){var faces=this.faceArray,verts=this.vertexArray,norms=this.normalArray;if(this.vertices&&this.faceidx)for(var a,b,c,vA,vB,vC,norm,i=0;i<faces.length/3;++i)a=3*faces[3*i],b=3*faces[3*i+1],c=3*faces[3*i+2],vA=new $3Dmol.Vector3(verts[a],verts[a+1],verts[a+2]),vB=new $3Dmol.Vector3(verts[b],verts[b+1],verts[b+2]),vC=new $3Dmol.Vector3(verts[c],verts[c+1],verts[c+2]),vA.subVectors(vA,vB),vC.subVectors(vC,vB),vC.cross(vA),norm=vC,norm.normalize(),norms[a]+=norm.x,norms[b]+=norm.x,norms[c]+=norm.x,norms[a+1]+=norm.y,norms[b+1]+=norm.y,norms[c+1]+=norm.y,norms[a+2]+=norm.z,norms[b+2]+=norm.z,norms[c+2]+=norm.z},geometryGroup.prototype.setLineIndices=function(){if(this.faceidx){var faceArr=this.faceArray,lineArr=this.lineArray=new Uint16Array(2*this.faceidx);this.lineidx=2*this.faceidx;for(var faceoffset,i=0;i<this.faceidx/3;++i){faceoffset=3*i,lineoffset=2*faceoffset;var a=faceArr[faceoffset],b=faceArr[faceoffset+1],c=faceArr[faceoffset+2];lineArr[lineoffset]=a,lineArr[lineoffset+1]=b,lineArr[lineoffset+2]=a,lineArr[lineoffset+3]=c,lineArr[lineoffset+4]=b,lineArr[lineoffset+5]=c}}},geometryGroup.prototype.truncateArrayBuffers=function(mesh,reallocatemem){mesh=mesh===!0?!0:!1;var vertexArr=this.vertexArray,colorArr=this.colorArray,normalArr=this.normalArray,faceArr=this.faceArray,lineArr=this.lineArray;this.vertexArray=vertexArr.subarray(0,3*this.vertices),this.colorArray=colorArr.subarray(0,3*this.vertices),mesh?(this.normalArray=normalArr.subarray(0,3*this.vertices),this.faceArray=faceArr.subarray(0,this.faceidx),this.lineidx>0?this.lineArray=lineArr.subarray(0,this.lineidx):this.lineArray=new Uint16Array):(this.normalArray=new Float32Array,this.faceArray=new Uint16Array,this.lineArray=new Uint16Array),reallocatemem&&(this.normalArray&&(this.normalArray=new Float32Array(this.normalArray)),this.faceArray&&(this.faceArray=new Uint16Array(this.faceArray)),this.lineArray&&(this.lineArray=new Uint16Array(this.lineArray)),this.vertexArray&&(this.vertexArray=new Float32Array(this.vertexArray)),this.colorArray&&(this.colorArray=new Float32Array(this.colorArray))),
this.__inittedArrays=!0};var addGroup=function(geo){var ret=new geometryGroup(geo.geometryGroups.length);return geo.geometryGroups.push(ret),geo.groups=geo.geometryGroups.length,ret.vertexArray=new Float32Array(3*BUFFERSIZE),ret.colorArray=new Float32Array(3*BUFFERSIZE),geo.mesh&&(ret.normalArray=new Float32Array(3*BUFFERSIZE),ret.faceArray=new Uint16Array(6*BUFFERSIZE),ret.lineArray=new Uint16Array(6*BUFFERSIZE)),ret},Geometry=function(mesh){$3Dmol.EventDispatcher.call(this),this.id=$3Dmol.GeometryIDCount++,this.name="",this.hasTangents=!1,this.dynamic=!0,this.mesh=mesh===!0?!0:!1,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.buffersNeedUpdate=!1,this.geometryGroups=[],this.groups=0};return Geometry.prototype={constructor:Geometry,updateGeoGroup:function(addVertices){addVertices=addVertices||0;var retGroup=this.groups>0?this.geometryGroups[this.groups-1]:null;return(!retGroup||retGroup.vertices+addVertices>BUFFERSIZE)&&(retGroup=addGroup(this)),retGroup},addGeoGroup:function(){return addGroup(this)},setUpNormals:function(three){three=three||!1;for(var g=0;g<this.groups;g++){var geoGroup=this.geometryGroups[g];geoGroup.setNormals(three)}},setUpWireframe:function(){for(var g=0;g<this.groups;g++){var geoGroup=this.geometryGroups[g];geoGroup.setLineIndices()}},initTypedArrays:function(){for(var g=0;g<this.groups;g++){var group=this.geometryGroups[g];group.__inittedArrays!==!0&&group.truncateArrayBuffers(this.mesh,!1)}},dispose:function(){this.dispatchEvent({type:"dispose"})}},Geometry}(),Object.defineProperty($3Dmol.Geometry.prototype,"vertices",{get:function(){for(var vertices=0,g=0;g<this.groups;g++)vertices+=this.geometryGroups[g].vertices;return vertices}}),$3Dmol.GeometryIDCount=0,$3Dmol.Raycaster=function(){var Raycaster=function(origin,direction,far,near){this.ray=new $3Dmol.Ray(origin,direction),this.ray.direction.lengthSq()>0&&this.ray.direction.normalize(),this.near=near||0,this.far=far||1/0},sphere=new $3Dmol.Sphere,cylinder=new $3Dmol.Cylinder,triangle=new $3Dmol.Triangle,w_0=new $3Dmol.Vector3,v1=new $3Dmol.Vector3,v2=new $3Dmol.Vector3,v3=new $3Dmol.Vector3,matrixPosition=(new $3Dmol.Ray,new $3Dmol.Vector3,new $3Dmol.Vector3),descSort=(new $3Dmol.Matrix4,function(a,b){return a.distance-b.distance}),clamp=function(x){return Math.min(Math.max(x,-1),1)},intersectObject=function(group,clickable,raycaster,intersects){if(matrixPosition.getPositionFromMatrix(group.matrixWorld),clickable.clickable!==!0||void 0===clickable.intersectionShape)return intersects;var intersectionShape=clickable.intersectionShape,precision=raycaster.linePrecision;precision*=group.matrixWorld.getMaxScaleOnAxis();var precisionSq=precision*precision;if(void 0!==clickable.boundingSphere&&clickable.boundingSphere instanceof $3Dmol.Sphere&&(sphere.copy(clickable.boundingSphere),sphere.applyMatrix4(group.matrixWorld),!raycaster.ray.isIntersectionSphere(sphere)))return intersects;var i,il,norm,normProj,cylProj,rayProj,distance,closestDistSq,denom,discriminant,s,t,s_c,t_c;for(i=0,il=intersectionShape.triangle.length;il>i;i++)if(intersectionShape.triangle[i]instanceof $3Dmol.Triangle){if(triangle.copy(intersectionShape.triangle[i]),triangle.applyMatrix4(group.matrixWorld),norm=triangle.getNormal(),normProj=raycaster.ray.direction.dot(norm),normProj>=0)continue;if(w_0.subVectors(triangle.a,raycaster.ray.origin),distance=norm.dot(w_0)/normProj,0>distance)continue;v1.copy(raycaster.ray.direction).multiplyScalar(distance).add(raycaster.ray.origin),v1.sub(triangle.a),v2.copy(triangle.b).sub(triangle.a),v3.copy(triangle.c).sub(triangle.a);var b_dot_c=v2.dot(v3),b_sq=v2.lengthSq(),c_sq=v3.lengthSq();if(t=(b_sq*v1.dot(v3)-b_dot_c*v1.dot(v2))/(b_sq*c_sq-b_dot_c*b_dot_c),0>t||t>1)continue;if(s=(v1.dot(v2)-t*b_dot_c)/b_sq,0>s||s>1||s+t>1)continue;intersects.push({clickable:clickable,distance:distance})}for(i=0,il=intersectionShape.cylinder.length;il>i;i++)if(intersectionShape.cylinder[i]instanceof $3Dmol.Cylinder){if(cylinder.copy(intersectionShape.cylinder[i]),cylinder.applyMatrix4(group.matrixWorld),w_0.subVectors(cylinder.c1,raycaster.ray.origin),cylProj=w_0.dot(cylinder.direction),rayProj=w_0.dot(raycaster.ray.direction),normProj=clamp(raycaster.ray.direction.dot(cylinder.direction)),denom=1-normProj*normProj,0===denom)continue;s_c=(normProj*rayProj-cylProj)/denom,t_c=(rayProj-normProj*cylProj)/denom,v1.copy(cylinder.direction).multiplyScalar(s_c).add(cylinder.c1),v2.copy(raycaster.ray.direction).multiplyScalar(t_c).add(raycaster.ray.origin),closestDistSq=v3.subVectors(v1,v2).lengthSq();var radiusSq=cylinder.radius*cylinder.radius;if(radiusSq>=closestDistSq){if(discriminant=(normProj*cylProj-rayProj)*(normProj*cylProj-rayProj)-denom*(w_0.lengthSq()-cylProj*cylProj-radiusSq),t=distance=0>=discriminant?Math.sqrt(closestDistSq):(rayProj-normProj*cylProj-Math.sqrt(discriminant))/denom,s=normProj*t-cylProj,0>s||s*s>cylinder.lengthSq()||0>t)continue;intersects.push({clickable:clickable,distance:distance})}}for(i=0,il=intersectionShape.line.length;il>i;i+=2){v1.copy(intersectionShape.line[i]),v1.applyMatrix4(group.matrixWorld),v2.copy(intersectionShape.line[i+1]),v2.applyMatrix4(group.matrixWorld),v3.subVectors(v2,v1);var bondLengthSq=v3.lengthSq();v3.normalize(),w_0.subVectors(v1,raycaster.ray.origin),lineProj=w_0.dot(v3),rayProj=w_0.dot(raycaster.ray.direction),normProj=clamp(raycaster.ray.direction.dot(v3)),denom=1-normProj*normProj,0!==denom&&(s_c=(normProj*rayProj-lineProj)/denom,t_c=(rayProj-normProj*lineProj)/denom,v1.add(v3.multiplyScalar(s_c)),v2.copy(raycaster.ray.direction).multiplyScalar(t_c).add(raycaster.ray.origin),closestDistSq=v3.subVectors(v2,v1).lengthSq(),precisionSq>closestDistSq&&bondLengthSq>s_c*s_c&&intersects.push({clickable:clickable,distance:t_c}))}for(i=0,il=intersectionShape.sphere.length;il>i;i++)if(intersectionShape.sphere[i]instanceof $3Dmol.Sphere&&(sphere.copy(intersectionShape.sphere[i]),sphere.applyMatrix4(group.matrixWorld),raycaster.ray.isIntersectionSphere(sphere))){v1.subVectors(sphere.center,raycaster.ray.origin);var distanceToCenter=v1.dot(raycaster.ray.direction);return discriminant=distanceToCenter*distanceToCenter-(v1.lengthSq()-sphere.radius*sphere.radius),0>distanceToCenter?intersects:(distance=0>=discriminant?distanceToCenter:distanceToCenter-Math.sqrt(discriminant),intersects.push({clickable:clickable,distance:distance}),intersects)}};return Raycaster.prototype.precision=1e-4,Raycaster.prototype.linePrecision=.2,Raycaster.prototype.set=function(origin,direction){this.ray.set(origin,direction)},Raycaster.prototype.intersectObjects=function(group,objects){for(var intersects=[],i=0,l=objects.length;l>i;i++)intersectObject(group,objects[i],this,intersects);return intersects.sort(descSort),intersects},Raycaster}(),$3Dmol.Projector=function(){var _viewProjectionMatrix=(new $3Dmol.Matrix4,new $3Dmol.Matrix4);this.projectVector=function(vector,camera){return camera.matrixWorldInverse.getInverse(camera.matrixWorld),_viewProjectionMatrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse),vector.applyProjection(_viewProjectionMatrix)},this.unprojectVector=function(vector,camera){return camera.projectionMatrixInverse.getInverse(camera.projectionMatrix),_viewProjectionMatrix.multiplyMatrices(camera.matrixWorld,camera.projectionMatrixInverse),vector.applyProjection(_viewProjectionMatrix)}},$3Dmol.Camera=function(fov,aspect,near,far){$3Dmol.Object3D.call(this),this.fov=void 0!==fov?fov:50,this.aspect=void 0!==aspect?aspect:1,this.near=void 0!==near?near:.1,this.far=void 0!==far?far:2e3,this.projectionMatrix=new $3Dmol.Matrix4,this.projectionMatrixInverse=new $3Dmol.Matrix4,this.matrixWorldInverse=new $3Dmol.Matrix4,this.updateProjectionMatrix()},$3Dmol.Camera.prototype=Object.create($3Dmol.Object3D.prototype),$3Dmol.Camera.prototype.lookAt=function(vector){this.matrix.lookAt(this.position,vector,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1]))},$3Dmol.Camera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},$3Dmol.SpritePlugin=function(){function createProgram(shader,precision){var program=_gl.createProgram(),fragmentShader=_gl.createShader(_gl.FRAGMENT_SHADER),vertexShader=_gl.createShader(_gl.VERTEX_SHADER),prefix="precision "+precision+" float;\n";return _gl.shaderSource(fragmentShader,prefix+shader.fragmentShader),_gl.shaderSource(vertexShader,prefix+shader.vertexShader),_gl.compileShader(fragmentShader),_gl.compileShader(vertexShader),_gl.getShaderParameter(fragmentShader,_gl.COMPILE_STATUS)&&_gl.getShaderParameter(vertexShader,_gl.COMPILE_STATUS)?(_gl.attachShader(program,fragmentShader),_gl.attachShader(program,vertexShader),_gl.linkProgram(program),_gl.getProgramParameter(program,_gl.LINK_STATUS)||console.error("Could not initialize shader"),program):(console.error(_gl.getShaderInfoLog(fragmentShader)),console.error("could not initialize shader"),null)}function painterSortStable(a,b){return a.z!==b.z?b.z-a.z:b.id-a.id}var _gl,_renderer,_precision,_sprite={};this.init=function(renderer){_gl=renderer.context,_renderer=renderer,_precision=renderer.getPrecision(),_sprite.vertices=new Float32Array(16),_sprite.faces=new Uint16Array(6);var i=0;_sprite.vertices[i++]=-1,_sprite.vertices[i++]=-1,_sprite.vertices[i++]=0,_sprite.vertices[i++]=0,_sprite.vertices[i++]=1,_sprite.vertices[i++]=-1,_sprite.vertices[i++]=1,_sprite.vertices[i++]=0,_sprite.vertices[i++]=1,_sprite.vertices[i++]=1,_sprite.vertices[i++]=1,_sprite.vertices[i++]=1,_sprite.vertices[i++]=-1,_sprite.vertices[i++]=1,_sprite.vertices[i++]=0,_sprite.vertices[i++]=1,i=0,_sprite.faces[i++]=0,_sprite.faces[i++]=1,_sprite.faces[i++]=2,_sprite.faces[i++]=0,_sprite.faces[i++]=2,_sprite.faces[i++]=3,_sprite.vertexBuffer=_gl.createBuffer(),_sprite.elementBuffer=_gl.createBuffer(),_gl.bindBuffer(_gl.ARRAY_BUFFER,_sprite.vertexBuffer),_gl.bufferData(_gl.ARRAY_BUFFER,_sprite.vertices,_gl.STATIC_DRAW),_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer),_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,_sprite.faces,_gl.STATIC_DRAW),_sprite.program=createProgram($3Dmol.ShaderLib.sprite,_precision),_sprite.attributes={},_sprite.uniforms={},_sprite.attributes.position=_gl.getAttribLocation(_sprite.program,"position"),_sprite.attributes.uv=_gl.getAttribLocation(_sprite.program,"uv"),_sprite.uniforms.uvOffset=_gl.getUniformLocation(_sprite.program,"uvOffset"),_sprite.uniforms.uvScale=_gl.getUniformLocation(_sprite.program,"uvScale"),_sprite.uniforms.rotation=_gl.getUniformLocation(_sprite.program,"rotation"),_sprite.uniforms.scale=_gl.getUniformLocation(_sprite.program,"scale"),_sprite.uniforms.alignment=_gl.getUniformLocation(_sprite.program,"alignment"),_sprite.uniforms.color=_gl.getUniformLocation(_sprite.program,"color"),_sprite.uniforms.map=_gl.getUniformLocation(_sprite.program,"map"),_sprite.uniforms.opacity=_gl.getUniformLocation(_sprite.program,"opacity"),_sprite.uniforms.useScreenCoordinates=_gl.getUniformLocation(_sprite.program,"useScreenCoordinates"),_sprite.uniforms.screenPosition=_gl.getUniformLocation(_sprite.program,"screenPosition"),_sprite.uniforms.modelViewMatrix=_gl.getUniformLocation(_sprite.program,"modelViewMatrix"),_sprite.uniforms.projectionMatrix=_gl.getUniformLocation(_sprite.program,"projectionMatrix"),_sprite.uniforms.fogType=_gl.getUniformLocation(_sprite.program,"fogType"),_sprite.uniforms.fogDensity=_gl.getUniformLocation(_sprite.program,"fogDensity"),_sprite.uniforms.fogNear=_gl.getUniformLocation(_sprite.program,"fogNear"),_sprite.uniforms.fogFar=_gl.getUniformLocation(_sprite.program,"fogFar"),_sprite.uniforms.fogColor=_gl.getUniformLocation(_sprite.program,"fogColor"),_sprite.uniforms.alphaTest=_gl.getUniformLocation(_sprite.program,"alphaTest")},this.render=function(scene,camera,viewportWidth,viewportHeight){var sprites=scene.__webglSprites,nSprites=sprites.length;if(nSprites){var attributes=_sprite.attributes,uniforms=_sprite.uniforms,halfViewportWidth=.5*viewportWidth,halfViewportHeight=.5*viewportHeight;_gl.useProgram(_sprite.program),_gl.enableVertexAttribArray(attributes.position),_gl.enableVertexAttribArray(attributes.uv),_gl.disable(_gl.CULL_FACE),_gl.enable(_gl.BLEND),_gl.bindBuffer(_gl.ARRAY_BUFFER,_sprite.vertexBuffer),_gl.vertexAttribPointer(attributes.position,2,_gl.FLOAT,!1,16,0),_gl.vertexAttribPointer(attributes.uv,2,_gl.FLOAT,!1,16,8),_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer),_gl.uniformMatrix4fv(uniforms.projectionMatrix,!1,camera.projectionMatrix.elements),_gl.activeTexture(_gl.TEXTURE0),_gl.uniform1i(uniforms.map,0);var oldFogType=0,sceneFogType=0,fog=scene.fog;fog?(_gl.uniform3f(uniforms.fogColor,fog.color.r,fog.color.g,fog.color.b),_gl.uniform1f(uniforms.fogNear,fog.near),_gl.uniform1f(uniforms.fogFar,fog.far),_gl.uniform1i(uniforms.fogType,1),oldFogType=1,sceneFogType=1):(_gl.uniform1i(uniforms.fogType,0),oldFogType=0,sceneFogType=0);var i,sprite,material,size,fogType,scale=[];for(i=0;nSprites>i;i++)sprite=sprites[i],material=sprite.material,sprite.visible&&0!==material.opacity&&(material.useScreenCoordinates?sprite.z=-sprite.position.z:(sprite._modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,sprite.matrixWorld),sprite.z=-sprite._modelViewMatrix.elements[14]));for(sprites.sort(painterSortStable),i=0;nSprites>i;i++)if(sprite=sprites[i],material=sprite.material,sprite.visible&&0!==material.opacity&&material.map&&material.map.image&&material.map.image.width){_gl.uniform1f(uniforms.alphaTest,material.alphaTest);var w=material.map.image.width,h=material.map.image.height;scale[0]=w*_renderer.devicePixelRatio/viewportWidth,scale[1]=h*_renderer.devicePixelRatio/viewportHeight,material.useScreenCoordinates===!0?(_gl.uniform1i(uniforms.useScreenCoordinates,1),_gl.uniform3f(uniforms.screenPosition,(sprite.position.x*_renderer.devicePixelRatio-halfViewportWidth)/halfViewportWidth,(halfViewportHeight-sprite.position.y*_renderer.devicePixelRatio)/halfViewportHeight,Math.max(0,Math.min(1,sprite.position.z)))):(_gl.uniform1i(uniforms.useScreenCoordinates,0),_gl.uniformMatrix4fv(uniforms.modelViewMatrix,!1,sprite._modelViewMatrix.elements)),fogType=scene.fog&&material.fog?sceneFogType:0,oldFogType!==fogType&&(_gl.uniform1i(uniforms.fogType,fogType),oldFogType=fogType),size=1/(material.scaleByViewport?viewportHeight:1),scale[0]*=size*sprite.scale.x,scale[1]*=size*sprite.scale.y,_gl.uniform2f(uniforms.uvScale,material.uvScale.x,material.uvScale.y),_gl.uniform2f(uniforms.uvOffset,material.uvOffset.x,material.uvOffset.y),_gl.uniform2f(uniforms.alignment,material.alignment.x,material.alignment.y),_gl.uniform1f(uniforms.opacity,material.opacity),_gl.uniform3f(uniforms.color,material.color.r,material.color.g,material.color.b),_gl.uniform1f(uniforms.rotation,sprite.rotation),_gl.uniform2fv(uniforms.scale,scale),_renderer.setDepthTest(material.depthTest),_renderer.setDepthWrite(material.depthWrite),_renderer.setTexture(material.map,0),_gl.drawElements(_gl.TRIANGLES,6,_gl.UNSIGNED_SHORT,0)}_gl.enable(_gl.CULL_FACE)}}},$3Dmol.Light=function(hex,intensity){$3Dmol.Object3D.call(this),this.color=new $3Dmol.Color(hex),this.position=new $3Dmol.Vector3(0,1,0),this.target=new $3Dmol.Object3D,this.intensity=void 0!==intensity?intensity:1,this.castShadow=!1,this.onlyShadow=!1},$3Dmol.Light.prototype=Object.create($3Dmol.Object3D.prototype),$3Dmol.Material=function(){$3Dmol.EventDispatcher.call(this),this.id=$3Dmol.MaterialIdCount++,this.name="",this.side=$3Dmol.FrontSide,this.opacity=1,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.stencilTest=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.visible=!0,this.needsUpdate=!0},$3Dmol.Material.prototype.setValues=function(values){if(void 0!==values)for(var key in values){var newValue=values[key];if(void 0!==newValue){if(key in this){var currentValue=this[key];currentValue instanceof $3Dmol.Color&&newValue instanceof $3Dmol.Color?currentValue.copy(newValue):currentValue instanceof $3Dmol.Color?currentValue.set(newValue):currentValue instanceof $3Dmol.Vector3&&newValue instanceof $3Dmol.Vector3?currentValue.copy(newValue):this[key]=newValue}}else console.warn("$3Dmol.Material: '"+key+"' parameter is undefined.")}},$3Dmol.Material.prototype.clone=function(material){return void 0===material&&(material=new $3Dmol.Material),material.name=this.name,material.side=this.side,material.opacity=this.opacity,material.transparent=this.transparent,material.depthTest=this.depthTest,material.depthWrite=this.depthWrite,material.stencilTest=this.stencilTest,material.polygonOffset=this.polygonOffset,material.polygonOffsetFactor=this.polygonOffsetFactor,material.polygonOffsetUnits=this.polygonOffsetUnits,material.alphaTest=this.alphaTest,material.overdraw=this.overdraw,material.visible=this.visible,material},$3Dmol.Material.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},$3Dmol.MaterialIdCount=0,$3Dmol.LineBasicMaterial=function(parameters){$3Dmol.Material.call(this),this.color=new $3Dmol.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.shaderID="basic",this.setValues(parameters)},$3Dmol.LineBasicMaterial.prototype=Object.create($3Dmol.Material.prototype),$3Dmol.LineBasicMaterial.prototype.clone=function(){var material=new $3Dmol.LineBasicMaterial;return $3Dmol.Material.prototype.clone.call(this,material),material.color.copy(this.color),material},$3Dmol.MeshLambertMaterial=function(parameters){$3Dmol.Material.call(this),this.color=new $3Dmol.Color(16777215),this.ambient=new $3Dmol.Color(1048575),this.emissive=new $3Dmol.Color(0),this.wrapAround=!1,this.wrapRGB=new $3Dmol.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=$3Dmol.SmoothShading,this.shaderID="lambert",this.vertexColors=$3Dmol.NoColors,this.skinning=!1,this.setValues(parameters)},$3Dmol.MeshLambertMaterial.prototype=Object.create($3Dmol.Material.prototype),$3Dmol.MeshLambertMaterial.prototype.clone=function(material){return"undefined"==typeof material&&(material=new $3Dmol.MeshLambertMaterial),$3Dmol.Material.prototype.clone.call(this,material),material.color.copy(this.color),material.ambient.copy(this.ambient),material.emissive.copy(this.emissive),material.wrapAround=this.wrapAround,material.wrapRGB.copy(this.wrapRGB),material.map=this.map,material.lightMap=this.lightMap,material.specularMap=this.specularMap,material.envMap=this.envMap,material.combine=this.combine,material.reflectivity=this.reflectivity,material.refractionRatio=this.refractionRatio,material.fog=this.fog,material.shading=this.shading,material.shaderID=this.shaderID,material.vertexColors=this.vertexColors,material.skinning=this.skinning,material.morphTargets=this.morphTargets,material.morphNormals=this.morphNormals,material},$3Dmol.MeshDoubleLambertMaterial=function(parameters){$3Dmol.MeshLambertMaterial.call(this,parameters),this.shaderID="lambertdouble",this.side=$3Dmol.DoubleSide},$3Dmol.MeshDoubleLambertMaterial.prototype=Object.create($3Dmol.MeshLambertMaterial.prototype),$3Dmol.MeshDoubleLambertMaterial.prototype.clone=function(){var material=new $3Dmol.MeshDoubleLambertMaterial;return $3Dmol.MeshLambertMaterial.prototype.clone.call(this,material),material},$3Dmol.MeshOutlineMaterial=function(parameters){$3Dmol.Material.call(this),parameters=parameters||{},this.fog=!0,this.shaderID="outline",this.wireframe=!1,this.outlineColor=parameters.color||new $3Dmol.Color(0,0,0),this.outlineWidth=parameters.width||.1,this.outlinePushback=parameters.pushback||1},$3Dmol.MeshOutlineMaterial.prototype=Object.create($3Dmol.Material.prototype),$3Dmol.MeshOutlineMaterial.prototype.clone=function(material){return"undefined"==typeof material&&(material=new $3Dmol.MeshOutlineMaterial),$3Dmol.Material.prototype.clone.call(this,material),material.fog=this.fog,material.shaderID=this.shaderID,material.wireframe=this.wireframe,material},$3Dmol.ImposterMaterial=function(parameters){$3Dmol.Material.call(this),this.color=new $3Dmol.Color(16777215),this.ambient=new $3Dmol.Color(1048575),this.emissive=new $3Dmol.Color(0),this.imposter=!0,this.wrapAround=!1,this.wrapRGB=new $3Dmol.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=$3Dmol.SmoothShading,this.shaderID="sphereimposter",this.vertexColors=$3Dmol.NoColors,this.skinning=!1,this.setValues(parameters)},$3Dmol.ImposterMaterial.prototype=Object.create($3Dmol.Material.prototype),$3Dmol.ImposterMaterial.prototype.clone=function(){var material=new $3Dmol.ImposterMaterial;return $3Dmol.Material.prototype.clone.call(this,material),material.color.copy(this.color),material.ambient.copy(this.ambient),material.emissive.copy(this.emissive),material.wrapAround=this.wrapAround,material.wrapRGB.copy(this.wrapRGB),material.map=this.map,material.lightMap=this.lightMap,material.specularMap=this.specularMap,material.envMap=this.envMap,material.combine=this.combine,material.reflectivity=this.reflectivity,material.refractionRatio=this.refractionRatio,material.fog=this.fog,material.shading=this.shading,material.shaderID=this.shaderID,material.vertexColors=this.vertexColors,material.skinning=this.skinning,material.morphTargets=this.morphTargets,material.morphNormals=this.morphNormals,material},$3Dmol.SpriteMaterial=function(parameters){$3Dmol.Material.call(this),this.color=new $3Dmol.Color(16777215),this.map=new $3Dmol.Texture,this.useScreenCoordinates=!0,this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.scaleByViewPort=!this.sizeAttenuation,this.alignment=$3Dmol.SpriteAlignment.center.clone(),this.fog=!1,this.uvOffset=new $3Dmol.Vector2(0,0),this.uvScale=new $3Dmol.Vector2(1,1),this.setValues(parameters),parameters=parameters||{},void 0===parameters.depthTest&&(this.depthTest=!this.useScreenCoordinates),void 0===parameters.sizeAttenuation&&(this.sizeAttenuation=!this.useScreenCoordinates),void 0===parameters.scaleByViewPort&&(this.scaleByViewPort=!this.sizeAttenuation)},$3Dmol.SpriteMaterial.prototype=Object.create($3Dmol.Material.prototype),$3Dmol.SpriteMaterial.prototype.clone=function(){var material=new $3Dmol.SpriteMaterial;return $3Dmol.Material.prototype.clone.call(this,material),material.color.copy(this.color),material.map=this.map,material.useScreenCoordinates=useScreenCoordinates,material.sizeAttenuation=this.sizeAttenuation,material.scaleByViewport=this.scaleByViewPort,material.alignment.copy(this.alignment),material.uvOffset.copy(this.uvOffset),material},$3Dmol.SpriteAlignment={},$3Dmol.SpriteAlignment.topLeft=new $3Dmol.Vector2(1,-1),$3Dmol.SpriteAlignment.topCenter=new $3Dmol.Vector2(0,-1),$3Dmol.SpriteAlignment.topRight=new $3Dmol.Vector2(-1,-1),$3Dmol.SpriteAlignment.centerLeft=new $3Dmol.Vector2(1,0),$3Dmol.SpriteAlignment.center=new $3Dmol.Vector2(0,0),$3Dmol.SpriteAlignment.centerRight=new $3Dmol.Vector2(-1,0),$3Dmol.SpriteAlignment.bottomLeft=new $3Dmol.Vector2(1,1),$3Dmol.SpriteAlignment.bottomCenter=new $3Dmol.Vector2(0,1),$3Dmol.SpriteAlignment.bottomRight=new $3Dmol.Vector2(-1,1),$3Dmol.Texture=function(image){$3Dmol.EventDispatcher.call(this),this.id=$3Dmol.TextureIdCount++,this.name="",this.image=image,this.mipmaps=[],this.mapping=new $3Dmol.UVMapping,this.wrapS=$3Dmol.ClampToEdgeWrapping,this.wrapT=$3Dmol.ClampToEdgeWrapping,this.magFilter=$3Dmol.LinearFilter,this.minFilter=$3Dmol.LinearMipMapLinearFilter,this.anisotropy=1,this.format=$3Dmol.RGBAFormat,this.type=$3Dmol.UnsignedByteType,this.offset=new $3Dmol.Vector2(0,0),this.repeat=new $3Dmol.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},$3Dmol.Texture.prototype={constructor:$3Dmol.Texture,clone:function(texture){return void 0===texture&&(texture=new $3Dmol.Texture),texture.image=this.image,texture.mipmaps=this.mipmaps.slice(0),texture.mapping=this.mapping,texture.wrapS=this.wrapS,texture.wrapT=this.wrapT,texture.magFilter=this.magFilter,texture.minFilter=this.minFilter,texture.anisotropy=this.anisotropy,texture.format=this.format,texture.type=this.type,texture.offset.copy(this.offset),texture.repeat.copy(this.repeat),texture.generateMipmaps=this.generateMipmaps,texture.premultiplyAlpha=this.premultiplyAlpha,texture.flipY=this.flipY,texture.unpackAlignment=this.unpackAlignment,texture},dispose:function(){this.dispatchEvent({type:"dispose"})}},$3Dmol.TextureIdCount=0,$3Dmol.FrontSide=0,$3Dmol.BackSide=1,$3Dmol.DoubleSide=2,$3Dmol.NoShading=0,$3Dmol.FlatShading=1,$3Dmol.SmoothShading=2,$3Dmol.NoColors=0,$3Dmol.FaceColors=1,$3Dmol.VertexColors=2,$3Dmol.MultiplyOperation=0,$3Dmol.MixOperation=1,$3Dmol.AddOperation=2,$3Dmol.UVMapping=function(){},$3Dmol.ClampToEdgeWrapping=1001,$3Dmol.LinearFilter=1006,$3Dmol.LinearMipMapLinearFilter=1008,$3Dmol.UnsignedByteType=1009,$3Dmol.RGBAFormat=1021,$3Dmol.Line=function(geometry,material,type){$3Dmol.Object3D.call(this),this.geometry=geometry,this.material=void 0!==material?material:new $3Dmol.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==type?type:$3Dmol.LineStrip},$3Dmol.LineStrip=0,$3Dmol.LinePieces=1,$3Dmol.Line.prototype=Object.create($3Dmol.Object3D.prototype),$3Dmol.Line.prototype.clone=function(object){return void 0===object&&(object=new $3Dmol.Line(this.geometry,this.material,this.type)),$3Dmol.Object3D.prototype.clone.call(this,object),object},$3Dmol.Mesh=function(geometry,material){$3Dmol.Object3D.call(this),this.geometry=geometry,this.material=void 0!==material?material:new $3Dmol.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0})},$3Dmol.Mesh.prototype=Object.create($3Dmol.Object3D.prototype),$3Dmol.Mesh.prototype.clone=function(object){return void 0===object&&(object=new $3Dmol.Mesh(this.geometry,this.material)),$3Dmol.Object3D.prototype.clone.call(this,object),object},$3Dmol.Sprite=function(material){$3Dmol.Object3D.call(this),this.material=void 0!==material?material:new $3Dmol.SpriteMaterial,this.rotation3d=this.rotation,this.rotation=0},$3Dmol.Sprite.prototype=Object.create($3Dmol.Object3D.prototype),$3Dmol.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(1!==this.scale.x||1!==this.scale.y)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},$3Dmol.Sprite.prototype.clone=function(object){return void 0===object&&(object=new $3Dmol.Sprite(this.material)),$3Dmol.Object3D.prototype.clone.call(this,object),object},$3Dmol.Renderer=function(parameters){function enableAttribute(attribute){_enabledAttributes[attribute]||(_gl.enableVertexAttribArray(attribute),_enabledAttributes[attribute]=!0)}function disableAttributes(){for(var attribute in _enabledAttributes)_enabledAttributes[attribute]&&(_gl.disableVertexAttribArray(attribute),_enabledAttributes[attribute]=!1)}function setPolygonOffset(polygonOffset,factor,units){_oldPolygonOffset!==polygonOffset&&(polygonOffset?_gl.enable(_gl.POLYGON_OFFSET_FILL):_gl.disable(_gl.POLYGON_OFFSET_FILL))}function setLineWidth(width){width!==_oldLineWidth&&(_gl.lineWidth(width),_oldLineWidth=width)}function getShader(type,str){var shader;return"fragment"===type?shader=_gl.createShader(_gl.FRAGMENT_SHADER):"vertex"===type&&(shader=_gl.createShader(_gl.VERTEX_SHADER)),_gl.shaderSource(shader,str),_gl.compileShader(shader),_gl.getShaderParameter(shader,_gl.COMPILE_STATUS)?shader:(console.error(_gl.getShaderInfoLog(shader)),console.error("could not initialize shader"),null)}function buildProgram(fragmentShader,vertexShader,uniforms,parameters){var p,pl,program,code,chunks=[];chunks.push(fragmentShader),chunks.push(vertexShader);for(p in parameters)chunks.push(p),chunks.push(parameters[p]);for(code=chunks.join(),p=0,pl=_programs.length;pl>p;p++){var programInfo=_programs[p];if(programInfo.code===code)return programInfo.usedTimes++,programInfo.program}program=_gl.createProgram();var precision=_precision,prefix="precision "+precision+" float;",prefix_vertex=[prefix].join("\n"),prefix_fragment=[parameters.fragdepth?"#extension GL_EXT_frag_depth: enable":"",parameters.wireframe?"#define WIREFRAME 1":"",prefix].join("\n"),glFragmentShader=getShader("fragment",prefix_fragment+fragmentShader),glVertexShader=getShader("vertex",prefix_vertex+vertexShader);_gl.attachShader(program,glVertexShader),_gl.attachShader(program,glFragmentShader),_gl.linkProgram(program),_gl.getProgramParameter(program,_gl.LINK_STATUS)||console.error("Could not initialize shader"),program.uniforms={},program.attributes={};var identifiers,u,i;identifiers=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition"];for(u in uniforms)identifiers.push(u);for(i=0;i<identifiers.length;i++){var uniformVar=identifiers[i];program.uniforms[uniformVar]=_gl.getUniformLocation(program,uniformVar)}for(identifiers=["position","normal","color","lineDistance"],i=0;i<identifiers.length;i++){var attributeVar=identifiers[i];program.attributes[attributeVar]=_gl.getAttribLocation(program,attributeVar)}return program.id=_programs_counter++,_programs.push({program:program,code:code,usedTimes:1}),_this.info.memory.programs=_programs.length,program}function setProgram(camera,lights,fog,material,object){material.needsUpdate&&(material.program&&deallocateMaterial(material),_this.initMaterial(material,lights,fog,object),material.needsUpdate=!1);var refreshMaterial=!1,program=material.program,p_uniforms=program.uniforms,m_uniforms=material.uniforms;return program!=_currentProgram&&(_gl.useProgram(program),_currentProgram=program,refreshMaterial=!0),material.id!=_currentMaterialId&&(_currentMaterialId=material.id,refreshMaterial=!0),camera!=_currentCamera&&(_currentCamera=camera,refreshMaterial=!0),_gl.uniformMatrix4fv(p_uniforms.projectionMatrix,!1,camera.projectionMatrix.elements),_gl.uniformMatrix4fv(p_uniforms.modelViewMatrix,!1,object._modelViewMatrix.elements),_gl.uniformMatrix3fv(p_uniforms.normalMatrix,!1,object._normalMatrix.elements),refreshMaterial&&(m_uniforms.fogColor.value=fog.color,m_uniforms.fogNear.value=fog.near,m_uniforms.fogFar.value=fog.far,0===material.shaderID.lastIndexOf("lambert",0)?(_gl.uniformMatrix4fv(p_uniforms.viewMatrix,!1,camera.matrixWorldInverse.elements),_lightsNeedUpdate&&(setupLights(program,lights),_lightsNeedUpdate=!1),m_uniforms.ambientLightColor.value=_lights.ambient,m_uniforms.directionalLightColor.value=_lights.directional.colors,m_uniforms.directionalLightDirection.value=_lights.directional.positions,m_uniforms.ambient.value=material.ambient,m_uniforms.emissive.value=material.emissive):"outline"===material.shaderID?(m_uniforms.outlineColor.value=material.outlineColor,m_uniforms.outlineWidth.value=material.outlineWidth,m_uniforms.outlinePushback.value=material.outlinePushback):"sphereimposter"===material.shaderID&&(_gl.uniformMatrix4fv(p_uniforms.viewMatrix,!1,camera.matrixWorldInverse.elements),_gl.uniformMatrix3fv(p_uniforms.normalMatrix,!1,object._normalMatrix.elements)),m_uniforms.opacity.value=material.opacity,m_uniforms.diffuse.value=material.color,loadMaterialUniforms(p_uniforms,m_uniforms)),program}function loadMaterialUniforms(p_uniforms,m_uniforms){var uniformVar,type,uniformVal,uniformLoc;for(uniformVar in m_uniforms)p_uniforms[uniformVar]&&(type=m_uniforms[uniformVar].type,uniformVal=m_uniforms[uniformVar].value,uniformLoc=p_uniforms[uniformVar],"f"===type?_gl.uniform1f(uniformLoc,uniformVal):"fv"===type?_gl.uniform3fv(uniformLoc,uniformVal):"c"===type&&_gl.uniform3f(uniformLoc,uniformVal.r,uniformVal.g,uniformVal.b));
}function renderObjects(renderList,reverse,materialType,camera,lights,fog,useBlending,overrideMaterial){var webglObject,object,buffer,material,start,end,delta;reverse?(start=renderList.length-1,end=-1,delta=-1):(start=0,end=renderList.length,delta=1);for(var i=start;i!==end;i+=delta)if(webglObject=renderList[i],webglObject.render){if(object=webglObject.object,buffer=webglObject.buffer,material=webglObject[materialType],!material)continue;useBlending&&_this.setBlending(!0),_this.setDepthTest(material.depthTest),_this.setDepthWrite(material.depthWrite),setPolygonOffset(material.polygonOffset,material.polygonOffsetFactor,material.polygonOffsetUnits);var reflected=object._modelViewMatrix.isReflected();_this.setMaterialFaces(material,reflected),_this.renderBuffer(camera,lights,fog,material,buffer,object),_outlineMaterial&&!material.wireframe&&"basic"!==material.shaderID&&0!==material.opacity&&_this.renderBuffer(camera,lights,fog,_outlineMaterial,buffer,object)}}function renderPlugins(plugins,scene,camera){if(_currentGeometryGroupHash=-1,_currentProgram=null,_currentCamera=null,_oldBlending=-1,_oldDepthWrite=-1,_oldDepthTest=-1,_oldDoubleSided=-1,_currentMaterialId=-1,_oldFlipSided=-1,plugins.length)for(var i=0,il=plugins.length;il>i;i++)_lightsNeedUpdate=!0,plugins[i].render(scene,camera,_currentWidth,_currentHeight),_currentGeometryGroupHash=-1,_currentProgram=null,_currentCamera=null,_oldBlending=-1,_oldDepthWrite=-1,_oldDepthTest=-1,_oldDoubleSided=-1,_currentMaterialId=-1,_oldFlipSided=-1}function addObject(object,scene){var g,gl,geometry,material,geometryGroup;if(!object.__webglInit&&(object.__webglInit=!0,object._modelViewMatrix=new $3Dmol.Matrix4,object._normalMatrix=new $3Dmol.Matrix3,void 0!==object.geometry&&void 0===object.geometry.__webglInit&&(object.geometry.__webglInit=!0,object.geometry.addEventListener("dispose",onGeometryDispose)),object instanceof $3Dmol.Mesh||object instanceof $3Dmol.Line))for(geometry=object.geometry,material=object.material,g=0,gl=geometry.geometryGroups.length;gl>g;g++)geometryGroup=geometry.geometryGroups[g],geometryGroup.id=_geometryGroupCounter++,geometryGroup.__webglVertexBuffer||(object instanceof $3Dmol.Mesh?(createMeshBuffers(geometryGroup),geometry.elementsNeedUpdate=!0,geometry.normalsNeedUpdate=!0):object instanceof $3Dmol.Line&&createLineBuffers(geometryGroup),geometry.verticesNeedUpdate=!0,geometry.colorsNeedUpdate=!0);if(!object.__webglActive){if(object instanceof $3Dmol.Mesh||object instanceof $3Dmol.Line)for(geometry=object.geometry,g=0,gl=geometry.geometryGroups.length;gl>g;g++)geometryGroup=geometry.geometryGroups[g],addBuffer(scene.__webglObjects,geometryGroup,object);else object instanceof $3Dmol.Sprite&&scene.__webglSprites.push(object);object.__webglActive=!0}}function updateObject(object){var geometryGroup,geometry=object.geometry;object.material;if(object instanceof $3Dmol.Mesh||object instanceof $3Dmol.Line){for(var g=0,gl=geometry.geometryGroups.length;gl>g;g++)geometryGroup=geometry.geometryGroups[g],(geometry.verticesNeedUpdate||geometry.elementsNeedUpdate||geometry.colorsNeedUpdate||geometry.normalsNeedUpdate)&&setBuffers(geometryGroup,_gl.STATIC_DRAW);geometry.verticesNeedUpdate=!1,geometry.elementsNeedUpdate=!1,geometry.normalsNeedUpdate=!1,geometry.colorsNeedUpdate=!1,geometry.buffersNeedUpdate=!1}}function removeObject(object,scene){object instanceof $3Dmol.Mesh||object instanceof $3Dmol.Line?removeInstances(scene.__webglObjects,object):object instanceof $3Dmol.Sprite&&removeInstancesDirect(scene.__webglSprites,object),object.__webglActive=!1}function removeInstances(objList,object){for(var o=objList.length-1;o>=0;--o)objList[o].object===object&&objList.splice(o,1)}function removeInstancesDirect(objList,object){for(var o=objList.length-1;o>=0;--o)objList[o]===object&&objList.splice(o,1)}function unrollBufferMaterial(globject){var object=globject.object,material=object.material;if(material.transparent){if(globject.opaque=null,globject.transparent=material,!material.wireframe){var blankMaterial=material.clone();blankMaterial.opacity=0,globject.blank=blankMaterial}}else globject.opaque=material,globject.transparent=null}function setBuffers(geometryGroup,hint,line){var vertexArray=geometryGroup.vertexArray,colorArray=geometryGroup.colorArray;if(_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglVertexBuffer),_gl.bufferData(_gl.ARRAY_BUFFER,vertexArray,hint),_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglColorBuffer),_gl.bufferData(_gl.ARRAY_BUFFER,colorArray,hint),void 0!==geometryGroup.normalArray&&void 0!==geometryGroup.__webglNormalBuffer){var normalArray=geometryGroup.normalArray;_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglNormalBuffer),_gl.bufferData(_gl.ARRAY_BUFFER,normalArray,hint)}if(void 0!==geometryGroup.faceArray&&void 0!==geometryGroup.__webglFaceBuffer){var faceArray=geometryGroup.faceArray;_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglFaceBuffer),_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,faceArray,hint)}if(void 0!==geometryGroup.lineArray&&void 0!==geometryGroup.__webglLineBuffer){var lineArray=geometryGroup.lineArray;_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglLineBuffer),_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,lineArray,hint)}}function createMeshBuffers(geometryGroup){geometryGroup.__webglVertexBuffer=_gl.createBuffer(),geometryGroup.__webglNormalBuffer=_gl.createBuffer(),geometryGroup.__webglColorBuffer=_gl.createBuffer(),geometryGroup.__webglFaceBuffer=_gl.createBuffer(),geometryGroup.__webglLineBuffer=_gl.createBuffer(),_this.info.memory.geometries++}function createLineBuffers(geometry){geometry.__webglVertexBuffer=_gl.createBuffer(),geometry.__webglColorBuffer=_gl.createBuffer(),_this.info.memory.geometries++}function addBuffer(objlist,buffer,object){objlist.push({buffer:buffer,object:object,opaque:null,transparent:null})}function setupMatrices(object,camera){object._modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,object.matrixWorld),object._normalMatrix.getInverse(object._modelViewMatrix),object._normalMatrix.transpose()}function isPowerOfTwo(value){return 0===(value&value-1)}function filterFallback(f){return _gl.LINEAR}function setTextureParameters(textureType,texture,isImagePowerOfTwo){isImagePowerOfTwo?(_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,paramToGL(texture.wrapS)),_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,paramToGL(texture.wrapT)),_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,paramToGL(texture.magFilter)),_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,paramToGL(texture.minFilter))):(_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,_gl.CLAMP_TO_EDGE),_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,_gl.CLAMP_TO_EDGE),_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,filterFallback(texture.magFilter)),_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,filterFallback(texture.minFilter)))}function paramToGL(p){return p===$3Dmol.UnsignedByteType?_gl.UNSIGNED_BYTE:p===$3Dmol.RGBAFormat?_gl.RGBA:0}function setupLights(program,lights){var l,ll,light,color,intensity,distance,r=0,g=0,b=0,zlights=_lights,dirColors=zlights.directional.colors,dirPositions=zlights.directional.positions,dirCount=0,dirLength=0,dirOffset=0;for(l=0,ll=lights.length;ll>l;l++)if(light=lights[l],color=light.color,intensity=light.intensity,distance=light.distance,light instanceof $3Dmol.Light){if(dirCount++,_direction.getPositionFromMatrix(light.matrixWorld),_vector3.getPositionFromMatrix(light.target.matrixWorld),_direction.sub(_vector3),_direction.normalize(),0===_direction.x&&0===_direction.y&&0===_direction.z)continue;dirPositions[dirOffset]=_direction.x,dirPositions[dirOffset+1]=_direction.y,dirPositions[dirOffset+2]=_direction.z,dirColors[dirOffset]=color.r*intensity,dirColors[dirOffset+1]=color.g*intensity,dirColors[dirOffset+2]=color.b*intensity,dirOffset+=3,dirLength++}zlights.ambient[0]=r,zlights.ambient[1]=g,zlights.ambient[2]=b,zlights.directional.length=dirLength}function initGL(){try{if(!(_gl=_canvas.getContext("experimental-webgl",{alpha:_alpha,premultipliedAlpha:_premultipliedAlpha,antialias:_antialias,stencil:_stencil,preserveDrawingBuffer:_preserveDrawingBuffer}))&&!(_gl=_canvas.getContext("webgl",{alpha:_alpha,premultipliedAlpha:_premultipliedAlpha,antialias:_antialias,stencil:_stencil,preserveDrawingBuffer:_preserveDrawingBuffer})))throw"Error creating WebGL context."}catch(error){console.error(error)}_ext=_gl.getExtension("EXT_frag_depth")}function setDefaultGLState(){_gl.clearColor(0,0,0,1),_gl.clearDepth(1),_gl.clearStencil(0),_gl.enable(_gl.DEPTH_TEST),_gl.depthFunc(_gl.LEQUAL),_gl.frontFace(_gl.CCW),_gl.cullFace(_gl.BACK),_gl.enable(_gl.CULL_FACE),_gl.enable(_gl.BLEND),_gl.blendEquation(_gl.FUNC_ADD),_gl.blendFunc(_gl.SRC_ALPHA,_gl.ONE_MINUS_SRC_ALPHA),_gl.clearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha);_gl.getExtension("EXT_frag_depth")}parameters=parameters||{};var _canvas=void 0!==parameters.canvas?parameters.canvas:document.createElement("canvas"),_precision=void 0!==parameters.precision?parameters.precision:"highp",_alpha=void 0!==parameters.alpha?parameters.alpha:!0,_premultipliedAlpha=void 0!==parameters.premultipliedAlpha?parameters.premultipliedAlpha:!0,_antialias=void 0!==parameters.antialias?parameters.antialias:!1,_stencil=void 0!==parameters.stencil?parameters.stencil:!0,_preserveDrawingBuffer=void 0!==parameters.preserveDrawingBuffer?parameters.preserveDrawingBuffer:!1,_clearColor=void 0!==parameters.clearColor?new $3Dmol.Color(parameters.clearColor):new $3Dmol.Color(0),_clearAlpha=void 0!==parameters.clearAlpha?parameters.clearAlpha:0,_outlineMaterial=void 0!==parameters.outline?new $3Dmol.MeshOutlineMaterial(parameters.outline):null;this.domElement=_canvas,this.context=null,this.devicePixelRatio=void 0!==parameters.devicePixelRatio?parameters.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var _gl,_ext,_this=this,_programs=[],_programs_counter=0,_currentProgram=null,_currentMaterialId=-1,_currentGeometryGroupHash=null,_currentCamera=null,_geometryGroupCounter=0,_oldDoubleSided=-1,_oldFlipSided=-1,_oldBlending=-1,_oldDepthTest=-1,_oldDepthWrite=-1,_oldPolygonOffset=null,_oldLineWidth=null,_viewportX=0,_viewportY=0,_viewportWidth=0,_viewportHeight=0,_currentWidth=0,_currentHeight=0,_enabledAttributes={},_projScreenMatrix=new $3Dmol.Matrix4,_vector3=new $3Dmol.Vector3,_direction=new $3Dmol.Vector3,_lightsNeedUpdate=!0,_lights={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};initGL(),setDefaultGLState(),this.context=_gl,this.getContext=function(){return _gl},this.getPrecision=function(){return _precision},this.setClearColorHex=function(hex,alpha){_clearColor.setHex(hex),_clearAlpha=alpha,_gl.clearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha)},this.enableOutline=function(parameters){_outlineMaterial=new $3Dmol.MeshOutlineMaterial(parameters)},this.disableOutline=function(){_outlineMaterial=null},this.setSize=function(width,height){_canvas.width=width*this.devicePixelRatio,_canvas.height=height*this.devicePixelRatio,_canvas.style.width=width+"px",_canvas.style.height=height+"px",this.setViewport(0,0,_canvas.width,_canvas.height)},this.setViewport=function(x,y,width,height){_viewportX=void 0!==x?x:0,_viewportY=void 0!==y?y:0,_viewportWidth=void 0!==width?width:_canvas.width,_viewportHeight=void 0!==height?height:_canvas.height,_gl.viewport(_viewportX,_viewportY,_viewportWidth,_viewportHeight)},this.clear=function(color,depth,stencil){var bits=0;(void 0===color||color)&&(bits|=_gl.COLOR_BUFFER_BIT),(void 0===depth||depth)&&(bits|=_gl.DEPTH_BUFFER_BIT),(void 0===stencil||stencil)&&(bits|=_gl.STENCIL_BUFFER_BIT),_gl.clear(bits)},this.clearTarget=function(color,depth,stencil){this.clear(color,depth,stencil)},this.setMaterialFaces=function(material,reflected){var doubleSided=material.side===$3Dmol.DoubleSide,flipSided=material.side===$3Dmol.BackSide;flipSided=reflected?!flipSided:flipSided,_oldDoubleSided!==doubleSided&&(doubleSided?_gl.disable(_gl.CULL_FACE):_gl.enable(_gl.CULL_FACE),_oldDoubleSided=doubleSided),_oldFlipSided!==flipSided&&(flipSided?_gl.frontFace(_gl.CW):_gl.frontFace(_gl.CCW),_oldFlipSided=flipSided)},this.setDepthTest=function(depthTest){_oldDepthTest!==depthTest&&(depthTest?_gl.enable(_gl.DEPTH_TEST):_gl.disable(_gl.DEPTH_TEST),_oldDepthTest=depthTest)},this.setDepthWrite=function(depthWrite){_oldDepthWrite!==depthWrite&&(_gl.depthMask(depthWrite),_oldDepthWrite=depthWrite)},this.setBlending=function(blending){blending?(_gl.enable(_gl.BLEND),_gl.blendEquationSeparate(_gl.FUNC_ADD,_gl.FUNC_ADD),_gl.blendFuncSeparate(_gl.SRC_ALPHA,_gl.ONE_MINUS_SRC_ALPHA,_gl.ONE,_gl.ONE_MINUS_SRC_ALPHA)):_gl.disable(_gl.BLEND),_oldBlending=blending},this.addPostPlugin=function(plugin){plugin.init(this),this.renderPluginsPost.push(plugin)};var onGeometryDispose=function(event){var geometry=event.target;geometry.removeEventListener("dispose",onGeometryDispose),deallocateGeometry(geometry),_this.info.memory.geometries--},onTextureDispose=function(event){var texture=event.target;texture.removeEventListener("dispose",onTextureDispose),deallocateTexture(texture),_this.info.memory.textures--},onMaterialDispose=function(event){var material=event.target;material.removeEventListener("dispose",onMaterialDispose),deallocateMaterial(material)},deallocateGeometry=function(geometry){if(geometry.__webglInit=void 0,void 0!==geometry.__webglVertexBuffer&&_gl.deleteBuffer(geometry.__webglVertexBuffer),void 0!==geometry.__webglColorBuffer&&_gl.deleteBuffer(geometry.__webglColorBuffer),void 0!==geometry.geometryGroups)for(var g=0,gl=geometry.groups;gl>g;g++){var geometryGroup=geometry.geometryGroups[g];void 0!==geometryGroup.__webglVertexBuffer&&_gl.deleteBuffer(geometryGroup.__webglVertexBuffer),void 0!==geometryGroup.__webglColorBuffer&&_gl.deleteBuffer(geometryGroup.__webglColorBuffer),void 0!==geometryGroup.__webglNormalBuffer&&_gl.deleteBuffer(geometryGroup.__webglNormalBuffer),void 0!==geometryGroup.__webglFaceBuffer&&_gl.deleteBuffer(geometryGroup.__webglFaceBuffer),void 0!==geometryGroup.__webglLineBuffer&&_gl.deleteBuffer(geometryGroup.__webglLineBuffer)}},deallocateMaterial=function(material){var program=material.program;if(void 0!==program){material.program=void 0;var i,il,programInfo,deleteProgram=!1;for(i=0,il=_programs.length;il>i;i++)if(programInfo=_programs[i],programInfo.program===program){programInfo.usedTimes--,0===programInfo.usedTimes&&(deleteProgram=!0);break}if(deleteProgram===!0){var newPrograms=[];for(i=0,il=_programs.length;il>i;i++)programInfo=_programs[i],programInfo.program!==program&&newPrograms.push(programInfo);_programs=newPrograms,_gl.deleteProgram(program),_this.info.memory.programs--}}},deallocateTexture=function(texture){if(texture.image&&texture.image.__webglTextureCube)_gl.deleteTexture(texture.image.__webglTextureCube);else{if(!texture.__webglInit)return;texture.__webglInit=!1,_gl.deleteTexture(texture.__webglTexture)}};this.initMaterial=function(material,lights,fog,object){material.addEventListener("dispose",onMaterialDispose);var parameters,shaderID;if(shaderID=material.shaderID){var shader=$3Dmol.ShaderLib[shaderID];material.vertexShader=shader.vertexShader,material.fragmentShader=shader.fragmentShader,material.uniforms=$3Dmol.ShaderUtils.clone(shader.uniforms)}parameters={wireframe:material.wireframe,fragdepth:material.imposter},material.program=buildProgram(material.fragmentShader,material.vertexShader,material.uniforms,parameters)},this.renderBuffer=function(camera,lights,fog,material,geometryGroup,object){if(material.visible){var program,attributes;program=setProgram(camera,lights,fog,material,object),attributes=program.attributes;var updateBuffers=!1,wireframeBit=material.wireframe?1:0,geometryGroupHash=16777215*geometryGroup.id+2*program.id+wireframeBit;geometryGroupHash!==_currentGeometryGroupHash&&(_currentGeometryGroupHash=geometryGroupHash,updateBuffers=!0),updateBuffers&&(disableAttributes(),attributes.position>=0&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglVertexBuffer),enableAttribute(attributes.position),_gl.vertexAttribPointer(attributes.position,3,_gl.FLOAT,!1,0,0)),attributes.color>=0&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglColorBuffer),enableAttribute(attributes.color),_gl.vertexAttribPointer(attributes.color,3,_gl.FLOAT,!1,0,0)),attributes.normal>=0&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglNormalBuffer),enableAttribute(attributes.normal),_gl.vertexAttribPointer(attributes.normal,3,_gl.FLOAT,!1,0,0)));var faceCount,lineCount;object instanceof $3Dmol.Mesh?(material.wireframe?(lineCount=geometryGroup.lineidx,setLineWidth(material.wireframeLinewidth),updateBuffers&&_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglLineBuffer),_gl.drawElements(_gl.LINES,lineCount,_gl.UNSIGNED_SHORT,0)):(faceCount=geometryGroup.faceidx,updateBuffers&&_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglFaceBuffer),_gl.drawElements(_gl.TRIANGLES,faceCount,_gl.UNSIGNED_SHORT,0)),_this.info.render.calls++,_this.info.render.vertices+=faceCount,_this.info.render.faces+=faceCount/3):object instanceof $3Dmol.Line&&(lineCount=geometryGroup.vertices,setLineWidth(material.linewidth),_gl.drawArrays(_gl.LINES,0,lineCount),_this.info.render.calls++)}},this.render=function(scene,camera,forceClear){if(camera instanceof $3Dmol.Camera==!1)return void console.error("$3Dmol.Renderer.render: camera is not an instance of $3Dmol.Camera.");var i,il,webglObject,object,renderList,lights=scene.__lights,fog=scene.fog;for(_currentMaterialId=-1,_lightsNeedUpdate=!0,this.autoUpdateScene&&scene.updateMatrixWorld(),void 0===camera.parent&&camera.updateMatrixWorld(),camera.matrixWorldInverse.getInverse(camera.matrixWorld),_projScreenMatrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse),this.autoUpdateObjects&&this.initWebGLObjects(scene),_this.info.render.calls=0,_this.info.render.vertices=0,_this.info.render.faces=0,_this.info.render.points=0,_currentWidth=_viewportWidth,_currentHeight=_viewportHeight,(this.autoClear||forceClear)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),renderList=scene.__webglObjects,i=0,il=renderList.length;il>i;i++)webglObject=renderList[i],object=webglObject.object,webglObject.render=!1,object.visible&&(setupMatrices(object,camera),unrollBufferMaterial(webglObject),webglObject.render=!0);var material=null;this.setBlending(!1),renderObjects(scene.__webglObjects,!0,"opaque",camera,lights,fog,!1,material),renderObjects(scene.__webglObjects,!0,"blank",camera,lights,fog,!0,material),renderObjects(scene.__webglObjects,!1,"transparent",camera,lights,fog,!0,material),renderPlugins(this.renderPluginsPost,scene,camera),this.setDepthTest(!0),this.setDepthWrite(!0)},this.initWebGLObjects=function(scene){if(scene.__webglObjects||(scene.__webglObjects=[],scene.__webglObjectsImmediate=[],scene.__webglSprites=[],scene.__webglFlares=[]),scene.__objectsAdded.length){for(;scene.__objectsAdded.length;)addObject(scene.__objectsAdded[0],scene),scene.__objectsAdded.splice(0,1);_currentGeometryGroupHash=-1}for(;scene.__objectsRemoved.length;)removeObject(scene.__objectsRemoved[0],scene),scene.__objectsRemoved.splice(0,1);for(var o=0,ol=scene.__webglObjects.length;ol>o;o++)updateObject(scene.__webglObjects[o].object)},this.setTexture=function(texture,slot){if(texture.needsUpdate){texture.__webglInit||(texture.__webglInit=!0,texture.addEventListener("dispose",onTextureDispose),texture.__webglTexture=_gl.createTexture(),_this.info.memory.textures++),_gl.activeTexture(_gl.TEXTURE0+slot),_gl.bindTexture(_gl.TEXTURE_2D,texture.__webglTexture),_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY),_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,texture.premultiplyAlpha),_gl.pixelStorei(_gl.UNPACK_ALIGNMENT,texture.unpackAlignment);var image=texture.image,isImagePowerOfTwo=isPowerOfTwo(image.width)&&isPowerOfTwo(image.height),glFormat=paramToGL(texture.format),glType=paramToGL(texture.type);setTextureParameters(_gl.TEXTURE_2D,texture,isImagePowerOfTwo);var mipmap,mipmaps=texture.mipmaps;if(mipmaps.length>0&&isImagePowerOfTwo){for(var i=0,il=mipmaps.length;il>i;i++)mipmap=mipmaps[i],_gl.texImage2D(_gl.TEXTURE_2D,i,glFormat,glFormat,glType,mipmap);texture.generateMipmaps=!1}else _gl.texImage2D(_gl.TEXTURE_2D,0,glFormat,glFormat,glType,texture.image);texture.generateMipmaps&&isImagePowerOfTwo&&_gl.generateMipmap(_gl.TEXTURE_2D),texture.needsUpdate=!1,texture.onUpdate&&texture.onUpdate()}else _gl.activeTexture(_gl.TEXTURE0+slot),_gl.bindTexture(_gl.TEXTURE_2D,texture.__webglTexture)},this.addPostPlugin(new $3Dmol.SpritePlugin)},$3Dmol.Scene=function(){$3Dmol.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},$3Dmol.Scene.prototype=Object.create($3Dmol.Object3D.prototype),$3Dmol.Scene.prototype.__addObject=function(object){if(object instanceof $3Dmol.Light)-1===this.__lights.indexOf(object)&&this.__lights.push(object),object.target&&void 0===object.target.parent&&this.add(object.target);else if(-1===this.__objects.indexOf(object)){this.__objects.push(object),this.__objectsAdded.push(object);var idx=this.__objectsRemoved.indexOf(object);-1!==idx&&this.__objectsRemoved.splice(i,1)}for(var i=0;i<object.children.length;i++)this.__addObject(object.children[i])},$3Dmol.Scene.prototype.__removeObject=function(object){var idx;if(object instanceof $3Dmol.Light)idx=this.__lights.indexOf(object),-1!==idx&&this.__lights.splice(idx,1);else if(idx=this.__objects.indexOf(object),-1!==idx){this.__objects.splice(idx,1),this.__objectsRemoved.push(object);var ai=this.__objectsAdded.indexOf(object);-1!==ai&&this.__objectsAdded.splice(idx,1)}for(var i=0;i<object.children.length;i++)this.__removeObject(object.children[i])},$3Dmol.Fog=function(hex,near,far){this.name="",this.color=new $3Dmol.Color(hex),this.near=void 0!==near?near:1,this.far=void 0!==far?far:1e3},$3Dmol.Fog.prototype.clone=function(){return new $3Dmol.Fog(this.color.getHex(),this.near,this.far)},$3Dmol.ShaderUtils={clone:function(uniforms_src){var u,uniforms_clone={};for(u in uniforms_src){uniforms_clone[u]={},uniforms_clone[u].type=uniforms_src[u].type;var srcValue=uniforms_src[u].value;srcValue instanceof $3Dmol.Color?uniforms_clone[u].value=srcValue.clone():"number"==typeof srcValue?uniforms_clone[u].value=srcValue:srcValue instanceof Array?uniforms_clone[u].value=[]:console.error("Error copying shader uniforms from ShaderLib: unknown type for uniform")}return uniforms_clone}},$3Dmol.ShaderLib={basic:{fragmentShader:["uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform vec3 diffuse;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vColor;","void main() {","    gl_FragColor = vec4( diffuse, opacity );","    gl_FragColor = gl_FragColor * vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 color;","varying vec3 vColor;","void main() {","    vColor = color;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},diffuse:{type:"c",value:new $3Dmol.Color(1,1,1)},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3}}},sphereimposter:{fragmentShader:["uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform vec3 diffuse;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","uniform float uDepth;","varying vec3 vColor;","varying vec2 mapping;","varying float rval;","void main() {","    float lensqr = dot(mapping,mapping);","    float rsqr = rval*rval;","    if(lensqr > rsqr)","       discard;","    float z = sqrt(rsqr-lensqr);","    float zscale = z/rval;","    gl_FragColor = vec4(zscale*vColor, 1 );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    gl_FragDepthEXT = gl_FragCoord.z-z/depth;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec2 mapping;","varying vec3 vColor;","varying float rval;","void main() {","    vColor = color;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    vec4 projPosition = projectionMatrix * mvPosition;","    vec4 adjust = projectionMatrix* vec4(normal,0.0); adjust.z = 0.0; adjust.w = 0.0;","    mapping = normal.xy;","    rval = abs(normal.x);","    gl_Position = projPosition+adjust;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},diffuse:{type:"c",value:new $3Dmol.Color(1,1,1)},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3}}},lambert:{fragmentShader:["uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vLightFront;","varying vec3 vColor;","void main() {","    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","    #ifndef WIREFRAME","    gl_FragColor.xyz *= vLightFront;","    #endif","    gl_FragColor = gl_FragColor * vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec3 vColor;","varying vec3 vLightFront;","void main() {","    vColor = color;","    vec3 objectNormal = normal;","    vec3 transformedNormal = normalMatrix * objectNormal;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    vLightFront = vec3( 0.0 );","    transformedNormal = normalize( transformedNormal );","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vec3 dirVector = normalize( lDirection.xyz );","    float dotProduct = dot( transformedNormal, dirVector );","    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;","    vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},diffuse:{type:"c",value:new $3Dmol.Color(1,1,1)},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},ambient:{type:"c",value:new $3Dmol.Color(1,1,1)},emissive:{type:"c",value:new $3Dmol.Color(1,1,1)},ambientLightColor:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},outline:{fragmentShader:["uniform float opacity;","uniform vec3 outlineColor;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","void main() {","    gl_FragColor = vec4( outlineColor, 1 );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float outlineWidth;","uniform float outlinePushback;","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","void main() {","    vec4 norm = modelViewMatrix*vec4(normalize(normal),0.0);","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    mvPosition.xy += norm.xy*outlineWidth;","    gl_Position = projectionMatrix * mvPosition;","    mvPosition.z -= outlinePushback;","    vec4 pushpos = projectionMatrix*mvPosition;","    gl_Position.z = gl_Position.w*pushpos.z/pushpos.w;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},diffuse:{type:"c",value:new $3Dmol.Color(1,1,1)},outlineColor:{type:"c",value:new $3Dmol.Color(0,0,0)},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},lambertdouble:{fragmentShader:["uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vLightFront;","varying vec3 vLightBack;","varying vec3 vColor;","void main() {","    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","    #ifndef WIREFRAME","    if ( gl_FrontFacing )","       gl_FragColor.xyz *= vLightFront;","    else","       gl_FragColor.xyz *= vLightBack;","    #endif","    gl_FragColor = gl_FragColor * vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec3 vColor;","varying vec3 vLightFront;","varying vec3 vLightBack;","void main() {","    vColor = color;","    vec3 objectNormal = normal;","    vec3 transformedNormal = normalMatrix * objectNormal;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    vLightFront = vec3( 0.0 );","    vLightBack = vec3( 0.0 );","    transformedNormal = normalize( transformedNormal );","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vec3 dirVector = normalize( lDirection.xyz );","    float dotProduct = dot( transformedNormal, dirVector );","    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","    vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;","    vLightBack += directionalLightColor[ 0 ] * directionalLightWeightingBack;","    vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","    vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},diffuse:{type:"c",value:new $3Dmol.Color(1,1,1)},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",
value:2e3},ambient:{type:"c",value:new $3Dmol.Color(1,1,1)},emissive:{type:"c",value:new $3Dmol.Color(1,1,1)},ambientLightColor:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},sprite:{fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","    vec4 texture = texture2D(map, vUV);","    if (texture.a < alphaTest) discard;","    gl_FragColor = vec4(color * texture.xyz, texture.a * opacity);","    if (fogType > 0) {","        float depth = gl_FragCoord.z / gl_FragCoord.w;","        float fogFactor = 0.0;","        if (fogType == 1) {","            fogFactor = smoothstep(fogNear, fogFar, depth);","        }","        else {","            const float LOG2 = 1.442695;","            float fogFactor = exp2(- fogDensity * fogDensity * depth * depth * LOG2);","            fogFactor = 1.0 - clamp(fogFactor, 0.0, 1.0);","        }","        gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);","    }","}"].join("\n"),vertexShader:["uniform int useScreenCoordinates;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","    vUV = uvOffset + uv * uvScale;","    vec2 alignedPosition = position + alignment;","    vec2 rotatedPosition;","    rotatedPosition.x = ( cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y ) * scale.x;","    rotatedPosition.y = ( sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y ) * scale.y;","    vec4 finalPosition;","    if(useScreenCoordinates != 0) {","        finalPosition = vec4(screenPosition.xy + rotatedPosition, screenPosition.z, 1.0);","    }","    else {","        finalPosition = projectionMatrix * modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0); finalPosition /= finalPosition.w;","        finalPosition.xy += rotatedPosition; ","    }","    gl_Position = finalPosition;","}"].join("\n"),uniforms:{}}},"undefined"==typeof console&&(console={log:function(){}}),$3Dmol.ProteinSurface=function(){var faces,verts,origextent,INOUT=1,ISDONE=2,ISBOUND=4,ptranx=0,ptrany=0,ptranz=0,probeRadius=1.4,defaultScaleFactor=2,scaleFactor=defaultScaleFactor,pHeight=0,pWidth=0,pLength=0,cutRadius=0,vpBits=null,vpDistance=null,vpAtomID=null,pminx=0,pminy=0,pminz=0,pmaxx=0,pmaxy=0,pmaxz=0,vdwRadii={H:1.2,Li:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},getVDWIndex=function(atom){return atom.elem&&"undefined"!=typeof vdwRadii[atom.elem]?atom.elem:"X"},depty={},widxz={},nb=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];this.getFacesAndVertices=function(atomlist){var i,il,atomsToShow={};for(i=0,il=atomlist.length;il>i;i++)atomsToShow[atomlist[i]]=!0;var vertices=verts;for(i=0,il=vertices.length;il>i;i++)vertices[i].x=vertices[i].x/scaleFactor-ptranx,vertices[i].y=vertices[i].y/scaleFactor-ptrany,vertices[i].z=vertices[i].z/scaleFactor-ptranz;var finalfaces=[];for(i=0,il=faces.length;il>i;i+=3){var fa=faces[i],fb=faces[i+1],fc=faces[i+2],a=vertices[fa].atomid,b=vertices[fb].atomid,c=vertices[fc].atomid,which=a;if(which>b&&(which=b),which>c&&(which=c),atomsToShow[which]){vertices[faces[i]],vertices[faces[i+1]],vertices[faces[i+2]];fa!==fb&&fb!==fc&&fa!==fc&&(finalfaces.push(fa),finalfaces.push(fb),finalfaces.push(fc))}}return vpBits=null,vpDistance=null,vpAtomID=null,{vertices:vertices,faces:finalfaces}},this.initparm=function(extent,btype,volume){volume>1e6&&(scaleFactor=defaultScaleFactor/2);var margin=1/scaleFactor*5.5;origextent=extent,pminx=extent[0][0],pmaxx=extent[1][0],pminy=extent[0][1],pmaxy=extent[1][1],pminz=extent[0][2],pmaxz=extent[1][2],btype?(pminx-=probeRadius+margin,pminy-=probeRadius+margin,pminz-=probeRadius+margin,pmaxx+=probeRadius+margin,pmaxy+=probeRadius+margin,pmaxz+=probeRadius+margin):(pminx-=margin,pminy-=margin,pminz-=margin,pmaxx+=margin,pmaxy+=margin,pmaxz+=margin),pminx=Math.floor(pminx*scaleFactor)/scaleFactor,pminy=Math.floor(pminy*scaleFactor)/scaleFactor,pminz=Math.floor(pminz*scaleFactor)/scaleFactor,pmaxx=Math.ceil(pmaxx*scaleFactor)/scaleFactor,pmaxy=Math.ceil(pmaxy*scaleFactor)/scaleFactor,pmaxz=Math.ceil(pmaxz*scaleFactor)/scaleFactor,ptranx=-pminx,ptrany=-pminy,ptranz=-pminz,pLength=Math.ceil(scaleFactor*(pmaxx-pminx))+1,pWidth=Math.ceil(scaleFactor*(pmaxy-pminy))+1,pHeight=Math.ceil(scaleFactor*(pmaxz-pminz))+1,this.boundingatom(btype),cutRadius=probeRadius*scaleFactor,vpBits=new Uint8Array(pLength*pWidth*pHeight),vpDistance=new Float64Array(pLength*pWidth*pHeight),vpAtomID=new Int32Array(pLength*pWidth*pHeight)},this.boundingatom=function(btype){var txz,tdept,sradius,tradius=[];flagradius=btype;for(var i in vdwRadii)if(vdwRadii.hasOwnProperty(i)){var r=vdwRadii[i];for(btype?tradius[i]=(r+probeRadius)*scaleFactor+.5:tradius[i]=r*scaleFactor+.5,sradius=tradius[i]*tradius[i],widxz[i]=Math.floor(tradius[i])+1,depty[i]=new Int32Array(widxz[i]*widxz[i]),indx=0,j=0;j<widxz[i];j++)for(k=0;k<widxz[i];k++)txz=j*j+k*k,txz>sradius?depty[i][indx]=-1:(tdept=Math.sqrt(sradius-txz),depty[i][indx]=Math.floor(tdept)),indx++}},this.fillvoxels=function(atoms,atomlist){var i,il;for(i=0,il=vpBits.length;il>i;i++)vpBits[i]=0,vpDistance[i]=-1,vpAtomID[i]=-1;for(i in atomlist){var atom=atoms[atomlist[i]];void 0!==atom&&this.fillAtom(atom,atoms)}for(i=0,il=vpBits.length;il>i;i++)vpBits[i]&INOUT&&(vpBits[i]|=ISDONE)},this.fillAtom=function(atom,atoms){var cx,cy,cz,ox,oy,oz,mi,mj,mk,i,j,k,si,sj,sk,ii,jj,kk,n;cx=Math.floor(.5+scaleFactor*(atom.x+ptranx)),cy=Math.floor(.5+scaleFactor*(atom.y+ptrany)),cz=Math.floor(.5+scaleFactor*(atom.z+ptranz));var at=getVDWIndex(atom),nind=0,pWH=pWidth*pHeight;for(i=0,n=widxz[at];n>i;i++)for(j=0;n>j;j++){if(-1!=depty[at][nind])for(ii=-1;2>ii;ii++)for(jj=-1;2>jj;jj++)for(kk=-1;2>kk;kk++)if(0!==ii&&0!==jj&&0!==kk)for(mi=ii*i,mk=kk*j,k=0;k<=depty[at][nind];k++)if(mj=k*jj,si=cx+mi,sj=cy+mj,sk=cz+mk,!(0>si||0>sj||0>sk||si>=pLength||sj>=pWidth||sk>=pHeight)){var index=si*pWH+sj*pHeight+sk;if(vpBits[index]&INOUT){var atom2=atoms[vpAtomID[index]];atom2.serial!=atom.serial&&(ox=cx+mi-Math.floor(.5+scaleFactor*(atom2.x+ptranx)),oy=cy+mj-Math.floor(.5+scaleFactor*(atom2.y+ptrany)),oz=cz+mk-Math.floor(.5+scaleFactor*(atom2.z+ptranz)),ox*ox+oy*oy+oz*oz>mi*mi+mj*mj+mk*mk&&(vpAtomID[index]=atom.serial))}else vpBits[index]|=INOUT,vpAtomID[index]=atom.serial}nind++}},this.fillvoxelswaals=function(atoms,atomlist){var i,il;for(i=0,il=vpBits.length;il>i;i++)vpBits[i]&=~ISDONE;for(i in atomlist){var atom=atoms[atomlist[i]];void 0!==atom&&this.fillAtomWaals(atom,atoms)}},this.fillAtomWaals=function(atom,atoms){var cx,cy,cz,ox,oy,oz,mi,mj,mk,si,sj,sk,i,j,k,ii,jj,kk,n,nind=0;cx=Math.floor(.5+scaleFactor*(atom.x+ptranx)),cy=Math.floor(.5+scaleFactor*(atom.y+ptrany)),cz=Math.floor(.5+scaleFactor*(atom.z+ptranz));var at=getVDWIndex(atom),pWH=pWidth*pHeight;for(i=0,n=widxz[at];n>i;i++)for(j=0;n>j;j++){if(-1!=depty[at][nind])for(ii=-1;2>ii;ii++)for(jj=-1;2>jj;jj++)for(kk=-1;2>kk;kk++)if(0!==ii&&0!==jj&&0!==kk)for(mi=ii*i,mk=kk*j,k=0;k<=depty[at][nind];k++)if(mj=k*jj,si=cx+mi,sj=cy+mj,sk=cz+mk,!(0>si||0>sj||0>sk||si>=pLength||sj>=pWidth||sk>=pHeight)){var index=si*pWH+sj*pHeight+sk;if(vpBits[index]&ISDONE){var atom2=atoms[vpAtomID[index]];atom2.serial!=atom.serial&&(ox=cx+mi-Math.floor(.5+scaleFactor*(atom2.x+ptranx)),oy=cy+mj-Math.floor(.5+scaleFactor*(atom2.y+ptrany)),oz=cz+mk-Math.floor(.5+scaleFactor*(atom2.z+ptranz)),ox*ox+oy*oy+oz*oz>mi*mi+mj*mj+mk*mk&&(vpAtomID[index]=atom.serial))}else vpBits[index]|=ISDONE,vpAtomID[index]=atom.serial}nind++}},this.buildboundary=function(){var pWH=pWidth*pHeight;for(i=0;i<pLength;i++)for(j=0;j<pHeight;j++)for(k=0;k<pWidth;k++){var index=i*pWH+k*pHeight+j;if(vpBits[index]&INOUT)for(var ii=0;26>ii;){var ti=i+nb[ii][0],tj=j+nb[ii][2],tk=k+nb[ii][1];if(ti>-1&&pLength>ti&&tk>-1&&pWidth>tk&&tj>-1&&pHeight>tj&&!(vpBits[ti*pWH+tk*pHeight+tj]&INOUT)){vpBits[index]|=ISBOUND;break}ii++}}};var PointGrid=function(length,width,height){var data=new Int32Array(length*width*height*3);this.set=function(x,y,z,pt){var index=3*((x*width+y)*height+z);data[index]=pt.ix,data[index+1]=pt.iy,data[index+2]=pt.iz},this.get=function(x,y,z){var index=3*((x*width+y)*height+z);return{ix:data[index],iy:data[index+1],iz:data[index+2]}}};this.fastdistancemap=function(){var i,j,k,n,index,boundPoint=new PointGrid(pLength,pWidth,pHeight),pWH=pWidth*pHeight,cutRSq=cutRadius*cutRadius,inarray=[],outarray=[];for(i=0;pLength>i;i++)for(j=0;pWidth>j;j++)for(k=0;pHeight>k;k++)if(index=i*pWH+j*pHeight+k,vpBits[index]&=~ISDONE,vpBits[index]&INOUT&&vpBits[index]&ISBOUND){var triple={ix:i,iy:j,iz:k};boundPoint.set(i,j,k,triple),inarray.push(triple),vpDistance[index]=0,vpBits[index]|=ISDONE,vpBits[index]&=~ISBOUND}do for(outarray=this.fastoneshell(inarray,boundPoint),inarray=[],i=0,n=outarray.length;n>i;i++)index=pWH*outarray[i].ix+pHeight*outarray[i].iy+outarray[i].iz,vpBits[index]&=~ISBOUND,vpDistance[index]<=1.0404*cutRSq&&inarray.push({ix:outarray[i].ix,iy:outarray[i].iy,iz:outarray[i].iz});while(0!==inarray.length);inarray=[],outarray=[],boundPoint=null;var cutsf=scaleFactor-.5;0>cutsf&&(cutsf=0);var cutoff=cutRSq-.5/(.1+cutsf);for(i=0;pLength>i;i++)for(j=0;pWidth>j;j++)for(k=0;pHeight>k;k++)index=i*pWH+j*pHeight+k,vpBits[index]&=~ISBOUND,vpBits[index]&INOUT&&(!(vpBits[index]&ISDONE)||vpBits[index]&ISDONE&&vpDistance[index]>=cutoff)&&(vpBits[index]|=ISBOUND)},this.fastoneshell=function(inarray,boundPoint){var tx,ty,tz,dx,dy,dz,i,j,n,square,bp,index,outarray=[];if(0===inarray.length)return outarray;tnv={ix:-1,iy:-1,iz:-1};var pWH=pWidth*pHeight;for(i=0,n=inarray.length;n>i;i++)for(tx=inarray[i].ix,ty=inarray[i].iy,tz=inarray[i].iz,bp=boundPoint.get(tx,ty,tz),j=0;6>j;j++)tnv.ix=tx+nb[j][0],tnv.iy=ty+nb[j][1],tnv.iz=tz+nb[j][2],tnv.ix<pLength&&tnv.ix>-1&&tnv.iy<pWidth&&tnv.iy>-1&&tnv.iz<pHeight&&tnv.iz>-1&&(index=tnv.ix*pWH+pHeight*tnv.iy+tnv.iz,vpBits[index]&INOUT&&!(vpBits[index]&ISDONE)?(boundPoint.set(tnv.ix,tnv.iy,tz+nb[j][2],bp),dx=tnv.ix-bp.ix,dy=tnv.iy-bp.iy,dz=tnv.iz-bp.iz,square=dx*dx+dy*dy+dz*dz,vpDistance[index]=square,vpBits[index]|=ISDONE,vpBits[index]|=ISBOUND,outarray.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):vpBits[index]&INOUT&&vpBits[index]&ISDONE&&(dx=tnv.ix-bp.ix,dy=tnv.iy-bp.iy,dz=tnv.iz-bp.iz,square=dx*dx+dy*dy+dz*dz,square<vpDistance[index]&&(boundPoint.set(tnv.ix,tnv.iy,tnv.iz,bp),vpDistance[index]=square,vpBits[index]&ISBOUND||(vpBits[index]|=ISBOUND,outarray.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})))));for(i=0,n=inarray.length;n>i;i++)for(tx=inarray[i].ix,ty=inarray[i].iy,tz=inarray[i].iz,bp=boundPoint.get(tx,ty,tz),j=6;18>j;j++)tnv.ix=tx+nb[j][0],tnv.iy=ty+nb[j][1],tnv.iz=tz+nb[j][2],tnv.ix<pLength&&tnv.ix>-1&&tnv.iy<pWidth&&tnv.iy>-1&&tnv.iz<pHeight&&tnv.iz>-1&&(index=tnv.ix*pWH+pHeight*tnv.iy+tnv.iz,vpBits[index]&INOUT&&!(vpBits[index]&ISDONE)?(boundPoint.set(tnv.ix,tnv.iy,tz+nb[j][2],bp),dx=tnv.ix-bp.ix,dy=tnv.iy-bp.iy,dz=tnv.iz-bp.iz,square=dx*dx+dy*dy+dz*dz,vpDistance[index]=square,vpBits[index]|=ISDONE,vpBits[index]|=ISBOUND,outarray.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):vpBits[index]&INOUT&&vpBits[index]&ISDONE&&(dx=tnv.ix-bp.ix,dy=tnv.iy-bp.iy,dz=tnv.iz-bp.iz,square=dx*dx+dy*dy+dz*dz,square<vpDistance[index]&&(boundPoint.set(tnv.ix,tnv.iy,tnv.iz,bp),vpDistance[index]=square,vpBits[index]&ISBOUND||(vpBits[index]|=ISBOUND,outarray.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})))));for(i=0,n=inarray.length;n>i;i++)for(tx=inarray[i].ix,ty=inarray[i].iy,tz=inarray[i].iz,bp=boundPoint.get(tx,ty,tz),j=18;26>j;j++)tnv.ix=tx+nb[j][0],tnv.iy=ty+nb[j][1],tnv.iz=tz+nb[j][2],tnv.ix<pLength&&tnv.ix>-1&&tnv.iy<pWidth&&tnv.iy>-1&&tnv.iz<pHeight&&tnv.iz>-1&&(index=tnv.ix*pWH+pHeight*tnv.iy+tnv.iz,vpBits[index]&INOUT&&!(vpBits[index]&ISDONE)?(boundPoint.set(tnv.ix,tnv.iy,tz+nb[j][2],bp),dx=tnv.ix-bp.ix,dy=tnv.iy-bp.iy,dz=tnv.iz-bp.iz,square=dx*dx+dy*dy+dz*dz,vpDistance[index]=square,vpBits[index]|=ISDONE,vpBits[index]|=ISBOUND,outarray.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):vpBits[index]&INOUT&&vpBits[index]&ISDONE&&(dx=tnv.ix-bp.ix,dy=tnv.iy-bp.iy,dz=tnv.iz-bp.iz,square=dx*dx+dy*dy+dz*dz,square<vpDistance[index]&&(boundPoint.set(tnv.ix,tnv.iy,tnv.iz,bp),vpDistance[index]=square,vpBits[index]&ISBOUND||(vpBits[index]|=ISBOUND,outarray.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})))));return outarray},this.marchingcubeinit=function(stype){for(var i=0,lim=vpBits.length;lim>i;i++)1==stype?vpBits[i]&=~ISBOUND:4==stype?(vpBits[i]&=~ISDONE,vpBits[i]&ISBOUND&&(vpBits[i]|=ISDONE),vpBits[i]&=~ISBOUND):2==stype?vpBits[i]&ISBOUND&&vpBits[i]&ISDONE?vpBits[i]&=~ISBOUND:vpBits[i]&ISBOUND&&!(vpBits[i]&ISDONE)&&(vpBits[i]|=ISDONE):3==stype&&(vpBits[i]&=~ISBOUND)};this.marchingcube=function(stype){this.marchingcubeinit(stype),verts=[],faces=[],$3Dmol.MarchingCube.march(vpBits,verts,faces,{smooth:1,nX:pLength,nY:pWidth,nZ:pHeight});for(var pWH=pWidth*pHeight,i=0,vlen=verts.length;vlen>i;i++)verts[i].atomid=vpAtomID[verts[i].x*pWH+pHeight*verts[i].y+verts[i].z];$3Dmol.MarchingCube.laplacianSmooth(1,verts,faces)}},$(document).ready(function(){if(void 0!==$(".viewer_3Dmoljs")[0]&&($3Dmol.autoinit=!0),$3Dmol.autoinit){$3Dmol.viewers={};var nviewers=0;$(".viewer_3Dmoljs").each(function(){var viewerdiv=$(this),datauri=null,callback="function"==typeof window[viewerdiv.data("callback")]?window[viewerdiv.data("callback")]:null,type=null;viewerdiv.data("pdb")?(datauri="http://www.rcsb.org/pdb/files/"+viewerdiv.data("pdb")+".pdb",type="pdb"):viewerdiv.data("cid")?(type="sdf",datauri="http://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+viewerdiv.data("cid")+"/SDF?record_type=3d"):viewerdiv.data("href")&&(datauri=viewerdiv.data("href"));var bgcolor=$3Dmol.CC.color(viewerdiv.data("backgroundcolor")),style={line:{}};viewerdiv.data("style")&&(style=$3Dmol.specStringToObject(viewerdiv.data("style")));var select={};viewerdiv.data("select")&&(select=$3Dmol.specStringToObject(viewerdiv.data("select")));var selectstylelist=[],surfaces=[],labels=[],d=viewerdiv.data(),stylere=/style(.+)/,surfre=/surface(.*)/,reslabre=/labelres(.*)/,keys=[];for(var dataname in d)d.hasOwnProperty(dataname)&&keys.push(dataname);keys.sort();for(var i=0;i<keys.length;i++){var dataname=keys[i],m=stylere.exec(dataname);if(m){var selname="select"+m[1],newsel=$3Dmol.specStringToObject(d[selname]),styleobj=$3Dmol.specStringToObject(d[dataname]);selectstylelist.push([newsel,styleobj])}if(m=surfre.exec(dataname)){var selname="select"+m[1],newsel=$3Dmol.specStringToObject(d[selname]),styleobj=$3Dmol.specStringToObject(d[dataname]);surfaces.push([newsel,styleobj])}if(m=reslabre.exec(dataname)){var selname="select"+m[1],newsel=$3Dmol.specStringToObject(d[selname]),styleobj=$3Dmol.specStringToObject(d[dataname]);labels.push([newsel,styleobj])}}var applyStyles=function(glviewer){glviewer.setStyle(select,style);for(var i=0;i<selectstylelist.length;i++){var sel=selectstylelist[i][0]||{},sty=selectstylelist[i][1]||{line:{}};glviewer.setStyle(sel,sty)}for(var i=0;i<surfaces.length;i++){var sel=surfaces[i][0]||{},sty=surfaces[i][1]||{};glviewer.addSurface($3Dmol.SurfaceType.VDW,sty,sel,sel)}for(var i=0;i<labels.length;i++){var sel=labels[i][0]||{},sty=labels[i][1]||{};glviewer.addResLabels(sel,sty)}glviewer.zoomTo(),glviewer.render()},glviewer=null;try{glviewer=$3Dmol.viewers[this.id||nviewers++]=$3Dmol.createViewer(viewerdiv,{defaultcolors:$3Dmol.rasmolElementColors}),glviewer.setBackgroundColor(bgcolor)}catch(error){window.location="http://get.webgl.org"}if(datauri)type=viewerdiv.data("type")||viewerdiv.data("datatype")||type,type||(type=datauri.substr(datauri.lastIndexOf(".")+1)),$.get(datauri,function(ret){glviewer.addModel(ret,type),applyStyles(glviewer),callback&&callback(glviewer)},"text");else{if(viewerdiv.data("element")){var moldata=$("#"+viewerdiv.data("element")).val()||"",type=viewerdiv.data("type")||viewerdiv.data("datatype");type||(console.log("Warning: No type specified for embedded viewer with moldata from "+viewerdiv.data("element")+"\n assuming type 'pdb'"),type="pdb"),glviewer.addModel(moldata,type)}applyStyles(glviewer),callback&&callback(glviewer)}})}}),$3Dmol.CC={cache:{0:new $3Dmol.Color(0)},color:function color_(hex){if(!hex)return this.cache[0];if("undefined"!=typeof this.cache[hex])return this.cache[hex];if(hex&&hex.constructor===Array)return hex.map(color_,this);if(hex=this.getHex(hex),"number"==typeof hex){var c=new $3Dmol.Color(hex);return this.cache[hex]=c,c}return hex},colorTab:{white:16777215,silver:12632256,gray:8421504,grey:8421504,black:0,red:16711680,maroon:8388608,yellow:16776960,orange:16737792,olive:8421376,lime:65280,green:32768,aqua:65535,cyan:65535,teal:32896,blue:255,navy:128,fuchsia:16711935,magenta:16711935,purple:8388736},getHex:function(hex){return isNaN(parseInt(hex))?"string"==typeof hex?this.colorTab[hex.trim().toLowerCase()]||0:hex:parseInt(hex)}},$3Dmol.CC=$3Dmol.CC,$3Dmol.CC.color=$3Dmol.CC.color,$3Dmol.getColorFromStyle=function(atom,style){var color=atom.color;if("undefined"!=typeof style.color&&"spectrum"!=style.color&&(color=style.color),"undefined"!=typeof style.colorscheme){if("undefined"!=typeof $3Dmol.elementColors[style.colorscheme]){var scheme=$3Dmol.elementColors[style.colorscheme];"undefined"!=typeof scheme[atom.elem]&&(color=scheme[atom.elem])}else if("undefined"!=typeof style.colorscheme[atom.elem])color=style.colorscheme[atom.elem];else if("undefined"!=typeof style.colorscheme.prop&&"undefined"!=typeof style.colorscheme.gradient){var prop=style.colorscheme.prop,scheme=style.colorscheme.gradient,range=scheme.range()||[-1,1],val=$3Dmol.getAtomProperty(atom,prop);null!=val&&(color=scheme.valueToHex(val,range))}}else"undefined"!=typeof style.colorfunc&&(color=style.colorfunc(atom));var C=$3Dmol.CC.color(color);return C},$3Dmol.elementColors=$3Dmol.elementColors||{},$3Dmol.elementColors.defaultColor=16716947,$3Dmol.elementColors.Jmol={H:16777215,He:14286847,HE:14286847,Li:13402367,LI:13402367,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,Na:11230450,NA:11230450,Mg:9109248,MG:9109248,Al:12560038,AL:12560038,Si:1578e4,SI:1578e4,P:16744448,S:16777008,Cl:2093087,CL:2093087,Ca:4062976,CA:4062976,Ti:12567239,TI:12567239,Cr:9083335,CR:9083335,Mn:10255047,MN:10255047,Fe:14706227,FE:14706227,Ni:5296208,NI:5296208,Cu:13140019,CU:13140019,Zn:8224944,ZN:8224944,Br:10889513,BR:10889513,Ag:12632256,AG:12632256,I:9699476,Ba:51456,BA:51456,Au:16765219,AU:16765219},$3Dmol.elementColors.rasmol={H:16777215,He:16761035,HE:16761035,Li:11674146,LI:11674146,B:65280,C:13158600,N:9408511,O:15728640,F:14329120,Na:255,NA:255,Mg:2263842,MG:2263842,Al:8421520,AL:8421520,Si:14329120,SI:14329120,P:16753920,S:16762930,Cl:65280,CL:65280,Ca:8421520,CA:8421520,Ti:8421520,TI:8421520,Cr:8421520,CR:8421520,Mn:8421520,MN:8421520,Fe:16753920,FE:16753920,Ni:10824234,NI:10824234,Cu:10824234,CU:10824234,Zn:10824234,ZN:10824234,Br:10824234,BR:10824234,Ag:8421520,AG:8421520,I:10494192,Ba:16753920,BA:16753920,Au:14329120,AU:14329120},$3Dmol.elementColors.defaultColors=$3Dmol.elementColors.rasmol,$3Dmol.elementColors.greenCarbon=$.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.greenCarbon.C=65280,$3Dmol.elementColors.cyanCarbon=$.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.cyanCarbon.C=65535,$3Dmol.elementColors.magentaCarbon=$.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.magentaCarbon.C=16711935,$3Dmol.elementColors.yellowCarbon=$.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.yellowCarbon.C=16776960,$3Dmol.elementColors.whiteCarbon=$.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.whiteCarbon.C=16777215,$3Dmol.elementColors.orangeCarbon=$.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.orangeCarbon.C=16737792,$3Dmol.elementColors.purpleCarbon=$.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.purpleCarbon.C=8388736,$3Dmol.elementColors.blueCarbon=$.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.blueCarbon.C=255;var $3Dmol=$3Dmol||{};$3Dmol.drawCartoon=function(){var defaultNum=5,defaultDiv=5,coilWidth=.5,helixSheetWidth=1.3,nucleicAcidWidth=.8,defaultThickness=.4,subdivide=function(_points,DIV){var ret=[],points=_points;points=[],points.push(_points[0]);var i,lim,size,p0,p1,p2,p3,v0,v1;for(i=1,lim=_points.length-1;lim>i;i++)p1=_points[i],p2=_points[i+1],p1.smoothen?points.push(new $3Dmol.Vector3((p1.x+p2.x)/2,(p1.y+p2.y)/2,(p1.z+p2.z)/2)):points.push(p1);for(points.push(_points[_points.length-1]),i=-1,size=points.length;size-3>=i;i++)if(p0=points[-1===i?0:i],p1=points[i+1],p2=points[i+2],p3=points[i===size-3?size-1:i+3],v0=(new $3Dmol.Vector3).subVectors(p2,p0).multiplyScalar(.5),v1=(new $3Dmol.Vector3).subVectors(p3,p1).multiplyScalar(.5),!p2.skip)for(var j=0;DIV>j;j++){var t=1/DIV*j,x=p1.x+t*v0.x+t*t*(-3*p1.x+3*p2.x-2*v0.x-v1.x)+t*t*t*(2*p1.x-2*p2.x+v0.x+v1.x),y=p1.y+t*v0.y+t*t*(-3*p1.y+3*p2.y-2*v0.y-v1.y)+t*t*t*(2*p1.y-2*p2.y+v0.y+v1.y),z=p1.z+t*v0.z+t*t*(-3*p1.z+3*p2.z-2*v0.z-v1.z)+t*t*t*(2*p1.z-2*p2.z+v0.z+v1.z),pt=new $3Dmol.Vector3(x,y,z),atomIndex=Math.floor((ret.length+2)/DIV);void 0!==_points[atomIndex]&&void 0!==_points[atomIndex].atom&&(pt.atom=_points[atomIndex].atom),ret.push(pt)}return ret.push(points[points.length-1]),ret},drawThinStrip=function(group,p1,p2,colors,div,opacity){for(var offset,vertoffset,color,colori,geo=new $3Dmol.Geometry(!0),i=0,lim=p1.length;lim>i;i++){colori=Math.round(i*(colors.length-1)/lim),color=$3Dmol.CC.color(colors[colori]),geoGroup=geo.updateGeoGroup(2);var vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray,faceArray=geoGroup.faceArray;offset=geoGroup.vertices,vertoffset=3*offset,vertexArray[vertoffset]=p1[i].x,vertexArray[vertoffset+1]=p1[i].y,vertexArray[vertoffset+2]=p1[i].z,vertexArray[vertoffset+3]=p2[i].x,vertexArray[vertoffset+4]=p2[i].y,vertexArray[vertoffset+5]=p2[i].z;for(var j=0;6>j;++j)colorArray[vertoffset+3*j]=color.r,colorArray[vertoffset+1+3*j]=color.g,colorArray[vertoffset+2+3*j]=color.b;if(i>0){var faces=[offset,offset+1,offset-1,offset-2],faceoffset=geoGroup.faceidx;faceArray[faceoffset]=faces[0],faceArray[faceoffset+1]=faces[1],faceArray[faceoffset+2]=faces[3],faceArray[faceoffset+3]=faces[1],faceArray[faceoffset+4]=faces[2],faceArray[faceoffset+5]=faces[3],geoGroup.faceidx+=6}geoGroup.vertices+=2}geo.initTypedArrays(),geo.setUpNormals();var material=new $3Dmol.MeshDoubleLambertMaterial;"number"==typeof opacity&&opacity>=0&&1>opacity&&(material.transparent=!0,material.opacity=opacity),material.vertexColors=$3Dmol.FaceColors;var mesh=new $3Dmol.Mesh(geo,material);group.add(mesh)},drawShapeStrip=function(group,points,colors,div,thickness,opacity,shape){var i,j,num,len;if(num=points.length,!(2>num||points[0].length<2)){for(div=div||axisDIV,i=0;num>i;i++)points[i]=subdivide(points[i],div);if(len=points[0].length,!thickness)return drawThinStrip(group,points[0],points[num-1],colors,div,opacity);var axis,cs_shape,cs_bottom,cs_top,last_cs_bottom,last_cs_top,geo=new $3Dmol.Geometry(!0),cs_ellipse=[],cs_rectangle=[],cs_parabola=[];for(j=0;num>j;j++)cs_ellipse.push(.25+1.5*Math.sqrt((num-1)*j-Math.pow(j,2))/(num-1)),cs_rectangle.push(.5),cs_parabola.push(2*(Math.pow(j/num,2)-j/num)+.6);var face_refs=[];for(j=0;2*num-1>j;j++)face_refs[j]=[j,j+1,j+1-2*num,j-2*num];face_refs[2*num-1]=[j,j+1-2*num,j+1-4*num,j-2*num];var v_offset,va_offset,f_offset,currentAtom,lastAtom,color,colori,geoGroup=geo.updateGeoGroup(2*num*len);for(i=0;len>i;i++){colori=Math.round(i*(colors.length-1)/len),color=$3Dmol.CC.color(colors[colori]),last_cs_bottom=cs_bottom,last_cs_top=cs_top,cs_bottom=[],cs_top=[],axis=[],void 0!==points[0][i].atom&&(currentAtom=points[0][i].atom,"oval"===shape?cs_shape=cs_ellipse:"rectangle"===shape?cs_shape=cs_rectangle:"parabola"===shape&&(cs_shape=cs_parabola)),cs_shape||(cs_shape=cs_rectangle);var toNext,toSide;for(j=0;num>j;j++)toNext=len-1>i?points[j][i+1].clone().sub(points[j][i]):points[j][i-1].clone().sub(points[j][i]).negate(),toSide=num-1>j?points[j+1][i].clone().sub(points[j][i]):points[j-1][i].clone().sub(points[j][i]).negate(),axis[j]=toSide.cross(toNext).normalize().multiplyScalar(thickness*cs_shape[j]);for(j=0;num>j;j++)cs_bottom[j]=points[j][i].clone().add(axis[j].clone().negate());for(j=0;num>j;j++)cs_top[j]=points[j][i].clone().add(axis[j]);var vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray,faceArray=geoGroup.faceArray;for(v_offset=geoGroup.vertices,va_offset=3*v_offset,j=0;num>j;j++)vertexArray[va_offset+3*j+0]=cs_bottom[j].x,vertexArray[va_offset+3*j+1]=cs_bottom[j].y,vertexArray[va_offset+3*j+2]=cs_bottom[j].z;for(j=0;num>j;j++)vertexArray[va_offset+3*j+0+3*num]=cs_top[num-1-j].x,vertexArray[va_offset+3*j+1+3*num]=cs_top[num-1-j].y,vertexArray[va_offset+3*j+2+3*num]=cs_top[num-1-j].z;for(j=0;2*num>j;++j)colorArray[va_offset+3*j+0]=color.r,colorArray[va_offset+3*j+1]=color.g,colorArray[va_offset+3*j+2]=color.b;if(i>0){for(j=0;2*num>j;j++){var face=[v_offset+face_refs[j][0],v_offset+face_refs[j][1],v_offset+face_refs[j][2],v_offset+face_refs[j][3]];f_offset=geoGroup.faceidx,faceArray[f_offset]=face[0],faceArray[f_offset+1]=face[1],faceArray[f_offset+2]=face[3],faceArray[f_offset+3]=face[1],faceArray[f_offset+4]=face[2],faceArray[f_offset+5]=face[3],geoGroup.faceidx+=6}if(currentAtom.clickable){var faces=[];faces.push(new $3Dmol.Triangle(last_cs_bottom[0],cs_bottom[0],cs_bottom[num-1])),faces.push(new $3Dmol.Triangle(last_cs_bottom[0],cs_bottom[num-1],last_cs_bottom[num-1])),faces.push(new $3Dmol.Triangle(last_cs_bottom[num-1],cs_bottom[num-1],cs_top[num-1])),faces.push(new $3Dmol.Triangle(last_cs_bottom[num-1],cs_top[num-1],last_cs_top[num-1])),faces.push(new $3Dmol.Triangle(cs_top[0],last_cs_top[0],last_cs_top[num-1])),faces.push(new $3Dmol.Triangle(cs_top[num-1],cs_top[0],last_cs_top[num-1])),faces.push(new $3Dmol.Triangle(cs_bottom[0],last_cs_bottom[0],last_cs_top[0])),faces.push(new $3Dmol.Triangle(cs_top[0],cs_bottom[0],last_cs_top[0]));for(j in faces)currentAtom.intersectionShape.triangle.push(faces[j])}}geoGroup.vertices+=2*num,lastAtom=currentAtom}var vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray,faceArray=geoGroup.faceArray;for(v_offset=geoGroup.vertices,va_offset=3*v_offset,f_offset=geoGroup.faceidx,i=0;num-1>i;i++){var face=[i,i+1,2*num-2-i,2*num-1-i];f_offset=geoGroup.faceidx,faceArray[f_offset]=face[0],faceArray[f_offset+1]=face[1],faceArray[f_offset+2]=face[3],faceArray[f_offset+3]=face[1],faceArray[f_offset+4]=face[2],faceArray[f_offset+5]=face[3],geoGroup.faceidx+=6}for(i=0;num-1>i;i++){var face=[v_offset-1-i,v_offset-2-i,v_offset-2*num+i+1,v_offset-2*num+i];f_offset=geoGroup.faceidx,faceArray[f_offset]=face[0],faceArray[f_offset+1]=face[1],faceArray[f_offset+2]=face[3],faceArray[f_offset+3]=face[1],faceArray[f_offset+4]=face[2],faceArray[f_offset+5]=face[3],geoGroup.faceidx+=6}geo.initTypedArrays(),geo.setUpNormals();var material=new $3Dmol.MeshDoubleLambertMaterial;material.vertexColors=$3Dmol.FaceColors,"number"==typeof opacity&&opacity>=0&&1>opacity&&(material.transparent=!0,material.opacity=opacity);var mesh=new $3Dmol.Mesh(geo,material);group.add(mesh)}},drawPlainStrip=function(group,points,colors,div,thickness,opacity){if(!(points.length<2)){var p1,p2;if(p1=points[0],p2=points[points.length-1],div=div||axisDIV,p1=subdivide(p1,div),p2=subdivide(p2,div),!thickness)return drawThinStrip(group,p1,p2,colors,div,opacity);var axis,p1v,p2v,a1v,a2v,offset,vertoffset,faceoffset,color,colori,currentAtom,lastAtom,i,lim,j,face1,face2,face3,geoGroup,geo=new $3Dmol.Geometry(!0),vs=[],faces=[[0,2,-6,-8],[-4,-2,6,4],[7,-1,-5,3],[-3,5,1,-7]];for(i=0,lim=p1.length;lim>i;i++){if(colori=Math.round(i*(colors.length-1)/lim),color=$3Dmol.CC.color(colors[colori]),vs.push(p1v=p1[i]),vs.push(p1v),vs.push(p2v=p2[i]),vs.push(p2v),lim-1>i){var toNext=p1[i+1].clone().sub(p1[i]),toSide=p2[i].clone().sub(p1[i]);axis=toSide.cross(toNext).normalize().multiplyScalar(thickness)}vs.push(a1v=p1[i].clone().add(axis)),vs.push(a1v),vs.push(a2v=p2[i].clone().add(axis)),vs.push(a2v),void 0!==p1v.atom&&(currentAtom=p1v.atom),geoGroup=geo.updateGeoGroup(8);var vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray,faceArray=geoGroup.faceArray;for(offset=geoGroup.vertices,vertoffset=3*offset,vertexArray[vertoffset]=p1v.x,vertexArray[vertoffset+1]=p1v.y,vertexArray[vertoffset+2]=p1v.z,vertexArray[vertoffset+3]=p1v.x,vertexArray[vertoffset+4]=p1v.y,vertexArray[vertoffset+5]=p1v.z,vertexArray[vertoffset+6]=p2v.x,vertexArray[vertoffset+7]=p2v.y,vertexArray[vertoffset+8]=p2v.z,vertexArray[vertoffset+9]=p2v.x,vertexArray[vertoffset+10]=p2v.y,vertexArray[vertoffset+11]=p2v.z,vertexArray[vertoffset+12]=a1v.x,vertexArray[vertoffset+13]=a1v.y,vertexArray[vertoffset+14]=a1v.z,vertexArray[vertoffset+15]=a1v.x,vertexArray[vertoffset+16]=a1v.y,vertexArray[vertoffset+17]=a1v.z,vertexArray[vertoffset+18]=a2v.x,vertexArray[vertoffset+19]=a2v.y,vertexArray[vertoffset+20]=a2v.z,vertexArray[vertoffset+21]=a2v.x,vertexArray[vertoffset+22]=a2v.y,vertexArray[vertoffset+23]=a2v.z,j=0;8>j;++j)colorArray[vertoffset+3*j]=color.r,colorArray[vertoffset+1+3*j]=color.g,colorArray[vertoffset+2+3*j]=color.b;if(i>0){var diffAtoms=void 0!==lastAtom&&void 0!==currentAtom&&lastAtom.serial!==currentAtom.serial;for(j=0;4>j;j++){var face=[offset+faces[j][0],offset+faces[j][1],offset+faces[j][2],offset+faces[j][3]];if(faceoffset=geoGroup.faceidx,faceArray[faceoffset]=face[0],faceArray[faceoffset+1]=face[1],faceArray[faceoffset+2]=face[3],faceArray[faceoffset+3]=face[1],faceArray[faceoffset+4]=face[2],faceArray[faceoffset+5]=face[3],geoGroup.faceidx+=6,currentAtom.clickable||lastAtom.clickable){var p1a=vs[face[3]].clone(),p1b=vs[face[0]].clone(),p2a=vs[face[2]].clone(),p2b=vs[face[1]].clone();if(p1a.atom=vs[face[3]].atom||null,p2a.atom=vs[face[2]].atom||null,p1b.atom=vs[face[0]].atom||null,p2b.atom=vs[face[1]].atom||null,diffAtoms){var m1=p1a.clone().add(p1b).multiplyScalar(.5),m2=p2a.clone().add(p2b).multiplyScalar(.5),m=p1a.clone().add(p2b).multiplyScalar(.5);j%2===0?(lastAtom.clickable&&(face1=new $3Dmol.Triangle(m1,m,p1a),face2=new $3Dmol.Triangle(m2,p2a,m),face3=new $3Dmol.Triangle(m,p2a,p1a),lastAtom.intersectionShape.triangle.push(face1),lastAtom.intersectionShape.triangle.push(face2),lastAtom.intersectionShape.triangle.push(face3)),currentAtom.clickable&&(face1=new $3Dmol.Triangle(p1b,p2b,m),face2=new $3Dmol.Triangle(p2b,m2,m),face3=new $3Dmol.Triangle(p1b,m,m1),currentAtom.intersectionShape.triangle.push(face1),currentAtom.intersectionShape.triangle.push(face2),currentAtom.intersectionShape.triangle.push(face3))):(currentAtom.clickable&&(face1=new $3Dmol.Triangle(m1,m,p1a),face2=new $3Dmol.Triangle(m2,p2a,m),face3=new $3Dmol.Triangle(m,p2a,p1a),currentAtom.intersectionShape.triangle.push(face1),currentAtom.intersectionShape.triangle.push(face2),currentAtom.intersectionShape.triangle.push(face3)),lastAtom.clickable&&(face1=new $3Dmol.Triangle(p1b,p2b,m),face2=new $3Dmol.Triangle(p2b,m2,m),face3=new $3Dmol.Triangle(p1b,m,m1),lastAtom.intersectionShape.triangle.push(face1),
lastAtom.intersectionShape.triangle.push(face2),lastAtom.intersectionShape.triangle.push(face3)))}else currentAtom.clickable&&(face1=new $3Dmol.Triangle(p1b,p2b,p1a),face2=new $3Dmol.Triangle(p2b,p2a,p1a),currentAtom.intersectionShape.triangle.push(face1),currentAtom.intersectionShape.triangle.push(face2))}}}geoGroup.vertices+=8,lastAtom=currentAtom}var vsize=vs.length-8;geoGroup=geo.updateGeoGroup(8);var vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray,faceArray=geoGroup.faceArray;for(offset=geoGroup.vertices,vertoffset=3*offset,faceoffset=geoGroup.faceidx,i=0;4>i;i++){vs.push(vs[2*i]),vs.push(vs[vsize+2*i]);var v1=vs[2*i],v2=vs[vsize+2*i];vertexArray[vertoffset+6*i]=v1.x,vertexArray[vertoffset+1+6*i]=v1.y,vertexArray[vertoffset+2+6*i]=v1.z,vertexArray[vertoffset+3+6*i]=v2.x,vertexArray[vertoffset+4+6*i]=v2.y,vertexArray[vertoffset+5+6*i]=v2.z,colorArray[vertoffset+6*i]=color.r,colorArray[vertoffset+1+6*i]=color.g,colorArray[vertoffset+2+6*i]=color.b,colorArray[vertoffset+3+6*i]=color.r,colorArray[vertoffset+4+6*i]=color.g,colorArray[vertoffset+5+6*i]=color.b}vsize+=8,face1=[offset,offset+2,offset+6,offset+4],face2=[offset+1,offset+5,offset+7,offset+3],faceArray[faceoffset]=face1[0],faceArray[faceoffset+1]=face1[1],faceArray[faceoffset+2]=face1[3],faceArray[faceoffset+3]=face1[1],faceArray[faceoffset+4]=face1[2],faceArray[faceoffset+5]=face1[3],faceArray[faceoffset+6]=face2[0],faceArray[faceoffset+7]=face2[1],faceArray[faceoffset+8]=face2[3],faceArray[faceoffset+9]=face2[1],faceArray[faceoffset+10]=face2[2],faceArray[faceoffset+11]=face2[3],geoGroup.faceidx+=12,geoGroup.vertices+=8,geo.initTypedArrays(),geo.setUpNormals();var material=new $3Dmol.MeshDoubleLambertMaterial;material.vertexColors=$3Dmol.FaceColors,"number"==typeof opacity&&opacity>=0&&1>opacity&&(material.transparent=!0,material.opacity=opacity);var mesh=new $3Dmol.Mesh(geo,material);group.add(mesh)}},drawSmoothCurve=function(group,_points,width,colors,div){if(0!==_points.length){div=void 0===div?5:div;var geo=new $3Dmol.Geometry,lineMaterial=(subdivide(_points,div),new $3Dmol.LineBasicMaterial({linewidth:width}));lineMaterial.vertexColors=!0;var line=new $3Dmol.Line(geo,lineMaterial);line.type=$3Dmol.LineStrip,group.add(line)}},drawStrip=function(group,points,colors,div,thickness,opacity,shape){shape&&"default"!==shape||(shape="rectangle"),"edged"===shape?drawPlainStrip(group,points,colors,div,thickness,opacity):("rectangle"===shape||"oval"===shape||"parabola"===shape)&&drawShapeStrip(group,points,colors,div,thickness,opacity,shape)},isAlphaCarbon=function(atom){return atom&&"C"===atom.elem&&"CA"===atom.atom},inConnectedResidues=function(a,b){if(a&&b&&a.chain===b.chain){if(a.reschain===b.reschain&&(a.resi===b.resi||a.resi===b.resi-1))return!0;if(a.resi<b.resi){var av=new $3Dmol.Vector3(a.x,a.y,a.z),bv=new $3Dmol.Vector3(b.x,b.y,b.z),dist=av.distanceToSquared(bv);if(16>dist)return!0}}return!1},drawCartoon=function(group,atomList,gradientScheme,fill,doNotSmoothen,num,div){num=num||defaultNum,div=div||defaultDiv;for(var geo,cartoon,prev,curr,next,currColor,nextColor,thickness,i,arrow,backbonePt,orientPt,prevOrientPt,terminalPt,termOrientPt,baseStartPt,baseEndPt,tubeStart,tubeEnd,drawingTube,cartoonAtoms=["CA","O","P","OP2","O2P","O5'","O3'","C5'","C2'","O5*","O3*","C5*","C2*","N1","N3"],purResns=["DA","DG","A","G"],pyrResns=["DT","DC","U","C","T"],naResns=purResns.concat(pyrResns),traceGeo=null,colors=[],points=[],i=0;num>i;i++)points[i]=[];var inSheet=!1,inHelix=!1;i=0;for(i in atomList)if(next=atomList[i],"C"===next.elem&&"CA"===next.atom){var connected=inConnectedResidues(curr,next);connected&&"s"===next.ss?inSheet=!0:inSheet&&(curr&&prev&&curr.style.cartoon.arrows&&prev.style.cartoon.arrows&&(curr.ss="arrow end",prev.ss="arrow start"),inSheet=!1),connected&&"h"===curr.ss?(!inHelix&&next.style.cartoon.tubes&&(next.ss="tube start"),inHelix=!0):inHelix&&"tube start"!==curr.ss&&(prev&&prev.style.cartoon.tubes&&(prev.ss="tube end"),inHelix=!1),prev=curr,curr=next}curr=void 0;for(i in atomList)if(next=atomList[i],void 0!==next&&-1!==$.inArray(next.atom,cartoonAtoms)&&!next.hetflag){var inNucleicAcid=-1!=$.inArray(next.resn.trim(),naResns);if(cartoon=next.style.cartoon,"trace"===cartoon.style){if(traceGeo||(traceGeo=new $3Dmol.Geometry(!0)),"C"===next.elem&&"CA"===next.atom||inNucleicAcid&&"P"===next.atom){if(nextColor=gradientScheme&&"spectrum"===cartoon.color?gradientScheme.valueToHex(next.resi,gradientScheme.range()):$3Dmol.getColorFromStyle(next,cartoon).getHex(),colors.push(nextColor),thickness=$.isNumeric(cartoon.thickness)?cartoon.thickness:defaultThickness,inConnectedResidues(curr,next))if(nextColor==currColor){var color=$3Dmol.CC.color(nextColor);$3Dmol.GLDraw.drawCylinder(traceGeo,curr,next,thickness,color,2,2)}else{var midpoint=(new $3Dmol.Vector3).addVectors(curr,next).multiplyScalar(.5),color1=$3Dmol.CC.color(currColor),color2=$3Dmol.CC.color(nextColor);$3Dmol.GLDraw.drawCylinder(traceGeo,curr,midpoint,thickness,color1,2,0),$3Dmol.GLDraw.drawCylinder(traceGeo,midpoint,next,thickness,color2,0,2)}if(curr&&traceGeo&&(curr.style.cartoon&&"trace"!=curr.style.cartoon.style||curr.chain!=next.chain)){var traceMaterial=new $3Dmol.MeshDoubleLambertMaterial;traceMaterial.vertexColors=$3Dmol.FaceColors,"number"==typeof traceGeo.opacity&&traceGeo.opacity>=0&&traceGeo.opacity<1&&(traceMaterial.transparent=!0,traceMaterial.opacity=traceGeo.opacity,delete traceGeo.opacity);var traceMesh=new $3Dmol.Mesh(traceGeo,traceMaterial);group.add(traceMesh),traceGeo=null}else curr&&(traceGeo.opacity&&curr.style.cartoon.opacity?traceGeo.opacity!=curr.style.cartoon.opacity&&(console.log("Warning: a trace-style chain's opacity is ambiguous"),traceGeo.opacity=1):traceGeo.opacity=parseFloat(curr.style.cartoon.opacity)||1);curr=next,currColor=nextColor}}else{if(geo||(geo=new $3Dmol.Geometry(!0)),isAlphaCarbon(next)||inNucleicAcid&&("P"===next.atom||0==next.atom.indexOf("O5"))){if(drawingTube){if("tube end"!==next.ss)continue;drawingTube=!1,tubeEnd=new $3Dmol.Vector3(next.x,next.y,next.z),$3Dmol.GLDraw.drawCylinder(geo,tubeStart,tubeEnd,2,$3Dmol.CC.color(currColor),1,1),next.ss="h"}if(curr&&(!inConnectedResidues(curr,next)||curr.style.cartoon.style!==next.style.cartoon.style||"tube start"===curr.ss)){for("tube start"===curr.ss&&(drawingTube=!0,tubeStart=new $3Dmol.Vector3(curr.x,curr.y,curr.z),curr.ss="h"),baseEndPt&&(baseStartPt=terminalPt?(new $3Dmol.Vector3).addVectors(curr,terminalPt).multiplyScalar(.5):new $3Dmol.Vector3(curr.x,curr.y,curr.z),$3Dmol.GLDraw.drawCylinder(geo,baseStartPt,baseEndPt,.4,$3Dmol.CC.color(baseEndPt.color),0,2),arrow=addBackbonePoints(points,num,!doNotSmoothen,terminalPt,termOrientPt,prevOrientPt,curr,atomList,i),colors.push(nextColor),arrow&&colors.push(nextColor),baseStartPt=null,baseEndPt=null),i=0;!thickness&&num>i;i++)drawSmoothCurve(group,points[i],1,colors,div,points.opacity);if(fill&&points[0].length>0&&drawStrip(group,points,colors,div,thickness,points.opacity,points.style),null!=geo&&geo.vertices>0){var cartoonMaterial=new $3Dmol.MeshDoubleLambertMaterial;cartoonMaterial.vertexColors=$3Dmol.FaceColors,"number"==typeof points.opacity&&points.opacity>=0&&points.opacity<1&&(cartoonMaterial.transparent=!0,cartoonMaterial.opacity=points.opacity);var cartoonMesh=new $3Dmol.Mesh(geo,cartoonMaterial);group.add(cartoonMesh),geo=null}for(points=[],i=0;num>i;i++)points[i]=[];colors=[]}if(void 0===curr||curr.rescode!=next.rescode||curr.resi!=next.resi){if(baseEndPt){baseStartPt=(new $3Dmol.Vector3).addVectors(curr,next).multiplyScalar(.5);var startFix=baseStartPt.clone().sub(baseEndPt).multiplyScalar(.02);baseStartPt.add(startFix),$3Dmol.GLDraw.drawCylinder(geo,baseStartPt,baseEndPt,.4,$3Dmol.CC.color(baseEndPt.color),0,2),baseStartPt=null,baseEndPt=null}nextColor=gradientScheme&&"spectrum"===cartoon.color?gradientScheme.valueToHex(next.resi,gradientScheme.range()):$3Dmol.getColorFromStyle(next,cartoon).getHex(),colors.push(nextColor),thickness=$.isNumeric(cartoon.thickness)?cartoon.thickness:defaultThickness,curr=next,backbonePt=new $3Dmol.Vector3(curr.x,curr.y,curr.z),backbonePt.resi=curr.resi,currColor=nextColor}next.clickable!==!0||void 0!==next.intersectionShape&&void 0!==next.intersectionShape.triangle||(next.intersectionShape={sphere:null,cylinder:[],line:[],triangle:[]})}else isAlphaCarbon(curr)&&"O"===next.atom||inNucleicAcid&&"P"===curr.atom&&("OP2"===next.atom||"O2P"===next.atom)||inNucleicAcid&&0==curr.atom.indexOf("O5")&&0==next.atom.indexOf("C5")?(orientPt=new $3Dmol.Vector3(next.x,next.y,next.z),orientPt.resi=next.resi,("OP2"===next.atom||"O2P"===next.atom)&&(termOrientPt=new $3Dmol.Vector3(next.x,next.y,next.z))):inNucleicAcid&&0==next.atom.indexOf("O3")?terminalPt=new $3Dmol.Vector3(next.x,next.y,next.z):("N1"===next.atom&&-1!=$.inArray(next.resn.trim(),purResns)||"N3"===next.atom&&-1!=$.inArray(next.resn.trim(),pyrResns))&&(baseEndPt=new $3Dmol.Vector3(next.x,next.y,next.z),baseEndPt.color=$3Dmol.getColorFromStyle(next,cartoon).getHex());orientPt&&backbonePt&&orientPt.resi===backbonePt.resi&&(arrow=addBackbonePoints(points,num,!doNotSmoothen,backbonePt,orientPt,prevOrientPt,curr,atomList,i),prevOrientPt=orientPt,backbonePt=null,orientPt=null,colors.push(nextColor),arrow&&colors.push(nextColor))}}for(baseEndPt&&(baseStartPt=terminalPt?(new $3Dmol.Vector3).addVectors(curr,terminalPt).multiplyScalar(.5):new $3Dmol.Vector3(curr.x,curr.y,curr.z),$3Dmol.GLDraw.drawCylinder(geo,baseStartPt,baseEndPt,.4,$3Dmol.CC.color(baseEndPt.color),0,2),arrow=addBackbonePoints(points,num,!doNotSmoothen,terminalPt,termOrientPt,prevOrientPt,curr,atomList,i),colors.push(nextColor),arrow&&colors.push(nextColor)),i=0;!thickness&&num>i;i++)drawSmoothCurve(group,points[i],1,colors,div,points.opacity);if(fill&&points[0].length>0&&drawStrip(group,points,colors,div,thickness,points.opacity,points.style),null!=geo&&geo.vertices>0){var cartoonMaterial=new $3Dmol.MeshDoubleLambertMaterial;cartoonMaterial.vertexColors=$3Dmol.FaceColors,"number"==typeof points.opacity&&points.opacity>=0&&points.opacity<1&&(cartoonMaterial.transparent=!0,cartoonMaterial.opacity=points.opacity);var cartoonMesh=new $3Dmol.Mesh(geo,cartoonMaterial);group.add(cartoonMesh),geo=null}if(null!=traceGeo&&traceGeo.vertices>0){var traceMaterial=new $3Dmol.MeshDoubleLambertMaterial;traceMaterial.vertexColors=$3Dmol.FaceColors,"number"==typeof traceGeo.opacity&&traceGeo.opacity>=0&&traceGeo.opacity<1&&(traceMaterial.transparent=!0,traceMaterial.opacity=traceGeo.opacity,delete traceGeo.opacity);var traceMesh=new $3Dmol.Mesh(traceGeo,traceMaterial);group.add(traceMesh)}},addBackbonePoints=function(points,num,smoothen,backbonePt,orientPt,prevOrientPt,backboneAtom,atomList,atomi){var widthScalar,i,delta,v,addArrowPoints,testOpacity,testStyle,resSize={ALA:5,ARG:11,ASN:8,ASP:8,CYS:6,GLN:9,GLU:9,GLY:4,HIS:10,ILE:8,LEU:8,LYS:9,MET:8,PHE:11,PRO:7,SER:6,THR:7,TRP:14,TYR:12,VAL:7};if(backbonePt&&orientPt&&backboneAtom){var sideVec=orientPt.sub(backbonePt);sideVec.normalize();var forwardVec=atomList[parseInt(atomi)+resSize[backboneAtom.resn]];if(forwardVec=forwardVec?new $3Dmol.Vector3(forwardVec.x,forwardVec.y,forwardVec.z):new $3Dmol.Vector3(0,0,0),forwardVec.sub(backbonePt),"arrow start"===backboneAtom.ss){var adjustment=forwardVec.clone().multiplyScalar(.3).cross(orientPt);backbonePt.add(adjustment);var upVec=forwardVec.clone().cross(sideVec).normalize();sideVec.rotateAboutVector(upVec,.43)}for(backboneAtom.style.cartoon.ribbon?widthScalar=backboneAtom.style.cartoon.thickness||defaultThickness:backboneAtom.style.cartoon.width?widthScalar=backboneAtom.style.cartoon.width:"c"===backboneAtom.ss?widthScalar="P"===backboneAtom.atom?nucleicAcidWidth:coilWidth:"arrow start"===backboneAtom.ss?(widthScalar=helixSheetWidth,addArrowPoints=!0):widthScalar="arrow end"===backboneAtom.ss?coilWidth:"h"===backboneAtom.ss&&backboneAtom.style.cartoon.tubes||"tube start"===backboneAtom.ss?coilWidth:helixSheetWidth,null!=prevOrientPt&&sideVec.dot(prevOrientPt)<0&&sideVec.negate(),sideVec.multiplyScalar(widthScalar),i=0;num>i;i++)delta=-1+2*i/(num-1),v=new $3Dmol.Vector3(backbonePt.x+delta*sideVec.x,backbonePt.y+delta*sideVec.y,backbonePt.z+delta*sideVec.z),v.atom=backboneAtom,smoothen&&"s"===backboneAtom.ss&&(v.smoothen=!0),points[i].push(v);if(addArrowPoints)for(sideVec.multiplyScalar(2),i=0;num>i;i++)delta=-1+2*i/(num-1),v=new $3Dmol.Vector3(backbonePt.x+delta*sideVec.x,backbonePt.y+delta*sideVec.y,backbonePt.z+delta*sideVec.z),v.atom=backboneAtom,v.smoothen=!1,v.skip=!0,points[i].push(v);return testOpacity=parseFloat(backboneAtom.style.cartoon.opacity)||1,points.opacity?points.opacity!=testOpacity&&(console.log("Warning: a cartoon-style chain's opacity is ambiguous"),points.opacity=1):points.opacity=testOpacity,testStyle=backboneAtom.style.cartoon.style||"default",points.style?points.style!=testStyle&&(console.log("Warning: a cartoon chain's strand-style is ambiguous"),points.style="default"):points.style=testStyle,("arrow start"===backboneAtom.ss||"arrow end"===backboneAtom.ss)&&(backboneAtom.ss="s"),addArrowPoints}},defaultDrawCartoon=function(group,atomList,gradientScheme,quality){quality=parseInt(5*parseFloat(quality))||5,drawCartoon(group,atomList,gradientScheme,fill=!0,doNotSmoothen=!1,num=quality,div=quality)};return defaultDrawCartoon}();var $3Dmol=$3Dmol||{};$3Dmol.GLDraw=function(){var draw={},getRotationMatrix=function(){var d=new $3Dmol.Vector3;return function(dir){d.set(dir[0],dir[1],dir[2]);var dyz,sinA,cosA,sinB,cosB,dx=d.x,dy=d.y,dz=d.z,dxy=Math.sqrt(dx*dx+dy*dy);1e-4>dxy?(sinA=0,cosA=1):(sinA=-dx/dxy,cosA=dy/dxy),dy=-sinA*dx+cosA*dy,dyz=Math.sqrt(dy*dy+dz*dz),1e-4>dyz?(sinB=0,cosB=1):(sinB=dz/dyz,cosB=dy/dyz);var rot=new Float32Array(9);return rot[0]=cosA,rot[1]=sinA,rot[2]=0,rot[3]=-sinA*cosB,rot[4]=cosA*cosB,rot[5]=sinB,rot[6]=sinA*sinB,rot[7]=-cosA*sinB,rot[8]=cosB,rot}}(),basisVectors=function(){var j,nvecs=[],subdivisions=4,N=Math.pow(2,subdivisions),i=2,M=Math.pow(2,i),spacing=N/M;for(nvecs[0]=new $3Dmol.Vector3(-1,0,0),nvecs[spacing]=new $3Dmol.Vector3(0,0,1),nvecs[2*spacing]=new $3Dmol.Vector3(1,0,0),nvecs[3*spacing]=new $3Dmol.Vector3(0,0,-1),i=3;subdivisions>=i;i++){for(M=Math.pow(2,i-1),spacing=N/M,j=0;M-1>j;j++)nvecs[spacing/2+j*spacing]=nvecs[j*spacing].clone().add(nvecs[(j+1)*spacing]).normalize();j=M-1,nvecs[spacing/2+j*spacing]=nvecs[j*spacing].clone().add(nvecs[0]).normalize()}return nvecs}(),cylVertexCache={cache:{"false":{},"true":{}},getVerticesForRadius:function(radius,flat){if(void 0!==this.cache[flat][radius])return this.cache[flat][radius];for(var n,w=(new $3Dmol.Vector3(0,1,0),basisVectors.length),nvecs=[],norms=[],i=0;w>i;i++)nvecs.push(basisVectors[i].clone().multiplyScalar(radius)),nvecs.push(basisVectors[i].clone().multiplyScalar(radius)),n=basisVectors[i].clone().normalize(),norms.push(n),norms.push(n);var verticesRows=[],heightSegments=10,widthSegments=w;if(heightSegments%2!==0||!heightSegments)return console.error("heightSegments must be even"),null;var x,y,phiStart=0,phiLength=2*Math.PI,thetaStart=0,thetaLength=Math.PI,polar=!1,equator=!1;for(y=0;heightSegments>=y;y++){polar=0===y||y===heightSegments?!0:!1,equator=y===heightSegments/2?!0:!1;var verticesRow=[],toRow=[];for(x=0;widthSegments>=x;x++)if(equator){var xi=widthSegments>x?2*x:0;toRow.push(xi+1),verticesRow.push(xi)}else{var u=x/widthSegments,v=y/heightSegments;if(polar&&0!==x)polar&&verticesRow.push(nvecs.length-1);else if(widthSegments>x){var vertex=new $3Dmol.Vector3;vertex.x=-radius*Math.cos(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength),vertex.y=flat?0:radius*Math.cos(thetaStart+v*thetaLength),vertex.z=radius*Math.sin(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength),Math.abs(vertex.x)<1e-5&&(vertex.x=0),Math.abs(vertex.y)<1e-5&&(vertex.y=0),Math.abs(vertex.z)<1e-5&&(vertex.z=0),flat?(n=new $3Dmol.Vector3(0,Math.cos(thetaStart+v*thetaLength),0),n.normalize()):(n=new $3Dmol.Vector3(vertex.x,vertex.y,vertex.z),n.normalize()),nvecs.push(vertex),norms.push(n),verticesRow.push(nvecs.length-1)}else verticesRow.push(nvecs.length-widthSegments)}equator&&verticesRows.push(toRow),verticesRows.push(verticesRow)}var obj={vertices:nvecs,normals:norms,verticesRows:verticesRows,w:widthSegments,h:heightSegments};return this.cache[flat][radius]=obj,obj}},drawnC=0;draw.drawCylinder=function(geo,from,to,radius,color,fromCap,toCap){if(from&&to){drawnC++;var drawcaps=fromCap||toCap,flat=!1;1==fromCap&&1==toCap&&(flat=!0),color=color||{r:0,g:0,b:0};var dir=[to.x,to.y,to.z];dir[0]-=from.x,dir[1]-=from.y,dir[2]-=from.z;var offset,faceoffset,i,x,y,z,e=getRotationMatrix(dir),vobj=cylVertexCache.getVerticesForRadius(radius,flat),n=vobj.w,h=vobj.h,n_verts=drawcaps?h*n+2:2*n,geoGroup=geo.updateGeoGroup(n_verts),vertices=vobj.vertices,normals=vobj.normals,verticesRows=vobj.verticesRows,toRow=verticesRows[h/2],fromRow=verticesRows[h/2+1],start=geoGroup.vertices,vertexArray=geoGroup.vertexArray,normalArray=geoGroup.normalArray,colorArray=geoGroup.colorArray,faceArray=geoGroup.faceArray;for(i=0;n>i;++i){var vi=2*i;x=e[0]*vertices[vi].x+e[3]*vertices[vi].y+e[6]*vertices[vi].z,y=e[1]*vertices[vi].x+e[4]*vertices[vi].y+e[7]*vertices[vi].z,z=e[5]*vertices[vi].y+e[8]*vertices[vi].z,offset=3*(start+vi),faceoffset=geoGroup.faceidx,vertexArray[offset]=x+from.x,vertexArray[offset+1]=y+from.y,vertexArray[offset+2]=z+from.z,vertexArray[offset+3]=x+to.x,vertexArray[offset+4]=y+to.y,vertexArray[offset+5]=z+to.z,normalArray[offset]=x,normalArray[offset+3]=x,normalArray[offset+1]=y,normalArray[offset+4]=y,normalArray[offset+2]=z,normalArray[offset+5]=z,colorArray[offset]=color.r,colorArray[offset+3]=color.r,colorArray[offset+1]=color.g,colorArray[offset+4]=color.g,colorArray[offset+2]=color.b,colorArray[offset+5]=color.b,faceArray[faceoffset]=fromRow[i]+start,faceArray[faceoffset+1]=fromRow[i+1]+start,faceArray[faceoffset+2]=toRow[i]+start,faceArray[faceoffset+3]=toRow[i]+start,faceArray[faceoffset+4]=fromRow[i+1]+start,faceArray[faceoffset+5]=toRow[i+1]+start,geoGroup.faceidx+=6}if(drawcaps){var v1,v2,v3,v4,x1,x2,x3,x4,y1,y2,y3,y4,z1,z2,z3,z4,nx1,nx2,nx3,nx4,ny1,ny2,ny3,ny4,nz1,nz2,nz3,nz4,v1offset,v2offset,v3offset,v4offset,ystart=toCap?0:h/2,yend=fromCap?h+1:h/2+1;for(y=ystart;yend>y;y++)if(y!==h/2){var cap=h/2>=y?to:from;for(x=0;n>x;x++)faceoffset=geoGroup.faceidx,v1=verticesRows[y][x+1],v1offset=3*(v1+start),v2=verticesRows[y][x],v2offset=3*(v2+start),v3=verticesRows[y+1][x],v3offset=3*(v3+start),v4=verticesRows[y+1][x+1],v4offset=3*(v4+start),x1=e[0]*vertices[v1].x+e[3]*vertices[v1].y+e[6]*vertices[v1].z,x2=e[0]*vertices[v2].x+e[3]*vertices[v2].y+e[6]*vertices[v2].z,x3=e[0]*vertices[v3].x+e[3]*vertices[v3].y+e[6]*vertices[v3].z,x4=e[0]*vertices[v4].x+e[3]*vertices[v4].y+e[6]*vertices[v4].z,y1=e[1]*vertices[v1].x+e[4]*vertices[v1].y+e[7]*vertices[v1].z,y2=e[1]*vertices[v2].x+e[4]*vertices[v2].y+e[7]*vertices[v2].z,y3=e[1]*vertices[v3].x+e[4]*vertices[v3].y+e[7]*vertices[v3].z,y4=e[1]*vertices[v4].x+e[4]*vertices[v4].y+e[7]*vertices[v4].z,z1=e[5]*vertices[v1].y+e[8]*vertices[v1].z,z2=e[5]*vertices[v2].y+e[8]*vertices[v2].z,z3=e[5]*vertices[v3].y+e[8]*vertices[v3].z,z4=e[5]*vertices[v4].y+e[8]*vertices[v4].z,vertexArray[v1offset]=x1+cap.x,vertexArray[v2offset]=x2+cap.x,vertexArray[v3offset]=x3+cap.x,vertexArray[v4offset]=x4+cap.x,vertexArray[v1offset+1]=y1+cap.y,vertexArray[v2offset+1]=y2+cap.y,vertexArray[v3offset+1]=y3+cap.y,vertexArray[v4offset+1]=y4+cap.y,vertexArray[v1offset+2]=z1+cap.z,vertexArray[v2offset+2]=z2+cap.z,vertexArray[v3offset+2]=z3+cap.z,vertexArray[v4offset+2]=z4+cap.z,colorArray[v1offset]=color.r,colorArray[v2offset]=color.r,colorArray[v3offset]=color.r,colorArray[v4offset]=color.r,colorArray[v1offset+1]=color.g,colorArray[v2offset+1]=color.g,colorArray[v3offset+1]=color.g,colorArray[v4offset+1]=color.g,colorArray[v1offset+2]=color.b,colorArray[v2offset+2]=color.b,colorArray[v3offset+2]=color.b,colorArray[v4offset+2]=color.b,nx1=e[0]*normals[v1].x+e[3]*normals[v1].y+e[6]*normals[v1].z,nx2=e[0]*normals[v2].x+e[3]*normals[v2].y+e[6]*normals[v2].z,nx3=e[0]*normals[v3].x+e[3]*normals[v3].y+e[6]*normals[v3].z,nx4=e[0]*normals[v4].x+e[3]*normals[v4].y+e[6]*normals[v4].z,ny1=e[1]*normals[v1].x+e[4]*normals[v1].y+e[7]*normals[v1].z,ny2=e[1]*normals[v2].x+e[4]*normals[v2].y+e[7]*normals[v2].z,ny3=e[1]*normals[v3].x+e[4]*normals[v3].y+e[7]*normals[v3].z,ny4=e[1]*normals[v4].x+e[4]*normals[v4].y+e[7]*normals[v4].z,nz1=e[5]*normals[v1].y+e[8]*normals[v1].z,nz2=e[5]*normals[v2].y+e[8]*normals[v2].z,nz3=e[5]*normals[v3].y+e[8]*normals[v3].z,nz4=e[5]*normals[v4].y+e[8]*normals[v4].z,0===y?(normalArray[v1offset]=nx1,normalArray[v3offset]=nx3,normalArray[v4offset]=nx4,normalArray[v1offset+1]=ny1,normalArray[v3offset+1]=ny3,normalArray[v4offset+1]=ny4,normalArray[v1offset+2]=nz1,normalArray[v3offset+2]=nz3,normalArray[v4offset+2]=nz4,faceArray[faceoffset]=v1+start,faceArray[faceoffset+1]=v3+start,faceArray[faceoffset+2]=v4+start,geoGroup.faceidx+=3):y===yend-1?(normalArray[v1offset]=nx1,normalArray[v2offset]=nx2,normalArray[v3offset]=nx3,normalArray[v1offset+1]=ny1,normalArray[v2offset+1]=ny2,normalArray[v3offset+1]=ny3,normalArray[v1offset+2]=nz1,normalArray[v2offset+2]=nz2,normalArray[v3offset+2]=nz3,faceArray[faceoffset]=v1+start,faceArray[faceoffset+1]=v2+start,faceArray[faceoffset+2]=v3+start,geoGroup.faceidx+=3):(normalArray[v1offset]=nx1,normalArray[v2offset]=nx2,normalArray[v4offset]=nx4,normalArray[v1offset+1]=ny1,normalArray[v2offset+1]=ny2,normalArray[v4offset+1]=ny4,normalArray[v1offset+2]=nz1,normalArray[v2offset+2]=nz2,normalArray[v4offset+2]=nz4,normalArray[v2offset]=nx2,normalArray[v3offset]=nx3,normalArray[v4offset]=nx4,normalArray[v2offset+1]=ny2,normalArray[v3offset+1]=ny3,normalArray[v4offset+1]=ny4,normalArray[v2offset+2]=nz2,normalArray[v3offset+2]=nz3,normalArray[v4offset+2]=nz4,faceArray[faceoffset]=v1+start,faceArray[faceoffset+1]=v2+start,faceArray[faceoffset+2]=v4+start,faceArray[faceoffset+3]=v2+start,faceArray[faceoffset+4]=v3+start,faceArray[faceoffset+5]=v4+start,geoGroup.faceidx+=6)}}geoGroup.vertices+=n_verts}},draw.drawCone=function(geo,from,to,radius,color){if(from&&to){color=color||{r:0,g:0,b:0};var dir=[to.x,to.y,to.z];dir.x-=from.x,dir.y-=from.y,dir.z-=from.z;var offset,faceoffset,i,x,y,z,e=getRotationMatrix(dir),n=basisVectors.length,basis=basisVectors,n_verts=n+2,geoGroup=geo.updateGeoGroup(n_verts),start=geoGroup.vertices,vertexArray=geoGroup.vertexArray,normalArray=geoGroup.normalArray,colorArray=geoGroup.colorArray,faceArray=geoGroup.faceArray,offset=3*start,ndir=new $3Dmol.Vector3(dir[0],dir[1],dir[2]).normalize();for(vertexArray[offset]=from.x,vertexArray[offset+1]=from.y,vertexArray[offset+2]=from.z,normalArray[offset]=-ndir.x,normalArray[offset+1]=-ndir.y,normalArray[offset+2]=-ndir.z,colorArray[offset]=color.r,colorArray[offset+1]=color.g,colorArray[offset+2]=color.b,vertexArray[offset+3]=to.x,vertexArray[offset+4]=to.y,vertexArray[offset+5]=to.z,normalArray[offset+3]=ndir.x,normalArray[offset+4]=ndir.y,normalArray[offset+5]=ndir.z,colorArray[offset+3]=color.r,colorArray[offset+4]=color.g,colorArray[offset+5]=color.b,offset+=6,i=0;n>i;++i){var vec=basis[i].clone();vec.multiplyScalar(radius),x=e[0]*vec.x+e[3]*vec.y+e[6]*vec.z,y=e[1]*vec.x+e[4]*vec.y+e[7]*vec.z,z=e[5]*vec.y+e[8]*vec.z,vertexArray[offset]=x+from.x,vertexArray[offset+1]=y+from.y,vertexArray[offset+2]=z+from.z,normalArray[offset]=x,normalArray[offset+1]=y,normalArray[offset+2]=z,colorArray[offset]=color.r,colorArray[offset+1]=color.g,colorArray[offset+2]=color.b,offset+=3}geoGroup.vertices+=n+2;var faceoffset=geoGroup.faceidx;for(i=0;n>i;i++){var v1=start+2+i,v2=start+2+(i+1)%n;faceArray[faceoffset]=v1,faceArray[faceoffset+1]=v2,faceArray[faceoffset+2]=start,faceoffset+=3,faceArray[faceoffset]=v1,faceArray[faceoffset+1]=v2,faceArray[faceoffset+2]=start+1,faceoffset+=3}geoGroup.faceidx+=6*n}};var sphereVertexCache={cache:{},getVerticesForRadius:function(radius){if("undefined"!=typeof this.cache[radius])return this.cache[radius];var obj={vertices:[],verticesRows:[],normals:[]},sphereQuality=1,widthSegments=16*sphereQuality,heightSegments=10*sphereQuality;1>radius&&(widthSegments=10*sphereQuality,heightSegments=8*sphereQuality);var x,y,phiStart=0,phiLength=2*Math.PI,thetaStart=0,thetaLength=Math.PI;for(y=0;heightSegments>=y;y++){var verticesRow=[];for(x=0;widthSegments>=x;x++){var u=x/widthSegments,v=y/heightSegments,vertex={};vertex.x=-radius*Math.cos(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength),vertex.y=radius*Math.cos(thetaStart+v*thetaLength),vertex.z=radius*Math.sin(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength);var n=new $3Dmol.Vector3(vertex.x,vertex.y,vertex.z);n.normalize(),obj.vertices.push(vertex),obj.normals.push(n),verticesRow.push(obj.vertices.length-1)}obj.verticesRows.push(verticesRow)}return this.cache[radius]=obj,obj}};return draw.drawSphere=function(geo,pos,radius,color){for(var x,y,vobj=(new $3Dmol.Vector3(pos.x,pos.y,pos.z),sphereVertexCache.getVerticesForRadius(radius)),vertices=vobj.vertices,normals=vobj.normals,geoGroup=geo.updateGeoGroup(vertices.length),start=geoGroup.vertices,vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray,faceArray=geoGroup.faceArray,lineArray=geoGroup.lineArray,normalArray=geoGroup.normalArray,i=0,il=vertices.length;il>i;++i){var offset=3*(start+i),v=vertices[i];vertexArray[offset]=v.x+pos.x,vertexArray[offset+1]=v.y+pos.y,vertexArray[offset+2]=v.z+pos.z,colorArray[offset]=color.r,colorArray[offset+1]=color.g,colorArray[offset+2]=color.b}geoGroup.vertices+=vertices.length;var verticesRows=vobj.verticesRows,h=verticesRows.length-1;for(y=0;h>y;y++){var w=verticesRows[y].length-1;for(x=0;w>x;x++){var faceoffset=geoGroup.faceidx,lineoffset=geoGroup.lineidx,v1=verticesRows[y][x+1]+start,v1offset=3*v1,v2=verticesRows[y][x]+start,v2offset=3*v2,v3=verticesRows[y+1][x]+start,v3offset=3*v3,v4=verticesRows[y+1][x+1]+start,v4offset=3*v4,n1=normals[v1-start],n2=normals[v2-start],n3=normals[v3-start],n4=normals[v4-start];Math.abs(vertices[v1-start].y)===radius?(normalArray[v1offset]=n1.x,normalArray[v3offset]=n3.x,normalArray[v4offset]=n4.x,normalArray[v1offset+1]=n1.y,normalArray[v3offset+1]=n3.y,normalArray[v4offset+1]=n4.y,normalArray[v1offset+2]=n1.z,normalArray[v3offset+2]=n3.z,normalArray[v4offset+2]=n4.z,faceArray[faceoffset]=v1,faceArray[faceoffset+1]=v3,faceArray[faceoffset+2]=v4,lineArray[lineoffset]=v1,lineArray[lineoffset+1]=v3,lineArray[lineoffset+2]=v1,lineArray[lineoffset+3]=v4,lineArray[lineoffset+4]=v3,lineArray[lineoffset+5]=v4,geoGroup.faceidx+=3,geoGroup.lineidx+=6):Math.abs(vertices[v3-start].y)===radius?(normalArray[v1offset]=n1.x,normalArray[v2offset]=n2.x,normalArray[v3offset]=n3.x,normalArray[v1offset+1]=n1.y,normalArray[v2offset+1]=n2.y,normalArray[v3offset+1]=n3.y,normalArray[v1offset+2]=n1.z,normalArray[v2offset+2]=n2.z,normalArray[v3offset+2]=n3.z,faceArray[faceoffset]=v1,faceArray[faceoffset+1]=v2,faceArray[faceoffset+2]=v3,lineArray[lineoffset]=v1,lineArray[lineoffset+1]=v2,lineArray[lineoffset+2]=v1,lineArray[lineoffset+3]=v3,lineArray[lineoffset+4]=v2,lineArray[lineoffset+5]=v3,geoGroup.faceidx+=3,geoGroup.lineidx+=6):(normalArray[v1offset]=n1.x,normalArray[v2offset]=n2.x,normalArray[v4offset]=n4.x,normalArray[v1offset+1]=n1.y,normalArray[v2offset+1]=n2.y,normalArray[v4offset+1]=n4.y,normalArray[v1offset+2]=n1.z,normalArray[v2offset+2]=n2.z,normalArray[v4offset+2]=n4.z,normalArray[v2offset]=n2.x,normalArray[v3offset]=n3.x,normalArray[v4offset]=n4.x,normalArray[v2offset+1]=n2.y,normalArray[v3offset+1]=n3.y,normalArray[v4offset+1]=n4.y,normalArray[v2offset+2]=n2.z,normalArray[v3offset+2]=n3.z,normalArray[v4offset+2]=n4.z,faceArray[faceoffset]=v1,faceArray[faceoffset+1]=v2,faceArray[faceoffset+2]=v4,faceArray[faceoffset+3]=v2,faceArray[faceoffset+4]=v3,faceArray[faceoffset+5]=v4,lineArray[lineoffset]=v1,lineArray[lineoffset+1]=v2,lineArray[lineoffset+2]=v1,lineArray[lineoffset+3]=v4,lineArray[lineoffset+4]=v2,lineArray[lineoffset+5]=v3,lineArray[lineoffset+6]=v3,lineArray[lineoffset+7]=v4,geoGroup.faceidx+=6,geoGroup.lineidx+=8)}}},draw}();var $3Dmol=$3Dmol||{};$3Dmol.GLModel=function(){function GLModel(mid,defaultcolors){var dontDuplicateAtoms,atoms=[],frames=[],id=mid,hidden=!1,molObj=null,renderedMolObj=null,lastColors=null,modelData={},idMatrix=new $3Dmol.Matrix4,defaultColor=$3Dmol.elementColors.defaultColor,ElementColors=defaultcolors?defaultcolors:$3Dmol.elementColors.defaultColors,defaultSphereRadius=1.5,getRadiusFromStyle=function(atom,style){var r=defaultSphereRadius;return"undefined"!=typeof style.radius?r=style.radius:vdwRadii[atom.elem]&&(r=vdwRadii[atom.elem]),"undefined"!=typeof style.scale&&(r*=style.scale),r},drawAtomCross=function(atom,geos){if(atom.style.cross){var style=atom.style.cross;if(!style.hidden){var linewidth=style.linewidth||defaultlineWidth;geos[linewidth]||(geos[linewidth]=new $3Dmol.Geometry);var geoGroup=geos[linewidth].updateGeoGroup(6),delta=getRadiusFromStyle(atom,style),points=[[delta,0,0],[-delta,0,0],[0,delta,0],[0,-delta,0],[0,0,delta],[0,0,-delta]],clickable=atom.clickable;clickable&&void 0===atom.intersectionShape&&(atom.intersectionShape={sphere:[],cylinder:[],line:[]});for(var c=$3Dmol.getColorFromStyle(atom,style),vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray,j=0;6>j;j++){var offset=3*geoGroup.vertices;if(geoGroup.vertices++,vertexArray[offset]=atom.x+points[j][0],vertexArray[offset+1]=atom.y+points[j][1],vertexArray[offset+2]=atom.z+points[j][2],colorArray[offset]=c.r,colorArray[offset+1]=c.g,colorArray[offset+2]=c.b,clickable){var point=new $3Dmol.Vector3(points[j][0],points[j][1],points[j][2]);point.multiplyScalar(.1),point.set(point.x+atom.x,point.y+atom.y,point.z+atom.z),atom.intersectionShape.line.push(point)}}}}},getSideBondV=function(atom,atom2,i){var p1=new $3Dmol.Vector3(atom.x,atom.y,atom.z),p2=new $3Dmol.Vector3(atom2.x,atom2.y,atom2.z),dir=p2.clone(),v=null;dir.sub(p1);var i2,j2,atom3,p3,dir2;return 1===atom.bonds.length?1===atom2.bonds.length?(v=dir.clone(),Math.abs(v.x)>1e-4?v.y+=1:v.x+=1):(i2=(i+1)%atom2.bonds.length,j2=atom2.bonds[i2],atom3=atoms[j2],p3=new $3Dmol.Vector3(atom3.x,atom3.y,atom3.z),dir2=p3.clone(),dir2.sub(p1),v=dir2.clone(),v.cross(dir)):(i2=(i+1)%atom.bonds.length,j2=atom.bonds[i2],atom3=atoms[j2],p3=new $3Dmol.Vector3(atom3.x,atom3.y,atom3.z),dir2=p3.clone(),dir2.sub(p1),v=dir2.clone(),v.cross(dir)),v.lengthSq()<.01&&(v=dir.clone(),Math.abs(v.x)>1e-4?v.y+=1:v.x+=1),v.cross(dir),v.normalize(),v},addLine=function(vertexArray,colorArray,offset,p1,p2,c1){vertexArray[offset]=p1.x,vertexArray[offset+1]=p1.y,vertexArray[offset+2]=p1.z,colorArray[offset]=c1.r,colorArray[offset+1]=c1.g,colorArray[offset+2]=c1.b,vertexArray[offset+3]=p2.x,vertexArray[offset+4]=p2.y,vertexArray[offset+5]=p2.z,colorArray[offset+3]=c1.r,colorArray[offset+4]=c1.g,colorArray[offset+5]=c1.b},drawBondLines=function(atom,atoms,geos){if(atom.style.line){var style=atom.style.line;if(!style.hidden){var linewidth=style.linewidth||defaultlineWidth;geos[linewidth]||(geos[linewidth]=new $3Dmol.Geometry);for(var geoGroup=geos[linewidth].updateGeoGroup(6*atom.bonds.length),vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray,i=0;i<atom.bonds.length;i++){var j=atom.bonds[i],atom2=atoms[j];if(atom2.style.line&&!(atom.serial>=atom2.serial)){var p1=new $3Dmol.Vector3(atom.x,atom.y,atom.z),p2=new $3Dmol.Vector3(atom2.x,atom2.y,atom2.z),mp=p1.clone().add(p2).multiplyScalar(.5),singleBond=!1;atom.clickable&&(void 0===atom.intersectionShape&&(atom.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),atom.intersectionShape.line.push(p1),atom.intersectionShape.line.push(p2));var c1=$3Dmol.getColorFromStyle(atom,atom.style.line),c2=$3Dmol.getColorFromStyle(atom2,atom2.style.line);if(atom.bondStyles&&atom.bondStyles[i]){var bstyle=atom.bondStyles[i];if(!bstyle.iswire)continue;bstyle.radius&&(bondR=bstyle.radius),bstyle.singleBond&&(singleBond=!0),"undefined"!=typeof bstyle.color1&&(c1=$3Dmol.CC.color(bstyle.color1)),"undefined"!=typeof bstyle.color2&&(c2=$3Dmol.CC.color(bstyle.color2));
}var offset=3*geoGroup.vertices;if(atom.bondOrder[i]>1&&atom.bondOrder[i]<4&&!singleBond){var v=getSideBondV(atom,atom2,i),dir=p2.clone();if(dir.sub(p1),2==atom.bondOrder[i])if(v.multiplyScalar(.1),p1a=p1.clone(),p1a.add(v),p1b=p1.clone(),p1b.sub(v),p2a=p1a.clone(),p2a.add(dir),p2b=p1b.clone(),p2b.add(dir),c1==c2)geoGroup.vertices+=4,addLine(vertexArray,colorArray,offset,p1a,p2a,c1),addLine(vertexArray,colorArray,offset+6,p1b,p2b,c1);else{geoGroup.vertices+=8,dir.multiplyScalar(.5);var mpa=p1a.clone();mpa.add(dir);var mpb=p1b.clone();mpb.add(dir),addLine(vertexArray,colorArray,offset,p1a,mpa,c1),addLine(vertexArray,colorArray,offset+6,mpa,p2a,c2),addLine(vertexArray,colorArray,offset+12,p1b,mpb,c1),addLine(vertexArray,colorArray,offset+18,mpb,p2b,c2)}else if(3==atom.bondOrder[i])if(v.multiplyScalar(.1),p1a=p1.clone(),p1a.add(v),p1b=p1.clone(),p1b.sub(v),p2a=p1a.clone(),p2a.add(dir),p2b=p1b.clone(),p2b.add(dir),c1==c2)geoGroup.vertices+=6,addLine(vertexArray,colorArray,offset,p1,p2,c1),addLine(vertexArray,colorArray,offset+6,p1a,p2a,c1),addLine(vertexArray,colorArray,offset+12,p1b,p2b,c1);else{geoGroup.vertices+=12,dir.multiplyScalar(.5);var mpa=p1a.clone();mpa.add(dir);var mpb=p1b.clone();mpb.add(dir),addLine(vertexArray,colorArray,offset,p1,mp,c1),addLine(vertexArray,colorArray,offset+6,mp,p2,c2),addLine(vertexArray,colorArray,offset+12,p1a,mpa,c1),addLine(vertexArray,colorArray,offset+18,mpa,p2a,c2),addLine(vertexArray,colorArray,offset+24,p1b,mpb,c1),addLine(vertexArray,colorArray,offset+30,mpb,p2b,c2)}}else c1==c2?(geoGroup.vertices+=2,addLine(vertexArray,colorArray,offset,p1,p2,c1)):(geoGroup.vertices+=4,addLine(vertexArray,colorArray,offset,p1,mp,c1),addLine(vertexArray,colorArray,offset+6,mp,p2,c2))}}}}},defaultStickRadius=.25,drawAtomSphere=function(atom,geo){if(atom.style.sphere){var style=atom.style.sphere;if(!style.hidden){var C=$3Dmol.getColorFromStyle(atom,style),radius=getRadiusFromStyle(atom,style);if(atom.clickable===!0&&void 0!==atom.intersectionShape){var center=new $3Dmol.Vector3(atom.x,atom.y,atom.z);atom.intersectionShape.sphere.push(new $3Dmol.Sphere(center,radius))}$3Dmol.GLDraw.drawSphere(geo,atom,radius,C)}}},drawAtomImposter=function(atom,geo){if(atom.style.spherei){var style=atom.style.spherei;if(!style.hidden){for(var radius=getRadiusFromStyle(atom,style),C=$3Dmol.getColorFromStyle(atom,style),geoGroup=geo.updateGeoGroup(4),startv=geoGroup.vertices,start=3*startv,vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray,i=0;4>i;i++)vertexArray[start+3*i]=atom.x,vertexArray[start+3*i+1]=atom.y,vertexArray[start+3*i+2]=atom.z;for(var normalArray=geoGroup.normalArray,colorArray=geoGroup.colorArray,i=0;4>i;i++)colorArray[start+3*i]=C.r,colorArray[start+3*i+1]=C.g,colorArray[start+3*i+2]=C.b;normalArray[start+0]=-radius,normalArray[start+1]=radius,normalArray[start+2]=0,normalArray[start+3]=-radius,normalArray[start+4]=-radius,normalArray[start+5]=0,normalArray[start+6]=radius,normalArray[start+7]=-radius,normalArray[start+8]=0,normalArray[start+9]=radius,normalArray[start+10]=radius,normalArray[start+11]=0,geoGroup.vertices+=4;var faceArray=geoGroup.faceArray,faceoffset=geoGroup.faceidx;faceArray[faceoffset+0]=startv,faceArray[faceoffset+1]=startv+1,faceArray[faceoffset+2]=startv+2,faceArray[faceoffset+3]=startv+2,faceArray[faceoffset+4]=startv+3,faceArray[faceoffset+5]=startv,geoGroup.faceidx+=6}}},drawBondSticks=function(atom,atoms,geo){if(atom.style.stick){var style=atom.style.stick;if(!style.hidden){var mp,mp2,atomBondR=style.radius||defaultStickRadius,bondR=atomBondR,atomSingleBond=style.singleBonds||!1,fromCap=0,toCap=0,C1=$3Dmol.getColorFromStyle(atom,style);!atom.capDrawn&&atom.bonds.length<4&&(fromCap=2);for(var i=0;i<atom.bonds.length;i++){var j=atom.bonds[i],atom2=atoms[j];if(atom.serial<atom2.serial){var style2=atom2.style;if(!style2.stick)continue;var C2=$3Dmol.getColorFromStyle(atom2,style2.stick);bondR=atomBondR;var singleBond=atomSingleBond;if(atom.bondStyles&&atom.bondStyles[i]){var bstyle=atom.bondStyles[i];if(bstyle.iswire)continue;bstyle.radius&&(bondR=bstyle.radius),bstyle.singleBond&&(singleBond=!0),"undefined"!=typeof bstyle.color1&&(C1=$3Dmol.CC.color(bstyle.color1)),"undefined"!=typeof bstyle.color2&&(C2=$3Dmol.CC.color(bstyle.color2))}var p1=new $3Dmol.Vector3(atom.x,atom.y,atom.z),p2=new $3Dmol.Vector3(atom2.x,atom2.y,atom2.z);if(1===atom.bondOrder[i]||singleBond){if(!atom2.capDrawn&&atom2.bonds.length<4&&(toCap=2),C1!=C2?(mp=(new $3Dmol.Vector3).addVectors(p1,p2).multiplyScalar(.5),$3Dmol.GLDraw.drawCylinder(geo,p1,mp,bondR,C1,fromCap,0),$3Dmol.GLDraw.drawCylinder(geo,mp,p2,bondR,C2,0,toCap)):$3Dmol.GLDraw.drawCylinder(geo,p1,p2,bondR,C1,fromCap,toCap),atom.clickable||atom2.clickable){if(mp=(new $3Dmol.Vector3).addVectors(p1,p2).multiplyScalar(.5),atom.clickable){var cylinder1=new $3Dmol.Cylinder(p1,mp,bondR),sphere1=new $3Dmol.Sphere(p1,bondR);atom.intersectionShape.cylinder.push(cylinder1),atom.intersectionShape.sphere.push(sphere1)}if(atom2.clickable){var cylinder2=new $3Dmol.Cylinder(p2,mp,bondR),sphere2=new $3Dmol.Sphere(p2,bondR);atom2.intersectionShape.cylinder.push(cylinder2),atom2.intersectionShape.sphere.push(sphere2)}}}else if(atom.bondOrder[i]>1){var mfromCap=0;mtoCap=0,bondR!=atomBondR&&(mfromCap=2,mtoCap=2);var dir=p2.clone(),v=null;dir.sub(p1);var r,p1a,p1b,p2a,p2b,v=getSideBondV(atom,atom2,i);if(2==atom.bondOrder[i]){var r=bondR/2.5,v=getSideBondV(atom,atom2,i);v.multiplyScalar(1.5*r),p1a=p1.clone(),p1a.add(v),p1b=p1.clone(),p1b.sub(v),p2a=p1a.clone(),p2a.add(dir),p2b=p1b.clone(),p2b.add(dir),C1!=C2?(mp=(new $3Dmol.Vector3).addVectors(p1a,p2a).multiplyScalar(.5),mp2=(new $3Dmol.Vector3).addVectors(p1b,p2b).multiplyScalar(.5),$3Dmol.GLDraw.drawCylinder(geo,p1a,mp,r,C1,mfromCap,0),$3Dmol.GLDraw.drawCylinder(geo,mp,p2a,r,C2,0,mtoCap),$3Dmol.GLDraw.drawCylinder(geo,p1b,mp2,r,C1,mfromCap,0),$3Dmol.GLDraw.drawCylinder(geo,mp2,p2b,r,C2,0,mtoCap)):($3Dmol.GLDraw.drawCylinder(geo,p1a,p2a,r,C1,mfromCap,mtoCap),$3Dmol.GLDraw.drawCylinder(geo,p1b,p2b,r,C1,mfromCap,mtoCap)),(atom.clickable||atom2.clickable)&&(mp=(new $3Dmol.Vector3).addVectors(p1a,p2a).multiplyScalar(.5),mp2=(new $3Dmol.Vector3).addVectors(p1b,p2b).multiplyScalar(.5),atom.clickable&&(cylinder1a=new $3Dmol.Cylinder(p1a,mp,r),cylinder1b=new $3Dmol.Cylinder(p1b,mp2,r),atom.intersectionShape.cylinder.push(cylinder1a),atom.intersectionShape.cylinder.push(cylinder1b)),atom2.clickable&&(cylinder2a=new $3Dmol.Cylinder(p2a,mp,r),cylinder2b=new $3Dmol.Cylinder(p2b,mp2,r),atom2.intersectionShape.cylinder.push(cylinder2a),atom2.intersectionShape.cylinder.push(cylinder2b)))}else 3==atom.bondOrder[i]&&(r=bondR/4,v.cross(dir),v.normalize(),v.multiplyScalar(3*r),p1a=p1.clone(),p1a.add(v),p1b=p1.clone(),p1b.sub(v),p2a=p1a.clone(),p2a.add(dir),p2b=p1b.clone(),p2b.add(dir),C1!=C2?(mp=(new $3Dmol.Vector3).addVectors(p1a,p2a).multiplyScalar(.5),mp2=(new $3Dmol.Vector3).addVectors(p1b,p2b).multiplyScalar(.5),mp3=(new $3Dmol.Vector3).addVectors(p1,p2).multiplyScalar(.5),$3Dmol.GLDraw.drawCylinder(geo,p1a,mp,r,C1,mfromCap,0),$3Dmol.GLDraw.drawCylinder(geo,mp,p2a,r,C2,0,mtoCap),$3Dmol.GLDraw.drawCylinder(geo,p1,mp3,r,C1,fromCap,0),$3Dmol.GLDraw.drawCylinder(geo,mp3,p2,r,C2,0,toCap),$3Dmol.GLDraw.drawCylinder(geo,p1b,mp2,r,C1,mfromCap,0),$3Dmol.GLDraw.drawCylinder(geo,mp2,p2b,r,C2,0,mtoCap)):($3Dmol.GLDraw.drawCylinder(geo,p1a,p2a,r,C1,mfromCap,mtoCap),$3Dmol.GLDraw.drawCylinder(geo,p1,p2,r,C1,fromCap,toCap),$3Dmol.GLDraw.drawCylinder(geo,p1b,p2b,r,C1,mfromCap,mtoCap)),(atom.clickable||atom2.clickable)&&(mp=(new $3Dmol.Vector3).addVectors(p1a,p2a).multiplyScalar(.5),mp2=(new $3Dmol.Vector3).addVectors(p1b,p2b).multiplyScalar(.5),mp3=(new $3Dmol.Vector3).addVectors(p1,p2).multiplyScalar(.5),atom.clickable&&(cylinder1a=new $3Dmol.Cylinder(p1a.clone(),mp.clone(),r),cylinder1b=new $3Dmol.Cylinder(p1b.clone(),mp2.clone(),r),cylinder1c=new $3Dmol.Cylinder(p1.clone(),mp3.clone(),r),atom.intersectionShape.cylinder.push(cylinder1a),atom.intersectionShape.cylinder.push(cylinder1b),atom.intersectionShape.cylinder.push(cylinder1c)),atom2.clickable&&(cylinder2a=new $3Dmol.Cylinder(p2a.clone(),mp.clone(),r),cylinder2b=new $3Dmol.Cylinder(p2b.clone(),mp2.clone(),r),cylinder2c=new $3Dmol.Cylinder(p2.clone(),mp3.clone(),r),atom2.intersectionShape.cylinder.push(cylinder2a),atom2.intersectionShape.cylinder.push(cylinder2b),atom2.intersectionShape.cylinder.push(cylinder2c))))}}}for(var drawSphere=!1,numsinglebonds=0,differentradii=!1,i=0;i<atom.bonds.length;i++){var singleBond=atomSingleBond;if(atom.bondStyles&&atom.bondStyles[i]){var bstyle=atom.bondStyles[i];bstyle.singleBond&&(singleBond=!0),bstyle.radius&&bstyle.radius!=atomBondR&&(differentradii=!0)}(singleBond||1==atom.bondOrder[i])&&numsinglebonds++}if(differentradii?numsinglebonds>0&&(drawSphere=!0):0==numsinglebonds&&atom.bonds.length>0&&(drawSphere=!0),drawSphere){atom.style;bondR=atomBondR,$3Dmol.GLDraw.drawSphere(geo,atom,bondR,C1)}}}},createMolObj=function(atoms){var i,j,n,testOpacities,ret=new $3Dmol.Object3D,cartoonAtoms=[],lineGeometries={},crossGeometries={},sphereGeometry=new $3Dmol.Geometry(!0),imposterGeometry=new $3Dmol.Geometry(!0),stickGeometry=new $3Dmol.Geometry(!0),opacities={},range=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(i=0,n=atoms.length;n>i;i++){var atom=atoms[i];if(atom&&atom.style){atom.clickable&&void 0===atom.intersectionShape&&(atom.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),testOpacities={line:void 0,cross:void 0,stick:void 0,sphere:void 0};for(j in testOpacities)atom.style[j]?atom.style[j].opacity?testOpacities[j]=parseFloat(atom.style[j].opacity):testOpacities[j]=1:testOpacities[j]=void 0,opacities[j]?void 0!=testOpacities[j]&&opacities[j]!=testOpacities[j]&&(console.log("Warning: "+j+" opacity is ambiguous"),opacities[j]=1):opacities[j]=testOpacities[j];drawAtomSphere(atom,sphereGeometry),drawAtomImposter(atom,imposterGeometry),drawAtomCross(atom,crossGeometries),drawBondLines(atom,atoms,lineGeometries),drawBondSticks(atom,atoms,stickGeometry),"undefined"==typeof atom.style.cartoon||atom.style.cartoon.hidden||("spectrum"!==atom.style.cartoon.color||"number"!=typeof atom.resi||atom.hetflag||(atom.resi<range[0]&&(range[0]=atom.resi),atom.resi>range[1]&&(range[1]=atom.resi)),cartoonAtoms.push(atom))}}if(cartoonAtoms.length>0){var gradientscheme=null;range[0]<range[1]&&(gradientscheme=new $3Dmol.Gradient.Sinebow(range[0],range[1])),$3Dmol.drawCartoon(ret,cartoonAtoms,gradientscheme)}if(sphereGeometry.vertices>0){var sphereMaterial=new $3Dmol.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0});opacities.sphere<1&&opacities.sphere>=0&&(sphereMaterial.transparent=!0,sphereMaterial.opacity=opacities.sphere),sphereGeometry.initTypedArrays();var sphere=new $3Dmol.Mesh(sphereGeometry,sphereMaterial);ret.add(sphere)}if(imposterGeometry.vertices>0){var imposterMaterial=new $3Dmol.ImposterMaterial({ambient:0,vertexColors:!0,reflectivity:0});imposterGeometry.initTypedArrays();var spherei=new $3Dmol.Mesh(imposterGeometry,imposterMaterial);console.log("spherei geometry "+imposterGeometry.vertices.length),ret.add(spherei)}if(stickGeometry.vertices>0){var cylinderMaterial=new $3Dmol.MeshLambertMaterial({vertexColors:!0,ambient:0,reflectivity:0});opacities.stick<1&&opacities.stick>=0&&(cylinderMaterial.transparent=!0,cylinderMaterial.opacity=opacities.stick),stickGeometry.initTypedArrays(),cylinderMaterial.wireframe&&stickGeometry.setUpWireframe();var sticks=new $3Dmol.Mesh(stickGeometry,cylinderMaterial);ret.add(sticks)}for(i in lineGeometries)if(lineGeometries.hasOwnProperty(i)){var linewidth=i,lineMaterial=new $3Dmol.LineBasicMaterial({linewidth:linewidth,vertexColors:!0});opacities.line<1&&opacities.line>=0&&(lineMaterial.transparent=!0,lineMaterial.opacity=opacities.line),lineGeometries[i].initTypedArrays();var line=new $3Dmol.Line(lineGeometries[i],lineMaterial,$3Dmol.LinePieces);ret.add(line)}for(i in crossGeometries)if(crossGeometries.hasOwnProperty(i)){var linewidth=i,crossMaterial=new $3Dmol.LineBasicMaterial({linewidth:linewidth,vertexColors:!0});opacities.cross<1&&opacities.cross>=0&&(crossMaterial.transparent=!0,crossMaterial.opacity=opacities.cross),crossGeometries[i].initTypedArrays();var cross=new $3Dmol.Line(crossGeometries[i],crossMaterial,$3Dmol.LinePieces);ret.add(cross)}if(dontDuplicateAtoms&&modelData.symmetries&&modelData.symmetries.length>0){var t,finalRet=new $3Dmol.Object3D;for(t=0;t<modelData.symmetries.length;t++){var transformedRet=new $3Dmol.Object3D;transformedRet=ret.clone(),transformedRet.matrix.copy(modelData.symmetries[t]),transformedRet.matrixAutoUpdate=!1,finalRet.add(transformedRet)}return finalRet}return ret};this.getCrystData=function(){return modelData.cryst?modelData.cryst:null},this.getSymmetries=function(){return"undefined"==typeof modelData.symmetries&&(modelData.symmetries=[idMatrix]),modelData.symmetries},this.setSymmetries=function(list){"undefined"==typeof list?modelData.symmetries=[idMatrix]:modelData.symmetries=list},this.getID=function(){return id},this.getFrames=function(){return frames},this.setFrame=function(framenum){0!=frames.length&&(atoms=framenum>=0&&framenum<frames.length?frames[framenum]:frames[frames.length-1],molObj=null)},this.addFrame=function(atoms){frames.push(atoms)},this.vibrate=function(numFrames,amplitude){for(var vectors=[],amplitude=amplitude||1,numFrames=numFrames||10,i=0;i<atoms.length;i++){var vector=new $3Dmol.Vector3(atoms[i].dx,atoms[i].dy,atoms[i].dz);vectors.push(vector)}numFrames--;for(var i=1;numFrames>=i;i++){for(var newAtoms=[],j=0;j<atoms.length;j++){var newVector=new $3Dmol.Vector3(atoms[j].dx,atoms[j].dy,atoms[j].dz),starting=new $3Dmol.Vector3(atoms[j].x,atoms[j].y,atoms[j].z);newVector.sub(starting),newVector.multiplyScalar(i*amplitude/numFrames),starting.add(newVector);var newAtom={};for(var k in atoms[j])newAtom[k]=atoms[j][k];newAtom.x=starting.x,newAtom.y=starting.y,newAtom.z=starting.z,newAtoms.push(newAtom)}frames.push(newAtoms)}frames.unshift(atoms)},this.setAtomDefaults=function(atoms){for(var i=0;i<atoms.length;i++){var atom=atoms[i];atom&&(atom.style=atom.style||defaultAtomStyle,atom.color=atom.color||ElementColors[atom.elem]||defaultColor,atom.model=id,atom.clickable&&(atom.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}))}},this.addMolData=function(data,format,options){options=options||{};var parsedAtoms=$3Dmol.GLModel.parseMolData(data,format,options);dontDuplicateAtoms=!options.duplicateAssemblyAtoms;var mData=parsedAtoms.modelData;if(mData&&(modelData=Array.isArray(mData)?mData[0]:mData),0==frames.length){for(var i=0;i<parsedAtoms.length;i++)0!=parsedAtoms[i].length&&frames.push(parsedAtoms[i]);frames[0]&&(atoms=frames[0])}else if(options.frames)for(var i=0;i<parsedAtoms.length;i++)frames.push(parsedAtoms[i]);else for(var i=0;i<parsedAtoms.length;i++)this.addAtoms(parsedAtoms[i]);for(var i=0;i<frames.length;i++)this.setAtomDefaults(frames[i],id)},this.setDontDuplicateAtoms=function(dup){dontDuplicateAtoms=dup},this.setModelData=function(mData){modelData=mData},this.atomIsSelected=function(atom,sel){if("undefined"==typeof sel)return!0;var invert=!!sel.invert,ret=!0;for(var key in sel)if("predicate"===key){if(!sel.predicate(atom)){ret=!1;break}}else if("properties"==key&&atom[key])for(var propkey in sel.properties){if("undefined"==typeof atom.properties[propkey]){ret=!1;break}if(atom.properties[propkey]!=sel.properties[propkey]){ret=!1;break}}else if(sel.hasOwnProperty(key)&&"props"!=key&&"invert"!=key&&"model"!=key&&"byres"!=key&&"expand"!=key&&"within"!=key){if("undefined"==typeof atom[key]){ret=!1;break}var isokay=!1;if("bonds"===key){var val=sel[key];if(val!=atom.bonds.length){ret=!1;break}}else if($.isArray(sel[key])){for(var valarr=sel[key],i=0;i<valarr.length;i++)if(atom[key]==valarr[i]){isokay=!0;break}if(!isokay){ret=!1;break}}else{var val=sel[key];if(atom[key]!=val){ret=!1;break}}}return invert?!ret:ret},this.selectedAtoms=function(sel,from){var ret=[];sel=sel||{},from||(from=atoms);for(var aLength=from.length,i=0;aLength>i;i++){var atom=from[i];atom&&this.atomIsSelected(atom,sel)&&ret.push(atom)}if(sel.hasOwnProperty("expand"))for(var expand=expandAtomList(ret,parseFloat(sel.expand)),retlen=ret.length,i=0;i<expand.length;i++)for(var j=0;retlen>j;j++){var dist=squaredDistance(expand[i],ret[j]),thresh=Math.pow(sel.expand,2);thresh>dist&&dist>0&&ret.push(expand[i])}if(sel.hasOwnProperty("within")&&sel.within.hasOwnProperty("sel")&&sel.within.hasOwnProperty("distance")){for(var sel2=this.selectedAtoms(sel.within.sel,atoms),within=[],i=0;i<sel2.length;i++)for(var j=0;j<ret.length;j++){var dist=squaredDistance(sel2[i],ret[j]),thresh=Math.pow(parseFloat(sel.within.distance),2);thresh>dist&&dist>0&&within.push(ret[j])}ret=within}if(sel.hasOwnProperty("byres"))for(var vResis={},vAtoms=[],stack=[],i=0;i<ret.length;i++){var atom=ret[i],c=atom.chain,r=atom.resi;if(void 0===vResis[c]&&(vResis[c]={}),atom.hasOwnProperty("resi")&&void 0===vResis[c][r])for(vResis[c][r]=!0,stack.push(atom);stack.length>0;)if(atom=stack.pop(),c=atom.chain,r=atom.resi,void 0===vAtoms[atom.index]){vAtoms[atom.index]=!0;for(var j=0;j<atom.bonds.length;j++){var atom2=atoms[atom.bonds[j]];void 0===vAtoms[atom2.index]&&atom2.hasOwnProperty("resi")&&atom2.chain==c&&atom2.resi==r&&(stack.push(atom2),ret.push(atom2))}}}return ret};var squaredDistance=function(atom1,atom2){var xd=atom2.x-atom1.x,yd=atom2.y-atom1.y,zd=atom2.z-atom1.z;return Math.pow(xd,2)+Math.pow(yd,2)+Math.pow(zd,2)},expandAtomList=function(atomList,amt){if(0>=amt)return atomList;for(var pb=$3Dmol.getExtent(atomList),nb=[[],[],[]],i=0;3>i;i++)nb[0][i]=pb[0][i]-amt,nb[1][i]=pb[1][i]+amt,nb[2][i]=pb[2][i];for(var expand=[],i=0;i<atoms.length;i++){var x=atoms[i].x,y=atoms[i].y,z=atoms[i].z;x>=nb[0][0]&&x<=nb[1][0]&&y>=nb[0][1]&&y<=nb[1][1]&&z>=nb[0][2]&&z<=nb[1][2]&&(x>=pb[0][0]&&x<=pb[1][0]&&y>=pb[0][1]&&y<=pb[1][1]&&z>=pb[0][2]&&z<=pb[1][2]||expand.push(atoms[i]))}return expand};this.addAtoms=function(newatoms){molObj=null;var i,start=atoms.length,indexmap=[];for(i=0;i<newatoms.length;i++)"undefined"==typeof newatoms[i].index&&(newatoms[i].index=i),"undefined"==typeof newatoms[i].serial&&(newatoms[i].serial=i),indexmap[newatoms[i].index]=start+i;for(i=0;i<newatoms.length;i++){var olda=newatoms[i],nindex=indexmap[olda.index],a=$.extend(!1,{},olda);a.index=nindex,a.bonds=[],a.bondOrder=[],a.model=id,a.style=a.style||defaultAtomStyle,"undefined"==typeof a.color&&(a.color=ElementColors[a.elem]||defaultColor);for(var nbonds=olda.bonds?olda.bonds.length:0,j=0;nbonds>j;j++){var neigh=indexmap[olda.bonds[j]];"undefined"!=typeof neigh&&(a.bonds.push(neigh),a.bondOrder.push(olda.bondOrder?olda.bondOrder[j]:1))}atoms.push(a)}},this.removeAtoms=function(badatoms){molObj=null;var i,baddies=[];for(i=0;i<badatoms.length;i++)baddies[badatoms[i].index]=!0;var newatoms=[];for(i=0;i<atoms.length;i++){var a=atoms[i];baddies[a.index]||newatoms.push(a)}atoms=[],this.addAtoms(newatoms)},this.setStyle=function(sel,style,add){"undefined"==typeof style&&"undefined"==typeof add&&(style=sel,sel={});var s;for(s in sel)-1===validAtomSelectionSpecs.indexOf(s)&&console.log("Unknown selector "+s);for(s in style)-1===validAtomStyleSpecs.indexOf(s)&&console.log("Unknown style "+s);var changedAtoms=!1,setStyleHelper=function(atomArr){for(var selected=that.selectedAtoms(sel,atomArr),i=0;i<atomArr.length;i++)atomArr[i]&&(atomArr[i].capDrawn=!1);for(var i=0;i<selected.length;i++){changedAtoms=!0,selected[i].clickable&&(selected[i].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),add||(selected[i].style={});for(s in style)if(style.hasOwnProperty(s)){selected[i].style[s]=selected[i].style[s]||{};for(var prop in style[s])selected[i].style[s][prop]=style[s][prop]}}},that=this;setStyleHelper(atoms);for(var i=0;i<frames.length;i++)setStyleHelper(frames[i]);changedAtoms&&(molObj=null)},this.setClickable=function(sel,clickable,callback){var s;for(s in sel)-1===validAtomSelectionSpecs.indexOf(s)&&console.log("Unknown selector "+s);if(clickable=!!clickable,callback&&"function"!=typeof callback)return void console.log("Callback is not a function");var i,selected=this.selectedAtoms(sel,atoms),len=selected.length;for(i=0;len>i;i++)selected[i].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},selected[i].clickable=clickable,callback&&(selected[i].callback=callback);len>0&&(molObj=null)},this.setColorByElement=function(sel,colors){if(null===molObj||!sameObj(colors,lastColors)){lastColors=colors;var atoms=this.selectedAtoms(sel,atoms);atoms.length>0&&(molObj=null);for(var i=0;i<atoms.length;i++){var a=atoms[i];"undefined"!=typeof colors[a.elem]&&(a.color=colors[a.elem])}}},this.setColorByProperty=function(sel,prop,scheme,range){var atoms=this.selectedAtoms(sel,atoms);lastColors=null,atoms.length>0&&(molObj=null);var i,a;Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY;for(range||(range=scheme.range()),range||(range=$3Dmol.getPropertyRange(atoms,prop)),i=0;i<atoms.length;i++){a=atoms[i];var val=$3Dmol.getAtomProperty(a,prop);null!=val&&(a.color=scheme.valueToHex(parseFloat(a.properties[prop]),[range[0],range[1]]))}},this.setColorByFunction=function(sel,colorfun){var atoms=this.selectedAtoms(sel,atoms);for(lastColors=null,atoms.length>0&&(molObj=null),i=0;i<atoms.length;i++)a=atoms[i],a.color=colorfun(a)},this.toCDObject=function(includeStyles){var out={a:[],b:[]};includeStyles&&(out.s=[]);for(var i=0;i<atoms.length;i++){var atomJSON={},atom=atoms[i];if(atomJSON.x=atom.x,atomJSON.y=atom.y,atomJSON.z=atom.z,"C"!=atom.elem&&(atomJSON.l=atom.elem),includeStyles){for(var s=0;s<out.s.length&&JSON.stringify(atom.style)!==JSON.stringify(out.s[s]);)s++;s===out.s.length&&out.s.push(atom.style),0!==s&&(atomJSON.s=s)}out.a.push(atomJSON);for(var b=0;b<atom.bonds.length;b++){var firstAtom=i,secondAtom=atom.bonds[b];if(!(firstAtom>=secondAtom)){var bond={b:firstAtom,e:secondAtom},bondOrder=atom.bondOrder[b];1!=bondOrder&&(bond.o=bondOrder),out.b.push(bond)}}}return out},this.globj=function(group){new Date;if(null===molObj){molObj=createMolObj(atoms);new Date;renderedMolObj&&(group.remove(renderedMolObj),renderedMolObj=null),renderedMolObj=molObj.clone(),hidden&&(renderedMolObj.setVisible(!1),molObj.setVisible(!1)),group.add(renderedMolObj)}},this.removegl=function(group){renderedMolObj&&(void 0!==renderedMolObj.geometry&&renderedMolObj.geometry.dispose(),void 0!==renderedMolObj.material&&renderedMolObj.material.dispose(),group.remove(renderedMolObj),renderedMolObj=null),molObj=null},this.hide=function(){hidden=!0,renderedMolObj&&renderedMolObj.setVisible(!1),molObj&&molObj.setVisible(!1)},this.show=function(){hidden=!1,renderedMolObj&&renderedMolObj.setVisible(!0),molObj&&molObj.setVisible(!0)},this.addResLabels=function(sel,viewer,style){for(var atoms=this.selectedAtoms(sel,atoms),bylabel={},i=0;i<atoms.length;i++){var a=atoms[i],c=a.chain,resn=a.resn,resi=a.resi,label=resn+""+resi;bylabel[c]||(bylabel[c]={}),bylabel[c][label]||(bylabel[c][label]=[]),bylabel[c][label].push(a)}var mystyle=$.extend(!0,{},style);for(var c in bylabel)if(bylabel.hasOwnProperty(c)){var labels=bylabel[c];for(var label in labels)if(labels.hasOwnProperty(label)){for(var atoms=labels[label],sum=new $3Dmol.Vector3(0,0,0),i=0;i<atoms.length;i++){var a=atoms[i];sum.x+=a.x,sum.y+=a.y,sum.z+=a.z}sum.divideScalar(atoms.length),mystyle.position=sum,viewer.addLabel(label,mystyle)}}}}var defaultAtomStyle={line:{}},defaultlineWidth=1,vdwRadii={H:1.2,Li:1.82,LI:1.82,Na:2.27,NA:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,Cl:1.75,BR:1.85,Br:1.85,SE:1.9,Se:1.9,ZN:1.39,Zn:1.39,CU:1.4,Cu:1.4,NI:1.63,Ni:1.63},validAtomSpecs=["resn","x","y","z","color","surfaceColor","elem","hetflag","chain","resi","icode","rescode","serial","atom","bonds","ss","singleBonds","bondOrder","properties","b","pdbline","clickable","callback","invert"],validAtomSelectionSpecs=validAtomSpecs.concat(["model","bonds","predicate","invert","byres","expand","within"]),validAtomStyleSpecs=["line","cross","stick","sphere","cartoon"],sameObj=function(a,b){return a&&b?JSON.stringify(a)==JSON.stringify(b):a==b};return GLModel.parseMolData=function(data,format,options){if(format=format||"",!data)return[];if(/\.gz$/.test(format)){format=format.replace(/\.gz$/,"");try{data=pako.inflate(data,{to:"string"})}catch(err){console.log(err)}}"undefined"==typeof $3Dmol.Parsers[format]&&(format=format.split(".").pop(),"undefined"==typeof $3Dmol.Parsers[format]&&(console.log("Unknown format: "+format),format=data.match(/^@<TRIPOS>MOLECULE/gm)?"mol2":data.match(/^HETATM/gm)||data.match(/^ATOM/gm)?"pdb":data.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/gm)?"sdf":"xyz",console.log("Best guess: "+format)));var parse=$3Dmol.Parsers[format],parsedAtoms=parse(data,options);return parsedAtoms},GLModel.setAtomDefaults=function(atoms,id){for(var i=0;i<atoms.length;i++){var atom=atoms[i];atom&&(atom.style=atom.style||defaultAtomStyle,atom.color=atom.color||ElementColors[atom.elem]||defaultColor,atom.model=id,atom.clickable&&(atom.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}))}},GLModel}(),$3Dmol.GLShape=function(){function GLShape(stylespec){stylespec=stylespec||{},$3Dmol.ShapeIDCount++,this.boundingSphere=new $3Dmol.Sphere,this.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},updateFromStyle(this,stylespec);var components=[],shapeObj=null,renderedShapeObj=null,geo=new $3Dmol.Geometry(!0),linegeo=new $3Dmol.Geometry(!0);this.updateStyle=function(newspec){for(var prop in newspec)stylespec[prop]=newspec[prop];updateFromStyle(this,stylespec)},this.addCustom=function(customSpec){customSpec.vertexArr=customSpec.vertexArr||[],customSpec.faceArr=customSpec.faceArr||[],customSpec.normalArr=customSpec.normalArr||[];geo.geometryGroups.length;drawCustom(this,geo,customSpec)},this.addSphere=function(sphereSpec){sphereSpec.center=sphereSpec.center||{x:0,y:0,z:0},sphereSpec.radius=sphereSpec.radius?$3Dmol.Math.clamp(sphereSpec.radius,0,1/0):1.5,sphereSpec.color=$3Dmol.CC.color(sphereSpec.color),this.intersectionShape.sphere.push(new $3Dmol.Sphere(sphereSpec.center,sphereSpec.radius));var geoGroup=geo.addGeoGroup();$3Dmol.GLDraw.drawSphere(geo,sphereSpec.center,sphereSpec.radius,sphereSpec.color),geoGroup.truncateArrayBuffers(!0,!0),components.push({id:geoGroup.id,geoGroup:geoGroup,centroid:new $3Dmol.Vector3(sphereSpec.center.x,sphereSpec.center.y,sphereSpec.center.z)}),updateBoundingFromPoints(this.boundingSphere,components,geoGroup.vertexArray)},this.addCylinder=function(cylinderSpec){cylinderSpec.start=cylinderSpec.start||{},cylinderSpec.end=cylinderSpec.end||{};var start=new $3Dmol.Vector3(cylinderSpec.start.x||0,cylinderSpec.start.y||0,cylinderSpec.start.z||0),end=new $3Dmol.Vector3(cylinderSpec.end.x,cylinderSpec.end.y||0,cylinderSpec.end.z||0);"undefined"==typeof end.x&&(end.x=3);var radius=cylinderSpec.radius||.1,color=$3Dmol.CC.color(cylinderSpec.color);this.intersectionShape.cylinder.push(new $3Dmol.Cylinder(start,end,radius));var geoGroup=geo.addGeoGroup();$3Dmol.GLDraw.drawCylinder(geo,start,end,radius,color,cylinderSpec.fromCap,cylinderSpec.toCap),geoGroup.truncateArrayBuffers(!0,!0);var centroid=new $3Dmol.Vector3;components.push({id:geoGroup.id,geoGroup:geoGroup,centroid:centroid.addVectors(start,end).multiplyScalar(.5)}),updateBoundingFromPoints(this.boundingSphere,components,geoGroup.vertexArray)},this.addLine=function(lineSpec){lineSpec.start=lineSpec.start||{},lineSpec.end=lineSpec.end||{};var start=new $3Dmol.Vector3(lineSpec.start.x||0,lineSpec.start.y||0,lineSpec.start.z||0),end=new $3Dmol.Vector3(lineSpec.end.x,lineSpec.end.y||0,lineSpec.end.z||0);"undefined"==typeof end.x&&(end.x=3);var geoGroup=geo.addGeoGroup(),vstart=geoGroup.vertices,i=3*vstart,vertexArray=geoGroup.vertexArray;vertexArray[i]=start.x,vertexArray[i+1]=start.y,vertexArray[i+2]=start.z,vertexArray[i+3]=end.x,vertexArray[i+4]=end.y,vertexArray[i+5]=end.z,geoGroup.vertices+=2;var lineArray=geoGroup.lineArray,li=geoGroup.lineidx;lineArray[li]=vstart,lineArray[li+1]=vstart+1,geoGroup.lineidx+=2,geoGroup.truncateArrayBuffers(!0,!0)},this.addArrow=function(arrowSpec){if(arrowSpec.start=arrowSpec.start||{},arrowSpec.end=arrowSpec.end||{},arrowSpec.start=new $3Dmol.Vector3(arrowSpec.start.x||0,arrowSpec.start.y||0,arrowSpec.start.z||0),arrowSpec.dir instanceof $3Dmol.Vector3&&arrowSpec.length instanceof number){var end=arrowSpec.dir.clone().multiplyScalar(arrowSpec.length).add(start);arrowSpec.end=end}else arrowSpec.end=new $3Dmol.Vector3(arrowSpec.end.x,arrowSpec.end.y||0,arrowSpec.end.z||0),"undefined"==typeof arrowSpec.end.x&&(arrowSpec.end.x=3);arrowSpec.radius=arrowSpec.radius||.1,arrowSpec.radiusRatio=arrowSpec.radiusRatio||1.618034,arrowSpec.mid=0<arrowSpec.mid&&arrowSpec.mid<1?arrowSpec.mid:.618034;var geoGroup=geo.addGeoGroup();drawArrow(this,geoGroup,arrowSpec),geoGroup.truncateArrayBuffers(!0,!0);var centroid=new $3Dmol.Vector3;components.push({id:geoGroup.id,geoGroup:geoGroup,centroid:centroid.addVectors(arrowSpec.start,arrowSpec.end).multiplyScalar(.5)}),updateBoundingFromPoints(this.boundingSphere,components,geoGroup.vertexArray)},this.addIsosurface=function(data,volSpec){var i,il,isoval=void 0!==volSpec.isoval&&"number"==typeof volSpec.isoval?volSpec.isoval:0,voxel=volSpec.voxel?!0:!1,smoothness=void 0===volSpec.smoothness?1:volSpec.smoothness,nX=data.size.x,nY=data.size.y,nZ=data.size.z,vertnums=new Int16Array(nX*nY*nZ),vals=data.data;for(i=0,il=vertnums.length;il>i;++i)vertnums[i]=-1;var bitdata=new Uint8Array(nX*nY*nZ);for(i=0,il=vals.length;il>i;++i){var val=isoval>=0?vals[i]-isoval:isoval-vals[i];val>0&&(bitdata[i]|=ISDONE)}var verts=[],faces=[];$3Dmol.MarchingCube.march(bitdata,verts,faces,{fulltable:!0,voxel:voxel,unitCube:data.unit,origin:data.origin,nX:nX,nY:nY,nZ:nZ}),voxel||$3Dmol.MarchingCube.laplacianSmooth(smoothness,verts,faces),drawCustom(this,geo,{vertexArr:verts,faceArr:faces,normalArr:[],clickable:volSpec.clickable}),this.updateStyle(volSpec)},this.addVolumetricData=function(data,fmt,volSpec){var data=new $3Dmol.VolumeData(data,fmt);this.addIsosurface(data,volSpec)},this.globj=function(group){if(renderedShapeObj&&(group.remove(renderedShapeObj),renderedShapeObj=null),!this.hidden){geo.initTypedArrays(),updateColor(geo,this.color),shapeObj=new $3Dmol.Object3D;var material=null;if(this.side==$3Dmol.DoubleSide)var material=new $3Dmol.MeshDoubleLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1?!0:!1,opacity:this.opacity,wireframeLinewidth:this.linewidth});else var material=new $3Dmol.MeshLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1?!0:!1,opacity:this.opacity,wireframeLinewidth:this.linewidth});var mesh=new $3Dmol.Mesh(geo,material);shapeObj.add(mesh);var lineMaterial=new $3Dmol.LineBasicMaterial({linewidth:this.linewidth,color:this.color}),line=new $3Dmol.Line(linegeo,lineMaterial,$3Dmol.LinePieces);shapeObj.add(line),renderedShapeObj=shapeObj.clone(),group.add(renderedShapeObj)}},this.removegl=function(group){renderedShapeObj&&(void 0!==renderedShapeObj.geometry&&renderedShapeObj.geometry.dispose(),void 0!==renderedShapeObj.material&&renderedShapeObj.material.dispose(),group.remove(renderedShapeObj),renderedShapeObj=null),shapeObj=null}}var ISDONE=2,updateColor=function(geo,color){color||$3Dmol.CC.color(color);geo.colorsNeedUpdate=!0;var r,g,b;color.constructor!==Array&&(r=color.r,g=color.g,b=color.b);for(var gg in geo.geometryGroups)for(var geoGroup=geo.geometryGroups[gg],colorArr=geoGroup.colorArray,i=0,il=geoGroup.vertices;il>i;++i){if(color.constructor===Array){var c=color[i];r=c.r,g=c.g,b=c.b}colorArr[3*i]=r,colorArr[3*i+1]=g,colorArr[3*i+2]=b}},drawArrow=function(shape,geoGroup,spec){var from=spec.start,end=spec.end,radius=spec.radius,radiusRatio=spec.radiusRatio,mid=spec.mid;if(from&&end){var dir=end.clone();dir.sub(from).multiplyScalar(mid);var to=from.clone().add(dir),negDir=dir.clone().negate();shape.intersectionShape.cylinder.push(new $3Dmol.Cylinder(from.clone(),to.clone(),radius)),
shape.intersectionShape.sphere.push(new $3Dmol.Sphere(from.clone(),radius));var nvecs=[];nvecs[0]=dir.clone(),Math.abs(nvecs[0].x)>1e-4?nvecs[0].y+=1:nvecs[0].x+=1,nvecs[0].cross(dir),nvecs[0].normalize(),nvecs[0]=nvecs[0],nvecs[4]=nvecs[0].clone(),nvecs[4].crossVectors(nvecs[0],dir),nvecs[4].normalize(),nvecs[8]=nvecs[0].clone().negate(),nvecs[12]=nvecs[4].clone().negate(),nvecs[2]=nvecs[0].clone().add(nvecs[4]).normalize(),nvecs[6]=nvecs[4].clone().add(nvecs[8]).normalize(),nvecs[10]=nvecs[8].clone().add(nvecs[12]).normalize(),nvecs[14]=nvecs[12].clone().add(nvecs[0]).normalize(),nvecs[1]=nvecs[0].clone().add(nvecs[2]).normalize(),nvecs[3]=nvecs[2].clone().add(nvecs[4]).normalize(),nvecs[5]=nvecs[4].clone().add(nvecs[6]).normalize(),nvecs[7]=nvecs[6].clone().add(nvecs[8]).normalize(),nvecs[9]=nvecs[8].clone().add(nvecs[10]).normalize(),nvecs[11]=nvecs[10].clone().add(nvecs[12]).normalize(),nvecs[13]=nvecs[12].clone().add(nvecs[14]).normalize(),nvecs[15]=nvecs[14].clone().add(nvecs[0]).normalize();var offset,i,n,start=geoGroup.vertices,vertexArray=geoGroup.vertexArray,faceArray=(geoGroup.colorArray,geoGroup.faceArray),normalArray=geoGroup.normalArray,lineArray=geoGroup.lineArray;for(i=0,n=nvecs.length;n>i;++i){offset=3*(start+3*i);var bottom=nvecs[i].clone().multiplyScalar(radius).add(from),top=nvecs[i].clone().multiplyScalar(radius).add(to),conebase=nvecs[i].clone().multiplyScalar(radius*radiusRatio).add(to);if(vertexArray[offset]=bottom.x,vertexArray[offset+1]=bottom.y,vertexArray[offset+2]=bottom.z,vertexArray[offset+3]=top.x,vertexArray[offset+4]=top.y,vertexArray[offset+5]=top.z,vertexArray[offset+6]=conebase.x,vertexArray[offset+7]=conebase.y,vertexArray[offset+8]=conebase.z,i>0){var prev_x=vertexArray[offset-3],prev_y=vertexArray[offset-2],prev_z=vertexArray[offset-1],c=new $3Dmol.Vector3(prev_x,prev_y,prev_z),b=end.clone(),b2=to.clone(),a=new $3Dmol.Vector3(conebase.x,conebase.y,conebase.z);shape.intersectionShape.triangle.push(new $3Dmol.Triangle(a,b,c)),shape.intersectionShape.triangle.push(new $3Dmol.Triangle(c.clone(),b2,a.clone()))}}geoGroup.vertices+=48,offset=3*geoGroup.vertices,vertexArray[offset]=from.x,vertexArray[offset+1]=from.y,vertexArray[offset+2]=from.z,vertexArray[offset+3]=to.x,vertexArray[offset+4]=to.y,vertexArray[offset+5]=to.z,vertexArray[offset+6]=end.x,vertexArray[offset+7]=end.y,vertexArray[offset+8]=end.z,geoGroup.vertices+=3;var face,norm,faceoffset,lineoffset,t1,t2,t2b,t3,t3b,t4,t1offset,t2offset,t2boffset,t3offset,t3boffset,t4offset,n1,n2,n3,n4,fromi=geoGroup.vertices-3,toi=geoGroup.vertices-2,endi=geoGroup.vertices-1,fromoffset=3*fromi,tooffset=3*toi,endoffset=3*endi;for(i=0,n=nvecs.length-1;n>i;++i){var ti=start+3*i;offset=3*ti,faceoffset=geoGroup.faceidx,lineoffset=geoGroup.lineidx,t1=ti,t1offset=3*t1,t2=ti+1,t2offset=3*t2,t2b=ti+2,t2boffset=3*t2b,t3=ti+4,t3offset=3*t3,t3b=ti+5,t3boffset=3*t3b,t4=ti+3,t4offset=3*t4,norm=[nvecs[i],nvecs[i],nvecs[i+1],nvecs[i+1]],n1=n2=nvecs[i],n3=n4=nvecs[i+1],normalArray[t1offset]=n1.x,normalArray[t2offset]=n2.x,normalArray[t4offset]=n4.x,normalArray[t1offset+1]=n1.y,normalArray[t2offset+1]=n2.y,normalArray[t4offset+1]=n4.y,normalArray[t1offset+2]=n1.z,normalArray[t2offset+2]=n2.z,normalArray[t4offset+2]=n4.z,normalArray[t2offset]=n2.x,normalArray[t3offset]=n3.x,normalArray[t4offset]=n4.x,normalArray[t2offset+1]=n2.y,normalArray[t3offset+1]=n3.y,normalArray[t4offset+1]=n4.y,normalArray[t2offset+2]=n2.z,normalArray[t3offset+2]=n3.z,normalArray[t4offset+2]=n4.z,normalArray[t2boffset]=n2.x,normalArray[t3boffset]=n3.x,normalArray[t2boffset+1]=n2.y,normalArray[t3boffset+1]=n3.y,normalArray[t2boffset+2]=n2.z,normalArray[t3boffset+2]=n3.z,faceArray[faceoffset]=t1,faceArray[faceoffset+1]=t2,faceArray[faceoffset+2]=t4,faceArray[faceoffset+3]=t2,faceArray[faceoffset+4]=t3,faceArray[faceoffset+5]=t4,faceArray[faceoffset+6]=t1,faceArray[faceoffset+7]=t4,faceArray[faceoffset+8]=fromi,faceArray[faceoffset+9]=t2b,faceArray[faceoffset+10]=toi,faceArray[faceoffset+11]=t3b,faceArray[faceoffset+12]=t2b,faceArray[faceoffset+13]=endi,faceArray[faceoffset+14]=t3b,lineArray[lineoffset]=t1,lineArray[lineoffset+1]=t2,lineArray[lineoffset+2]=t1,lineArray[lineoffset+3]=t4,lineArray[lineoffset+4]=t3,lineArray[lineoffset+5]=t4,lineArray[lineoffset+6]=t1,lineArray[lineoffset+7]=t4,lineArray[lineoffset+8]=t2b,lineArray[lineoffset+9]=t2,lineArray[lineoffset+10]=t2b,lineArray[lineoffset+11]=t3b,lineArray[lineoffset+12]=t3,lineArray[lineoffset+13]=t3b,lineArray[lineoffset+14]=t2b,lineArray[lineoffset+15]=endi,lineArray[lineoffset+16]=t2b,lineArray[lineoffset+17]=t3b,lineArray[lineoffset+18]=endi,lineArray[lineoffset+19]=t3b,geoGroup.faceidx+=15,geoGroup.lineidx+=20}face=[start+45,start+46,start+1,start,start+47,start+2],norm=[nvecs[15],nvecs[15],nvecs[0],nvecs[0]],faceoffset=geoGroup.faceidx,lineoffset=geoGroup.lineidx,t1=face[0],t1offset=3*t1,t2=face[1],t2offset=3*t2,t2b=face[4],t2boffset=3*t2b,t3=face[2],t3offset=3*t3,t3b=face[5],t3boffset=3*t3b,t4=face[3],t4offset=3*t4,n1=n2=nvecs[15],n3=n4=nvecs[0],normalArray[t1offset]=n1.x,normalArray[t2offset]=n2.x,normalArray[t4offset]=n4.x,normalArray[t1offset+1]=n1.y,normalArray[t2offset+1]=n2.y,normalArray[t4offset+1]=n4.y,normalArray[t1offset+2]=n1.z,normalArray[t2offset+2]=n2.z,normalArray[t4offset+2]=n4.z,normalArray[t2offset]=n2.x,normalArray[t3offset]=n3.x,normalArray[t4offset]=n4.x,normalArray[t2offset+1]=n2.y,normalArray[t3offset+1]=n3.y,normalArray[t4offset+1]=n4.y,normalArray[t2offset+2]=n2.z,normalArray[t3offset+2]=n3.z,normalArray[t4offset+2]=n4.z,normalArray[t2boffset]=n2.x,normalArray[t3boffset]=n3.x,normalArray[t2boffset+1]=n2.y,normalArray[t3boffset+1]=n3.y,normalArray[t2boffset+2]=n2.z,normalArray[t3boffset+2]=n3.z,dir.normalize(),negDir.normalize(),normalArray[fromoffset]=negDir.x,normalArray[tooffset]=normalArray[endoffset]=dir.x,normalArray[fromoffset+1]=negDir.y,normalArray[tooffset+1]=normalArray[endoffset+1]=dir.y,normalArray[fromoffset+2]=negDir.z,normalArray[tooffset+2]=normalArray[endoffset+2]=dir.z,faceArray[faceoffset]=t1,faceArray[faceoffset+1]=t2,faceArray[faceoffset+2]=t4,faceArray[faceoffset+3]=t2,faceArray[faceoffset+4]=t3,faceArray[faceoffset+5]=t4,faceArray[faceoffset+6]=t1,faceArray[faceoffset+7]=t4,faceArray[faceoffset+8]=fromi,faceArray[faceoffset+9]=t2b,faceArray[faceoffset+10]=toi,faceArray[faceoffset+11]=t3b,faceArray[faceoffset+12]=t2b,faceArray[faceoffset+13]=endi,faceArray[faceoffset+14]=t3b,lineArray[lineoffset]=t1,lineArray[lineoffset+1]=t2,lineArray[lineoffset+2]=t1,lineArray[lineoffset+3]=t4,lineArray[lineoffset+4]=t3,lineArray[lineoffset+5]=t4,lineArray[lineoffset+6]=t1,lineArray[lineoffset+7]=t4,lineArray[lineoffset+8]=t2b,lineArray[lineoffset+9]=t2,lineArray[lineoffset+10]=t2b,lineArray[lineoffset+11]=t3b,lineArray[lineoffset+12]=t3,lineArray[lineoffset+13]=t3b,lineArray[lineoffset+14]=t2b,lineArray[lineoffset+15]=endi,lineArray[lineoffset+16]=t2b,lineArray[lineoffset+17]=t3b,lineArray[lineoffset+18]=endi,lineArray[lineoffset+19]=t3b,geoGroup.faceidx+=15,geoGroup.lineidx+=20}},addCustomGeo=function(shape,geo,mesh,color,clickable){var geoGroup=geo.addGeoGroup(),vertexArr=mesh.vertexArr,normalArr=mesh.normalArr,faceArr=mesh.faceArr;geoGroup.vertices=vertexArr.length,geoGroup.faceidx=faceArr.length;var offset,v,a,b,c,i,il,vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray;if(color.constructor!==Array)var r=color.r,g=color.g,b=color.b;for(i=0,il=geoGroup.vertices;il>i;++i){if(offset=3*i,v=vertexArr[i],vertexArray[offset]=v.x,vertexArray[offset+1]=v.y,vertexArray[offset+2]=v.z,color.constructor===Array)var c=color[i],r=c.r,g=c.g,b=c.b;colorArray[offset]=r,colorArray[offset+1]=g,colorArray[offset+2]=b}if(geoGroup.truncateArrayBuffers(!0,!0),clickable)for(i=0,il=geoGroup.faceidx/3;il>i;++i){offset=3*i,a=faceArr[offset],b=faceArr[offset+1],c=faceArr[offset+2];var vA=new $3Dmol.Vector3,vB=new $3Dmol.Vector3,vC=new $3Dmol.Vector3;shape.intersectionShape.triangle.push(new $3Dmol.Triangle(vA.copy(vertexArr[a]),vB.copy(vertexArr[b]),vC.copy(vertexArr[c])))}if(clickable){for(var center=new $3Dmol.Vector3(0,0,0),cnt=0,g=0;g<geo.geometryGroups.length;g++)center.add(geo.geometryGroups[g].getCentroid()),cnt++;center.divideScalar(cnt),updateBoundingFromPoints(shape.boundingSphere,{centroid:center},vertexArray)}if(geoGroup.faceArray=new Uint16Array(faceArr),geoGroup.truncateArrayBuffers(!0,!0),normalArr.length<geoGroup.vertices)geoGroup.setNormals();else{var n,normalArray=geoGroup.normalArray=new Float32Array(3*geoGroup.vertices);for(i=0,il=geoGroup.vertices;il>i;++i)offset=3*i,n=normalArr[i],normalArray[offset]=n.x,normalArray[offset+1]=n.y,normalArray[offset+2]=n.z}geoGroup.setLineIndices(),geoGroup.lineidx=geoGroup.lineArray.length},drawCustom=function(shape,geo,customSpec){var mesh=customSpec,vertexArr=mesh.vertexArr,faceArr=(mesh.normalArr,mesh.faceArr);(0===vertexArr.length||0===faceArr.length)&&console.warn("Error adding custom shape component: No vertices and/or face indices supplied!");var color=customSpec.color;"undefined"==typeof color&&(color=shape.color),color=$3Dmol.CC.color(color);for(var splits=$3Dmol.splitMesh(mesh),i=0,n=splits.length;n>i;i++)addCustomGeo(shape,geo,splits[i],splits[i].colorArr?splits[i].colorArr:color,customSpec.clickable)},updateBoundingFromPoints=function(sphere,components,points){sphere.center.set(0,0,0);var i,il;if(components.length>0){for(i=0,il=components.length;il>i;++i){var centroid=components[i].centroid;sphere.center.add(centroid)}sphere.center.divideScalar(components.length)}var maxRadiusSq=sphere.radius*sphere.radius;for(i=0,il=points.length/3;il>i;i++){var x=points[3*i],y=points[3*i+1],z=points[3*i+2],radiusSq=sphere.center.distanceToSquared({x:x,y:y,z:z});maxRadiusSq=Math.max(maxRadiusSq,radiusSq)}sphere.radius=Math.sqrt(maxRadiusSq)},updateFromStyle=function(shape,stylespec){shape.color=stylespec.color||new $3Dmol.Color,stylespec.color instanceof $3Dmol.Color||(shape.color=$3Dmol.CC.color(stylespec.color)),shape.wireframe=stylespec.wireframe?!0:!1,shape.opacity=stylespec.alpha?$3Dmol.Math.clamp(stylespec.alpha,0,1):1,"undefined"!=typeof stylespec.opacity&&(shape.opacity=$3Dmol.Math.clamp(stylespec.opacity,0,1)),shape.side=void 0!==stylespec.side?stylespec.side:$3Dmol.DoubleSide,shape.linewidth="undefined"==typeof stylespec.linewidth?1:stylespec.linewidth,shape.clickable=stylespec.clickable?!0:!1,shape.callback="function"==typeof stylespec.callback?stylespec.callback:null,shape.hidden=stylespec.hidden};return Object.defineProperty(GLShape.prototype,"position",{get:function(){return this.boundingSphere.center}}),Object.defineProperty(GLShape.prototype,"x",{get:function(){return this.boundingSphere.center.x}}),Object.defineProperty(GLShape.prototype,"y",{get:function(){return this.boundingSphere.center.y}}),Object.defineProperty(GLShape.prototype,"z",{get:function(){return this.boundingSphere.center.z}}),GLShape}(),$3Dmol.ShapeIDCount=0,$3Dmol.splitMesh=function(mesh){var MAXVERT=64e3;if(mesh.vertexArr.length<MAXVERT)return[mesh];var slices=(mesh.vertexArr.length,[{vertexArr:[],normalArr:[],faceArr:[]}]);mesh.colorArr&&(slices.colorArr=[]);for(var vertSlice=[],vertIndex=[],currentSlice=0,faces=mesh.faceArr,i=0,nf=faces.length;nf>i;i+=3){for(var slice=slices[currentSlice],j=0;3>j;j++){var v=faces[i+j];vertSlice[v]!==currentSlice&&(vertSlice[v]=currentSlice,vertIndex[v]=slice.vertexArr.length,slice.vertexArr.push(mesh.vertexArr[v]),mesh.normalArr&&mesh.normalArr[v]&&slice.normalArr.push(mesh.normalArr[v]),mesh.colorArr&&mesh.colorArr[v]&&slice.colorArr.push(mesh.colorArr[v])),slice.faceArr.push(vertIndex[v])}slice.vertexArr.length>=MAXVERT&&(slices.push({vertexArr:[],normalArr:[],faceArr:[]}),mesh.colorArr&&(slices.colorArr=[]),currentSlice++)}return slices},$3Dmol.GLViewer=function(){function GLViewer(element,config){function getAtomsFromSel(sel){var atoms=[];"undefined"==typeof sel&&(sel={});var i,ms=[];if("undefined"==typeof sel.model)for(i=0;i<models.length;i++)models[i]&&ms.push(models[i]);else ms=sel.model,$.isArray(ms)||(ms=[ms]);for(i=0;i<ms.length;i++)atoms=atoms.concat(ms[i].selectedAtoms(sel));return atoms}function atomIsSelected(atom,sel){"undefined"==typeof sel&&(sel={});var i,ms=[];if("undefined"==typeof sel.model)for(i=0;i<models.length;i++)models[i]&&ms.push(models[i]);else ms=sel.model,$.isArray(ms)||(ms=[ms]);for(i=0;i<ms.length;i++)if(ms[i].atomIsSelected(atom,sel))return!0;return!1}function addLineDashed(spec,s){spec.dashLength=spec.dashLength||.5,spec.gapLength=spec.gapLength||.5,spec.start=spec.start||{},spec.end=spec.end||{};var length,dashAmt,gapAmt,p1=new $3Dmol.Vector3(spec.start.x||0,spec.start.y||0,spec.start.z||0),p2=new $3Dmol.Vector3(spec.end.x,spec.end.y||0,spec.end.z||0),dir=new $3Dmol.Vector3,dash=new $3Dmol.Vector3,gap=new $3Dmol.Vector3,temp=p1.clone(),drawn=0;for(dir.subVectors(p2,p1),length=dir.length(),dir.normalize(),dash=dir.clone(),gap=dir.clone(),dash.multiplyScalar(spec.dashLength),gap.multiplyScalar(spec.gapLength),dashAmt=dash.length(),gapAmt=gap.length();length>drawn;){if(drawn+dashAmt>length){spec.start=p1,spec.end=p2,s.addLine(spec);break}temp.addVectors(p1,dash),spec.start=p1,spec.end=temp,s.addLine(spec),p1=temp.clone(),drawn+=dashAmt,temp.addVectors(p1,gap),p1=temp.clone(),drawn+=gapAmt}return s}function applyToModels(func,sel,value1,value2){var ms=[];if("undefined"==typeof sel.model)for(i=0;i<models.length;i++)models[i]&&ms.push(models[i]);else ms=sel.model,$.isArray(ms)||(ms=[ms]);for(var i=0;i<ms.length;i++)ms[i]&&ms[i][func](sel,value1,value2)}function getMatWithStyle(style){var mat=new $3Dmol.MeshLambertMaterial;mat.vertexColors=$3Dmol.VertexColors;for(var prop in style)"color"===prop||"map"===prop||style.hasOwnProperty(prop)&&(mat[prop]=style[prop]);return void 0!==style.opacity&&(1===style.opacity?mat.transparent=!1:mat.transparent=!0),mat}config=config||{};var callback=config.callback,defaultcolors=config.defaultcolors;defaultcolors||(defaultcolors=$3Dmol.elementColors.defaultColors);var nomouse=config.nomouse,bgColor=0;void 0!=typeof config.backgroundColor&&(bgColor=$3Dmol.CC.color(config.backgroundColor).getHex());var camerax=0;void 0!=typeof config.camerax&&(camerax=parseFloat(config.camerax));var _viewer=this,container=element,glDOM=(container.id,null),models=[],surfaces={},shapes=[],labels=[],clickables=[],WIDTH=container.width(),HEIGHT=container.height(),ASPECT=WIDTH/HEIGHT,NEAR=1,FAR=800,CAMERA_Z=150,fov=20,linkedViewers=[],renderer=new $3Dmol.Renderer({antialias:!0,preserveDrawingBuffer:!0,premultipliedAlpha:!1});renderer.domElement.style.width="100%",renderer.domElement.style.height="100%",renderer.domElement.style.padding="0",renderer.domElement.style.position="absolute",renderer.domElement.style.top="0px",renderer.domElement.style.left="0px",renderer.domElement.style.zIndex="0";var camera=new $3Dmol.Camera(fov,ASPECT,NEAR,FAR);camera.position=new $3Dmol.Vector3(camerax,0,CAMERA_Z);var lookingAt=new $3Dmol.Vector3;camera.lookAt(lookingAt);var raycaster=new $3Dmol.Raycaster(new $3Dmol.Vector3(0,0,0),new $3Dmol.Vector3(0,0,0)),projector=new $3Dmol.Projector,mouseVector=new $3Dmol.Vector3(0,0,0),scene=null,rotationGroup=null,modelGroup=null,fogStart=.4,slabNear=-50,slabFar=50,cq=new $3Dmol.Quaternion(0,0,0,1),dq=new $3Dmol.Quaternion(0,0,0,1),animated=!1,isDragging=!1,mouseStartX=0,mouseStartY=0,touchDistanceStart=0,currentModelPos=0,cz=0,cslabNear=0,cslabFar=0,nextSurfID=function(){var max=0;for(i in surfaces)surfaces.hasOwnProperty(i)&&i>max&&(max=i);return max+1},setSlabAndFog=function(){var center=camera.position.z-rotationGroup.position.z;1>center&&(center=1),camera.near=center+slabNear,camera.near<1&&(camera.near=1),camera.far=center+slabFar,camera.near+1>camera.far&&(camera.far=camera.near+1),camera instanceof $3Dmol.Camera?camera.fov=fov:(camera.right=center*Math.tan(Math.PI/180*fov),camera.left=-camera.right,camera.top=camera.right/ASPECT,camera.bottom=-camera.top),camera.updateProjectionMatrix(),scene.fog.near=camera.near+fogStart*(camera.far-camera.near),scene.fog.far=camera.far},show=function(nolink){if(scene&&(setSlabAndFog(),renderer.render(scene,camera),!nolink&&linkedViewers.length>0))for(var view=_viewer.getView(),i=0;i<linkedViewers.length;i++){var other=linkedViewers[i];other.setView(view,!0)}},initializeScene=function(){scene=new $3Dmol.Scene,scene.fog=new $3Dmol.Fog(bgColor,100,200),modelGroup=new $3Dmol.Object3D,rotationGroup=new $3Dmol.Object3D,rotationGroup.useQuaternion=!0,rotationGroup.quaternion=new $3Dmol.Quaternion(0,0,0,1),rotationGroup.add(modelGroup),scene.add(rotationGroup);var directionalLight=new $3Dmol.Light(16777215);directionalLight.position=new $3Dmol.Vector3(.2,.2,1).normalize(),directionalLight.intensity=1,scene.add(directionalLight)};initializeScene(),renderer.setClearColorHex(bgColor,1),scene.fog.color=$3Dmol.CC.color(bgColor);var clickedAtom=null,updateClickables=function(){clickables.splice(0,clickables.length);var i,il;for(i=0,il=models.length;il>i;i++){var model=models[i];if(model){var atoms=model.selectedAtoms({clickable:!0});Array.prototype.push.apply(clickables,atoms)}}for(i=0,il=shapes.length;il>i;i++){var shape=shapes[i];shape&&shape.clickable&&clickables.push(shape)}},handleClickSelection=function(mouseX,mouseY,event){if(0!=clickables.length){var mouse={x:mouseX,y:mouseY,z:-1};mouseVector.set(mouse.x,mouse.y,mouse.z),projector.unprojectVector(mouseVector,camera),mouseVector.sub(camera.position).normalize(),raycaster.set(camera.position,mouseVector);var intersects=[];if(intersects=raycaster.intersectObjects(modelGroup,clickables),intersects.length){var selected=intersects[0].clickable;void 0!==selected.callback&&"function"==typeof selected.callback&&selected.callback(selected,_viewer,event,container)}}},calcTouchDistance=function(ev){var xdiff=ev.originalEvent.targetTouches[0].pageX-ev.originalEvent.targetTouches[1].pageX,ydiff=ev.originalEvent.targetTouches[0].pageY-ev.originalEvent.targetTouches[1].pageY;return Math.sqrt(xdiff*xdiff+ydiff*ydiff)},getXY=function(ev){var x=ev.pageX,y=ev.pageY;return ev.originalEvent.targetTouches&&ev.originalEvent.targetTouches[0]?(x=ev.originalEvent.targetTouches[0].pageX,y=ev.originalEvent.targetTouches[0].pageY):ev.originalEvent.changedTouches&&ev.originalEvent.changedTouches[0]&&(x=ev.originalEvent.changedTouches[0].pageX,y=ev.originalEvent.changedTouches[0].pageY),[x,y]},screenXY2model=function(x,y){var dx=x/WIDTH,dy=y/HEIGHT,zpos=rotationGroup.position.z,q=rotationGroup.quaternion,t=new $3Dmol.Vector3(0,0,zpos);return projector.projectVector(t,camera),t.x+=2*dx,t.y-=2*dy,projector.unprojectVector(t,camera),t.z=0,t.applyQuaternion(q),t};$("body").bind("mouseup touchend",function(ev){if(isDragging&&scene){var xy=getXY(ev),x=xy[0],y=xy[1];if(x==mouseStartX&&y==mouseStartY){var offset=$("canvas",container).offset(),mouseX=(x-offset.left)/WIDTH*2-1,mouseY=2*-((y-offset.top)/HEIGHT)+1;handleClickSelection(mouseX,mouseY,ev,container)}}isDragging=!1});var _handleMouseDown=this._handleMouseDown=function(ev){if(ev.preventDefault(),scene){var xy=getXY(ev),x=xy[0],y=xy[1];void 0!==x&&(isDragging=!0,clickedAtom=null,mouseButton=ev.which,mouseStartX=x,mouseStartY=y,touchDistanceStart=0,ev.originalEvent.targetTouches&&2==ev.originalEvent.targetTouches.length&&(touchDistanceStart=calcTouchDistance(ev)),cq=rotationGroup.quaternion,cz=rotationGroup.position.z,currentModelPos=modelGroup.position.clone(),cslabNear=slabNear,cslabFar=slabFar)}},_handleMouseScroll=this._handleMouseScroll=function(ev){if(ev.preventDefault(),scene){var scaleFactor=.85*(CAMERA_Z-rotationGroup.position.z);ev.originalEvent.detail?rotationGroup.position.z+=scaleFactor*ev.originalEvent.detail/10:ev.originalEvent.wheelDelta&&(rotationGroup.position.z-=scaleFactor*ev.originalEvent.wheelDelta/400),rotationGroup.position.z>CAMERA_Z&&(rotationGroup.position.z=.999*CAMERA_Z),show()}},_handleMouseMove=this._handleMouseMove=function(ev){if(WIDTH=container.width(),HEIGHT=container.height(),ev.preventDefault(),scene&&isDragging){var mode=0,xy=getXY(ev),x=xy[0],y=xy[1];if(void 0!==x){var dx=(x-mouseStartX)/WIDTH,dy=(y-mouseStartY)/HEIGHT;if(0!=touchDistanceStart&&ev.originalEvent.targetTouches&&2==ev.originalEvent.targetTouches.length){var newdist=calcTouchDistance(ev);mode=2,dy=2*(touchDistanceStart-newdist)/(WIDTH+HEIGHT)}else ev.originalEvent.targetTouches&&3==ev.originalEvent.targetTouches.length&&(mode=1);var scaleFactor,r=Math.sqrt(dx*dx+dy*dy);if(3==mode||3==mouseButton&&ev.ctrlKey)slabNear=cslabNear+100*dx,slabFar=cslabFar+100*dy;else if(2==mode||3==mouseButton||ev.shiftKey)scaleFactor=.85*(CAMERA_Z-rotationGroup.position.z),80>scaleFactor&&(scaleFactor=80),rotationGroup.position.z=cz-dy*scaleFactor,rotationGroup.position.z>CAMERA_Z&&(rotationGroup.position.z=.999*CAMERA_Z);else if(1==mode||2==mouseButton||ev.ctrlKey){var t=screenXY2model(x-mouseStartX,y-mouseStartY);modelGroup.position.addVectors(currentModelPos,t)}else if((0===mode||1==mouseButton)&&0!==r){var rs=Math.sin(r*Math.PI)/r;dq.x=Math.cos(r*Math.PI),dq.y=0,dq.z=rs*dx,dq.w=-rs*dy,rotationGroup.quaternion=new $3Dmol.Quaternion(1,0,0,0),rotationGroup.quaternion.multiply(dq),rotationGroup.quaternion.multiply(cq)}show()}}},initContainer=function(element){container=element,WIDTH=container.width(),HEIGHT=container.height(),ASPECT=WIDTH/HEIGHT,renderer.setSize(WIDTH,HEIGHT),container.append(renderer.domElement),glDOM=$(renderer.domElement),nomouse||(glDOM.bind("mousedown touchstart",_handleMouseDown),glDOM.bind("DOMMouseScroll mousewheel",_handleMouseScroll),glDOM.bind("mousemove touchmove",_handleMouseMove),glDOM.bind("contextmenu",function(ev){ev.preventDefault()}))};initContainer(container),this.setContainer=function(element){return"string"===$.type(element)&&(element=$("#"+element)),element||(element=container),initContainer(element),this},this.setBackgroundColor=function(hex,a){"undefined"==typeof a?a=1:(0>a||a>1)&&(a=1);var c=$3Dmol.CC.color(hex);return scene.fog.color=c,bgColor=c.getHex(),renderer.setClearColorHex(c.getHex(),a),show(),this},this.setViewStyle=function(parameters){if("outline"===parameters.style){var params={};parameters.color&&(params.color=$3Dmol.CC.color(parameters.color)),parameters.width&&(params.width=parameters.width),renderer.enableOutline(params)}else renderer.disableOutline();return this},config.style&&this.setViewStyle(config.style),this.setWidth=function(w){return WIDTH=w||WIDTH,renderer.setSize(WIDTH,HEIGHT),this},this.setHeight=function(h){return HEIGHT=h||HEIGHT,renderer.setSize(WIDTH,HEIGHT),this},this.resize=function(){return WIDTH=container.width(),HEIGHT=container.height(),ASPECT=WIDTH/HEIGHT,renderer.setSize(WIDTH,HEIGHT),camera.aspect=ASPECT,camera.updateProjectionMatrix(),show(),this},$(window).resize(this.resize),this.getModel=function(id){return id=id||models.length-1,models[id]},this.rotate=function(angle,axis){"undefined"==typeof axis&&(axis="y");var i=0,j=0,k=0,rangle=Math.PI*angle/180,s=Math.sin(rangle/2),c=Math.cos(rangle/2);"x"==axis&&(i=s),"y"==axis&&(j=s),"z"==axis&&(k=s);var q=new $3Dmol.Quaternion(i,j,k,c).normalize();return rotationGroup.quaternion.multiply(q),show(),this},this.getView=function(){if(!modelGroup)return[0,0,0,0,0,0,0,1];var pos=modelGroup.position,q=rotationGroup.quaternion;return[pos.x,pos.y,pos.z,rotationGroup.position.z,q.x,q.y,q.z,q.w]},this.setView=function(arg,nolink){return void 0!==arg&&(arg instanceof Array||8!==arg.length)&&modelGroup&&rotationGroup?(modelGroup.position.x=arg[0],modelGroup.position.y=arg[1],modelGroup.position.z=arg[2],rotationGroup.position.z=arg[3],rotationGroup.quaternion.x=arg[4],rotationGroup.quaternion.y=arg[5],rotationGroup.quaternion.z=arg[6],rotationGroup.quaternion.w=arg[7],"undefined"!=typeof arg[8]&&(rotationGroup.position.x=arg[8],rotationGroup.position.y=arg[9]),show(nolink),this):this},this.render=function(){updateClickables();var i,n,view=(new Date,this.getView());for(i=0;i<models.length;i++)models[i]&&models[i].globj(modelGroup);for(i=0;i<shapes.length;i++)shapes[i]&&shapes[i].globj(modelGroup);for(i in surfaces)if(surfaces.hasOwnProperty(i)){var surfArr=surfaces[i];for(n=0;n<surfArr.length;n++)if(surfArr.hasOwnProperty(n)){var geo=surfArr[n].geo;if(!surfArr[n].finished){geo.verticesNeedUpdate=!0,geo.elementsNeedUpdate=!0,geo.normalsNeedUpdate=!0,geo.colorsNeedUpdate=!0,geo.buffersNeedUpdate=!0,geo.boundingSphere=null,surfArr[n].done&&(surfArr[n].finished=!0),surfArr[n].lastGL&&modelGroup.remove(surfArr[n].lastGL);var smesh=null;if(smesh=surfArr[n].mat instanceof $3Dmol.LineBasicMaterial?new $3Dmol.Line(geo,surfArr[n].mat):new $3Dmol.Mesh(geo,surfArr[n].mat),surfArr[n].mat.transparent&&0==surfArr[n].mat.opacity?smesh.visible=!1:smesh.visible=!0,surfArr[n].symmetries.length>1||1==surfArr[n].symmetries.length&&!surfArr[n].symmetries[n].isIdentity()){var j,tmeshes=new $3Dmol.Object3D;for(j=0;j<surfArr[n].symmetries.length;j++){var tmesh=smesh.clone();tmesh.matrix=surfArr[n].symmetries[j],tmesh.matrixAutoUpdate=!1,tmeshes.add(tmesh)}surfArr[n].lastGL=tmeshes,modelGroup.add(tmeshes)}else surfArr[n].lastGL=smesh,modelGroup.add(smesh)}}}this.setView(view);new Date;return this},this.selectedAtoms=function(sel){return getAtomsFromSel(sel)},this.pdbData=function(sel){for(var atoms=getAtomsFromSel(sel),ret="",i=0,n=atoms.length;n>i;++i)ret+=atoms[i].pdbline+"\n";return ret},this.zoom=function(factor){var factor=factor||2,scale=(CAMERA_Z-rotationGroup.position.z)/factor;return rotationGroup.position.z=CAMERA_Z-scale,show(),this},this.translate=function(x,y){var dx=x/WIDTH,dy=y/HEIGHT,v=new $3Dmol.Vector3(0,0,-CAMERA_Z);return projector.projectVector(v,camera),v.x-=dx,v.y-=dy,projector.unprojectVector(v,camera),v.z=0,lookingAt.add(v),camera.lookAt(lookingAt),show(),this},this.zoomTo=function(sel){var allatoms,alltmp;sel=sel||{};var atoms=getAtomsFromSel(sel),tmp=$3Dmol.getExtent(atoms);$.isEmptyObject(sel)?($.each(shapes,function(i,shape){shape&&shape.boundingSphere&&shape.boundingSphere.center&&atoms.push(shape.boundingSphere.center)}),tmp=$3Dmol.getExtent(atoms),allatoms=atoms,alltmp=tmp):(allatoms=getAtomsFromSel({}),alltmp=$3Dmol.getExtent(allatoms));var center=new $3Dmol.Vector3(tmp[2][0],tmp[2][1],tmp[2][2]);modelGroup.position=center.clone().multiplyScalar(-1);var x=alltmp[1][0]-alltmp[0][0],y=alltmp[1][1]-alltmp[0][1],z=alltmp[1][2]-alltmp[0][2],maxD=Math.sqrt(x*x+y*y+z*z);5>maxD&&(maxD=5),slabNear=-maxD/1.9,slabFar=maxD/2,x=tmp[1][0]-tmp[0][0],y=tmp[1][1]-tmp[0][1],z=tmp[1][2]-tmp[0][2],maxD=Math.sqrt(x*x+y*y+z*z),5>maxD&&(maxD=5);for(var maxDsq=25,i=0;i<atoms.length;i++)if(atoms[i]){var dsq=center.distanceToSquared(atoms[i]);dsq>maxDsq&&(maxDsq=dsq)}var maxD=2*Math.sqrt(maxDsq);return rotationGroup.position.z=-(.5*maxD/Math.tan(Math.PI/180*camera.fov/2)-CAMERA_Z),show(),this},this.addLabel=function(text,data){var label=new $3Dmol.Label(text,data);return label.setContext(),modelGroup.add(label.sprite),labels.push(label),show(),label},this.addResLabels=function(sel,style){return applyToModels("addResLabels",sel,this,style),this},this.removeLabel=function(label){for(var i=0;i<labels.length;i++)if(labels[i]==label){labels.splice(i,1),label.dispose(),modelGroup.remove(label.sprite);break}return this},this.removeAllLabels=function(){for(var i=0;i<labels.length;i++)modelGroup.remove(labels[i].sprite);return labels.splice(0,labels.length),this},this.setLabelStyle=function(label,stylespec){return modelGroup.remove(label.sprite),label.dispose(),label.stylespec=stylespec,label.setContext(),modelGroup.add(label.sprite),show(),label},this.setLabelText=function(label,text){return modelGroup.remove(label.sprite),label.dispose(),label.text=text,label.setContext(),modelGroup.add(label.sprite),show(),label},this.addShape=function(shapeSpec){shapeSpec=shapeSpec||{};var shape=new $3Dmol.GLShape(shapeSpec);return shape.shapePosition=shapes.length,shapes.push(shape),shape},this.removeShape=function(shape){if(!shape)return this;for(shape.removegl(modelGroup),delete shapes[shape.shapePosition];shapes.length>0&&"undefined"==typeof shapes[shapes.length-1];)shapes.pop();return this},this.removeAllShapes=function(){for(var i=0;i<shapes.length;i++){var shape=shapes[i];shape.removegl(modelGroup)}return shapes.splice(0,shapes.length),this},this.addSphere=function(spec){spec=spec||{};var s=new $3Dmol.GLShape(spec);return s.shapePosition=shapes.length,s.addSphere(spec),shapes.push(s),s},this.addArrow=function(spec){spec=spec||{};var s=new $3Dmol.GLShape(spec);return s.shapePosition=shapes.length,s.addArrow(spec),shapes.push(s),s},this.addCylinder=function(spec){spec=spec||{};var s=new $3Dmol.GLShape(spec);return s.shapePosition=shapes.length,s.addCylinder(spec),shapes.push(s),s},this.addLine=function(spec){spec=spec||{},spec.wireframe=!0;var s=new $3Dmol.GLShape(spec);return s.shapePosition=shapes.length,spec.dashed?s=addLineDashed(spec,s):s.addLine(spec),shapes.push(s),s},this.addUnitCell=function(model){var s=new $3Dmol.GLShape({wireframe:!0});s.shapePosition=shapes.length;var data=model.getCrystData();if(data){var a=data.a,b=data.b,c=data.c,alpha=data.alpha,beta=data.beta,gamma=data.gamma;alpha=alpha*Math.PI/180,beta=beta*Math.PI/180,gamma=gamma*Math.PI/180;var u,v,w;u=Math.cos(beta),v=(Math.cos(alpha)-Math.cos(beta)*Math.cos(gamma))/Math.sin(gamma),w=Math.sqrt(Math.max(0,1-u*u-v*v));for(var matrix=new $3Dmol.Matrix4(a,b*Math.cos(gamma),c*u,0,0,b*Math.sin(gamma),c*v,0,0,0,c*w,0,0,0,0,1),points=[new $3Dmol.Vector3(0,0,0),new $3Dmol.Vector3(1,0,0),new $3Dmol.Vector3(0,1,0),new $3Dmol.Vector3(0,0,1),new $3Dmol.Vector3(1,1,0),new $3Dmol.Vector3(0,1,1),new $3Dmol.Vector3(1,0,1),new $3Dmol.Vector3(1,1,1)],i=0;i<points.length;i++)points[i]=points[i].applyMatrix4(matrix);s.addLine({start:points[0],end:points[1]}),s.addLine({start:points[0],end:points[2]}),s.addLine({start:points[1],end:points[4]}),s.addLine({start:points[2],end:points[4]}),s.addLine({start:points[0],end:points[3]}),s.addLine({start:points[3],end:points[5]}),s.addLine({start:points[2],end:points[5]}),s.addLine({start:points[1],end:points[6]}),s.addLine({start:points[4],end:points[7]}),s.addLine({start:points[6],end:points[7]}),s.addLine({start:points[3],end:points[6]}),s.addLine({start:points[5],end:points[7]})}return shapes.push(s),s},this.addCustom=function(spec){spec=spec||{};var s=new $3Dmol.GLShape(spec);return s.shapePosition=shapes.length,s.addCustom(spec),shapes.push(s),s},this.addVolumetricData=function(data,format,spec){spec=spec||{};var s=new $3Dmol.GLShape(spec);return s.shapePosition=shapes.length,s.addVolumetricData(data,format,spec),shapes.push(s),s},this.addIsosurface=function(data,spec){spec=spec||{};var s=new $3Dmol.GLShape(spec);return s.shapePosition=shapes.length,s.addIsosurface(data,spec),shapes.push(s),s},this.setFrame=function(framenum){for(var i=0;i<models.length;i++)models[i].setFrame(framenum);return this},this.getFrames=function(){for(var mostFrames=0,modelNum=0,i=0;i<models.length;i++)models[i].getFrames().length>mostFrames&&(modelNum=i,mostFrames=models[i].getFrames().length);return mostFrames},this.animate=function(options){animated=!0;var interval=100,loop="forward",reps=0;options=options||{},options.interval&&(interval=options.interval),options.loop&&(loop=options.loop),options.reps&&(reps=options.reps);var mostFrames=this.getFrames(),that=this,currFrame=0,inc=1,displayCount=0,displayMax=mostFrames*reps,display=function(direction){"forward"==direction?(that.setFrame(currFrame),currFrame=(currFrame+inc)%mostFrames):"backward"==direction?(that.setFrame(mostFrames-1-currFrame),currFrame=(currFrame+inc)%mostFrames):(that.setFrame(currFrame),currFrame+=inc,inc*=currFrame%(mostFrames-1)==0?-1:1),that.render(),++displayCount!=displayMax&&that.isAnimated()||clearInterval(intervalID)},intervalID=setInterval(function(){display(loop)},interval);return this},this.stopAnimate=function(){return animated=!1,this},this.isAnimated=function(){return animated},this.addModel=function(data,format,options){var m=new $3Dmol.GLModel(models.length,defaultcolors);return m.addMolData(data,format,options),
models.push(m),m},this.addModels=function(data,format,options){options=options||{},options.multimodel=!0,options.frames=!0;for(var modelatoms=$3Dmol.GLModel.parseMolData(data,format,options),i=0;i<modelatoms.length;i++){var newModel=new $3Dmol.GLModel(models.length,defaultcolors);newModel.setAtomDefaults(modelatoms[i]),newModel.addFrame(modelatoms[i]),newModel.setFrame(0),newModel.setModelData(modelatoms.modelData[i]),newModel.setDontDuplicateAtoms(!options.duplicateAssemblyAtoms),models.push(newModel)}return models},this.addModelsAsFrames=function(data,format,options){options=options||{},options.multimodel=!0,options.frames=!0;var m=new $3Dmol.GLModel(models.length,defaultcolors);return m.addMolData(data,format,options),models.push(m),m},this.addAsOneMolecule=function(data,format,options){options=options||{},options.multimodel=!0,options.onemol=!0;var m=new $3Dmol.GLModel(models.length,defaultcolors);return m.addMolData(data,format,options),models.push(m),m},this.removeModel=function(model){if(model){for(model.removegl(modelGroup),delete models[model.getID()];models.length>0&&"undefined"==typeof models[models.length-1];)models.pop();return this}},this.removeAllModels=function(){for(var i=0;i<models.length;i++){var model=models[i];model.removegl(modelGroup)}return models.splice(0,models.length),this},this.exportJSON=function(includeStyles,modelID){var object={};return void 0===modelID?object.m=models.map(function(model){return model.toCDObject(includeStyles)}):object.m=[model[modelID].toCDObject()],JSON.stringify(object)},this.createModelFrom=function(sel,extract){for(var m=new $3Dmol.GLModel(models.length,defaultcolors),i=0;i<models.length;i++)if(models[i]){var atoms=models[i].selectedAtoms(sel);m.addAtoms(atoms),extract&&models[i].removeAtoms(atoms)}return models.push(m),m},this.setStyle=function(sel,style){return"undefined"==typeof style&&(style=sel,sel={}),applyToModels("setStyle",sel,style,!1),this},this.addStyle=function(sel,style){return"undefined"==typeof style&&(style=sel,sel={}),applyToModels("setStyle",sel,style,!0),this},this.setClickable=function(sel,clickable,callback){return applyToModels("setClickable",sel,clickable,callback),this},this.setColorByProperty=function(sel,prop,scheme){return applyToModels("setColorByProperty",sel,prop,scheme),this},this.setColorByElement=function(sel,colors){return applyToModels("setColorByElement",sel,colors),this};var getAtomsWithin=function(atomlist,extent){for(var ret=[],i=0;i<atomlist.length;i++){var atom=atomlist[i];"undefined"!=typeof atom&&(atom.x<extent[0][0]||atom.x>extent[1][0]||atom.y<extent[0][1]||atom.y>extent[1][1]||atom.z<extent[0][2]||atom.z>extent[1][2]||ret.push(i))}return ret},volume=function(extent){var w=extent[1][0]-extent[0][0],h=extent[1][1]-extent[0][1],d=extent[1][2]-extent[0][2];return w*h*d},carveUpExtent=function(extent,atomlist,atomstoshow){for(var ret=[],copyExtent=function(extent){var ret=[];return ret[0]=[extent[0][0],extent[0][1],extent[0][2]],ret[1]=[extent[1][0],extent[1][1],extent[1][2]],ret},splitExtentR=function(extent){if(volume(extent)<maxVolume)return[extent];var index,w=extent[1][0]-extent[0][0],h=extent[1][1]-extent[0][1],d=extent[1][2]-extent[0][2];index=w>h&&w>d?0:h>w&&h>d?1:2;var a=copyExtent(extent),b=copyExtent(extent),mid=(extent[1][index]-extent[0][index])/2+extent[0][index];a[1][index]=mid,b[0][index]=mid;var alist=splitExtentR(a),blist=splitExtentR(b);return alist.concat(blist)},splits=splitExtentR(extent),off=6,i=0,n=splits.length;n>i;i++){var e=copyExtent(splits[i]);e[0][0]-=off,e[0][1]-=off,e[0][2]-=off,e[1][0]+=off,e[1][1]+=off,e[1][2]+=off;var atoms=getAtomsWithin(atomlist,e),toshow=getAtomsWithin(atomstoshow,splits[i]);ret.push({extent:splits[i],atoms:atoms,toshow:toshow})}return ret},generateSurfaceMesh=function(atoms,VandF,mat){var geo=new $3Dmol.Geometry(!0),geoGroup=geo.updateGeoGroup(0),colors=[];for(i=0,il=atoms.length;il>i;i++){var atom=atoms[i];atom&&("undefined"!=typeof atom.surfaceColor?colors[i]=atom.surfaceColor:atom.color&&(colors[i]=$3Dmol.CC.color(atom.color)))}var offset,i,il,vertexArray=geoGroup.vertexArray,v=VandF.vertices;for(i=0,il=v.length;il>i;i++)offset=3*geoGroup.vertices,vertexArray[offset]=v[i].x,vertexArray[offset+1]=v[i].y,vertexArray[offset+2]=v[i].z,geoGroup.vertices++;var colorArray=geoGroup.colorArray;if(mat.voldata&&mat.volscheme){var scheme=mat.volscheme,voldata=mat.voldata,range=scheme.range()||[-1,1];for(i=0,il=v.length;il>i;i++){var val=voldata.getVal(v[i].x,v[i].y,v[i].z),col=$3Dmol.CC.color(scheme.valueToHex(val,range)),offset=3*i;colorArray[offset]=col.r,colorArray[offset+1]=col.g,colorArray[offset+2]=col.b}}else if(colors.length>0)for(i=0,il=v.length;il>i;i++){var A=v[i].atomid,offsetA=3*i;colorArray[offsetA]=colors[A].r,colorArray[offsetA+1]=colors[A].g,colorArray[offsetA+2]=colors[A].b}var faces=VandF.faces;geoGroup.faceidx=faces.length,geo.initTypedArrays();var vA,vB,vC,norm,verts=geoGroup.vertexArray,normalArray=geoGroup.normalArray;for(i=0,il=faces.length;il>i;i+=3){var a=faces[i],b=faces[i+1],c=faces[i+2],A=v[a].atomid,offsetA=(v[b].atomid,v[c].atomid,3*a),offsetB=3*b,offsetC=3*c;vA=new $3Dmol.Vector3(verts[offsetA],verts[offsetA+1],verts[offsetA+2]),vB=new $3Dmol.Vector3(verts[offsetB],verts[offsetB+1],verts[offsetB+2]),vC=new $3Dmol.Vector3(verts[offsetC],verts[offsetC+1],verts[offsetC+2]),vC.subVectors(vC,vB),vA.subVectors(vA,vB),vC.cross(vA),norm=vC,norm.normalize(),normalArray[offsetA]+=norm.x,normalArray[offsetB]+=norm.x,normalArray[offsetC]+=norm.x,normalArray[offsetA+1]+=norm.y,normalArray[offsetB+1]+=norm.y,normalArray[offsetC+1]+=norm.y,normalArray[offsetA+2]+=norm.z,normalArray[offsetB+2]+=norm.z,normalArray[offsetC+2]+=norm.z}geoGroup.faceArray=new Uint16Array(faces);var mesh=new $3Dmol.Mesh(geo,mat);return mesh.doubleSided=!0,mesh},generateMeshSyncHelper=function(type,expandedExtent,extendedAtoms,atomsToShow,atoms,vol){var ps=(new Date,new $3Dmol.ProteinSurface);ps.initparm(expandedExtent,1===type?!1:!0,vol);new Date;ps.fillvoxels(atoms,extendedAtoms);new Date;ps.buildboundary(),type==$3Dmol.SurfaceType.SES&&(ps.fastdistancemap(),ps.boundingatom(!1),ps.fillvoxelswaals(atoms,extendedAtoms));new Date;ps.marchingcube(type);new Date;return ps.getFacesAndVertices(atomsToShow)};this.addMesh=function(mesh){var surfobj={geo:mesh.geometry,mat:mesh.material,done:!0,finished:!1},surfid=nextSurfID();return surfaces[surfid]=surfobj,surfid};var shallowCopy=function(l){var ret=[];return $.each(l,function(k,v){ret[k]=$.extend({},v)}),ret};this.addSurface=function(type,style,atomsel,allsel,focus){var atomlist=null,focusSele=null,atomsToShow=shallowCopy(getAtomsFromSel(atomsel));atomlist=allsel?shallowCopy(getAtomsFromSel(allsel)):atomsToShow;var n,symmetries=!1;for(n=0;n<models.length;n++)if(models[n]){var symMatrices=models[n].getSymmetries();if(symMatrices.length>1||1==symMatrices.length&&!symMatrices[0].isIdentity()){symmetries=!0;break}}var addSurfaceHelper=function(surfobj,atomlist,atomsToShow){focusSele=focus?shallowCopy(getAtomsFromSel(focus)):atomsToShow;var atom,i,il,extent=(new Date,$3Dmol.getExtent(atomsToShow,!0));if(style.map&&style.map.prop){var prop=style.map.prop,scheme=style.map.scheme||style.map.gradient||new $3Dmol.Gradient.RWB,range=scheme.range();range||(range=$3Dmol.getPropertyRange(atomsToShow,prop)),style.colorscheme={prop:prop,gradient:scheme}}for(i=0,il=atomlist.length;il>i;i++)atom=atomlist[i],atom.surfaceColor=$3Dmol.getColorFromStyle(atom,style);var totalVol=volume(extent),extents=carveUpExtent(extent,atomlist,atomsToShow);if(focusSele&&focusSele.length&&focusSele.length>0){var seleExtent=$3Dmol.getExtent(focusSele,!0),sortFunc=function(a,b){var distSq=function(ex,sele){var e=ex.extent,x=e[1][0]-e[0][0],y=e[1][1]-e[0][1],z=e[1][2]-e[0][2],dx=x-sele[2][0];dx*=dx;var dy=y-sele[2][1];dy*=dy;var dz=z-sele[2][2];return dz*=dz,dx+dy+dz},d1=distSq(a,seleExtent),d2=distSq(b,seleExtent);return d1-d2};extents.sort(sortFunc)}var reducedAtoms=[];for(i=0,il=atomlist.length;il>i;i++)atom=atomlist[i],reducedAtoms[i]={x:atom.x,y:atom.y,z:atom.z,serial:i,elem:atom.elem};var sync=!!$3Dmol.syncSurface;if(sync){var callSyncHelper=function callSyncHelper(i){if(!(i>=extents.length)){var VandF=generateMeshSyncHelper(type,extents[i].extent,extents[i].atoms,extents[i].toshow,reducedAtoms,totalVol),mesh=generateSurfaceMesh(atomlist,VandF,mat);$3Dmol.mergeGeos(surfobj.geo,mesh),_viewer.render(),setTimeout(callSyncHelper,1,i+1)}};setTimeout(callSyncHelper,1,0)}else{var workers=[];for(0>type&&(type=0),i=0,il=numWorkers;il>i;i++){var w=new Worker($3Dmol.SurfaceWorker);workers.push(w),w.postMessage({type:-1,atoms:reducedAtoms,volume:totalVol})}var cnt=0,rfunction=function(event){for(var VandFs=$3Dmol.splitMesh({vertexArr:event.data.vertices,faceArr:event.data.faces}),i=0,vl=VandFs.length;vl>i;i++){var VandF={vertices:VandFs[i].vertexArr,faces:VandFs[i].faceArr},mesh=generateSurfaceMesh(atomlist,VandF,mat);$3Dmol.mergeGeos(surfobj.geo,mesh),_viewer.render()}cnt++,cnt==extents.length&&(surfobj.done=!0)},efunction=function(event){console.log(event.message+" ("+event.filename+":"+event.lineno+")")};for(i=0;i<extents.length;i++){var worker=workers[i%workers.length];worker.onmessage=rfunction,worker.onerror=efunction,worker.postMessage({type:type,expandedExtent:extents[i].extent,extendedAtoms:extents[i].atoms,atomsToShow:extents[i].toshow})}}};style=style||{};var mat=getMatWithStyle(style),surfobj=[];if(symmetries){var modelsAtomList={},modelsAtomsToShow={};for(n=0;n<models.length;n++)modelsAtomList[n]=[],modelsAtomsToShow[n]=[];for(n=0;n<atomlist.length;n++)modelsAtomList[atomlist[n].model].push(atomlist[n]);for(n=0;n<atomsToShow.length;n++)modelsAtomsToShow[atomsToShow[n].model].push(atomsToShow[n]);for(n=0;n<models.length;n++)surfobj.push({geo:new $3Dmol.Geometry(!0),mat:mat,done:!1,finished:!1,symmetries:models[n].getSymmetries()}),addSurfaceHelper(surfobj[n],modelsAtomList[n],modelsAtomsToShow[n])}else surfobj.push({geo:new $3Dmol.Geometry(!0),mat:mat,done:!1,finished:!1,symmetries:[new $3Dmol.Matrix4]}),addSurfaceHelper(surfobj[surfobj.length-1],atomlist,atomsToShow);var surfid=nextSurfID();return surfaces[surfid]=surfobj,surfid},this.setSurfaceMaterialStyle=function(surf,style){if(surfaces[surf]){surfArr=surfaces[surf];for(var i=0;i<surfArr.length;i++)surfArr[i].mat=getMatWithStyle(style),surfArr[i].mat.side=$3Dmol.FrontSide,surfArr[i].finished=!1}return this},this.removeSurface=function(surf){for(var surfArr=surfaces[surf],i=0;i<surfArr.length;i++)surfArr[i]&&surfArr[i].lastGL&&(void 0!==surfArr[i].geo&&surfArr[i].geo.dispose(),void 0!==surfArr[i].mat&&surfArr[i].mat.dispose(),modelGroup.remove(surfArr[i].lastGL));return delete surfaces[surf],show(),this},this.removeAllSurfaces=function(){for(n in surfaces)if(surfaces.hasOwnProperty(n)){for(var surfArr=surfaces[n],i=0;i<surfArr.length;i++)surfArr[i]&&surfArr[i].lastGL&&(void 0!==surfArr[i].geo&&surfArr[i].geo.dispose(),void 0!==surfArr[i].mat&&surfArr[i].mat.dispose(),modelGroup.remove(surfArr[i].lastGL));delete surfaces[n]}return show(),this},this.jmolMoveTo=function(){var pos=modelGroup.position,ret="center { "+-pos.x+" "+-pos.y+" "+-pos.z+" }; ",q=rotationGroup.quaternion;return ret+="moveto .5 quaternion { "+q.x+" "+q.y+" "+q.z+" "+q.w+" };"},this.clear=function(){return this.removeAllSurfaces(),this.removeAllModels(),this.removeAllLabels(),this.removeAllShapes(),show(),this},this.mapAtomProperties=function(props,sel){sel=sel||{};var atoms=getAtomsFromSel(sel);if("function"==typeof props)for(var a=0,numa=atoms.length;numa>a;a++){var atom=atoms[a];props(atom)}else for(var a=0,numa=atoms.length;numa>a;a++)for(var atom=atoms[a],i=0,n=props.length;n>i;i++){var prop=props[i];if(prop.props)for(var p in prop.props)prop.props.hasOwnProperty(p)&&atomIsSelected(atom,prop)&&(atom.properties||(atom.properties={}),atom.properties[p]=prop.props[p])}return this},this.linkViewer=function(otherviewer){return linkedViewers.push(otherviewer),this};try{"function"==typeof callback&&callback(this)}catch(e){console.log("error with glviewer callback: "+e)}}var numWorkers=4,maxVolume=64e3;return GLViewer}(),$3Dmol.glmolViewer=$3Dmol.GLViewer;var $3Dmol=$3Dmol||{};$3Dmol.Gradient=function(min,max){},$3Dmol.Gradient.valueToHex=function(val,range){},$3Dmol.Gradient.range=function(){},$3Dmol.Gradient.RWB=function(min,max,mid){var mult=1;"undefined"==typeof max&&$.isArray(min)&&min.length>=2&&(max=min[1],min=min[0]),min>max&&(mult=-1,min*=-1,max*=-1),this.valueToHex=function(val,range){var lo,hi;if(val=mult*val,range?(lo=range[0],hi=range[1]):(lo=min,hi=max),void 0===val)return 16777215;lo>val&&(val=lo),val>hi&&(val=hi);var middle=(hi+lo)/2;"undefined"!=typeof mid&&(middle=mid);var scale,color;return middle>=val?(scale=Math.floor(255*Math.sqrt((val-lo)/(middle-lo))),color=16711680+256*scale+scale):(scale=Math.floor(255*Math.sqrt(1-(val-middle)/(hi-middle))),color=65536*scale+256*scale+255)},this.range=function(){return"undefined"!=typeof min&&"undefined"!=typeof max?[min,max]:null}},$3Dmol.Gradient.ROYGB=function(min,max){var mult=1;"undefined"==typeof max&&$.isArray(min)&&min.length>=2&&(max=min[1],min=min[0]),min>max&&(mult=-1,min*=-1,max*=-1),this.valueToHex=function(val,range){var lo,hi;if(val=mult*val,range?(lo=range[0],hi=range[1]):(lo=min,hi=max),"undefined"==typeof val)return 16777215;lo>val&&(val=lo),val>hi&&(val=hi);var scale,color,mid=(lo+hi)/2,q1=(lo+mid)/2,q3=(mid+hi)/2;return q1>val?(scale=Math.floor(255*Math.sqrt((val-lo)/(q1-lo))),color=16711680+256*scale+0):mid>val?(scale=Math.floor(255*Math.sqrt(1-(val-q1)/(mid-q1))),color=65536*scale+65280+0):q3>val?(scale=Math.floor(255*Math.sqrt((val-mid)/(q3-mid))),color=65280+1*scale):(scale=Math.floor(255*Math.sqrt(1-(val-q3)/(hi-q3))),color=0+256*scale+255)},this.range=function(){return"undefined"!=typeof min&&"undefined"!=typeof max?[min,max]:null}},$3Dmol.Gradient.Sinebow=function(min,max){var mult=1;"undefined"==typeof max&&$.isArray(min)&&min.length>=2&&(max=min[1],min=min[0]),min>max&&(mult=-1,min*=-1,max*=-1),this.valueToHex=function(val,range){var lo,hi;if(val=mult*val,range?(lo=range[0],hi=range[1]):(lo=min,hi=max),"undefined"==typeof val)return 16777215;lo>val&&(val=lo),val>hi&&(val=hi);var scale=(val-lo)/(hi-lo),h=5*scale/6+.5,r=Math.sin(Math.PI*h);r*=255*r;var g=Math.sin(Math.PI*(h+1/3));g*=255*g;var b=Math.sin(Math.PI*(h+2/3));return b*=255*b,65536*Math.floor(r)+256*Math.floor(b)+1*Math.floor(g)},this.range=function(){return"undefined"!=typeof min&&"undefined"!=typeof max?[min,max]:null}},$3Dmol.LabelCount=0,$3Dmol.Label=function(text,parameters){this.id=$3Dmol.LabelCount++,this.stylespec=parameters||{},this.canvas=document.createElement("canvas"),this.canvas.width=134,this.canvas.height=35,this.context=this.canvas.getContext("2d"),this.sprite=new $3Dmol.Sprite,this.text=text},$3Dmol.Label.prototype={constructor:$3Dmol.Label,getStyle:function(){return this.stylespec},setContext:function(){var roundRect=function(ctx,x,y,w,h,r,drawBorder){ctx.beginPath(),ctx.moveTo(x+r,y),ctx.lineTo(x+w-r,y),ctx.quadraticCurveTo(x+w,y,x+w,y+r),ctx.lineTo(x+w,y+h-r),ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h),ctx.lineTo(x+r,y+h),ctx.quadraticCurveTo(x,y+h,x,y+h-r),ctx.lineTo(x,y+r),ctx.quadraticCurveTo(x,y,x+r,y),ctx.closePath(),ctx.fill(),drawBorder&&ctx.stroke()},getColor=function(style,stylealpha,init){var ret=init;return"undefined"!=typeof style&&(ret=style instanceof $3Dmol.Color?style.scaled():$3Dmol.CC.color(style).scaled()),"undefined"!=typeof stylealpha&&(ret.a=parseFloat(stylealpha)),ret};return function(){var style=this.stylespec,useScreen="undefined"==typeof style.useScreen?!1:style.useScreen,showBackground=style.showBackground;("0"===showBackground||"false"===showBackground)&&(showBackground=!1),"undefined"==typeof showBackground&&(showBackground=!0);var font=style.font?style.font:"sans-serif",fontSize=parseInt(style.fontSize)?parseInt(style.fontSize):18,fontColor=getColor(style.fontColor,style.fontOpacity,{r:255,g:255,b:255,a:1}),padding=style.padding?style.padding:4,borderThickness=style.borderThickness?style.borderThickness:0,backgroundColor=getColor(style.backgroundColor,style.backgroundOpacity,{r:0,g:0,b:0,a:1}),borderColor=getColor(style.borderColor,style.borderOpacity,backgroundColor),position=style.position?style.position:{x:-10,y:1,z:1},inFront=void 0!==style.inFront?style.inFront:!0;("false"===inFront||"0"===inFront)&&(inFront=!1);var spriteAlignment=style.alignment||$3Dmol.SpriteAlignment.topLeft,bold="";style.bold&&(bold="bold "),this.context.font=bold+fontSize+"px  "+font;var metrics=this.context.measureText(this.text),textWidth=metrics.width;showBackground||(borderThickness=0);var width=textWidth+2.5*borderThickness+2*padding,height=1.25*fontSize+2*borderThickness+2*padding;if(style.backgroundImage){var img=style.backgroundImage,w=style.backgroundWidth?style.backgroundWidth:img.width,h=style.backgroundHeight?style.backgroundHeight:img.height;w>width&&(width=w),h>height&&(height=h)}this.canvas.width=width,this.canvas.height=height,this.context.clearRect(0,0,this.canvas.width,this.canvas.height);var bold="";if(style.bold&&(bold="bold "),this.context.font=bold+fontSize+"px  "+font,this.context.fillStyle="rgba("+backgroundColor.r+","+backgroundColor.g+","+backgroundColor.b+","+backgroundColor.a+")",this.context.strokeStyle="rgba("+borderColor.r+","+borderColor.g+","+borderColor.b+","+borderColor.a+")",this.context.lineWidth=borderThickness,showBackground&&roundRect(this.context,borderThickness,borderThickness,width-2*borderThickness,height-2*borderThickness,6,borderThickness>0),style.backgroundImage){var img=style.backgroundImage,w=style.backgroundWidth?style.backgroundWidth:img.width,h=style.backgroundHeight?style.backgroundHeight:img.height;this.context.drawImage(img,0,0,w,h)}this.context.fillStyle="rgba("+fontColor.r+","+fontColor.g+","+fontColor.b+","+fontColor.a+")",this.context.fillText(this.text,borderThickness+padding,fontSize+borderThickness+padding,textWidth);var texture=new $3Dmol.Texture(this.canvas);texture.needsUpdate=!0,this.sprite.material=new $3Dmol.SpriteMaterial({map:texture,useScreenCoordinates:useScreen,alignment:spriteAlignment,depthTest:!inFront}),this.sprite.scale.set(1,1,1),this.sprite.position.set(position.x,position.y,position.z)}}(),dispose:function(){void 0!==this.sprite.material.map&&this.sprite.material.map.dispose(),void 0!==this.sprite.material&&this.sprite.material.dispose()}},$3Dmol=$3Dmol||{},$3Dmol.MarchingCubeInitializer=function(){var ISDONE=2,my={};my.march=function(data,verts,faces,spec){var fulltable=!!spec.fulltable,origin=spec.hasOwnProperty("origin")&&spec.origin.hasOwnProperty("x")?spec.origin:{x:0,y:0,z:0},voxel=!!spec.voxel,nX=spec.nX||0,nY=spec.nY||0,nZ=spec.nZ||0,scale=spec.scale||1,unitCube=null;unitCube=spec.unitCube?spec.unitCube:{x:scale,y:scale,z:scale};var i,il,vertnums=new Int32Array(nX*nY*nZ);for(i=0,il=vertnums.length;il>i;++i)vertnums[i]=-1;var getVertex=function(i,j,k,code,p1,p2){var pt={x:origin.x,y:origin.y,z:origin.z},val1=!!(code&1<<p1),val2=!!(code&1<<p2),p=p1;!val1&&val2&&(p=p2),1&p&&k++,2&p&&j++,4&p&&i++,pt.x+=unitCube.x*i,pt.y+=unitCube.y*j,pt.z+=unitCube.z*k;var index=(nY*i+j)*nZ+k;return voxel?(verts.push(pt),verts.length-1):(vertnums[index]<0&&(vertnums[index]=verts.length,verts.push(pt)),vertnums[index])},intersects=new Int32Array(12),etable=fulltable?edgeTable2:edgeTable,tritable=fulltable?triTable2:triTable;for(i=0;nX-1>i;++i)for(var j=0;nY-1>j;++j)for(var k=0;nZ-1>k;++k){for(var code=0,p=0;8>p;++p){var index=(nY*(i+((4&p)>>2))+j+((2&p)>>1))*nZ+k+(1&p),val=!!(data[index]&ISDONE);code|=val<<p}if(0!==code&&255!==code){var ecode=etable[code];if(0!==ecode){var ttable=tritable[code];1&ecode&&(intersects[0]=getVertex(i,j,k,code,0,1)),2&ecode&&(intersects[1]=getVertex(i,j,k,code,1,3)),4&ecode&&(intersects[2]=getVertex(i,j,k,code,3,2)),8&ecode&&(intersects[3]=getVertex(i,j,k,code,2,0)),16&ecode&&(intersects[4]=getVertex(i,j,k,code,4,5)),32&ecode&&(intersects[5]=getVertex(i,j,k,code,5,7)),64&ecode&&(intersects[6]=getVertex(i,j,k,code,7,6)),128&ecode&&(intersects[7]=getVertex(i,j,k,code,6,4)),256&ecode&&(intersects[8]=getVertex(i,j,k,code,0,4)),512&ecode&&(intersects[9]=getVertex(i,j,k,code,1,5)),1024&ecode&&(intersects[10]=getVertex(i,j,k,code,3,7)),2048&ecode&&(intersects[11]=getVertex(i,j,k,code,2,6));for(var t=0;t<ttable.length;t+=3){var a=intersects[ttable[t]],b=intersects[ttable[t+1]],c=intersects[ttable[t+2]];voxel&&t>=3&&(verts.push(verts[a]),a=verts.length-1,verts.push(verts[b]),b=verts.length-1,verts.push(verts[c]),c=verts.length-1),faces.push(a),faces.push(b),faces.push(c)}}}}},my.laplacianSmooth=function(numiter,verts,faces){var i,il,j,jl,k,tps=new Array(verts.length);for(i=0,il=verts.length;il>i;i++)tps[i]={x:0,y:0,z:0};var flagvert,vertdeg=new Array(20);for(i=0;20>i;i++)vertdeg[i]=new Array(verts.length);for(i=0,il=verts.length;il>i;i++)vertdeg[0][i]=0;for(i=0,il=faces.length/3;il>i;i++){var aoffset=3*i,boffset=3*i+1,coffset=3*i+2;for(flagvert=!0,j=0,jl=vertdeg[0][faces[aoffset]];jl>j;j++)if(faces[boffset]==vertdeg[j+1][faces[aoffset]]){flagvert=!1;break}for(flagvert&&(vertdeg[0][faces[aoffset]]++,vertdeg[vertdeg[0][faces[aoffset]]][faces[aoffset]]=faces[boffset]),flagvert=!0,j=0,jl=vertdeg[0][faces[aoffset]];jl>j;j++)if(faces[coffset]==vertdeg[j+1][faces[aoffset]]){flagvert=!1;break}for(flagvert&&(vertdeg[0][faces[aoffset]]++,vertdeg[vertdeg[0][faces[aoffset]]][faces[aoffset]]=faces[coffset]),flagvert=!0,j=0,jl=vertdeg[0][faces[boffset]];jl>j;j++)if(faces[aoffset]==vertdeg[j+1][faces[boffset]]){flagvert=!1;break}for(flagvert&&(vertdeg[0][faces[boffset]]++,vertdeg[vertdeg[0][faces[boffset]]][faces[boffset]]=faces[aoffset]),flagvert=!0,j=0,jl=vertdeg[0][faces[boffset]];jl>j;j++)if(faces[coffset]==vertdeg[j+1][faces[boffset]]){flagvert=!1;break}for(flagvert&&(vertdeg[0][faces[boffset]]++,vertdeg[vertdeg[0][faces[boffset]]][faces[boffset]]=faces[coffset]),flagvert=!0,j=0;j<vertdeg[0][faces[coffset]];j++)if(faces[aoffset]==vertdeg[j+1][faces[coffset]]){flagvert=!1;break}for(flagvert&&(vertdeg[0][faces[coffset]]++,vertdeg[vertdeg[0][faces[coffset]]][faces[coffset]]=faces[aoffset]),flagvert=!0,j=0,jl=vertdeg[0][faces[coffset]];jl>j;j++)if(faces[boffset]==vertdeg[j+1][faces[coffset]]){flagvert=!1;break}flagvert&&(vertdeg[0][faces[coffset]]++,vertdeg[vertdeg[0][faces[coffset]]][faces[coffset]]=faces[boffset])}var wt=1,wt2=.5;for(k=0;numiter>k;k++){for(i=0,il=verts.length;il>i;i++)if(vertdeg[0][i]<3)tps[i].x=verts[i].x,tps[i].y=verts[i].y,tps[i].z=verts[i].z;else if(3==vertdeg[0][i]||4==vertdeg[0][i]){for(tps[i].x=0,tps[i].y=0,tps[i].z=0,j=0,jl=vertdeg[0][i];jl>j;j++)tps[i].x+=verts[vertdeg[j+1][i]].x,tps[i].y+=verts[vertdeg[j+1][i]].y,tps[i].z+=verts[vertdeg[j+1][i]].z;tps[i].x+=wt2*verts[i].x,tps[i].y+=wt2*verts[i].y,tps[i].z+=wt2*verts[i].z,tps[i].x/=wt2+vertdeg[0][i],tps[i].y/=wt2+vertdeg[0][i],tps[i].z/=wt2+vertdeg[0][i]}else{for(tps[i].x=0,tps[i].y=0,tps[i].z=0,j=0,jl=vertdeg[0][i];jl>j;j++)tps[i].x+=verts[vertdeg[j+1][i]].x,tps[i].y+=verts[vertdeg[j+1][i]].y,tps[i].z+=verts[vertdeg[j+1][i]].z;tps[i].x+=wt*verts[i].x,tps[i].y+=wt*verts[i].y,tps[i].z+=wt*verts[i].z,tps[i].x/=wt+vertdeg[0][i],tps[i].y/=wt+vertdeg[0][i],tps[i].z/=wt+vertdeg[0][i]}for(i=0,il=verts.length;il>i;i++)verts[i].x=tps[i].x,verts[i].y=tps[i].y,verts[i].z=tps[i].z}},my.edgeTable=[0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0];var edgeTable=new Uint32Array(my.edgeTable),triTable=my.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],edgeTable2=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],triTable2=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]];
return my},$3Dmol.MarchingCube=$3Dmol.MarchingCubeInitializer(),$3Dmol.Parsers=function(){var parsers={},assignBonds=function(atoms){for(var i=0,n=atoms.length;n>i;i++)atoms[i].index||(atoms[i].index=i);for(var grid={},MAX_BOND_LENGTH=4.95,index=0;index<atoms.length;index++){var atom=atoms[index],x=Math.floor(atom.x/MAX_BOND_LENGTH),y=Math.floor(atom.y/MAX_BOND_LENGTH),z=Math.floor(atom.z/MAX_BOND_LENGTH);grid[x]||(grid[x]={}),grid[x][y]||(grid[x][y]={}),grid[x][y][z]||(grid[x][y][z]=[]),grid[x][y][z].push(atom)}var findConnections=function(points,otherPoints){for(var i=0;i<points.length;i++)for(var atom1=points[i],j=0;j<otherPoints.length;j++){var atom2=otherPoints[j];areConnected(atom1,atom2)&&-1==atom1.bonds.indexOf(atom2.index)&&(atom1.bonds.push(atom2.index),atom1.bondOrder.push(1),atom2.bonds.push(atom1.index),atom2.bondOrder.push(1))}},OFFSETS=[{x:0,y:0,z:1},{x:0,y:1,z:-1},{x:0,y:1,z:0},{x:0,y:1,z:1},{x:1,y:-1,z:-1},{x:1,y:-1,z:0},{x:1,y:-1,z:1},{x:1,y:0,z:-1},{x:1,y:0,z:0},{x:1,y:0,z:1},{x:1,y:1,z:-1},{x:1,y:1,z:0},{x:1,y:1,z:1}];for(var x in grid){x=parseInt(x);for(var y in grid[x]){y=parseInt(y);for(var z in grid[x][y]){z=parseInt(z);for(var points=grid[x][y][z],i=0;i<points.length;i++)for(var atom1=points[i],j=i+1;j<points.length;j++){var atom2=points[j];areConnected(atom1,atom2)&&-1==atom1.bonds.indexOf(atom2.index)&&(atom1.bonds.push(atom2.index),atom1.bondOrder.push(1),atom2.bonds.push(atom1.index),atom2.bondOrder.push(1))}for(var o=0;o<OFFSETS.length;o++){var offset=OFFSETS[o];if(grid[x+offset.x]&&grid[x+offset.x][y+offset.y]&&grid[x+offset.x][y+offset.y][z+offset.z]){var otherPoints=grid[x+offset.x][y+offset.y][z+offset.z];findConnections(points,otherPoints)}}}}}},assignPDBBonds=function(atomsarray){var i,n,protatoms=[],hetatoms=[];for(i=0,n=atomsarray.length;n>i;i++){var atom=atomsarray[i];atom.index=i,atom.hetflag?hetatoms.push(atom):protatoms.push(atom)}assignBonds(hetatoms),protatoms.sort(function(a,b){return a.chain!=b.chain?a.chain<b.chain?-1:1:a.resi-b.resi});var lastResConnected,currentResi=-1,reschain=-1;for(i=0,n=protatoms.length;n>i;i++){var ai=protatoms[i];ai.resi!==currentResi&&(currentResi=ai.resi,lastResConnected||reschain++,lastResConnected=!1),ai.reschain=reschain;for(var j=i+1;j<protatoms.length;j++){var aj=protatoms[j];if(aj.chain!=ai.chain)break;if(aj.resi-ai.resi>1)break;areConnected(ai,aj)&&(-1===ai.bonds.indexOf(aj.index)&&(ai.bonds.push(aj.index),ai.bondOrder.push(1),aj.bonds.push(ai.index),aj.bondOrder.push(1)),ai.resi!==aj.resi&&(lastResConnected=!0))}}},assignBackboneHBonds=function(atomsarray){var i,j,n,maxlength=3.2,maxlengthSq=10.24,atoms=[];for(i=0,n=atomsarray.length;n>i;i++){atomsarray[i].index=i;var atom=atomsarray[i];atom.hetflag||"N"!==atom.atom&&"O"!==atom.atom||(atoms.push(atom),atom.hbondOther=null,atom.hbondDistanceSq=Number.POSITIVE_INFINITY)}for(atoms.sort(function(a,b){return a.z-b.z}),i=0,n=atoms.length;n>i;i++){var ai=atoms[i];for(j=i+1;n>j;j++){var aj=atoms[j],zdiff=aj.z-ai.z;if(zdiff>maxlength)break;if(aj.atom!=ai.atom){var ydiff=Math.abs(aj.y-ai.y);if(!(ydiff>maxlength)){var xdiff=Math.abs(aj.x-ai.x);if(!(xdiff>maxlength)){var dist=xdiff*xdiff+ydiff*ydiff+zdiff*zdiff;dist>maxlengthSq||aj.chain==ai.chain&&Math.abs(aj.resi-ai.resi)<4||(dist<ai.hbondDistanceSq&&(ai.hbondOther=aj,ai.hbondDistanceSq=dist),dist<aj.hbondDistanceSq&&(aj.hbondOther=ai,aj.hbondDistanceSq=dist))}}}}}},computeSecondaryStructure=function(atomsarray){assignBackboneHBonds(atomsarray);var i,il,c,r,atom,val,chres={};for(i=0,il=atomsarray.length;il>i;i++)if(atom=atomsarray[i],"undefined"==typeof chres[atom.chain]&&(chres[atom.chain]=[]),isFinite(atom.hbondDistanceSq)){var other=atom.hbondOther;"undefined"==typeof chres[other.chain]&&(chres[other.chain]=[]),4===Math.abs(other.resi-atom.resi)&&(chres[atom.chain][atom.resi]="h")}for(c in chres)for(r=1;r<chres[c].length-1;r++){var valbefore=chres[c][r-1],valafter=chres[c][r+1];val=chres[c][r],"h"==valbefore&&valbefore==valafter&&val!=valbefore&&(chres[c][r]=valbefore)}for(i=0,il=atomsarray.length;il>i;i++)atom=atomsarray[i],isFinite(atom.hbondDistanceSq)&&"h"!=chres[atom.chain][atom.resi]&&"h"!=atom.ss&&(chres[atom.chain][atom.resi]="maybesheet");for(i=0,il=atomsarray.length;il>i;i++)if(atom=atomsarray[i],isFinite(atom.hbondDistanceSq)&&"maybesheet"==chres[atom.chain][atom.resi]){var other=atom.hbondOther,otherval=chres[other.chain][other.resi];("maybesheet"==otherval||"s"==otherval)&&(chres[atom.chain][atom.resi]="s",chres[other.chain][other.resi]="s")}for(c in chres){for(r=1;r<chres[c].length-1;r++){var valbefore=chres[c][r-1],valafter=chres[c][r+1];val=chres[c][r],"s"==valbefore&&valbefore==valafter&&val!=valbefore&&(chres[c][r]=valbefore)}for(r=0;r<chres[c].length;r++)val=chres[c][r],("h"==val||"s"==val)&&chres[c][r-1]!=val&&chres[c][r+1]!=val&&delete chres[c][r]}for(i=0,il=atomsarray.length;il>i;i++)atom=atomsarray[i],val=chres[atom.chain][atom.resi],"undefined"!=typeof val&&"maybesheet"!=val&&(atom.ss=val,chres[atom.chain][atom.resi-1]!=val&&(atom.ssbegin=!0),chres[atom.chain][atom.resi+1]!=val&&(atom.ssend=!0))};parsers.cube=parsers.CUBE=function(str,options){var atoms=[[]],lines=str.replace(/^\s+/,"").split(/\n\r|\r+/);if(lines.length<6)return atoms;var lineArr=lines[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),natoms=Math.abs(parseFloat(lineArr[0]));lineArr=lines[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var convFactor=parseFloat(lineArr[0])>0?.529177:1;lines=lines.splice(6,natoms);for(var start=atoms[atoms.length-1].length,end=start+lines.length,i=start;end>i;++i){var atom={};atom.serial=i;var line=lines[i-start],tokens=line.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");6==tokens[0]?atom.elem="C":1==tokens[0]?atom.elem="H":8==tokens[0]?atom.elem="O":17==tokens[0]&&(atom.elem="Cl"),atom.x=parseFloat(tokens[2])*convFactor,atom.y=parseFloat(tokens[3])*convFactor,atom.z=parseFloat(tokens[4])*convFactor,atom.hetflag=!0,atom.bonds=[],atom.bondOrder=[],atom.properties={},atoms[atoms.length-1].push(atom)}for(var i=0;i<atoms.length;i++)assignBonds(atoms[i]);return atoms},parsers.xyz=parsers.XYZ=function(str,options){for(var atoms=[[]],lines=str.split(/\r?\n|\r/);lines.length>0&&!(lines.length<3);){var atomCount=parseInt(lines[0].substr(0,3));if(isNaN(atomCount)||0>=atomCount)break;if(lines.length<atomCount+2)break;for(var offset=2,start=atoms[atoms.length-1].length,end=start+atomCount,i=start;end>i;i++){var line=lines[offset++],tokens=line.replace(/^\s+/,"").replace(/\s+/g," ").split(" "),atom={};atom.serial=i;var elem=tokens[0];atom.atom=atom.elem=elem[0].toUpperCase()+elem.substr(1).toLowerCase(),atom.x=parseFloat(tokens[1]),atom.y=parseFloat(tokens[2]),atom.z=parseFloat(tokens[3]),atom.hetflag=!0,atom.bonds=[],atom.bondOrder=[],atom.properties={},atoms[atoms.length-1][i]=atom,tokens.length>=7&&(atom.dx=parseFloat(tokens[4]),atom.dy=parseFloat(tokens[5]),atom.dz=parseFloat(tokens[6]))}if(!options.multimodel)break;atoms.push([]),lines.splice(0,offset)}for(var i=0;i<atoms.length;i++)assignBonds(atoms[i]);if(options.onemol){var temp=atoms;atoms=[],atoms.push(temp[0]);for(var i=1;i<temp.length;i++)for(var offset=atoms[0].length,j=0;j<temp[i].length;j++){for(var a=temp[i][j],k=0;k<a.bonds.length;k++)a.bonds[k]=a.bonds[k]+offset;a.index=atoms[0].length,a.serial=atoms[0].length,atoms[0].push(a)}}return atoms},parsers.sdf=parsers.SDF=function(str,options){var atoms=[[]],noH=!1;"undefined"!=typeof options.keepH&&(noH=!options.keepH);for(var lines=str.split(/\r?\n|\r/);lines.length>0&&!(lines.length<4);){var atomCount=parseInt(lines[3].substr(0,3));if(isNaN(atomCount)||0>=atomCount)break;var bondCount=parseInt(lines[3].substr(3,3)),offset=4;if(lines.length<4+atomCount+bondCount)break;var i,line,serialToIndex=[],start=atoms[atoms.length-1].length,end=start+atomCount;for(i=start;end>i;i++,offset++){line=lines[offset];var atom={},elem=line.substr(31,3).replace(/ /g,"");atom.atom=atom.elem=elem[0].toUpperCase()+elem.substr(1).toLowerCase(),"H"==atom.elem&&noH||(atom.serial=i,serialToIndex[i]=atoms[atoms.length-1].length,atom.x=parseFloat(line.substr(0,10)),atom.y=parseFloat(line.substr(10,10)),atom.z=parseFloat(line.substr(20,10)),atom.hetflag=!0,atom.bonds=[],atom.bondOrder=[],atom.properties={},atom.index=atoms[atoms.length-1].length,atoms[atoms.length-1].push(atom))}for(i=0;bondCount>i;i++,offset++){line=lines[offset];var from=serialToIndex[parseInt(line.substr(0,3))-1+start],to=serialToIndex[parseInt(line.substr(3,3))-1+start],order=parseInt(line.substr(6,3));"undefined"!=typeof from&&"undefined"!=typeof to&&(atoms[atoms.length-1][from].bonds.push(to),atoms[atoms.length-1][from].bondOrder.push(order),atoms[atoms.length-1][to].bonds.push(from),atoms[atoms.length-1][to].bondOrder.push(order))}if(!options.multimodel)break;for(options.onemol||atoms.push([]);"$$$$"!=lines[offset];)offset++;lines.splice(0,++offset)}return atoms},parsers.cdjson=parsers.json=function(str,options){var atoms=[[]];"string"==typeof str&&(str=JSON.parse(str));for(var molecules=str.m,atomsInFile=molecules[0].a,bondsInFile=molecules[0].b,styles=molecules[0].s,parseStyle=void 0!==options&&void 0!==options.parseStyle?options.parseStyle:void 0!==styles,offset=atoms[atoms.length-1].length,i=0;i<atomsInFile.length;i++){var currentAtom=atomsInFile[i],atom={};atom.id=currentAtom.i,atom.x=currentAtom.x,atom.y=currentAtom.y,atom.z=currentAtom.z||0,atom.bonds=[],atom.bondOrder=[];var elem=currentAtom.l||"C";atom.elem=elem[0].toUpperCase()+elem.substr(1).toLowerCase(),atom.serial=atoms[atoms.length-1].length,parseStyle&&(atom.style=styles[currentAtom.s||0]),atoms[atoms.length-1].push(atom)}for(var i=0;i<bondsInFile.length;i++){var currentBond=bondsInFile[i],beginIndex=currentBond.b+offset,endIndex=currentBond.e+offset,bondOrder=currentBond.o||1,firstAtom=atoms[atoms.length-1][beginIndex],secondAtom=atoms[atoms.length-1][endIndex];firstAtom.bonds.push(endIndex),firstAtom.bondOrder.push(bondOrder),secondAtom.bonds.push(beginIndex),secondAtom.bondOrder.push(bondOrder)}return atoms},parsers.mcif=parsers.cif=function(str,options){function splitRespectingQuotes(string,separator){for(var sections=[],sectionStart=0,sectionEnd=0;sectionEnd<string.length;){for(;string.substr(sectionEnd,separator.length)!==separator&&sectionEnd<string.length;){if("'"===string[sectionEnd])for(sectionEnd++;sectionEnd<string.length&&"'"!==string[sectionEnd];)sectionEnd++;else if('"'===string[sectionEnd])for(sectionEnd++;sectionEnd<string.length&&'"'!==string[sectionEnd];)sectionEnd++;sectionEnd++}sections.push(string.substr(sectionStart,sectionEnd-sectionStart)),sectionStart=sectionEnd+=separator.length}return sections}function sqr(n){return n*n}function fractionalToCartesian(a,b,c){var x=conversionMatrix[0][0]*a+conversionMatrix[0][1]*b+conversionMatrix[0][2]*c,y=conversionMatrix[1][0]*a+conversionMatrix[1][1]*b+conversionMatrix[1][2]*c,z=conversionMatrix[2][0]*a+conversionMatrix[2][1]*b+conversionMatrix[2][2]*c;return{x:x,y:y,z:z}}function parseTerm(term){var negative=term.match("-");term=term.replace(/[-xyz]/g,"");var numerator,denominator,fractionParts=term.split("/");return denominator=void 0===fractionParts[1]?1:parseInt(fractionParts[1]),numerator=""===fractionParts[0]?1:parseInt(fractionParts[0]),numerator/denominator*(negative?-1:1)}for(var atoms=[],noAssembly=!options.doAssembly,copyMatrix=!options.duplicateAssemblyAtoms,modelData=atoms.modelData=[],lines=str.split(/\r?\n|\r/),linesFiltered=[],trimDisabled=!1,lineNum=0;lineNum<lines.length;lineNum++){var line=lines[lineNum].split("#")[0];if(trimDisabled?";"===line[0]&&(trimDisabled=!1):";"===line[0]&&(trimDisabled=!0),trimDisabled||""!==line){if(!trimDisabled&&(line=line.trim(),"_"===line[0])){var dot=line.split(/\s/)[0].indexOf(".");dot>-1&&(line[dot]="_",line=line.substr(0,dot)+"_"+line.substr(dot+1))}linesFiltered.push(line)}}for(var lineNum=0;lineNum<linesFiltered.length;){for(;!linesFiltered[lineNum].startsWith("data_")||"data_global"===linesFiltered[lineNum];)lineNum++;lineNum++;for(var mmCIF={};lineNum<linesFiltered.length&&!linesFiltered[lineNum].startsWith("data_");)if(void 0===linesFiltered[lineNum][0])lineNum++;else if("_"===linesFiltered[lineNum][0]){var dataItemName=linesFiltered[lineNum].split(/\s/)[0].toLowerCase(),dataItem=mmCIF[dataItemName]=mmCIF[dataItemName]||[],restOfLine=linesFiltered[lineNum].substr(linesFiltered[lineNum].indexOf(dataItemName)+dataItemName.length);if(""===restOfLine)if(lineNum++,";"===linesFiltered[lineNum][0]){var dataBlock=linesFiltered[lineNum].substr(1);for(lineNum++;";"!==linesFiltered[lineNum];)dataBlock=dataBlock+"\n"+linesFiltered[lineNum],lineNum++;dataItem.push(dataBlock)}else dataItem.push(linesFiltered[lineNum]);else dataItem.push(restOfLine.trim());lineNum++}else if("loop_"===linesFiltered[lineNum].substr(0,5)){lineNum++;for(var dataItems=[];""===linesFiltered[lineNum]||"_"===linesFiltered[lineNum][0];){if(""!==linesFiltered[lineNum]){var dataItemName=linesFiltered[lineNum].split(/\s/)[0].toLowerCase(),dataItem=mmCIF[dataItemName]=mmCIF[dataItemName]||[];dataItems.push(dataItem)}lineNum++}for(var currentDataItem=0;lineNum<linesFiltered.length&&"_"!==linesFiltered[lineNum][0]&&!linesFiltered[lineNum].startsWith("loop_")&&!linesFiltered[lineNum].startsWith("data_");){for(var line=splitRespectingQuotes(linesFiltered[lineNum]," "),field=0;field<line.length;field++)""!==line[field]&&(dataItems[currentDataItem].push(line[field]),currentDataItem=(currentDataItem+1)%dataItems.length);lineNum++}}else lineNum++;modelData.push({symmetries:[]}),atoms.push([]);var conversionMatrix,atomCount=void 0!==mmCIF._atom_site_id?mmCIF._atom_site_id.length:mmCIF._atom_site_label.length;if(void 0!==mmCIF._cell_length_a){var a=parseFloat(mmCIF._cell_length_a),b=parseFloat(mmCIF._cell_length_b),c=parseFloat(mmCIF._cell_length_c),alpha_deg=parseFloat(mmCIF._cell_angle_alpha)||90,beta_deg=parseFloat(mmCIF._cell_angle_beta)||90,gamma_deg=parseFloat(mmCIF._cell_angle_gamma)||90,alpha=alpha_deg*Math.PI/180,beta=beta_deg*Math.PI/180,gamma=gamma_deg*Math.PI/180,cos_alpha=Math.cos(alpha),cos_beta=Math.cos(beta),cos_gamma=Math.cos(gamma),sin_gamma=Math.sin(gamma);conversionMatrix=[[a,b*cos_gamma,c*cos_beta],[0,b*sin_gamma,c*(cos_alpha-cos_beta*cos_gamma)/sin_gamma],[0,0,c*Math.sqrt(1-sqr(cos_alpha)-sqr(cos_beta)-sqr(cos_gamma)+2*cos_alpha*cos_beta*cos_gamma)/sin_gamma]],modelData[modelData.length-1].cryst={a:a,b:b,c:c,alpha:alpha_deg,beta:beta_deg,gamma:gamma_deg}}for(var i=0;atomCount>i;i++)if(void 0===mmCIF._atom_site_group_pdb||"TER"!==mmCIF._atom_site_group_pdb[i]){var atom={};if(void 0!==mmCIF._atom_site_cartn_x)atom.x=parseFloat(mmCIF._atom_site_cartn_x[i]),atom.y=parseFloat(mmCIF._atom_site_cartn_y[i]),atom.z=parseFloat(mmCIF._atom_site_cartn_z[i]);else{var coords=fractionalToCartesian(parseFloat(mmCIF._atom_site_fract_x[i]),parseFloat(mmCIF._atom_site_fract_y[i]),parseFloat(mmCIF._atom_site_fract_z[i]));atom.x=coords.x,atom.y=coords.y,atom.z=coords.z}atom.chain=mmCIF._atom_site_auth_asym_id?mmCIF._atom_site_auth_asym_id[i]:void 0,atom.resi=mmCIF._atom_site_auth_seq_id?parseInt(mmCIF._atom_site_auth_seq_id[i]):void 0,atom.resn=mmCIF._atom_site_auth_comp_id?mmCIF._atom_site_auth_comp_id[i].trim():void 0,atom.atom=mmCIF._atom_site_auth_atom_id?mmCIF._atom_site_auth_atom_id[i].replace(/"/gm,""):void 0,atom.hetflag=!mmCIF._atom_site_group_pdb||"HETA"===mmCIF._atom_site_group_pdb[i]||"HETATM"===mmCIF._atom_site_group_pdb[i];var elem=mmCIF._atom_site_type_symbol[i];atom.elem=elem[0].toUpperCase()+elem.substr(1).toLowerCase(),atom.bonds=[],atom.ss="c",atom.serial=i,atom.bondOrder=[],atom.properties={},atoms[atoms.length-1].push(atom)}if(void 0!==mmCIF._pdbx_struct_oper_list_id&&!noAssembly){for(var i=0;i<mmCIF._pdbx_struct_oper_list_id.length;i++){var matrix11=parseFloat(mmCIF["_pdbx_struct_oper_list_matrix[1][1]"][i]),matrix12=parseFloat(mmCIF["_pdbx_struct_oper_list_matrix[1][2]"][i]),matrix13=parseFloat(mmCIF["_pdbx_struct_oper_list_matrix[1][3]"][i]),vector1=parseFloat(mmCIF["_pdbx_struct_oper_list_vector[1]"][i]),matrix21=parseFloat(mmCIF["_pdbx_struct_oper_list_matrix[2][1]"][i]),matrix22=parseFloat(mmCIF["_pdbx_struct_oper_list_matrix[2][2]"][i]),matrix23=parseFloat(mmCIF["_pdbx_struct_oper_list_matrix[2][3]"][i]),vector2=parseFloat(mmCIF["_pdbx_struct_oper_list_vector[2]"][i]),matrix31=parseFloat(mmCIF["_pdbx_struct_oper_list_matrix[3][1]"][i]),matrix32=parseFloat(mmCIF["_pdbx_struct_oper_list_matrix[3][2]"][i]),matrix33=parseFloat(mmCIF["_pdbx_struct_oper_list_matrix[3][3]"][i]),vector3=parseFloat(mmCIF["_pdbx_struct_oper_list_vector[3]"][i]),matrix=new $3Dmol.Matrix4(matrix11,matrix12,matrix13,vector1,matrix21,matrix22,matrix23,vector2,matrix31,matrix32,matrix33,vector3);modelData[modelData.length-1].symmetries.push(matrix)}for(var i=0;i<atoms.length;i++)processSymmetries(modelData[modelData.length-1].symmetries,copyMatrix,atoms[i])}if(void 0!==mmCIF._symmetry_equiv_pos_as_xyz)for(var sym=0;sym<mmCIF._symmetry_equiv_pos_as_xyz.length;sym++){for(var transform=mmCIF._symmetry_equiv_pos_as_xyz[sym].replace(/["' ]/g,""),componentStrings=transform.split(",").map(function(val){return val.replace(/-/g,"+-")}),matrix=new $3Dmol.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1),coord=0;3>coord;coord++)for(var terms=componentStrings[coord].split("+"),t=0;t<terms.length;t++){var term=terms[t];if(""!==term){var coefficient=parseTerm(term);term.match("x")?matrix.elements[coord+0]=coefficient:term.match("y")?matrix.elements[coord+4]=coefficient:term.match("z")?matrix.elements[coord+8]=coefficient:matrix.elements[coord+12]=coefficient}}var conversionMatrix4=new $3Dmol.Matrix4(conversionMatrix[0][0],conversionMatrix[0][1],conversionMatrix[0][2],0,conversionMatrix[1][0],conversionMatrix[1][1],conversionMatrix[1][2],0,conversionMatrix[2][0],conversionMatrix[2][1],conversionMatrix[2][2],0),conversionInverse=(new $3Dmol.Matrix4).getInverse(conversionMatrix4,!0);matrix=(new $3Dmol.Matrix4).multiplyMatrices(matrix,conversionInverse),matrix=(new $3Dmol.Matrix4).multiplyMatrices(conversionMatrix4,matrix),modelData[modelData.length-1].symmetries.push(matrix)}}for(var i=0;i<atoms.length;i++)assignBonds(atoms[i]),computeSecondaryStructure(atoms[i]),processSymmetries(modelData[modelData.length-1].symmetries,copyMatrix,atoms[i]);return atoms},parsers.mol2=parsers.MOL2=function(str,options){var atoms=[[]],noH=!1;"undefined"!=typeof options.keepH&&(noH=!options.keepH);for(var lines=str.substr(mol_pos,str.length).split(/\r?\n|\r/);lines.length>0;){var mol_pos=str.search(/@<TRIPOS>MOLECULE/),atom_pos=str.search(/@<TRIPOS>ATOM/);if(-1==mol_pos||-1==atom_pos)break;var serialToIndex=[],tokens=lines[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),natoms=parseInt(tokens[0]),nbonds=0;tokens.length>1&&(nbonds=parseInt(tokens[1]));var i,offset=4;for(i=3;i<lines.length;i++)if("@<TRIPOS>ATOM"==lines[i]){offset=i+1;break}var line,start=atoms[atoms.length-1].length,end=start+natoms;for(i=start;end>i;i++){line=lines[offset++],tokens=line.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var atom={},elem=tokens[5].split(".")[0];if(atom.atom=atom.elem=elem[0].toUpperCase()+elem.substr(1).toLowerCase(),"H"==atom.elem&&noH);else{var index=atoms[atoms.length-1].length,serial=parseInt(tokens[0]);atom.serial=serial,atom.x=parseFloat(tokens[2]),atom.y=parseFloat(tokens[3]),atom.z=parseFloat(tokens[4]),atom.atom=tokens[5];var charge=parseFloat(tokens[8]);atom.index=index,atom.bonds=[],atom.bondOrder=[],atom.properties={charge:charge,partialCharge:charge},serialToIndex[serial]=index,atoms[atoms.length-1].push(atom)}}for(var bonds_found=!1;offset<lines.length;)if("@<TRIPOS>BOND"==lines[offset++]){bonds_found=!0;break}if(bonds_found&&nbonds)for(i=0;nbonds>i;i++){line=lines[offset++],tokens=line.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var from=parseInt(tokens[1]);fromAtom=atoms[atoms.length-1][serialToIndex[from]];var to=parseInt(tokens[2]);toAtom=atoms[atoms.length-1][serialToIndex[to]];var order=parseInt(tokens[3]);isNaN(order)&&(order=1),void 0!==fromAtom&&void 0!==toAtom&&(fromAtom.bonds.push(serialToIndex[to]),fromAtom.bondOrder.push(order),toAtom.bonds.push(serialToIndex[from]),toAtom.bondOrder.push(order))}if(!options.multimodel)break;options.onemol||atoms.push([]),lines.splice(0,offset),str=lines.join("\n")}return atoms};var bondTable={H:.37,He:.32,Li:1.34,Be:.9,B:.82,C:.77,N:.75,O:.73,F:.71,Ne:.69,Na:1.54,Mg:1.3,Al:1.18,Si:1.11,P:1.06,S:1.02,Cl:.99,Ar:.97,K:1.96,Ca:1.74,Sc:1.44,Ti:1.56,V:1.25,Mn:1.39,Fe:1.25,Co:1.26,Ni:1.21,Cu:1.38,Zn:1.31,Ga:1.26,Ge:1.22,Se:1.16,Br:1.14,Kr:1.1,Rb:2.11,Sr:1.92,Y:1.62,Zr:1.48,Nb:1.37,Mo:1.45,Tc:1.56,Ru:1.26,Rh:1.35,Pd:1.31,Ag:1.53,Cd:1.48,In:1.44,Sn:1.41,Sb:1.38,Te:1.35,I:1.33,Xe:1.3,Cs:2.25,Ba:1.98,Lu:1.6,Hf:1.5,Ta:1.38,W:1.46,Re:1.59,Os:1.44,Ir:1.37,Pt:1.28,Au:1.44,Hg:1.49,Tl:1.48,Pb:1.47,Bi:1.46,Rn:1.45},bondLength=function(elem){return bondTable[elem]||1.6},areConnected=function(atom1,atom2){var maxsq=bondLength(atom1.elem)+bondLength(atom2.elem);maxsq+=.25,maxsq*=maxsq;var xdiff=atom1.x-atom2.x;if(xdiff*=xdiff,xdiff>maxsq)return!1;var ydiff=atom1.y-atom2.y;if(ydiff*=ydiff,ydiff>maxsq)return!1;var zdiff=atom1.z-atom2.z;if(zdiff*=zdiff,zdiff>maxsq)return!1;var distSquared=xdiff+ydiff+zdiff;return isNaN(distSquared)?!1:.5>distSquared?!1:distSquared>maxsq?!1:!0},processSymmetries=function(copyMatrices,copyMatrix,atoms){var t,l,n,end=atoms.length,offset=end;if(copyMatrix){if(copyMatrices.length>1)for(t=0;t<atoms.length;t++){var symmetries=[];for(l=0;l<copyMatrices.length;l++)if(!copyMatrices[l].isIdentity()){var newXYZ=new $3Dmol.Vector3;newXYZ.set(atoms[t].x,atoms[t].y,atoms[t].z),newXYZ.applyMatrix4(copyMatrices[l]),symmetries.push(newXYZ)}atoms[t].symmetries=symmetries}}else for(t=0;t<copyMatrices.length;t++)if(!copyMatrices[t].isIdentity()){var xyz=new $3Dmol.Vector3;for(n=0;end>n;n++){var bondsArr=[];for(l=0;l<atoms[n].bonds.length;l++)bondsArr.push(atoms[n].bonds[l]+offset);xyz.set(atoms[n].x,atoms[n].y,atoms[n].z),xyz.applyMatrix4(copyMatrices[t]);var newAtom={};for(var i in atoms[n])newAtom[i]=atoms[n][i];newAtom.x=xyz.x,newAtom.y=xyz.y,newAtom.z=xyz.z,newAtom.bonds=bondsArr,atoms.push(newAtom)}offset=atoms.length}};return parsers.pdb=parsers.PDB=parsers.pdbqt=parsers.PDBQT=function(str,options){var atom,i,j,line,atoms=[[]],noH=!options.keepH,computeStruct=!options.noSecondaryStructure,noAssembly=!options.doAssembly,copyMatrix=!options.duplicateAssemblyAtoms,modelData=atoms.modelData=[{symmetries:[]}],start=atoms[atoms.length-1].length,protein={sheet:[],helix:[]},hasStruct=!1,serialToIndex=[],lines=str.split(/\r?\n|\r/),seenbonds={};for(i=0;i<lines.length;i++){line=lines[i].replace(/^\s*/,"");var startChain,startResi,endChain,endResi,recordName=line.substr(0,6);if(0==recordName.indexOf("END")){if(options.multimodel){options.onemol||(atoms.push([]),modelData.push({symmetries:[]}));continue}break}if("ATOM  "==recordName||"HETATM"==recordName){var resn,chain,resi,icode,x,y,z,hetflag,elem,serial,altLoc,b;if(altLoc=line.substr(16,1)," "!=altLoc&&"A"!=altLoc)continue;if(serial=parseInt(line.substr(6,5)),atom=line.substr(12,4).replace(/ /g,""),resn=line.substr(17,3).replace(/ /g,""),chain=line.substr(21,1),resi=parseInt(line.substr(22,4)),icode=line.substr(26,1),x=parseFloat(line.substr(30,8)),y=parseFloat(line.substr(38,8)),z=parseFloat(line.substr(46,8)),b=parseFloat(line.substr(60,8)),elem=line.substr(76,2).replace(/ /g,""),""===elem||"undefined"==typeof bondTable[elem]?(elem=line.substr(12,2).replace(/ /g,""),elem.length>0&&"H"==elem[0]&&"Hg"!=elem&&(elem="H"),elem.length>1&&(elem=elem[0].toUpperCase()+elem.substr(1).toLowerCase(),"undefined"==typeof bondTable[elem]?elem=elem[0]:"A"==line[0]&&"Ca"==elem&&(elem="C"))):elem=elem[0].toUpperCase()+elem.substr(1).toLowerCase(),"H"==elem&&noH)continue;hetflag="H"==line[0]?!0:!1,serialToIndex[serial]=atoms[atoms.length-1].length,atoms[atoms.length-1].push({resn:resn,x:x,y:y,z:z,elem:elem,hetflag:hetflag,chain:chain,resi:resi,icode:icode,rescode:resi+(" "!=icode?"^"+icode:""),serial:serial,atom:atom,bonds:[],ss:"c",bondOrder:[],properties:{},b:b,pdbline:line})}else if("SHEET "==recordName)hasStruct=!0,startChain=line.substr(21,1),startResi=parseInt(line.substr(22,4)),endChain=line.substr(32,1),endResi=parseInt(line.substr(33,4)),protein.sheet.push([startChain,startResi,endChain,endResi]);else if("CONECT"==recordName){var from=parseInt(line.substr(6,5)),fromindex=serialToIndex[from],fromAtom=atoms[atoms.length-1][fromindex];for(j=0;4>j;j++){var to=parseInt(line.substr([11,16,21,26][j],5)),toindex=serialToIndex[to],toAtom=atoms[atoms.length-1][toindex];if(void 0!==fromAtom&&void 0!==toAtom)if(seenbonds[[fromindex,toindex]]){seenbonds[[fromindex,toindex]]+=1;for(var bi=0;bi<fromAtom.bonds.length;bi++)if(fromAtom.bonds[bi]==toindex){var newbo=seenbonds[[fromindex,toindex]];newbo>=4?fromAtom.bondOrder[bi]=1:fromAtom.bondOrder[bi]=newbo}}else seenbonds[[fromindex,toindex]]=1,(0==fromAtom.bonds.length||fromAtom.bonds[fromAtom.bonds.length-1]!=toindex)&&(fromAtom.bonds.push(toindex),fromAtom.bondOrder.push(1))}}else if("HELIX "==recordName)hasStruct=!0,startChain=line.substr(19,1),startResi=parseInt(line.substr(21,4)),endChain=line.substr(31,1),endResi=parseInt(line.substr(33,4)),protein.helix.push([startChain,startResi,endChain,endResi]);else if(noAssembly||"REMARK"!=recordName||"BIOMT"!=line.substr(13,5)){if("CRYST1"==recordName){var a,b,c,alpha,beta,gamma;a=parseFloat(line.substr(7,8)),b=parseFloat(line.substr(16,8)),c=parseFloat(line.substr(25,8)),alpha=parseFloat(line.substr(34,6)),beta=parseFloat(line.substr(41,6)),gamma=parseFloat(line.substr(48,6)),modelData[modelData.length-1].cryst={a:a,b:b,c:c,alpha:alpha,beta:beta,gamma:gamma}}}else{var n,matrix=new $3Dmol.Matrix4;for(n=1;3>=n;n++)if(line=lines[i].replace(/^\s*/,""),parseInt(line.substr(18,1))==n)matrix.elements[n-1]=parseFloat(line.substr(23,10)),matrix.elements[n-1+4]=parseFloat(line.substr(33,10)),matrix.elements[n-1+8]=parseFloat(line.substr(43,10)),matrix.elements[n-1+12]=parseFloat(line.substr(53)),i++;else for(;"BIOMT"==line.substr(13,5);)i++,line=lines[i].replace(/^\s*/,"");matrix.elements[3]=0,matrix.elements[7]=0,matrix.elements[11]=0,matrix.elements[15]=1,modelData[modelData.length-1].symmetries.push(matrix),i--}}for(var starttime=(new Date).getTime(),n=0;n<atoms.length;n++)for(assignPDBBonds(atoms[n]),noAssembly||processSymmetries(modelData[modelData.length-1].symmetries,copyMatrix,atoms[n]),(computeStruct||!hasStruct)&&(starttime=(new Date).getTime(),computeSecondaryStructure(atoms[n])),i=start;i<atoms[n].length;i++)if(atom=atoms[n][i],void 0!==atom){for(j=0;j<protein.sheet.length;j++)atom.chain==protein.sheet[j][0]&&(atom.resi<protein.sheet[j][1]||atom.resi>protein.sheet[j][3]||(atom.ss="s",atom.resi==protein.sheet[j][1]&&(atom.ssbegin=!0),atom.resi==protein.sheet[j][3]&&(atom.ssend=!0)));for(j=0;j<protein.helix.length;j++)atom.chain==protein.helix[j][0]&&(atom.resi<protein.helix[j][1]||atom.resi>protein.helix[j][3]||(atom.ss="h",atom.resi==protein.helix[j][1]?atom.ssbegin=!0:atom.resi==protein.helix[j][3]&&(atom.ssend=!0)))}return atoms},parsers.pqr=parsers.PQR=function(str,options){var atom,i,j,line,atoms=[[]],computeStruct=(atoms[atoms.length-1].length,!options.noSecondaryStructure),serialToIndex=[],lines=str.split(/\r?\n|\r/);for(i=0;i<lines.length;i++){line=lines[i].replace(/^\s*/,"");var recordName=line.substr(0,6);if(0==recordName.indexOf("END")){if(options.multimodel){options.onemol||atoms.push([]);continue}break}if("ATOM  "==recordName||"HETATM"==recordName){var serial=parseInt(line.substr(6,5)),atom=line.substr(12,4).replace(/ /g,""),resn=line.substr(17,3),chain=line.substr(21,1),resi=parseInt(line.substr(22,4)),vals=line.substr(30).trim().split(/\s+/),x=parseFloat(vals[0]),y=parseFloat(vals[1]),z=parseFloat(vals[2]),charge=parseFloat(vals[3]),radius=parseFloat(vals[4]),elem=atom[0];atom.length>1&&atom[1].toUpperCase()!=atom[1]&&(elem=atom.substr(0,2)),"H"==line[0]?hetflag=!0:hetflag=!1,serialToIndex[serial]=atoms[atoms.length-1].length,atoms[atoms.length-1].push({resn:resn,x:x,y:y,z:z,elem:elem,hetflag:hetflag,chain:chain,resi:resi,serial:serial,atom:atom,bonds:[],ss:"c",bondOrder:[],properties:{charge:charge,partialCharge:charge,radius:radius},pdbline:line})}else if("CONECT"==recordName){var from=parseInt(line.substr(6,5)),fromAtom=atoms[atoms.length-1][serialToIndex[from]];for(j=0;4>j;j++){var to=parseInt(line.substr([11,16,21,26][j],5)),toAtom=atoms[atoms.length-1][serialToIndex[to]];void 0!==fromAtom&&void 0!==toAtom&&(fromAtom.bonds.push(serialToIndex[to]),fromAtom.bondOrder.push(1))}}}for(var i=0;i<atoms.length;i++)assignPDBBonds(atoms[i]),computeStruct&&computeSecondaryStructure(atoms[i]);return atoms},parsers}();var $3Dmol=$3Dmol||{};$3Dmol.partialCharges={"ALA:N":-.15,"ALA:CA":.1,"ALA:CB":0,"ALA:C":.6,"ALA:O":-.55,"ARG:N":-.15,"ARG:CA":.1,"ARG:CB":0,"ARG:CG":0,"ARG:CD":.1,"ARG:NE":-.1,"ARG:CZ":.5,"ARG:NH1":.25,"ARG:NH2":.25,"ARG:C":.6,"ARG:O":-.55,"ASN:N":-.15,"ASN:CA":.1,"ASN:CB":0,"ASN:CG":.55,"ASN:OD1":-.55,"ASN:ND2":0,"ASN:C":.6,"ASN:O":-.55,"ASP:N":-.15,"ASP:CA":.1,"ASP:CB":0,"ASP:CG":.14,"ASP:OD1":-.57,"ASP:OD2":-.57,"ASP:C":.6,"ASP:O":-.55,"CYS:N":-.15,"CYS:CA":.1,"CYS:CB":.19,"CYS:SG":-.19,"CYS:C":.6,"CYS:O":-.55,"GLN:N":-.15,"GLN:CA":.1,"GLN:CB":0,"GLN:CG":0,"GLN:CD":.55,"GLN:OE1":-.55,"GLN:NE2":0,"GLN:C":.6,"GLN:O":-.55,"GLU:N":-.15,"GLU:CA":.1,"GLU:CB":0,"GLU:CG":0,"GLU:CD":.14,"GLU:OE1":-.57,"GLU:OE2":-.57,"GLU:C":.6,"GLU:O":-.55,"GLY:N":-.15,"GLY:CA":.1,"GLY:C":.6,"GLY:O":-.55,"HIS:N":-.15,"HIS:CA":.1,"HIS:CB":0,"HIS:CG":.1,"HIS:ND1":-.1,"HIS:CD2":.1,"HIS:NE2":-.4,"HIS:CE1":.3,"HIS:C":.6,"HIS:O":-.55,"ILE:N":-.15,"ILE:CA":.1,"ILE:CB":0,"ILE:CG2":0,"ILE:CG1":0,"ILE:CD":0,"ILE:C":.6,"ILE:O":-.55,"LEU:N":-.15,"LEU:CA":.1,"LEU:CB":0,"LEU:CG":0,"LEU:CD1":0,"LEU:CD2":0,"LEU:C":.6,"LEU:O":-.55,"LYS:N":-.15,"LYS:CA":.1,"LYS:CB":0,"LYS:CG":0,"LYS:CD":0,"LYS:CE":.25,"LYS:NZ":.75,"LYS:C":.6,"LYS:O":-.55,"MET:N":-.15,"MET:CA":.1,"MET:CB":0,"MET:CG":.06,"MET:SD":-.12,"MET:CE":.06,"MET:C":.6,"MET:O":-.55,"PHE:N":-.15,"PHE:CA":.1,"PHE:CB":0,"PHE:CG":0,"PHE:CD1":0,"PHE:CD2":0,"PHE:CE1":0,"PHE:CE2":0,"PHE:CZ":0,"PHE:C":.6,"PHE:O":-.55,"PRO:N":-.25,"PRO:CD":.1,"PRO:CA":.1,"PRO:CB":0,"PRO:CG":0,"PRO:C":.6,"PRO:O":-.55,"SER:N":-.15,"SER:CA":.1,"SER:CB":.25,"SER:OG":-.25,"SER:C":.6,"SER:O":-.55,"THR:N":-.15,"THR:CA":.1,"THR:CB":.25,"THR:OG1":-.25,"THR:CG2":0,"THR:C":.6,"THR:O":-.55,"TRP:N":-.15,"TRP:CA":.1,"TRP:CB":0,"TRP:CG":-.03,"TRP:CD2":.1,"TRP:CE2":-.04,"TRP:CE3":-.03,"TRP:CD1":.06,"TRP:NE1":-.06,"TRP:CZ2":0,"TRP:CZ3":0,"TRP:CH2":0,"TRP:C":.6,"TRP:O":-.55,"TYR:N":-.15,"TYR:CA":.1,"TYR:CB":0,"TYR:CG":0,"TYR:CD1":0,"TYR:CE1":0,"TYR:CD2":0,"TYR:CE2":0,"TYR:CZ":.25,"TYR:OH":-.25,"TYR:C":.6,"TYR:O":-.55,"VAL:N":-.15,"VAL:CA":.1,"VAL:CB":0,"VAL:CG1":0,"VAL:CG2":0,"VAL:C":.6,"VAL:O":-.55},$3Dmol.applyPartialCharges=function(atom,keepexisting){if((!keepexisting||"undefined"==typeof atom.partialCharge)&&atom.resn&&atom.atom){var key=atom.resn+":"+atom.atom;atom.properties.partialCharge=$3Dmol.partialCharges[key]}},$3Dmol.VolumeData=function(str,format){this.unit={x:1,y:1,z:1},this.origin={x:0,y:0,z:0},this.size={x:0,y:0,z:0},this.data=new Float32Array([]),format=format.toLowerCase(),this[format]&&this[format](str)},$3Dmol.VolumeData.prototype.getVal=function(x,y,z){return x-=this.origin.x,y-=this.origin.y,z-=this.origin.z,x/=this.unit.x,y/=this.unit.y,z/=this.unit.z,x=Math.round(x),y=Math.round(y),z=Math.round(z),0>x||x>=this.size.x?0:0>y||y>=this.size.y?0:0>z||z>=this.size.z?0:this.data[x*this.size.y*this.size.z+y*this.size.z+z]},$3Dmol.VolumeData.prototype.cube=function(str){var lines=str.replace(/^\s+/,"").split(/[\n\r]+/);if(!(lines.length<6)){var lineArr=lines[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),atomsnum=parseFloat(lineArr[0]),natoms=Math.abs(atomsnum),origin=this.origin=new $3Dmol.Vector3(parseFloat(lineArr[1]),parseFloat(lineArr[2]),parseFloat(lineArr[3]));lineArr=lines[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var convFactor=lineArr[0]>0?.529177:1;
origin.multiplyScalar(convFactor);var nX=Math.abs(lineArr[0]),xVec=new $3Dmol.Vector3(parseFloat(lineArr[1]),parseFloat(lineArr[2]),parseFloat(lineArr[3])).multiplyScalar(convFactor);lineArr=lines[4].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var nY=Math.abs(lineArr[0]),yVec=new $3Dmol.Vector3(parseFloat(lineArr[1]),parseFloat(lineArr[2]),parseFloat(lineArr[3])).multiplyScalar(convFactor);lineArr=lines[5].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var nZ=Math.abs(lineArr[0]),zVec=new $3Dmol.Vector3(parseFloat(lineArr[1]),parseFloat(lineArr[2]),parseFloat(lineArr[3])).multiplyScalar(convFactor);this.size={x:nX,y:nY,z:nZ},this.unit=new $3Dmol.Vector3(xVec.x,yVec.y,zVec.z),(0!=xVec.y||0!=xVec.z||0!=yVec.x||0!=yVec.z||0!=zVec.x||0!=zVec.y)&&console.log("Warning: Cube file is not axis aligned.  This isn't going to look right.");var headerlines=6;0>atomsnum&&headerlines++;var raw=lines.splice(natoms+headerlines).join(" ");raw=raw.replace(/^\s+/,""),raw=raw.split(/[\s\r]+/),this.data=new Float32Array(raw)}},$3Dmol.workerString=function(){self.onmessage=function(oEvent){var obj=oEvent.data,type=obj.type;if(0>type)self.atomData=obj.atoms,self.volume=obj.volume,self.ps=new ProteinSurface;else{var ps=self.ps;ps.initparm(obj.expandedExtent,1==type?!1:!0,self.volume),ps.fillvoxels(self.atomData,obj.extendedAtoms),ps.buildboundary(),(4===type||2===type)&&(ps.fastdistancemap(),ps.boundingatom(!1),ps.fillvoxelswaals(self.atomData,obj.extendedAtoms)),ps.marchingcube(type);var VandF=ps.getFacesAndVertices(obj.atomsToShow);self.postMessage(VandF)}}}.toString().replace(/(^.*?\{|\}$)/g,""),$3Dmol.workerString+="; var ProteinSurface="+$3Dmol.ProteinSurface.toString().replace(/\$3Dmol.MarchingCube./g,"MarchingCube."),$3Dmol.workerString+=",MarchingCube=("+$3Dmol.MarchingCubeInitializer.toString()+")();",$3Dmol.SurfaceWorker=window.URL.createObjectURL(new Blob([$3Dmol.workerString],{type:"text/javascript"})),$3Dmol.workerString=$3Dmol.workerString,$3Dmol.SurfaceWorker=$3Dmol.SurfaceWorker,function(){var a,b,c,d,e,f,g,h,i=[].slice,j={}.hasOwnProperty,k=function(a,b){function c(){this.constructor=a}for(var d in b)j.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};g=function(){},b=function(){function a(){}return a.prototype.addEventListener=a.prototype.on,a.prototype.on=function(a,b){return this._callbacks=this._callbacks||{},this._callbacks[a]||(this._callbacks[a]=[]),this._callbacks[a].push(b),this},a.prototype.emit=function(){var a,b,c,d,e,f;if(d=arguments[0],a=2<=arguments.length?i.call(arguments,1):[],this._callbacks=this._callbacks||{},c=this._callbacks[d])for(e=0,f=c.length;f>e;e++)b=c[e],b.apply(this,a);return this},a.prototype.removeListener=a.prototype.off,a.prototype.removeAllListeners=a.prototype.off,a.prototype.removeEventListener=a.prototype.off,a.prototype.off=function(a,b){var c,d,e,f,g;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;if(d=this._callbacks[a],!d)return this;if(1===arguments.length)return delete this._callbacks[a],this;for(e=f=0,g=d.length;g>f;e=++f)if(c=d[e],c===b){d.splice(e,1);break}return this},a}(),a=function(a){function c(a,b){var e,f,g;if(this.element=a,this.version=c.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");if(c.instances.push(this),this.element.dropzone=this,e=null!=(g=c.optionsForElement(this.element))?g:{},this.options=d({},this.defaultOptions,e,null!=b?b:{}),this.options.forceFallback||!c.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(f=this.getExistingFallback())&&f.parentNode&&f.parentNode.removeChild(f),this.options.previewsContainer!==!1&&(this.previewsContainer=this.options.previewsContainer?c.getElement(this.options.previewsContainer,"previewsContainer"):this.element),this.options.clickable&&(this.clickableElements=this.options.clickable===!0?[this.element]:c.getElements(this.options.clickable,"clickable")),this.init()}var d,e;return k(c,a),c.prototype.Emitter=b,c.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","addedfiles","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],c.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,filesizeBase:1e3,maxFiles:null,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,hiddenInputContainer:"body",capture:null,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",accept:function(a,b){return b()},init:function(){return g},forceFallback:!1,fallback:function(){var a,b,d,e,f,g;for(this.element.className=""+this.element.className+" dz-browser-not-supported",g=this.element.getElementsByTagName("div"),e=0,f=g.length;f>e;e++)a=g[e],/(^| )dz-message($| )/.test(a.className)&&(b=a,a.className="dz-message");return b||(b=c.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(b)),d=b.getElementsByTagName("span")[0],d&&(null!=d.textContent?d.textContent=this.options.dictFallbackMessage:null!=d.innerText&&(d.innerText=this.options.dictFallbackMessage)),this.element.appendChild(this.getFallbackForm())},resize:function(a){var b,c,d;return b={srcX:0,srcY:0,srcWidth:a.width,srcHeight:a.height},c=a.width/a.height,b.optWidth=this.options.thumbnailWidth,b.optHeight=this.options.thumbnailHeight,null==b.optWidth&&null==b.optHeight?(b.optWidth=b.srcWidth,b.optHeight=b.srcHeight):null==b.optWidth?b.optWidth=c*b.optHeight:null==b.optHeight&&(b.optHeight=1/c*b.optWidth),d=b.optWidth/b.optHeight,a.height<b.optHeight||a.width<b.optWidth?(b.trgHeight=b.srcHeight,b.trgWidth=b.srcWidth):c>d?(b.srcHeight=a.height,b.srcWidth=b.srcHeight*d):(b.srcWidth=a.width,b.srcHeight=b.srcWidth/d),b.srcX=(a.width-b.srcWidth)/2,b.srcY=(a.height-b.srcHeight)/2,b},drop:function(){return this.element.classList.remove("dz-drag-hover")},dragstart:g,dragend:function(){return this.element.classList.remove("dz-drag-hover")},dragenter:function(){return this.element.classList.add("dz-drag-hover")},dragover:function(){return this.element.classList.add("dz-drag-hover")},dragleave:function(){return this.element.classList.remove("dz-drag-hover")},paste:g,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(a){var b,d,e,f,g,h,i,j,k,l,m,n,o;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer){for(a.previewElement=c.createElement(this.options.previewTemplate.trim()),a.previewTemplate=a.previewElement,this.previewsContainer.appendChild(a.previewElement),l=a.previewElement.querySelectorAll("[data-dz-name]"),f=0,i=l.length;i>f;f++)b=l[f],b.textContent=a.name;for(m=a.previewElement.querySelectorAll("[data-dz-size]"),g=0,j=m.length;j>g;g++)b=m[g],b.innerHTML=this.filesize(a.size);for(this.options.addRemoveLinks&&(a._removeLink=c.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>"),a.previewElement.appendChild(a._removeLink)),d=function(b){return function(d){return d.preventDefault(),d.stopPropagation(),a.status===c.UPLOADING?c.confirm(b.options.dictCancelUploadConfirmation,function(){return b.removeFile(a)}):b.options.dictRemoveFileConfirmation?c.confirm(b.options.dictRemoveFileConfirmation,function(){return b.removeFile(a)}):b.removeFile(a)}}(this),n=a.previewElement.querySelectorAll("[data-dz-remove]"),o=[],h=0,k=n.length;k>h;h++)e=n[h],o.push(e.addEventListener("click",d));return o}},removedfile:function(a){var b;return a.previewElement&&null!=(b=a.previewElement)&&b.parentNode.removeChild(a.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(a,b){var c,d,e,f;if(a.previewElement){for(a.previewElement.classList.remove("dz-file-preview"),f=a.previewElement.querySelectorAll("[data-dz-thumbnail]"),d=0,e=f.length;e>d;d++)c=f[d],c.alt=a.name,c.src=b;return setTimeout(function(){return function(){return a.previewElement.classList.add("dz-image-preview")}}(this),1)}},error:function(a,b){var c,d,e,f,g;if(a.previewElement){for(a.previewElement.classList.add("dz-error"),"String"!=typeof b&&b.error&&(b=b.error),f=a.previewElement.querySelectorAll("[data-dz-errormessage]"),g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(c.textContent=b);return g}},errormultiple:g,processing:function(a){return a.previewElement&&(a.previewElement.classList.add("dz-processing"),a._removeLink)?a._removeLink.textContent=this.options.dictCancelUpload:void 0},processingmultiple:g,uploadprogress:function(a,b){var c,d,e,f,g;if(a.previewElement){for(f=a.previewElement.querySelectorAll("[data-dz-uploadprogress]"),g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push("PROGRESS"===c.nodeName?c.value=b:c.style.width=""+b+"%");return g}},totaluploadprogress:g,sending:g,sendingmultiple:g,success:function(a){return a.previewElement?a.previewElement.classList.add("dz-success"):void 0},successmultiple:g,canceled:function(a){return this.emit("error",a,"Upload canceled.")},canceledmultiple:g,complete:function(a){return a._removeLink&&(a._removeLink.textContent=this.options.dictRemoveFile),a.previewElement?a.previewElement.classList.add("dz-complete"):void 0},completemultiple:g,maxfilesexceeded:g,maxfilesreached:g,queuecomplete:g,addedfiles:g,previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <div class="dz-details">\n    <div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <div class="dz-success-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Check</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="dz-error-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Error</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">\n          <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" sketch:type="MSShapeGroup"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>'},d=function(){var a,b,c,d,e,f,g;for(d=arguments[0],c=2<=arguments.length?i.call(arguments,1):[],f=0,g=c.length;g>f;f++){b=c[f];for(a in b)e=b[a],d[a]=e}return d},c.prototype.getAcceptedFiles=function(){var a,b,c,d,e;for(d=this.files,e=[],b=0,c=d.length;c>b;b++)a=d[b],a.accepted&&e.push(a);return e},c.prototype.getRejectedFiles=function(){var a,b,c,d,e;for(d=this.files,e=[],b=0,c=d.length;c>b;b++)a=d[b],a.accepted||e.push(a);return e},c.prototype.getFilesWithStatus=function(a){var b,c,d,e,f;for(e=this.files,f=[],c=0,d=e.length;d>c;c++)b=e[c],b.status===a&&f.push(b);return f},c.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(c.QUEUED)},c.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(c.UPLOADING)},c.prototype.getAddedFiles=function(){return this.getFilesWithStatus(c.ADDED)},c.prototype.getActiveFiles=function(){var a,b,d,e,f;for(e=this.files,f=[],b=0,d=e.length;d>b;b++)a=e[b],(a.status===c.UPLOADING||a.status===c.QUEUED)&&f.push(a);return f},c.prototype.init=function(){var a,b,d,e,f,g,h;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(c.createElement('<div class="dz-default dz-message"><span>'+this.options.dictDefaultMessage+"</span></div>")),this.clickableElements.length&&(d=function(a){return function(){return a.hiddenFileInput&&a.hiddenFileInput.parentNode.removeChild(a.hiddenFileInput),a.hiddenFileInput=document.createElement("input"),a.hiddenFileInput.setAttribute("type","file"),(null==a.options.maxFiles||a.options.maxFiles>1)&&a.hiddenFileInput.setAttribute("multiple","multiple"),a.hiddenFileInput.className="dz-hidden-input",null!=a.options.acceptedFiles&&a.hiddenFileInput.setAttribute("accept",a.options.acceptedFiles),null!=a.options.capture&&a.hiddenFileInput.setAttribute("capture",a.options.capture),a.hiddenFileInput.style.visibility="hidden",a.hiddenFileInput.style.position="absolute",a.hiddenFileInput.style.top="0",a.hiddenFileInput.style.left="0",a.hiddenFileInput.style.height="0",a.hiddenFileInput.style.width="0",document.querySelector(a.options.hiddenInputContainer).appendChild(a.hiddenFileInput),a.hiddenFileInput.addEventListener("change",function(){var b,c,e,f;if(c=a.hiddenFileInput.files,c.length)for(e=0,f=c.length;f>e;e++)b=c[e],a.addFile(b);return a.emit("addedfiles",c),d()})}}(this))(),this.URL=null!=(g=window.URL)?g:window.webkitURL,h=this.events,e=0,f=h.length;f>e;e++)a=h[e],this.on(a,this.options[a]);return this.on("uploadprogress",function(a){return function(){return a.updateTotalUploadProgress()}}(this)),this.on("removedfile",function(a){return function(){return a.updateTotalUploadProgress()}}(this)),this.on("canceled",function(a){return function(b){return a.emit("complete",b)}}(this)),this.on("complete",function(a){return function(){return 0===a.getAddedFiles().length&&0===a.getUploadingFiles().length&&0===a.getQueuedFiles().length?setTimeout(function(){return a.emit("queuecomplete")},0):void 0}}(this)),b=function(a){return a.stopPropagation(),a.preventDefault?a.preventDefault():a.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(a){return function(b){return a.emit("dragstart",b)}}(this),dragenter:function(a){return function(c){return b(c),a.emit("dragenter",c)}}(this),dragover:function(a){return function(c){var d;try{d=c.dataTransfer.effectAllowed}catch(e){}return c.dataTransfer.dropEffect="move"===d||"linkMove"===d?"move":"copy",b(c),a.emit("dragover",c)}}(this),dragleave:function(a){return function(b){return a.emit("dragleave",b)}}(this),drop:function(a){return function(c){return b(c),a.drop(c)}}(this),dragend:function(a){return function(b){return a.emit("dragend",b)}}(this)}}],this.clickableElements.forEach(function(a){return function(b){return a.listeners.push({element:b,events:{click:function(d){return(b!==a.element||d.target===a.element||c.elementInside(d.target,a.element.querySelector(".dz-message")))&&a.hiddenFileInput.click(),!0}}})}}(this)),this.enable(),this.options.init.call(this)},c.prototype.destroy=function(){var a;return this.disable(),this.removeAllFiles(!0),(null!=(a=this.hiddenFileInput)?a.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,c.instances.splice(c.instances.indexOf(this),1)},c.prototype.updateTotalUploadProgress=function(){var a,b,c,d,e,f,g,h;if(d=0,c=0,a=this.getActiveFiles(),a.length){for(h=this.getActiveFiles(),f=0,g=h.length;g>f;f++)b=h[f],d+=b.upload.bytesSent,c+=b.upload.total;e=100*d/c}else e=100;return this.emit("totaluploadprogress",e,c,d)},c.prototype._getParamName=function(a){return"function"==typeof this.options.paramName?this.options.paramName(a):""+this.options.paramName+(this.options.uploadMultiple?"["+a+"]":"")},c.prototype.getFallbackForm=function(){var a,b,d,e;return(a=this.getExistingFallback())?a:(d='<div class="dz-fallback">',this.options.dictFallbackText&&(d+="<p>"+this.options.dictFallbackText+"</p>"),d+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',b=c.createElement(d),"FORM"!==this.element.tagName?(e=c.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>'),e.appendChild(b)):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=e?e:b)},c.prototype.getExistingFallback=function(){var a,b,c,d,e,f;for(b=function(a){var b,c,d;for(c=0,d=a.length;d>c;c++)if(b=a[c],/(^| )fallback($| )/.test(b.className))return b},f=["div","form"],d=0,e=f.length;e>d;d++)if(c=f[d],a=b(this.element.getElementsByTagName(c)))return a},c.prototype.setupEventListeners=function(){var a,b,c,d,e,f,g;for(f=this.listeners,g=[],d=0,e=f.length;e>d;d++)a=f[d],g.push(function(){var d,e;d=a.events,e=[];for(b in d)c=d[b],e.push(a.element.addEventListener(b,c,!1));return e}());return g},c.prototype.removeEventListeners=function(){var a,b,c,d,e,f,g;for(f=this.listeners,g=[],d=0,e=f.length;e>d;d++)a=f[d],g.push(function(){var d,e;d=a.events,e=[];for(b in d)c=d[b],e.push(a.element.removeEventListener(b,c,!1));return e}());return g},c.prototype.disable=function(){var a,b,c,d,e;for(this.clickableElements.forEach(function(a){return a.classList.remove("dz-clickable")}),this.removeEventListeners(),d=this.files,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(this.cancelUpload(a));return e},c.prototype.enable=function(){return this.clickableElements.forEach(function(a){return a.classList.add("dz-clickable")}),this.setupEventListeners()},c.prototype.filesize=function(a){var b,c,d,e,f,g,h,i;if(d=0,e="b",a>0){for(g=["TB","GB","MB","KB","b"],c=h=0,i=g.length;i>h;c=++h)if(f=g[c],b=Math.pow(this.options.filesizeBase,4-c)/10,a>=b){d=a/Math.pow(this.options.filesizeBase,4-c),e=f;break}d=Math.round(10*d)/10}return"<strong>"+d+"</strong> "+e},c.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")},c.prototype.drop=function(a){var b,c;a.dataTransfer&&(this.emit("drop",a),b=a.dataTransfer.files,this.emit("addedfiles",b),b.length&&(c=a.dataTransfer.items,c&&c.length&&null!=c[0].webkitGetAsEntry?this._addFilesFromItems(c):this.handleFiles(b)))},c.prototype.paste=function(a){var b,c;return null!=(null!=a&&null!=(c=a.clipboardData)?c.items:void 0)?(this.emit("paste",a),b=a.clipboardData.items,b.length?this._addFilesFromItems(b):void 0):void 0},c.prototype.handleFiles=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this.addFile(b));return e},c.prototype._addFilesFromItems=function(a){var b,c,d,e,f;for(f=[],d=0,e=a.length;e>d;d++)c=a[d],f.push(null!=c.webkitGetAsEntry&&(b=c.webkitGetAsEntry())?b.isFile?this.addFile(c.getAsFile()):b.isDirectory?this._addFilesFromDirectory(b,b.name):void 0:null!=c.getAsFile&&(null==c.kind||"file"===c.kind)?this.addFile(c.getAsFile()):void 0);return f},c.prototype._addFilesFromDirectory=function(a,b){var c,d;return c=a.createReader(),d=function(a){return function(c){var d,e,f;for(e=0,f=c.length;f>e;e++)d=c[e],d.isFile?d.file(function(c){return a.options.ignoreHiddenFiles&&"."===c.name.substring(0,1)?void 0:(c.fullPath=""+b+"/"+c.name,a.addFile(c))}):d.isDirectory&&a._addFilesFromDirectory(d,""+b+"/"+d.name)}}(this),c.readEntries(d,function(a){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(a):void 0})},c.prototype.accept=function(a,b){return a.size>1024*this.options.maxFilesize*1024?b(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(a.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):c.isValidFile(a,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(b(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",a)):this.options.accept.call(this,a,b):b(this.options.dictInvalidFileType)},c.prototype.addFile=function(a){return a.upload={progress:0,total:a.size,bytesSent:0},this.files.push(a),a.status=c.ADDED,this.emit("addedfile",a),this._enqueueThumbnail(a),this.accept(a,function(b){return function(c){return c?(a.accepted=!1,b._errorProcessing([a],c)):(a.accepted=!0,b.options.autoQueue&&b.enqueueFile(a)),b._updateMaxFilesReachedClass()}}(this))},c.prototype.enqueueFiles=function(a){var b,c,d;for(c=0,d=a.length;d>c;c++)b=a[c],this.enqueueFile(b);return null},c.prototype.enqueueFile=function(a){if(a.status!==c.ADDED||a.accepted!==!0)throw new Error("This file can't be queued because it has already been processed or was rejected.");return a.status=c.QUEUED,this.options.autoProcessQueue?setTimeout(function(a){return function(){return a.processQueue()}}(this),0):void 0},c.prototype._thumbnailQueue=[],c.prototype._processingThumbnail=!1,c.prototype._enqueueThumbnail=function(a){return this.options.createImageThumbnails&&a.type.match(/image.*/)&&a.size<=1024*this.options.maxThumbnailFilesize*1024?(this._thumbnailQueue.push(a),setTimeout(function(a){return function(){return a._processThumbnailQueue()}}(this),0)):void 0},c.prototype._processThumbnailQueue=function(){return this._processingThumbnail||0===this._thumbnailQueue.length?void 0:(this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),function(a){return function(){return a._processingThumbnail=!1,a._processThumbnailQueue()}}(this)))},c.prototype.removeFile=function(a){return a.status===c.UPLOADING&&this.cancelUpload(a),this.files=h(this.files,a),this.emit("removedfile",a),0===this.files.length?this.emit("reset"):void 0},c.prototype.removeAllFiles=function(a){var b,d,e,f;for(null==a&&(a=!1),f=this.files.slice(),d=0,e=f.length;e>d;d++)b=f[d],(b.status!==c.UPLOADING||a)&&this.removeFile(b);return null},c.prototype.createThumbnail=function(a,b){var c;return c=new FileReader,c.onload=function(d){return function(){return"image/svg+xml"===a.type?(d.emit("thumbnail",a,c.result),void(null!=b&&b())):d.createThumbnailFromUrl(a,c.result,b)}}(this),c.readAsDataURL(a)},c.prototype.createThumbnailFromUrl=function(a,b,c,d){var e;return e=document.createElement("img"),d&&(e.crossOrigin=d),e.onload=function(b){return function(){var d,g,h,i,j,k,l,m;return a.width=e.width,a.height=e.height,h=b.options.resize.call(b,a),null==h.trgWidth&&(h.trgWidth=h.optWidth),null==h.trgHeight&&(h.trgHeight=h.optHeight),d=document.createElement("canvas"),g=d.getContext("2d"),d.width=h.trgWidth,d.height=h.trgHeight,f(g,e,null!=(j=h.srcX)?j:0,null!=(k=h.srcY)?k:0,h.srcWidth,h.srcHeight,null!=(l=h.trgX)?l:0,null!=(m=h.trgY)?m:0,h.trgWidth,h.trgHeight),i=d.toDataURL("image/png"),b.emit("thumbnail",a,i),null!=c?c():void 0}}(this),null!=c&&(e.onerror=c),e.src=b},c.prototype.processQueue=function(){var a,b,c,d;if(b=this.options.parallelUploads,c=this.getUploadingFiles().length,a=c,!(c>=b)&&(d=this.getQueuedFiles(),d.length>0)){if(this.options.uploadMultiple)return this.processFiles(d.slice(0,b-c));for(;b>a;){if(!d.length)return;this.processFile(d.shift()),a++}}},c.prototype.processFile=function(a){return this.processFiles([a])},c.prototype.processFiles=function(a){var b,d,e;for(d=0,e=a.length;e>d;d++)b=a[d],b.processing=!0,b.status=c.UPLOADING,this.emit("processing",b);return this.options.uploadMultiple&&this.emit("processingmultiple",a),this.uploadFiles(a)},c.prototype._getFilesWithXhr=function(a){var b,c;return c=function(){var c,d,e,f;for(e=this.files,f=[],c=0,d=e.length;d>c;c++)b=e[c],b.xhr===a&&f.push(b);return f}.call(this)},c.prototype.cancelUpload=function(a){var b,d,e,f,g,h,i;if(a.status===c.UPLOADING){for(d=this._getFilesWithXhr(a.xhr),e=0,g=d.length;g>e;e++)b=d[e],b.status=c.CANCELED;for(a.xhr.abort(),f=0,h=d.length;h>f;f++)b=d[f],this.emit("canceled",b);this.options.uploadMultiple&&this.emit("canceledmultiple",d)}else((i=a.status)===c.ADDED||i===c.QUEUED)&&(a.status=c.CANCELED,this.emit("canceled",a),this.options.uploadMultiple&&this.emit("canceledmultiple",[a]));return this.options.autoProcessQueue?this.processQueue():void 0},e=function(){var a,b;return b=arguments[0],a=2<=arguments.length?i.call(arguments,1):[],"function"==typeof b?b.apply(this,a):b},c.prototype.uploadFile=function(a){return this.uploadFiles([a])},c.prototype.uploadFiles=function(a){var b,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;for(w=new XMLHttpRequest,x=0,B=a.length;B>x;x++)b=a[x],b.xhr=w;p=e(this.options.method,a),u=e(this.options.url,a),w.open(p,u,!0),w.withCredentials=!!this.options.withCredentials,s=null,g=function(c){return function(){var d,e,f;for(f=[],d=0,e=a.length;e>d;d++)b=a[d],f.push(c._errorProcessing(a,s||c.options.dictResponseError.replace("{{statusCode}}",w.status),w));return f}}(this),t=function(c){return function(d){var e,f,g,h,i,j,k,l,m;if(null!=d)for(f=100*d.loaded/d.total,g=0,j=a.length;j>g;g++)b=a[g],b.upload={progress:f,total:d.total,bytesSent:d.loaded};else{for(e=!0,f=100,h=0,k=a.length;k>h;h++)b=a[h],(100!==b.upload.progress||b.upload.bytesSent!==b.upload.total)&&(e=!1),b.upload.progress=f,b.upload.bytesSent=b.upload.total;if(e)return}for(m=[],i=0,l=a.length;l>i;i++)b=a[i],m.push(c.emit("uploadprogress",b,f,b.upload.bytesSent));return m}}(this),w.onload=function(b){return function(d){var e;if(a[0].status!==c.CANCELED&&4===w.readyState){if(s=w.responseText,w.getResponseHeader("content-type")&&~w.getResponseHeader("content-type").indexOf("application/json"))try{s=JSON.parse(s)}catch(f){d=f,s="Invalid JSON response from server."}return t(),200<=(e=w.status)&&300>e?b._finished(a,s,d):g()}}}(this),w.onerror=function(){return function(){return a[0].status!==c.CANCELED?g():void 0}}(this),r=null!=(G=w.upload)?G:w,r.onprogress=t,j={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&d(j,this.options.headers);for(h in j)i=j[h],i&&w.setRequestHeader(h,i);if(f=new FormData,this.options.params){H=this.options.params;for(o in H)v=H[o],f.append(o,v)}for(y=0,C=a.length;C>y;y++)b=a[y],this.emit("sending",b,w,f);if(this.options.uploadMultiple&&this.emit("sendingmultiple",a,w,f),"FORM"===this.element.tagName)for(I=this.element.querySelectorAll("input, textarea, select, button"),z=0,D=I.length;D>z;z++)if(l=I[z],m=l.getAttribute("name"),n=l.getAttribute("type"),"SELECT"===l.tagName&&l.hasAttribute("multiple"))for(J=l.options,A=0,E=J.length;E>A;A++)q=J[A],q.selected&&f.append(m,q.value);else(!n||"checkbox"!==(K=n.toLowerCase())&&"radio"!==K||l.checked)&&f.append(m,l.value);for(k=F=0,L=a.length-1;L>=0?L>=F:F>=L;k=L>=0?++F:--F)f.append(this._getParamName(k),a[k],a[k].name);return this.submitRequest(w,f,a)},c.prototype.submitRequest=function(a,b){return a.send(b)},c.prototype._finished=function(a,b,d){var e,f,g;for(f=0,g=a.length;g>f;f++)e=a[f],e.status=c.SUCCESS,this.emit("success",e,b,d),this.emit("complete",e);return this.options.uploadMultiple&&(this.emit("successmultiple",a,b,d),this.emit("completemultiple",a)),this.options.autoProcessQueue?this.processQueue():void 0},c.prototype._errorProcessing=function(a,b,d){var e,f,g;for(f=0,g=a.length;g>f;f++)e=a[f],e.status=c.ERROR,this.emit("error",e,b,d),this.emit("complete",e);return this.options.uploadMultiple&&(this.emit("errormultiple",a,b,d),this.emit("completemultiple",a)),this.options.autoProcessQueue?this.processQueue():void 0},c}(b),a.version="4.2.0",a.options={},a.optionsForElement=function(b){return b.getAttribute("id")?a.options[c(b.getAttribute("id"))]:void 0},a.instances=[],a.forElement=function(a){if("string"==typeof a&&(a=document.querySelector(a)),null==(null!=a?a.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return a.dropzone},a.autoDiscover=!0,a.discover=function(){var b,c,d,e,f,g;for(document.querySelectorAll?d=document.querySelectorAll(".dropzone"):(d=[],b=function(a){var b,c,e,f;for(f=[],c=0,e=a.length;e>c;c++)b=a[c],f.push(/(^| )dropzone($| )/.test(b.className)?d.push(b):void 0);return f},b(document.getElementsByTagName("div")),b(document.getElementsByTagName("form"))),g=[],e=0,f=d.length;f>e;e++)c=d[e],g.push(a.optionsForElement(c)!==!1?new a(c):void 0);return g},a.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],a.isBrowserSupported=function(){
var b,c,d,e,f;if(b=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(f=a.blacklistedBrowsers,d=0,e=f.length;e>d;d++)c=f[d],c.test(navigator.userAgent)&&(b=!1);else b=!1;else b=!1;return b},h=function(a,b){var c,d,e,f;for(f=[],d=0,e=a.length;e>d;d++)c=a[d],c!==b&&f.push(c);return f},c=function(a){return a.replace(/[\-_](\w)/g,function(a){return a.charAt(1).toUpperCase()})},a.createElement=function(a){var b;return b=document.createElement("div"),b.innerHTML=a,b.childNodes[0]},a.elementInside=function(a,b){if(a===b)return!0;for(;a=a.parentNode;)if(a===b)return!0;return!1},a.getElement=function(a,b){var c;if("string"==typeof a?c=document.querySelector(a):null!=a.nodeType&&(c=a),null==c)throw new Error("Invalid `"+b+"` option provided. Please provide a CSS selector or a plain HTML element.");return c},a.getElements=function(a,b){var c,d,e,f,g,h,i,j;if(a instanceof Array){e=[];try{for(f=0,h=a.length;h>f;f++)d=a[f],e.push(this.getElement(d,b))}catch(k){c=k,e=null}}else if("string"==typeof a)for(e=[],j=document.querySelectorAll(a),g=0,i=j.length;i>g;g++)d=j[g],e.push(d);else null!=a.nodeType&&(e=[a]);if(null==e||!e.length)throw new Error("Invalid `"+b+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return e},a.confirm=function(a,b,c){return window.confirm(a)?b():null!=c?c():void 0},a.isValidFile=function(a,b){var c,d,e,f,g;if(!b)return!0;for(b=b.split(","),d=a.type,c=d.replace(/\/.*$/,""),f=0,g=b.length;g>f;f++)if(e=b[f],e=e.trim(),"."===e.charAt(0)){if(-1!==a.name.toLowerCase().indexOf(e.toLowerCase(),a.name.length-e.length))return!0}else if(/\/\*$/.test(e)){if(c===e.replace(/\/.*$/,""))return!0}else if(d===e)return!0;return!1},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(b){return this.each(function(){return new a(this,b)})}),"undefined"!=typeof module&&null!==module?module.exports=a:window.Dropzone=a,a.ADDED="added",a.QUEUED="queued",a.ACCEPTED=a.QUEUED,a.UPLOADING="uploading",a.PROCESSING=a.UPLOADING,a.CANCELED="canceled",a.ERROR="error",a.SUCCESS="success",e=function(a){var b,c,d,e,f,g,h,i,j,k;for(h=a.naturalWidth,g=a.naturalHeight,c=document.createElement("canvas"),c.width=1,c.height=g,d=c.getContext("2d"),d.drawImage(a,0,0),e=d.getImageData(0,0,1,g).data,k=0,f=g,i=g;i>k;)b=e[4*(i-1)+3],0===b?f=i:k=i,i=f+k>>1;return j=i/g,0===j?1:j},f=function(a,b,c,d,f,g,h,i,j,k){var l;return l=e(b),a.drawImage(b,c,d,f,g,h,i,j,k/l)},d=function(a,b){var c,d,e,f,g,h,i,j,k;if(e=!1,k=!0,d=a.document,j=d.documentElement,c=d.addEventListener?"addEventListener":"attachEvent",i=d.addEventListener?"removeEventListener":"detachEvent",h=d.addEventListener?"":"on",f=function(c){return"readystatechange"!==c.type||"complete"===d.readyState?(("load"===c.type?a:d)[i](h+c.type,f,!1),!e&&(e=!0)?b.call(a,c.type||c):void 0):void 0},g=function(){var a;try{j.doScroll("left")}catch(b){return a=b,void setTimeout(g,50)}return f("poll")},"complete"!==d.readyState){if(d.createEventObject&&j.doScroll){try{k=!a.frameElement}catch(l){}k&&g()}return d[c](h+"DOMContentLoaded",f,!1),d[c](h+"readystatechange",f,!1),a[c](h+"load",f,!1)}},a._autoDiscoverFunction=function(){return a.autoDiscover?a.discover():void 0},d(window,a._autoDiscoverFunction)}.call(this);